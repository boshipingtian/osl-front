(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9712],{81618:function(et){"use strict";(function(I,T){et.exports=T()})(this,function(){function I(K){var ne=[];return K.AMapUI&&ne.push(T(K.AMapUI)),K.Loca&&ne.push(W(K.Loca)),Promise.all(ne)}function T(K){return new Promise(function(ne,le){var pe=[];if(K.plugins)for(var xe=0;xe<K.plugins.length;xe+=1)$.AMapUI.plugins.indexOf(K.plugins[xe])==-1&&pe.push(K.plugins[xe]);if(k.AMapUI===A.failed)le("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(k.AMapUI===A.notload){k.AMapUI=A.loading,$.AMapUI.version=K.version||$.AMapUI.version,xe=$.AMapUI.version;var it=document.body||document.head,nt=document.createElement("script");nt.type="text/javascript",nt.src="https://webapi.amap.com/ui/"+xe+"/main.js",nt.onerror=function(we){k.AMapUI=A.failed,le("\u8BF7\u6C42 AMapUI \u5931\u8D25")},nt.onload=function(){if(k.AMapUI=A.loaded,pe.length)window.AMapUI.loadUI(pe,function(){for(var we=0,Ke=pe.length;we<Ke;we++){var ke=pe[we].split("/").slice(-1)[0];window.AMapUI[ke]=arguments[we]}for(ne();L.AMapUI.length;)L.AMapUI.splice(0,1)[0]()});else for(ne();L.AMapUI.length;)L.AMapUI.splice(0,1)[0]()},it.appendChild(nt)}else k.AMapUI===A.loaded?K.version&&K.version!==$.AMapUI.version?le("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):pe.length?window.AMapUI.loadUI(pe,function(){for(var we=0,Ke=pe.length;we<Ke;we++){var ke=pe[we].split("/").slice(-1)[0];window.AMapUI[ke]=arguments[we]}ne()}):ne():K.version&&K.version!==$.AMapUI.version?le("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):L.AMapUI.push(function(we){we?le(we):pe.length?window.AMapUI.loadUI(pe,function(){for(var Ke=0,ke=pe.length;Ke<ke;Ke++){var Oe=pe[Ke].split("/").slice(-1)[0];window.AMapUI[Oe]=arguments[Ke]}ne()}):ne()})})}function W(K){return new Promise(function(ne,le){if($.AMap.version.startsWith("2.0"))le("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(k.Loca===A.failed)le("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(k.Loca===A.notload){k.Loca=A.loading,$.Loca.version=K.version||$.Loca.version;var pe=$.Loca.version,xe=$.key,it=document.body||document.head,nt=document.createElement("script");nt.type="text/javascript",nt.src="https://webapi.amap.com/loca?v="+pe+"&key="+xe,nt.onerror=function(we){k.Loca=A.failed,le("\u8BF7\u6C42 AMapUI \u5931\u8D25")},nt.onload=function(){for(k.Loca=A.loaded,ne();L.Loca.length;)L.Loca.splice(0,1)[0]()},it.appendChild(nt)}else k.Loca===A.loaded?K.version&&K.version!==$.Loca.version?le("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):ne():K.version&&K.version!==$.Loca.version?le("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):L.Loca.push(function(we){we?le(we):le()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var A;(function(K){K.notload="notload",K.loading="loading",K.loaded="loaded",K.failed="failed"})(A||(A={}));var $={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},k={AMap:A.notload,AMapUI:A.notload,Loca:A.notload},L={AMap:[],AMapUI:[],Loca:[]},U=[],re=function(K){typeof K=="function"&&(k.AMap===A.loaded?K(window.AMap):U.push(K))};return{load:function(K){return new Promise(function(ne,le){if(k.AMap==A.failed)le("");else if(k.AMap==A.notload){var pe=K.key,xe=K.version,it=K.plugins;pe?(window.AMap&&location.host!=="lbs.amap.com"&&le("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),$.key=pe,$.AMap.version=xe||$.AMap.version,$.AMap.plugins=it||$.AMap.plugins,k.AMap=A.loading,xe=document.body||document.head,window.___onAPILoaded=function(we){if(delete window.___onAPILoaded,we)k.AMap=A.failed,le(we);else for(k.AMap=A.loaded,I(K).then(function(){ne(window.AMap)}).catch(le);U.length;)U.splice(0,1)[0]()},it=document.createElement("script"),it.type="text/javascript",it.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+$.AMap.version+"&key="+pe+"&plugin="+$.AMap.plugins.join(","),it.onerror=function(we){k.AMap=A.failed,le(we)},xe.appendChild(it)):le("\u8BF7\u586B\u5199key")}else if(k.AMap==A.loaded)if(K.key&&K.key!==$.key)le("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(K.version&&K.version!==$.AMap.version)le("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(pe=[],K.plugins)for(xe=0;xe<K.plugins.length;xe+=1)$.AMap.plugins.indexOf(K.plugins[xe])==-1&&pe.push(K.plugins[xe]);pe.length?window.AMap.plugin(pe,function(){I(K).then(function(){ne(window.AMap)}).catch(le)}):I(K).then(function(){ne(window.AMap)}).catch(le)}else if(K.key&&K.key!==$.key)le("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(K.version&&K.version!==$.AMap.version)le("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var nt=[];if(K.plugins)for(xe=0;xe<K.plugins.length;xe+=1)$.AMap.plugins.indexOf(K.plugins[xe])==-1&&nt.push(K.plugins[xe]);re(function(){nt.length?window.AMap.plugin(nt,function(){I(K).then(function(){ne(window.AMap)}).catch(le)}):I(K).then(function(){ne(window.AMap)}).catch(le)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,$={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},k={AMap:A.notload,AMapUI:A.notload,Loca:A.notload},L={AMap:[],AMapUI:[],Loca:[]}}}})},6265:function(et,I,T){"use strict";T.d(I,{MK:function(){return LP},Ie:function(){return M5},Jx:function(){return H5}});var W={};T.r(W),T.d(W,{add:function(){return Ne},adjoint:function(){return st},clone:function(){return wt},copy:function(){return tr},create:function(){return He},determinant:function(){return or},equals:function(){return ue},exactEquals:function(){return N},frob:function(){return Ye},fromQuat:function(){return Zi},fromQuat2:function(){return Ti},fromRotation:function(){return Ir},fromRotationTranslation:function(){return tn},fromRotationTranslationScale:function(){return Mi},fromRotationTranslationScaleOrigin:function(){return Di},fromScaling:function(){return Or},fromTranslation:function(){return Jt},fromValues:function(){return yt},fromXRotation:function(){return en},fromYRotation:function(){return An},fromZRotation:function(){return Un},frustum:function(){return vi},getRotation:function(){return pi},getScaling:function(){return Ei},getTranslation:function(){return jn},identity:function(){return Kt},invert:function(){return ht},lookAt:function(){return mi},mul:function(){return _e},multiply:function(){return Bt},multiplyScalar:function(){return on},multiplyScalarAndAdd:function(){return q},ortho:function(){return qr},orthoNO:function(){return Rr},orthoZO:function(){return Pn},perspective:function(){return Oi},perspectiveFromFieldOfView:function(){return Ri},perspectiveNO:function(){return jr},perspectiveZO:function(){return bn},rotate:function(){return Yt},rotateX:function(){return Nr},rotateY:function(){return Mr},rotateZ:function(){return $t},scale:function(){return Xt},set:function(){return Qt},str:function(){return te},sub:function(){return We},subtract:function(){return nr},targetTo:function(){return au},translate:function(){return Ot},transpose:function(){return br}});var A={};T.r(A),T.d(A,{add:function(){return rA},angle:function(){return zm},bezier:function(){return pA},ceil:function(){return nA},clone:function(){return JC},copy:function(){return eA},create:function(){return Bh},cross:function(){return gy},dist:function(){return MA},distance:function(){return hy},div:function(){return TA},divide:function(){return fy},dot:function(){return vy},equals:function(){return AA},exactEquals:function(){return CA},floor:function(){return iA},forEach:function(){return wA},fromValues:function(){return uo},hermite:function(){return dA},inverse:function(){return fA},len:function(){return RA},length:function(){return sy},lerp:function(){return hA},max:function(){return oA},min:function(){return aA},mul:function(){return bA},multiply:function(){return cy},negate:function(){return cA},normalize:function(){return Zh},random:function(){return vA},rotateX:function(){return _A},rotateY:function(){return yA},rotateZ:function(){return EA},round:function(){return uA},scale:function(){return sA},scaleAndAdd:function(){return lA},set:function(){return tA},sqrDist:function(){return OA},sqrLen:function(){return PA},squaredDistance:function(){return dy},squaredLength:function(){return py},str:function(){return SA},sub:function(){return Hm},subtract:function(){return ly},transformMat3:function(){return mA},transformMat4:function(){return $0},transformQuat:function(){return gA},zero:function(){return xA}});var $=T(67294),k=(0,$.createContext)({});function L(){return(0,$.useContext)(k)}var U={},re={},K=function(r){return re[r]},ne=function(r,t){re[r]=t},le=function(r){return U[r]},pe=function(r,t){U[r]=t},xe={},it={},nt=34,we=10,Ke=13;function ke(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function Oe(e,r){var t=ke(e);return function(n,i){return r(t(n),i,e)}}function Re(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function Je(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function O(e){return e<0?"-"+Je(-e,6):e>9999?"+"+Je(e,6):Je(e,4)}function at(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":O(e.getUTCFullYear(),4)+"-"+Je(e.getUTCMonth()+1,2)+"-"+Je(e.getUTCDate(),2)+(i?"T"+Je(r,2)+":"+Je(t,2)+":"+Je(n,2)+"."+Je(i,3)+"Z":n?"T"+Je(r,2)+":"+Je(t,2)+":"+Je(n,2)+"Z":t||r?"T"+Je(r,2)+":"+Je(t,2)+"Z":"")}function Pe(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(g,y){var E,b,w=i(g,function(F,ee){if(E)return E(F,ee-1);b=F,E=y?Oe(F,y):ke(F)});return w.columns=b||[],w}function i(g,y){var E=[],b=g.length,w=0,F=0,ee,se=b<=0,ge=!1;g.charCodeAt(b-1)===we&&--b,g.charCodeAt(b-1)===Ke&&--b;function Ee(){if(se)return it;if(ge)return ge=!1,xe;var Ve,rt=w,Et;if(g.charCodeAt(rt)===nt){for(;w++<b&&g.charCodeAt(w)!==nt||g.charCodeAt(++w)===nt;);return(Ve=w)>=b?se=!0:(Et=g.charCodeAt(w++))===we?ge=!0:Et===Ke&&(ge=!0,g.charCodeAt(w)===we&&++w),g.slice(rt+1,Ve-1).replace(/""/g,'"')}for(;w<b;){if((Et=g.charCodeAt(Ve=w++))===we)ge=!0;else if(Et===Ke)ge=!0,g.charCodeAt(w)===we&&++w;else if(Et!==t)continue;return g.slice(rt,Ve)}return se=!0,g.slice(rt,b)}for(;(ee=Ee())!==it;){for(var je=[];ee!==xe&&ee!==it;)je.push(ee),ee=Ee();y&&(je=y(je,F++))==null||E.push(je)}return E}function a(g,y){return g.map(function(E){return y.map(function(b){return d(E[b])}).join(e)})}function o(g,y){return y==null&&(y=Re(g)),[y.map(d).join(e)].concat(a(g,y)).join(`
`)}function s(g,y){return y==null&&(y=Re(g)),a(g,y).join(`
`)}function l(g){return g.map(h).join(`
`)}function h(g){return g.map(d).join(e)}function d(g){return g==null?"":g instanceof Date?at(g):r.test(g+="")?'"'+g.replace(/"/g,'""')+'"':g}return{parse:n,parseRows:i,format:o,formatBody:s,formatRows:l,formatRow:h,formatValue:d}}var ve=Pe(","),Be=ve.parse,Ae=ve.parseRows,ct=ve.format,ut=ve.formatBody,St=ve.formatRows,Tt=ve.formatRow,Q=ve.formatValue,p=T(96156),B=T(85061),be=T(38163),Te=T.n(be);function Ge(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function $e(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ge(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ge(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Mt(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,o=r.coordinates,s=[];return e.forEach(function(l,h){var d=[];if(t&&n&&(d=[parseFloat(l[t]),parseFloat(l[n])]),t&&n&&i&&a){var g=[parseFloat(l[t]),parseFloat(l[n])],y=[parseFloat(l[i]),parseFloat(l[a])];d=[g,y]}if(o){var E="Polygon";Array.isArray(o[0])||(E="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(E="LineString");var b={type:E,coordinates:(0,B.Z)(l[o])};Te()(b,!0),d=b.coordinates}var w=$e($e({},l),{},{_id:h,coordinates:d});s.push(w)}),{dataArray:s}}var Sr=[{lng1:100,lat1:30,lng2:130,lat2:30}],gr={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function sn(e,r){var t=Be(e);return Mt(t,r)}var Cr=63710088e-1,Br={centimeters:Cr*100,centimetres:Cr*100,degrees:Cr/111325,feet:Cr*3.28084,inches:Cr*39.37,kilometers:Cr/1e3,kilometres:Cr/1e3,meters:Cr,metres:Cr,miles:Cr/1609.344,millimeters:Cr*1e3,millimetres:Cr*1e3,nauticalmiles:Cr/1852,radians:1,yards:Cr*1.0936},Zr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Cr,yards:1.0936133},kr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Jn(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function Tn(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return rn(r).geometry;case"LineString":return si(r).geometry;case"Polygon":return Gr(r).geometry;case"MultiPoint":return On(r).geometry;case"MultiLineString":return _n(r).geometry;case"MultiPolygon":return cn(r).geometry;default:throw new Error(e+" is invalid")}}function rn(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Tr(e[0])||!Tr(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Jn(n,r,t)}function En(e,r,t){return t===void 0&&(t={}),Nn(e.map(function(n){return rn(n,r)}),t)}function Gr(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:e};return Jn(s,r,t)}function Fn(e,r,t){return t===void 0&&(t={}),Nn(e.map(function(n){return Gr(n,r)}),t)}function si(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Jn(n,r,t)}function zn(e,r,t){return t===void 0&&(t={}),Nn(e.map(function(n){return si(n,r)}),t)}function Nn(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function _n(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return Jn(n,r,t)}function On(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return Jn(n,r,t)}function cn(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return Jn(n,r,t)}function Aa(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return Jn(n,r,t)}function j(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function Hr(e,r){r===void 0&&(r="kilometers");var t=Br[r];if(!t)throw new Error(r+" units is invalid");return e*t}function ri(e,r){r===void 0&&(r="kilometers");var t=Br[r];if(!t)throw new Error(r+" units is invalid");return e/t}function fu(e,r){return dt(ri(e,r))}function qe(e){var r=e%360;return r<0&&(r+=360),r}function dt(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Nt(e){var r=e%360;return r*Math.PI/180}function ar(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Hr(ri(e,r),t)}function yr(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=kr[r];if(!n)throw new Error("invalid original units");var i=kr[t];if(!i)throw new Error("invalid final units");return e/n*i}function Tr(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function $r(e){return!!e&&e.constructor===Object}function Vr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Tr(r))throw new Error("bbox must only contain numbers")})}function vr(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ln(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fn(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ni(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ni(e[0]);throw new Error("coordinates must only contain numbers")}function hu(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function da(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function ni(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function lo(e){return e.type==="Feature"?e.geometry:e}function gl(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function To(e,r,t){if(e!==null)for(var n,i,a,o,s,l,h,d=0,g=0,y,E=e.type,b=E==="FeatureCollection",w=E==="Feature",F=b?e.features.length:1,ee=0;ee<F;ee++){h=b?e.features[ee].geometry:w?e.geometry:e,y=h?h.type==="GeometryCollection":!1,s=y?h.geometries.length:1;for(var se=0;se<s;se++){var ge=0,Ee=0;if(o=y?h.geometries[se]:h,o!==null){l=o.coordinates;var je=o.type;switch(d=t&&(je==="Polygon"||je==="MultiPolygon")?1:0,je){case null:break;case"Point":if(r(l,g,ee,ge,Ee)===!1)return!1;g++,ge++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(r(l[n],g,ee,ge,Ee)===!1)return!1;g++,je==="MultiPoint"&&ge++}je==="LineString"&&ge++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-d;i++){if(r(l[n][i],g,ee,ge,Ee)===!1)return!1;g++}je==="MultiLineString"&&ge++,je==="Polygon"&&Ee++}je==="Polygon"&&ge++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(Ee=0,i=0;i<l[n].length;i++){for(a=0;a<l[n][i].length-d;a++){if(r(l[n][i][a],g,ee,ge,Ee)===!1)return!1;g++}Ee++}ge++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(To(o.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ms(e,r,t,n){var i=t;return To(e,function(a,o,s,l,h){o===0&&t===void 0?i=a:i=r(i,a,o,s,l,h)},n),i}function Os(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function du(e,r,t){var n=t;return Os(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function ki(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function _l(e,r,t){var n=t;return ki(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function oc(e){var r=[];return To(e,function(t){r.push(t)}),r}function Vo(e,r){var t,n,i,a,o,s,l,h,d,g,y=0,E=e.type==="FeatureCollection",b=e.type==="Feature",w=E?e.features.length:1;for(t=0;t<w;t++){for(s=E?e.features[t].geometry:b?e.geometry:e,h=E?e.features[t].properties:b?e.properties:{},d=E?e.features[t].bbox:b?e.bbox:void 0,g=E?e.features[t].id:b?e.id:void 0,l=s?s.type==="GeometryCollection":!1,o=l?s.geometries.length:1,i=0;i<o;i++){if(a=l?s.geometries[i]:s,a===null){if(r(null,y,h,d,g)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,y,h,d,g)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],y,h,d,g)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}y++}}function yl(e,r,t){var n=t;return Vo(e,function(i,a,o,s,l){a===0&&t===void 0?n=i:n=r(n,i,a,o,s,l)}),n}function ja(e,r){Vo(e,function(t,n,i,a,o){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return r(Jn(t,i,{bbox:a,id:o}),n,0)===!1?!1:void 0}var l;switch(s){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var h=0;h<t.coordinates.length;h++){var d=t.coordinates[h],g={type:l,coordinates:d};if(r(Jn(g,i),n,h)===!1)return!1}})}function Fr(e,r,t){var n=t;return ja(e,function(i,a,o){a===0&&o===0&&t===void 0?n=i:n=r(n,i,a,o)}),n}function Qi(e,r){ja(e,function(t,n,i){var a=0;if(!!t.geometry){var o=t.geometry.type;if(!(o==="Point"||o==="MultiPoint")){var s,l=0,h=0,d=0;if(To(t,function(g,y,E,b,w){if(s===void 0||n>l||b>h||w>d){s=g,l=n,h=b,d=w,a=0;return}var F=lineString([s,g],t.properties);if(r(F,n,i,w,a)===!1)return!1;a++,s=g})===!1)return!1}}})}function zu(e,r,t){var n=t,i=!1;return Qi(e,function(a,o,s,l,h){i===!1&&t===void 0?n=a:n=r(n,a,o,s,l,h),i=!0}),n}function Hu(e,r){if(!e)throw new Error("geojson is required");ja(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,o=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(r(lineString(o[s],t.properties),n,i,s)===!1)return!1;break}}})}function Rs(e,r,t){var n=t;return Hu(e,function(i,a,o,s){a===0&&t===void 0?n=i:n=r(n,i,a,o,s)}),n}function $n(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,o=r.properties,s;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),o=o||e.features[t].properties,s=e.features[t].geometry;break;case"Feature":o=o||e.properties,s=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=e;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var l=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=l.length+a-1),lineString([l[a],l[a+1]],o,r);case"Polygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a-1),lineString([l[i][a],l[i][a+1]],o,r);case"MultiLineString":return n<0&&(n=l.length+n),a<0&&(a=l[n].length+a-1),lineString([l[n][a],l[n][a+1]],o,r);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),a<0&&(a=l[n][i].length-a-1),lineString([l[n][i][a],l[n][i][a+1]],o,r)}throw new Error("geojson is invalid")}function El(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,o=r.properties,s;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),o=o||e.features[t].properties,s=e.features[t].geometry;break;case"Feature":o=o||e.properties,s=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=e;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var l=s.coordinates;switch(s.type){case"Point":return point(l,o,r);case"MultiPoint":return n<0&&(n=l.length+n),point(l[n],o,r);case"LineString":return a<0&&(a=l.length+a),point(l[a],o,r);case"Polygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),point(l[i][a],o,r);case"MultiLineString":return n<0&&(n=l.length+n),a<0&&(a=l[n].length+a),point(l[n][a],o,r);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),a<0&&(a=l[n][i].length-a),point(l[n][i][a],o,r)}throw new Error("geojson is invalid")}function ju(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Vu(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ju(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ju(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Wu(e,r){var t=[],n={};if(e.features=e.features.filter(function(a){var o=a.geometry;return a!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),Te()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var i=0;return ja(e,function(a,o){var s=fn(a),l=o,h=Vu(Vu({},a.properties),{},{coordinates:s,_id:l});t.push(h)}),{dataArray:t,featureKeys:n}}function xl(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function pu(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}var Rn=T(28481),Va="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function pa(e){this.message=e}pa.prototype=new Error,pa.prototype.name="InvalidCharacterError";function va(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new pa("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,i,a,o=0;a=r.charAt(o++);~a&&(i=n%4?i*64+a:a,n++%4)?t+=String.fromCharCode(255&i>>(-2*n&6)):0)a=Va.indexOf(a);return t}function nn(e){e=String(e);for(var r,t,n,i,a="",o=0,s=e.length%3;o<e.length;){if((t=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");r=t<<16|n<<8|i,a+=Va.charAt(r>>18&63)+Va.charAt(r>>12&63)+Va.charAt(r>>6&63)+Va.charAt(r&63)}return s?a.slice(0,s-3)+"===".substring(s):a}var ft=T(6610),mt=T(5991),Xu=function(){function e(r,t){(0,ft.Z)(this,e),this.buffers=r,this.type=t}return(0,mt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,i){throw new Error("not implemented")}}]),e}(),Ui;typeof window=="undefined"?Ui={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(r){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(r){return null},clearMeasures:function(r){return null},clearMarks:function(r){return null},measure:function(r,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(r){return!0},Event:function(r,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ui=window;var Wo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Gi=Wo?my.getSystemInfoSync().pixelRatio:Ui.devicePixelRatio,lr=T(10379),cr=T(46070),Xe=T(77608),Bi=(0,mt.Z)(function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"cancelBubble",void 0),(0,p.Z)(this,"cancelable",void 0),(0,p.Z)(this,"target",void 0),(0,p.Z)(this,"currentTarget",void 0),(0,p.Z)(this,"preventDefault",void 0),(0,p.Z)(this,"stopPropagation",void 0),(0,p.Z)(this,"type",void 0),(0,p.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=r,this.timeStamp=Date.now()}),z=T(63349);function zi(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yu(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function Yu(e,r){if(!!e){if(typeof e=="string")return co(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return co(e,r)}}function co(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Ji=new WeakMap,Hi=function(){function e(){(0,ft.Z)(this,e),Ji.set(this,{})}return(0,mt.Z)(e,[{key:"addEventListener",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Ji.get(this);a||(a={}),a[t]||(a[t]=[]),a[t].push(n),Ji.set(this,a),i.capture,i.once,i.passive}},{key:"removeEventListener",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Ji.get(this);if(a){var o=a[t];if(o&&o.length>0){for(var s=o.length;s--;s>0)if(o[s]===n){o.splice(s,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=Ji.get(this)[t.type];if(n){var i=zi(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o(t)}}catch(s){i.e(s)}finally{i.f()}}}}]),e}();function Wa(e){var r=ba();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function ba(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xo=function(e){(0,lr.Z)(t,e);var r=Wa(t);function t(){var n;return(0,ft.Z)(this,t),n=r.call(this),(0,p.Z)((0,z.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,mt.Z)(t,[{key:"appendChild",value:function(i){this.childNodes.push(i)}},{key:"cloneNode",value:function(){var i=Object.create(this);return Object.assign(i,this),i}},{key:"removeChild",value:function(i){var a=this.childNodes.findIndex(function(o){return o===i});return a>-1?this.childNodes.splice(a,1):null}}]),t}(Hi);function Yo(e){var r=Xa();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Xa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yi=function(e){(0,lr.Z)(t,e);var r=Yo(t);function t(){var n;return(0,ft.Z)(this,t),n=r.call(this),(0,p.Z)((0,z.Z)(n),"className",void 0),(0,p.Z)((0,z.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,mt.Z)(t,[{key:"setAttribute",value:function(i,a){this[i]=a}},{key:"getAttribute",value:function(i){return this[i]}},{key:"setAttributeNS",value:function(i,a){this[i]=a}},{key:"getAttributeNS",value:function(i){return this[i]}}]),t}(Xo),Hn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,$o,Ya,Ta,Mo;if(Hn){var ma=my.getSystemInfoSync();$o=ma.screenWidth,Ya=ma.screenHeight,Ta=ma.windowWidth,Mo=ma.windowHeight}else{var ji=Ui.innerWidth,D=Ui.innerHeight;$o=ji,Ya=D,Ta=ji,Mo=D}var V={width:$o,height:Ya,availWidth:Ta,availHeight:Mo,availLeft:0,availTop:0},he=V.availWidth,Ue=V.availHeight,Zt={style:[]};function mr(e,r){if(!("parentNode"in e)){var t;r===0?t=function(){return null}:r===1?t=function(){return Zt}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;r===0?n=function(){return null}:r===1?n=function(){return Zt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function hn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:he+"px",height:Ue+"px",margin:"0px",padding:"0px"})}function li(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=he,e.clientHeight=Ue),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var r={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return r})}function ii(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=he,e.offsetHeight=Ue)}function Kn(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=he,e.scrollHeight=Ue)}function Vi(e){var r=function(){return!0};e.classList=[],e.classList.add=r,e.classList.remove=r,e.classList.contains=r,e.classList.toggle=r}function Sl(e){var r=$a();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function $a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ga(){}var Wi=function(e){(0,lr.Z)(t,e);var r=Sl(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0;return(0,ft.Z)(this,t),n=r.call(this),(0,p.Z)((0,z.Z)(n),"className",void 0),(0,p.Z)((0,z.Z)(n),"children",void 0),(0,p.Z)((0,z.Z)(n),"focus",void 0),(0,p.Z)((0,z.Z)(n),"blur",void 0),(0,p.Z)((0,z.Z)(n),"insertBefore",void 0),(0,p.Z)((0,z.Z)(n),"appendChild",void 0),(0,p.Z)((0,z.Z)(n),"removeChild",void 0),(0,p.Z)((0,z.Z)(n),"remove",void 0),(0,p.Z)((0,z.Z)(n),"innerHTML",void 0),(0,p.Z)((0,z.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=ga,n.blur=ga,n.insertBefore=ga,n.appendChild=ga,n.removeChild=ga,n.remove=ga,n.innerHTML="",n.tagName=i.toUpperCase(),mr((0,z.Z)(n),a),hn((0,z.Z)(n)),Vi((0,z.Z)(n)),li((0,z.Z)(n)),ii((0,z.Z)(n)),Kn((0,z.Z)(n)),n}return(0,mt.Z)(t)}(yi);function vu(e){var r=Ps();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Oo=function(e){(0,lr.Z)(t,e);var r=vu(t);function t(n){return(0,ft.Z)(this,t),r.call(this,n)}return(0,mt.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(Wi);function ef(e){var r=Ka();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vn=function(e){(0,lr.Z)(t,e);var r=ef(t);function t(){return(0,ft.Z)(this,t),r.call(this,"video")}return(0,mt.Z)(t)}(Oo),dn={},ea={};function $u(e,r){dn=e,dn.id=r,"tagName"in dn||(dn.tagName="CANVAS"),dn.type="canvas",Mixin.parentNode(dn),Mixin.style(dn),Mixin.classList(dn),Mixin.clientRegion(dn),Mixin.offsetRegion(dn),dn.focus=function(){},dn.blur=function(){}}function Wf(e,r){var t=1024,n=1024;ea={width:t,height:n,clientWidth:t/devicePixelRatio,clientHeight:n/devicePixelRatio,id:r,type:"canvas"},"tagName"in ea||(ea.tagName="CANVAS"),Mixin.parentNode(ea),Mixin.style(ea),Mixin.classList(ea),Mixin.clientRegion(ea),Mixin.offsetRegion(ea),ea.getContext=function(i){if(i==="2d")return e},ea.focus=function(){},ea.blur=function(){}}function Ma(){return dn}function Cl(){return ea}var fo=(0,mt.Z)(function e(){(0,ft.Z)(this,e);var r=Ma(),t=r.createImage&&r.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),mr(t),Vi(t),Object.assign(t,{addEventListener:function(i,a){t["on".concat(i)]=a.bind(t)},removeEventListener:function(i){t["on".concat(i)]=null}}),t}),mu={href:"",protocol:"",host:""};function f(e){var r=m();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C=function(e){(0,lr.Z)(t,e);var r=f(t);function t(){return(0,ft.Z)(this,t),r.call(this,"body",0)}return(0,mt.Z)(t,[{key:"addEventListener",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(i,a,o){}},{key:"dispatchEvent",value:function(i){}}]),t}(Wi),_=function(e){(0,lr.Z)(t,e);var r=f(t);function t(){return(0,ft.Z)(this,t),r.call(this,"html",0)}return(0,mt.Z)(t,[{key:"addEventListener",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(i,a){}},{key:"dispatchEvent",value:function(i){}}]),t}(Wi),R={},X={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:mu,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(r){return r=r.toLowerCase(),r==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):r==="img"?new fo:r==="video"?new vn:new Wi(r)},createElementNS:function(r,t){return this.createElement(t)},createTextNode:function(r){return r},getElementById:function(r){return null},getElementsByTagName:function(r){return r=r.toLowerCase(),[]},getElementsByTagNameNS:function(r,t){return this.getElementsByTagName(t)},getElementsByName:function(r){return[]},querySelector:function(r){return null},querySelectorAll:function(r){return[]},addEventListener:function(r,t,n){R[r]||(R[r]=[]),R[r].push(t)},removeEventListener:function(r,t){var n=R[r];if(n&&n.length>0){for(var i=n.length;i--;i>0)if(n[i]===t){n.splice(i,1);break}}},dispatchEvent:function(r){var t=r.type,n=R[t];if(n)for(var i=0;i<n.length;i++)n[i](r);r.target&&typeof r.target["on"+t]=="function"&&r.target["on"+t](r)},createEvent:function(r){return new Bi(r)}};X.documentElement=new _,X.head=new Wi("head"),X.body=new C;var oe=Object,Me=T(90484),Ie=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"_w",void 0),(0,p.Z)(this,"_h",void 0),(0,p.Z)(this,"_data",void 0);var r=arguments.length;if(r===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else r===3&&(0,Me.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,mt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Ct=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Pt,dr,zr;if(Ct){var Ar=my.getSystemInfoSync();Pt=Ar.system,dr=Ar.platform,zr=Ar.language}else{var Qr={versions:function(){var e=Ui.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ui.navigator.browserLanguage||Ui.navigator.language).toLowerCase()};Qr.versions.android?dr="android":Qr.versions.trident?dr="IE":Qr.versions.presto?dr="Opera":Qr.versions.webKit?dr="webKit":Qr.versions.gecko?dr="Firefox":Qr.versions.mobile?dr="mobile":Qr.versions.ios?dr="ios":Qr.versions.iPhone?dr="iPhone":Qr.versions.iPad?dr="ipad":Qr.versions.webApp?dr="webApp":Qr.versions.weixin?dr="weixin":Qr.versions.qq&&(dr="qq"),Pt=Ui.navigator.userAgent,zr=Qr.language}var un=Pt.toLowerCase().indexOf("android")!==-1,kn=un?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Oa="Mozilla/5.0 (".concat(kn,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(zr),ci={platform:dr,language:zr,appVersion:"5.0 (".concat(kn,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Oa},ho={mark:function(r){return null},clearMeasures:function(r){return null},clearMarks:function(r){return null},measure:function(r,t,n){return{duration:0}},now:function(){}},Ro=0,qn=0;function _a(e){var r=Date.now(),t=Math.max(Ro+23,r);return qn=setTimeout(function(){e(Ro=t)},t-r),qn}function ws(e){var r=Ma();return r.requestAnimationFrame?r.requestAnimationFrame(e):_a(e)}function uc(e){var r=Ma();return r.cancelAnimationFrame?r.cancelAnimationFrame(e):clearTimeout(e)}var Al=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ft.Z)(this,e),(0,p.Z)(this,"href",void 0),r.indexOf("http://")==0||r.indexOf("https://")==0){this.href=r;return}this.href=t+r}return(0,mt.Z)(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],i=t.type,a=sc(n),o="data:".concat(i,";base64, ");return o+a}}]),e}();function sc(e){for(var r="",t=new Uint8Array(e),n=t.byteLength,i=0;i<n;i++)r+=String.fromCharCode(t[i]);return nn(r)}var fi={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Xf={};function Yf(e){var r=Ra();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Ra(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Po=new Map,bl=new Map,gu=new Map,tf={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Is(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,r)}function Ls(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Is.call(this,"readystatechange",r)}var ta=function(e){(0,lr.Z)(t,e);var r=Yf(t);function t(){var n;return(0,ft.Z)(this,t),n=r.call(this),(0,p.Z)((0,z.Z)(n),"onabort",void 0),(0,p.Z)((0,z.Z)(n),"onerror",void 0),(0,p.Z)((0,z.Z)(n),"onload",void 0),(0,p.Z)((0,z.Z)(n),"onloadstart",void 0),(0,p.Z)((0,z.Z)(n),"onprogress",void 0),(0,p.Z)((0,z.Z)(n),"ontimeout",void 0),(0,p.Z)((0,z.Z)(n),"onloadend",void 0),(0,p.Z)((0,z.Z)(n),"onreadystatechange",void 0),(0,p.Z)((0,z.Z)(n),"readyState",void 0),(0,p.Z)((0,z.Z)(n),"response",void 0),(0,p.Z)((0,z.Z)(n),"responseText",void 0),(0,p.Z)((0,z.Z)(n),"_responseType",void 0),(0,p.Z)((0,z.Z)(n),"responseXML",void 0),(0,p.Z)((0,z.Z)(n),"status",void 0),(0,p.Z)((0,z.Z)(n),"statusText",void 0),(0,p.Z)((0,z.Z)(n),"upload",void 0),(0,p.Z)((0,z.Z)(n),"withCredentials",void 0),(0,p.Z)((0,z.Z)(n),"timeout",void 0),(0,p.Z)((0,z.Z)(n),"_url",void 0),(0,p.Z)((0,z.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Po.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,mt.Z)(t,[{key:"responseType",set:function(i){this._responseType=i}},{key:"abort",value:function(){var i=gu.get("requestTask");i&&i.abort()}},{key:"getAllResponseHeaders",value:function(){var i=bl.get("responseHeader");return Object.keys(i).map(function(a){return"".concat(a,": ").concat(i[a])}).join(`
`)}},{key:"getResponseHeader",value:function(i){return bl.get("responseHeader")[i]}},{key:"open",value:function(i,a,o){this._method=i,this._url=a}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(i,a){var o=Po.get("requestHeader");o[i]=a,Po.set("requestHeader",o)}},{key:"addEventListener",value:function(i,a){var o=this;typeof a=="function"&&(this["on"+i]=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};s.target=s.target||o,a.call(o,s)})}},{key:"removeEventListener",value:function(i,a){this["on"+i]===a&&(this["on"+i]=null)}}]),t}(Hi);(0,p.Z)(ta,"UNSEND",void 0),(0,p.Z)(ta,"OPENED",void 0),(0,p.Z)(ta,"HEADERS_RECEIVED",void 0),(0,p.Z)(ta,"LOADING",void 0),(0,p.Z)(ta,"DONE",void 0),ta.UNSEND=0,ta.OPENED=1,ta.HEADERS_RECEIVED=2,ta.LOADING=3,ta.DONE=4;function $f(e){var r=Tl();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Tl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lc=function(e){(0,lr.Z)(t,e);var r=$f(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this,n),(0,p.Z)((0,z.Z)(i),"touches",void 0),(0,p.Z)((0,z.Z)(i),"targetTouches",void 0),(0,p.Z)((0,z.Z)(i),"changedTouches",void 0),i.touches=[],i.targetTouches=[],i.changedTouches=[],i.target=Ma(),i.currentTarget=Ma(),i}return(0,mt.Z)(t)}(Bi);function rf(e){var r=e||{},t=r.x,n=t===void 0?0:t,i=r.y,a=i===void 0?0:i,o=r.clientX,s=o===void 0?0:o,l=r.clientY,h=l===void 0?0:l;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=a):(e.x=s,e.y=h)}function cc(e){return function(r){var t=new lc(e);t.changedTouches=r.changedTouches,t.touches=r.touches,t.targetTouches=Array.prototype.slice.call(r.touches),t.timeStamp=r.timeStamp,t.changedTouches.forEach(function(n){return rf(n)}),t.touches.forEach(function(n){return rf(n)}),t.targetTouches.forEach(function(n){return rf(n)}),X.dispatchEvent(t)}}function Pa(e){return function(r){r.type=e,X.dispatchEvent(r)}}var Kf=cc("touchstart"),Ds=cc("touchmove"),fc=cc("touchend"),nf=Pa("mapCameaParams");function af(e){var r=Fs();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Fs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var of=function(e){(0,lr.Z)(t,e);var r=af(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this,n),(0,p.Z)((0,z.Z)(i),"buttons",void 0),(0,p.Z)((0,z.Z)(i),"which",void 0),(0,p.Z)((0,z.Z)(i),"pointerId",void 0),(0,p.Z)((0,z.Z)(i),"bubbles",void 0),(0,p.Z)((0,z.Z)(i),"button",void 0),(0,p.Z)((0,z.Z)(i),"width",void 0),(0,p.Z)((0,z.Z)(i),"height",void 0),(0,p.Z)((0,z.Z)(i),"pressure",void 0),(0,p.Z)((0,z.Z)(i),"isPrimary",void 0),(0,p.Z)((0,z.Z)(i),"pointerType",void 0),(0,p.Z)((0,z.Z)(i),"altKey",void 0),(0,p.Z)((0,z.Z)(i),"ctrlKey",void 0),(0,p.Z)((0,z.Z)(i),"metaKey",void 0),(0,p.Z)((0,z.Z)(i),"shiftKey",void 0),i.target=Ma(),i.currentTarget=Ma(),i}return(0,mt.Z)(t)}(Bi),hc=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],uf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],_u="touch";function qf(e,r,t){for(var n=new of(e),i=0;i<hc.length;i++){var a=hc[i];n[a]=r[a]||uf[i]}return n.type=e,n.target=Ma(),n.currentTarget=Ma(),n.buttons=Qf(e),n.which=n.buttons,n.pointerId=(r.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(r.radiusX||.5)*2,n.height=(r.radiusY||.5)*2,n.pressure=r.force||.5,n.isPrimary=sf(r),n.pointerType=_u,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function Qf(e){var r=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(r=1),r}var yu=null;function sf(e){return yu===e.identifier}function Ko(e){yu===null&&(yu=e.identifier)}function Ml(e){yu===e.identifier&&(yu=null)}function dc(e){return function(r){for(var t=r.changedTouches,n=0;n<t.length;n++){var i=t[n];n===0&&e==="pointerdown"?Ko(i):(e==="pointerup"||e==="pointercancel")&&Ml(i);var a=qf(e,i,r);X.dispatchEvent(a)}}}var Kh=dc("pointerdown"),Ol=dc("pointermove"),Ku=dc("pointerup");function wa(e){var r=Ns();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Ns(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ld=function(e){(0,lr.Z)(t,e);var r=wa(t);function t(n){return(0,ft.Z)(this,t),r.call(this,n)}return(0,mt.Z)(t)}(Bi);function lf(e){return function(r){r.type=e,X.dispatchEvent(r)}}var cd=lf("mousedown"),Jf=lf("mousemove"),fd=lf("mouseup"),pc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Fe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),lt=pc||Fe,ot={atob:va,btoa:nn,devicePixelRatio:Gi,Blob:Xu,document:X,Element:yi,Event:Bi,EventTarget:Hi,HTMLCanvasElement:oe,HTMLElement:Wi,HTMLMediaElement:Oo,HTMLVideoElement:vn,Image:fo,ImageData:Ie,navigator:ci,Node:Xo,requestAnimationFrame:ws,cancelAnimationFrame:uc,screen:V,XMLHttpRequest:ta,performance:ho,URL:Al,WebGLRenderingContext:fi,WebGL2RenderingContext:Xf,addEventListener:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};X.addEventListener(r,t,n)},removeEventListener:function(r,t,n){X.removeEventListener(r,t)},dispatchEvent:function(r){X.dispatchEvent(r)},innerWidth:V.availWidth,innerHeight:V.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Wt=lt?ot:Ui,an=lt?ta:Ui.XMLHttpRequest,Bn=lt?mu:Ui.location;function ei(e){var r=e;return typeof e=="string"&&(r=Wt.document.getElementById(e)),r}function wn(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function ks(e){return wn(e).split(/\s+/)}function qh(e){var r,t,n=Wt==null||(r=Wt.document)===null||r===void 0||(t=r.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var i in e)if(e[i]&&e[i]in n)return e[i];return e[0]}function Cn(e,r,t){var n=Wt.document.createElement(e);return n.className=r||"",t&&t.appendChild(n),n}function qo(e){var r=e.parentNode;r&&r.removeChild(e)}function qu(e,r){if(e.classList!==void 0)for(var t=ks(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!vc(e,r)){var a=In(e);Rl(e,(a?a+" ":"")+r)}}function wo(e,r){e.classList!==void 0?e.classList.remove(r):Rl(e,wn((" "+In(e)+" ").replace(" "+r+" "," ")))}function vc(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=In(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function Rl(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function In(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Bs(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var eh=qh(["transform","WebkitTransform"]);function Eu(e,r){e.style[eh]=r}function qa(){if(typeof Event=="function")Wt.dispatchEvent(new Event("resize"));else{var e=Wt.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Wt,0),Wt.dispatchEvent(e)}}function Pl(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function th(){var e,r=Wt.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),o=(0,Rn.Z)(a,2),s=o[0],l=o[1];return s==="initial-scale"});return n?n.split("=")[1]*1:1}var Qn=th()<1?1:Wt.devicePixelRatio,Io=T(14665);function wl(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var cf=T(51814);function Lo(e,r,t){return(0,cf.Z)()?Lo=Reflect.construct:Lo=function(i,a,o){var s=[null];s.push.apply(s,a);var l=Function.bind.apply(i,s),h=new l;return o&&(0,Io.Z)(h,o.prototype),h},Lo.apply(null,arguments)}function mc(e){var r=typeof Map=="function"?new Map:void 0;return mc=function(n){if(n===null||!wl(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return Lo(n,arguments,(0,Xe.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,Io.Z)(i,n)},mc(e)}function Qu(e){var r=Ci();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Ci(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Il=function(e){(0,lr.Z)(t,e);var r=Qu(t);function t(n,i,a){var o;return(0,ft.Z)(this,t),o=r.call(this,n),(0,p.Z)((0,z.Z)(o),"status",void 0),(0,p.Z)((0,z.Z)(o),"url",void 0),o.status=i,o.url=a,o.name=o.constructor.name,o.message=n,o}return(0,mt.Z)(t,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),t}(mc(Error));function Ju(e){var r=new an;r.open("GET",e.url,!0);for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return r.withCredentials=e.credentials==="include",r}var Qa=function(r,t){var n=Ju(r);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var i;try{i=JSON.parse(n.response)}catch(a){return t(a)}t(null,i)}else n.status===401?t(new Il("".concat(n.statusText),n.status,r.url)):t(new Il(n.statusText,n.status,r.url))},n.send(),n},Ll=function(r,t){var n=Ju(r);return n.responseType="arraybuffer",n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){var i=n.response;if(i.byteLength===0&&n.status===200)return t(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?t(null,{data:i,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):t(new Il(n.statusText,n.status,r.url))},n.send(),n};function Qh(e){var r=$window.document.createElement("a");return r.href=e,r.protocol===$window.document.location.protocol&&r.host===$window.document.location.host}var Jh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",rh=function(r,t){return Ll(r,function(n,i){if(n)t(n);else if(i){var a=new Wt.Image;a.crossOrigin="anonymous";var o=Wt.URL||Wt.webkitURL;a.onload=function(){t(null,a),o.revokeObjectURL(a.src)};var s=new Wt.Blob([new Uint8Array(i.data)],{type:"image/png"});a.src=i.data.byteLength?o.createObjectURL(s):Jh}})},es=2*Math.PI*6378137/2;function gc(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;Zs(r,n)}),r}function Zs(e,r){return Array.isArray(r[0])?r.forEach(function(t){Zs(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function e0(e,r){return Dl(e,r)}function Dl(e,r){return Array.isArray(e[0])?e.map(function(t){return Dl(t,r)}):r(e)}function _c(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=t0(e,r);var n=e[0],i=e[1],a=n*es/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*es/180,t.enable&&(a=Number(a.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),e.length===3?[a,o,e[2]]:[a,o]}function hd(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/es*180,a=n/es*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function bi(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Xi(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function t0(e,r){if(r===!1)return e;var t=bi(e[0]),n=Xi(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Ia(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,o=t*i;o=Math.log(Math.tan(Math.PI/4+o/2));var s=.5/Math.PI,l=.5,h=-.5/Math.PI;return i=.5,a=n*(s*a+l),o=n*(h*o+i),[Math.floor(a),Math.floor(o)]}function r0(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,o=_slicedToArray(e,2),s=o[0],l=o[1];s=(s/a-t)/r,l=(l/a-i)/n,l=(Math.atan(Math.pow(Math.E,l))-Math.PI/4)*2,i=Math.PI/180;var h=l/i,d=s/i;return[d,h]}function xu(e,r,t){var n=Nt(r[1]-e[1]),i=Nt(r[0]-e[0]),a=Nt(e[1]),o=Nt(r[1]),s=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return Hr(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),t="meters")}function Fl(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),o=n*e[0]*r,s=n*Math.log((1+a)/(1-a))/2;return[o,s]}function Su(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function Nl(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function ts(e){return[[e[0],e[1]],[e[2],e[3]]]}function Us(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Gs(e,r){return e[0]*r[0]+e[1]*r[1]}function zs(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Hs(e,r){return Math.acos(Gs(e,r)/(zs(e)*zs(r)))*180/Math.PI}function nh(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function n0(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var o=e[a],s=e[a+1],l=Us(o,s);n+=l;var h=[o[0]-s[0],o[1]-s[1]],d=nh(t,h);if(a>0){var g=i[a-1].rotation;g-d>360-g+d&&(d=d+360)}i.push({start:o,end:s,dis:l,rotation:d,duration:0})}return i.map(function(y){y.duration=r*(y.dis/n)}),i}}var po=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,ft.Z)(this,e),(0,p.Z)(this,"limit",void 0),(0,p.Z)(this,"cache",void 0),(0,p.Z)(this,"destroy",void 0),(0,p.Z)(this,"order",void 0),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,mt.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function rs(e,r){e.forEach(function(t){!r[t]||(r[t]=r[t].bind(r))})}var dd=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ft.Z)(this,e),(0,p.Z)(this,"duration",16),(0,p.Z)(this,"timestamp",new Date().getTime()),this.duration=r}return(0,mt.Z)(e,[{key:"run",value:function(t){var n=new Date().getTime(),i=n-this.timestamp;this.timestamp=n,i>=this.duration&&t()}}]),e}();function ya(e,r,t){e.prototype=r.prototype=t,t.constructor=e}function Cu(e,r){var t=Object.create(e.prototype);for(var n in r)t[n]=r[n];return t}function Ja(){}var Z=.7,Do=1/Z,Fo="\\s*([+-]?\\d+)\\s*",Yi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ih=/^#([0-9a-f]{3,8})$/,i0=new RegExp("^rgb\\("+[Fo,Fo,Fo]+"\\)$"),a0=new RegExp("^rgb\\("+[Jr,Jr,Jr]+"\\)$"),ns=new RegExp("^rgba\\("+[Fo,Fo,Fo,Yi]+"\\)$"),o0=new RegExp("^rgba\\("+[Jr,Jr,Jr,Yi]+"\\)$"),u0=new RegExp("^hsl\\("+[Yi,Jr,Jr]+"\\)$"),s0=new RegExp("^hsla\\("+[Yi,Jr,Jr,Yi]+"\\)$"),ah={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ya(Ja,Au,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:ff,formatHex:ff,formatHsl:No,formatRgb:oh,toString:oh});function ff(){return this.rgb().formatHex()}function No(){return bu(this).formatHsl()}function oh(){return this.rgb().formatRgb()}function Au(e){var r,t;return e=(e+"").trim().toLowerCase(),(r=ih.exec(e))?(t=r[1].length,r=parseInt(r[1],16),t===6?yc(r):t===3?new La(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):t===8?is(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):t===4?is(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=i0.exec(e))?new La(r[1],r[2],r[3],1):(r=a0.exec(e))?new La(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=ns.exec(e))?is(r[1],r[2],r[3],r[4]):(r=o0.exec(e))?is(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=u0.exec(e))?lh(r[1],r[2]/100,r[3]/100,1):(r=s0.exec(e))?lh(r[1],r[2]/100,r[3]/100,r[4]):ah.hasOwnProperty(e)?yc(ah[e]):e==="transparent"?new La(NaN,NaN,NaN,0):null}function yc(e){return new La(e>>16&255,e>>8&255,e&255,1)}function is(e,r,t,n){return n<=0&&(e=r=t=NaN),new La(e,r,t,n)}function l0(e){return e instanceof Ja||(e=Au(e)),e?(e=e.rgb(),new La(e.r,e.g,e.b,e.opacity)):new La}function eo(e,r,t,n){return arguments.length===1?l0(e):new La(e,r,t,n==null?1:n)}function La(e,r,t,n){this.r=+e,this.g=+r,this.b=+t,this.opacity=+n}ya(La,eo,Cu(Ja,{brighter:function(e){return e=e==null?Do:Math.pow(Do,e),new La(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Z:Math.pow(Z,e),new La(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:uh,formatHex:uh,formatRgb:sh,toString:sh}));function uh(){return"#"+Ec(this.r)+Ec(this.g)+Ec(this.b)}function sh(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Ec(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function lh(e,r,t,n){return n<=0?e=r=t=NaN:t<=0||t>=1?e=r=NaN:r<=0&&(e=NaN),new ko(e,r,t,n)}function bu(e){if(e instanceof ko)return new ko(e.h,e.s,e.l,e.opacity);if(e instanceof Ja||(e=Au(e)),!e)return new ko;if(e instanceof ko)return e;e=e.rgb();var r=e.r/255,t=e.g/255,n=e.b/255,i=Math.min(r,t,n),a=Math.max(r,t,n),o=NaN,s=a-i,l=(a+i)/2;return s?(r===a?o=(t-n)/s+(t<n)*6:t===a?o=(n-r)/s+2:o=(r-t)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new ko(o,s,l,e.opacity)}function c0(e,r,t,n){return arguments.length===1?bu(e):new ko(e,r,t,n==null?1:n)}function ko(e,r,t,n){this.h=+e,this.s=+r,this.l=+t,this.opacity=+n}ya(ko,c0,Cu(Ja,{brighter:function(e){return e=e==null?Do:Math.pow(Do,e),new ko(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Z:Math.pow(Z,e),new ko(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*r,i=2*t-n;return new La(Da(e>=240?e-240:e+120,i,n),Da(e,i,n),Da(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Da(e,r,t){return(e<60?r+(t-r)*e/60:e<180?t:e<240?r+(t-r)*(240-e)/60:r)*255}function js(e){return typeof e=="string"?!!Au(e):!1}function Zn(e){var r=Au(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function Vs(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function Ws(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Xs(e){var r=Wt.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=t.createLinearGradient(0,0,256,1),i=null,a=e.positions[0],o=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var l=(e.positions[s]-a)/(o-a);n.addColorStop(l,e.colors[s])}if(t.fillStyle=n,t.fillRect(0,0,256,1),lt)return i=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),{data:i,width:256,height:1};i=t.getImageData(0,0,256,1).data;for(var h=t.createImageData(256,1),d=0;d<h.data.length;d+=4)h.data[d+0]=i[d+0],h.data[d+1]=i[d+1],h.data[d+2]=i[d+2],h.data[d+3]=i[d+3];return h}var Ys;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Ys||(Ys={}));var as={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ch(e,r,t){var n=e.classList;for(var i in as)as.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}function ai(e,r){return{enable:e,mask:255,func:{cmp:514,ref:r?1:0,mask:255}}}var Qo={BACK:1029,FRONT:1028};function Jo(e){switch(e){case"GAODE1.x":return Qo.BACK;case"GAODE2.x":return Qo.BACK;case"MAPBOX":return Qo.FRONT;case"SIMPLE":return Qo.FRONT;case"GLOBEL":return Qo.BACK;case"L7MAP":return Qo.FRONT;default:return Qo.FRONT}}function xc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function f0(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function hf(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function kl(e){if(e.length===0)throw new Error("mean requires at least one data point");return hf(e)/e.length}function eu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var Tu={min:f0,max:xc,mean:kl,sum:hf,mode:eu};function tu(e,r){return e.map(function(t){return t[r]})}function $i(e,r){return Tu[e](r)}function os(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=new Promise(function(o){fh(e,function(s){o(s)})}),a={originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return a}function fh(e,r){var t=e,n=[];if(typeof t=="string")rh({url:t},function(o,s){n.push(s),r(n)});else{var i=t.length,a=0;t.forEach(function(o){rh({url:o},function(s,l){a++,n.push(l),a===i&&r(n)})})}return os}function us(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,o=r.max,s={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:i,min:a,max:o,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return s}var $s=T(30236),Fa=T.n($s),Sc=T(47037),Na=T.n(Sc),Ks=T(23560),ru=T.n(Ks),Cc=T(50361),hi=T.n(Cc),qs=T(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function df(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function s(d){try{h(n.next(d))}catch(g){o(g)}}function l(d){try{h(n.throw(d))}catch(g){o(g)}}function h(d){d.done?a(d.value):i(d.value).then(s,l)}h((n=n.apply(e,r||[])).next())})}function vo(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(h){return function(d){return l([h,d])}}function l(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=r.call(e,t)}catch(d){h=[6,d],i=0}finally{n=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Ac(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],o;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return a}function Bl(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(Ac(arguments[r]));return e}function Wn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function di(e,r){return r={exports:{}},e(r,r.exports),r.exports}var Ii=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=r.default});Wn(Ii);var Zl=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return t.call(this,n,a)}},e.exports=r.default});Wn(Zl);var ss=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.fallback=i,r.wrap=a;var t=r.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=r.hasNextTick=typeof qs=="object"&&typeof qs.nextTick=="function";function i(s){setTimeout(s,0)}function a(s){return function(l){for(var h=[],d=arguments.length-1;d-- >0;)h[d]=arguments[d+1];return s(function(){return l.apply(void 0,h)})}}var o;t?o=setImmediate:n?o=qs.nextTick:o=i,r.default=a(o)});Wn(ss);var h0=ss.fallback,hh=ss.wrap,pf=ss.hasSetImmediate,d0=ss.hasNextTick,Mu=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=i(Zl),n=i(ss);function i(l){return l&&l.__esModule?l:{default:l}}function a(l){return(0,Ea.isAsync)(l)?function(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];var g=h.pop(),y=l.apply(this,h);return o(y,g)}:(0,t.default)(function(h,d){var g;try{g=l.apply(this,h)}catch(y){return d(y)}if(g&&typeof g.then=="function")return o(g,d);d(null,g)})}function o(l,h){return l.then(function(d){s(h,null,d)},function(d){s(h,d&&d.message?d:new Error(d))})}function s(l,h,d){try{l(h,d)}catch(g){(0,n.default)(function(y){throw y},g)}}e.exports=r.default});Wn(Mu);var Ea=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isAsyncIterable=r.isAsyncGenerator=r.isAsync=void 0;var t=n(Mu);function n(l){return l&&l.__esModule?l:{default:l}}function i(l){return l[Symbol.toStringTag]==="AsyncFunction"}function a(l){return l[Symbol.toStringTag]==="AsyncGenerator"}function o(l){return typeof l[Symbol.asyncIterator]=="function"}function s(l){if(typeof l!="function")throw new Error("expected a function");return i(l)?(0,t.default)(l):l}r.default=s,r.isAsync=i,r.isAsyncGenerator=a,r.isAsyncIterable=o});Wn(Ea);var p0=Ea.isAsyncIterable,dh=Ea.isAsyncGenerator,Ul=Ea.isAsync,ls=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var o=this,s=[],l=arguments.length;l--;)s[l]=arguments[l];return typeof s[i-1]=="function"?n.apply(this,s):new Promise(function(h,d){s[i-1]=function(g){for(var y=[],E=arguments.length-1;E-- >0;)y[E]=arguments[E+1];if(g)return d(g);h(y.length>1?y:y[0])},n.apply(o,s)})}return Object.defineProperty(a,"name",{configurable:!0,value:"awaitable("+n.name+")"}),a}e.exports=r.default});Wn(ls);var Gl=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=a(Ii),n=a(Ea),i=a(ls);function a(o){return o&&o.__esModule?o:{default:o}}r.default=(0,i.default)(function(o,s,l){var h=(0,t.default)(s)?[]:{};o(s,function(d,g,y){(0,n.default)(d)(function(E){for(var b,w=[],F=arguments.length-1;F-- >0;)w[F]=arguments[F+1];w.length<2&&(b=w,w=b[0]),h[g]=w,y(E)})},function(d){return l(d,h)})},3),e.exports=r.default});Wn(Gl);var cs=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(n!==null){var s=n;n=null,s.apply(this,a)}}return Object.assign(i,n),i}e.exports=r.default});Wn(cs);var bc=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default});Wn(bc);var Tc=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=i(Ii),n=i(bc);function i(h){return h&&h.__esModule?h:{default:h}}function a(h){var d=-1,g=h.length;return function(){return++d<g?{value:h[d],key:d}:null}}function o(h){var d=-1;return function(){var y=h.next();return y.done?null:(d++,{value:y.value,key:d})}}function s(h){var d=h?Object.keys(h):[],g=-1,y=d.length;return function(){var b=d[++g];return g<y?{value:h[b],key:b}:null}}function l(h){if((0,t.default)(h))return a(h);var d=(0,n.default)(h);return d?o(d):s(h)}e.exports=r.default});Wn(Tc);var Qs=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var o=n;n=null,o.apply(this,i)}}e.exports=r.default});Wn(Qs);var Ou=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default});Wn(Ou);var Mc=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=i;var t=n(Ou);function n(a){return a&&a.__esModule?a:{default:a}}function i(a,o,s,l){var h=!1,d=!1,g=!1,y=0,E=0;function b(){y>=o||g||h||(g=!0,a.next().then(function(ee){var se=ee.value,ge=ee.done;if(!(d||h)){if(g=!1,ge){h=!0,y<=0&&l(null);return}y++,s(se,E,w),E++,b()}}).catch(F))}function w(ee,se){if(y-=1,!d){if(ee)return F(ee);if(ee===!1){h=!0,d=!0;return}if(se===t.default||h&&y<=0)return h=!0,l(null);b()}}function F(ee){d||(g=!1,h=!0,l(ee))}b()}e.exports=r.default});Wn(Mc);var fs=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=s(cs),n=s(Tc),i=s(Qs),a=s(Mc),o=s(Ou);function s(l){return l&&l.__esModule?l:{default:l}}r.default=function(l){return function(h,d,g){if(g=(0,t.default)(g),l<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!h)return g(null);if((0,Ea.isAsyncGenerator)(h))return(0,a.default)(h,l,d,g);if((0,Ea.isAsyncIterable)(h))return(0,a.default)(h[Symbol.asyncIterator](),l,d,g);var y=(0,n.default)(h),E=!1,b=!1,w=0,F=!1;function ee(ge,Ee){if(!b)if(w-=1,ge)E=!0,g(ge);else if(ge===!1)E=!0,b=!0;else{if(Ee===o.default||E&&w<=0)return E=!0,g(null);F||se()}}function se(){for(F=!0;w<l&&!E;){var ge=y();if(ge===null){E=!0,w<=0&&g(null);return}w+=1,d(ge.value,ge.key,(0,i.default)(ee))}F=!1}se()}},e.exports=r.default});Wn(fs);var mo=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=a(fs),n=a(Ea),i=a(ls);function a(s){return s&&s.__esModule?s:{default:s}}function o(s,l,h,d){return(0,t.default)(l)(s,(0,n.default)(h),d)}r.default=(0,i.default)(o,4),e.exports=r.default});Wn(mo);var Ru=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=i(mo),n=i(ls);function i(o){return o&&o.__esModule?o:{default:o}}function a(o,s,l){return(0,t.default)(o,1,s,l)}r.default=(0,n.default)(a,3),e.exports=r.default});Wn(Ru);var Pu=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=i(Gl),n=i(Ru);function i(o){return o&&o.__esModule?o:{default:o}}function a(o,s){return(0,t.default)(n.default,o,s)}e.exports=r.default}),hs=Wn(Pu),ua=function(){function e(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,hs(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,Bl(n.args)),i(null,r)})},e}(),go=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=h(Ii),n=h(Ou),i=h(mo),a=h(cs),o=h(Qs),s=h(Ea),l=h(ls);function h(E){return E&&E.__esModule?E:{default:E}}function d(E,b,w){w=(0,a.default)(w);var F=0,ee=0,se=E.length,ge=!1;se===0&&w(null);function Ee(je,Ve){je===!1&&(ge=!0),ge!==!0&&(je?w(je):(++ee===se||Ve===n.default)&&w(null))}for(;F<se;F++)b(E[F],F,(0,o.default)(Ee))}function g(E,b,w){return(0,i.default)(E,Infinity,b,w)}function y(E,b,w){var F=(0,t.default)(E)?d:g;return F(E,(0,s.default)(b),w)}r.default=(0,l.default)(y,3),e.exports=r.default});Wn(go);var ds=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=i(go),n=i(Gl);function i(o){return o&&o.__esModule?o:{default:o}}function a(o,s){return(0,n.default)(t.default,o,s)}e.exports=r.default}),wu=Wn(ds),zl=function(){function e(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return wu(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return df(n,void 0,void 0,function(){return vo(this,function(a){switch(a.label){case 0:return[4,t()];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),Oc=di(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=o(cs),n=o(Qs),i=o(Ea),a=o(ls);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,h){if(h=(0,t.default)(h),!Array.isArray(l))return h(new Error("First argument to waterfall must be an array of functions"));if(!l.length)return h();var d=0;function g(E){var b=(0,i.default)(l[d++]);b.apply(void 0,E.concat([(0,n.default)(y)]))}function y(E){for(var b=[],w=arguments.length-1;w-- >0;)b[w]=arguments[w+1];if(E!==!1){if(E||d===l.length)return h.apply(void 0,[E].concat(b));g(b)}}g([])}r.default=(0,a.default)(s),e.exports=r.default}),Js=Wn(Oc),vf=function(){function e(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return Js(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=t();i(a?null:!1,r)})},e}(),ps=function(){function e(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return hs(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),Ki=T(26729),Iu=T.n(Ki),v0=T(69848),Rc=T.n(v0);function mn(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function mf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?mn(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):mn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function gf(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,o=r.minZoom,s=o===void 0?0:o,l=r.zoom,h=l===void 0?2:l;if(e.pointIndex){var d=e.pointIndex.getClusters(e.extent,Math.floor(h));return e.dataArray=Hl(d),e}var g=new(Rc())({radius:n,minZoom:s,maxZoom:a}),y={type:"FeatureCollection",features:[]};return y.features=e.dataArray.map(function(E){return{type:"Feature",geometry:{type:"Point",coordinates:E.coordinates},properties:mf({},E)}}),g.load(y.features),g}function Hl(e){return e.map(function(r,t){return mf({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function vs(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function _f(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function ph(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function to(e){if(e.length===0)throw new Error("mean requires at least one data point");return ph(e)/e.length}var vh={min:_f,max:vs,mean:to,sum:ph};function Pc(e,r){return e.map(function(t){return t[r]*1})}function wc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function jl(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?wc(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):wc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mh(e){var r=ka();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lu(e,r){if(Array.isArray(r))return r}var yf=function(e){(0,lr.Z)(t,e);var r=mh(t);function t(n,i){var a;return(0,ft.Z)(this,t),a=r.call(this),(0,p.Z)((0,z.Z)(a),"data",void 0),(0,p.Z)((0,z.Z)(a),"extent",void 0),(0,p.Z)((0,z.Z)(a),"hooks",{init:new ua}),(0,p.Z)((0,z.Z)(a),"parser",{type:"geojson"}),(0,p.Z)((0,z.Z)(a),"transforms",[]),(0,p.Z)((0,z.Z)(a),"cluster",!1),(0,p.Z)((0,z.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,p.Z)((0,z.Z)(a),"mapService",void 0),(0,p.Z)((0,z.Z)(a),"invalidExtent",!1),(0,p.Z)((0,z.Z)(a),"dataArrayChanged",!1),(0,p.Z)((0,z.Z)(a),"originData",void 0),(0,p.Z)((0,z.Z)(a),"rawData",void 0),(0,p.Z)((0,z.Z)(a),"cfg",{}),(0,p.Z)((0,z.Z)(a),"clusterIndex",void 0),a.originData=n,a.initCfg(i),a.hooks.init.tap("parser",function(){a.excuteParser()}),a.hooks.init.tap("cluster",function(){a.initCluster()}),a.hooks.init.tap("transform",function(){a.executeTrans()}),a.init(),a}return(0,mt.Z)(t,[{key:"setData",value:function(i,a){this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init(),this.emit("update")}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"updateClusterData",value:function(i){var a=this,o=this.clusterOptions,s=o.method,l=s===void 0?"sum":s,h=o.field,d=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,d.forEach(function(g){g.id||(g.properties.point_count=1)}),(h||ru()(l))&&(d=d.map(function(g){var y=g.id;if(y){var E=a.clusterIndex.getLeaves(y,Infinity),b=E.map(function(ee){return ee.properties}),w;if(Na()(l)&&h){var F=Pc(b,h);w=vh[l](F)}ru()(l)&&(w=l(b)),g.properties.stat=w}else g.properties.point_count=1;return g})),this.data=K("geojson")({type:"FeatureCollection",features:d}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser.type,o=a===void 0?"geojson":a;if(o==="geojson"&&!this.cluster){var s=i<this.originData.features.length?this.originData.features[i]:"null",l=hi()(s);if(this.transforms.length!==0||this.dataArrayChanged){var h=this.data.dataArray.find(function(d){return d._id===i});l.properties=h}return l}else return i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===i?jl(jl({},o),a):o}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(i,a){var o=this.data.dataArray.find(function(s){return s[i]===a});return o==null?void 0:o._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(i){var a=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(a=Su(ts(this.extent),i)),a[0].concat(a[1])}},{key:"initCfg",value:function(i){this.cfg=Fa()(this.cfg,i,Lu);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=jl(jl({},this.clusterOptions),a.clusterOptions)))}},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson";if(a==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var o=K(a);this.data=o(this.originData,i),this.extent=gc(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(o){var s=o.type,l=le(s)(i.data,o);Object.assign(i.data,l)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=gf(this.data,i)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),t}(Ki.EventEmitter);function gh(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function Vl(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_h(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function _h(e,r){if(!!e){if(typeof e=="string")return el(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return el(e,r)}}function el(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var ms=6378e3;function tl(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*ms)*(256<<20)/2,o=rl(t,i),s=o.gridHash,l=o.gridOffset,h=Wl(s,l,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:h}}function rl(e,r){var t=Infinity,n=-Infinity,i,a=Vl(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i=s.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(ge){a.e(ge)}finally{a.f()}var l=(t+n)/2,h=Bo(r,l);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};var d={},g=Vl(e),y;try{for(g.s();!(y=g.n()).done;){var E=y.value,b=E.coordinates[1],w=E.coordinates[0];if(Number.isFinite(b)&&Number.isFinite(w)){var F=Math.floor((b+90)/h.yOffset),ee=Math.floor((w+180)/h.xOffset),se="".concat(F,"-").concat(ee);d[se]=d[se]||{count:0,points:[]},d[se].count+=1,d[se].points.push(E)}}}catch(ge){g.e(ge)}finally{g.f()}return{gridHash:d,gridOffset:h}}function Bo(e,r){var t=Ic(e),n=_o(r,e);return{yOffset:t,xOffset:n}}function Ic(e){return e/ms*(180/Math.PI)}function _o(e,r){return r/ms*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Wl(e,r,t){return Object.keys(e).reduce(function(n,i,a){var o=i.split("-"),s=parseInt(o[0],10),l=parseInt(o[1],10),h={};if(t.field&&t.method){var d=tu(e[i].points,t.field);h[t.method]=Tu[t.method](d)}return Object.assign(h,{_id:a,coordinates:Ia([-180+r.xOffset*(l+.5),-90+r.yOffset*(s+.5)]),rawData:e[i].points,count:e[i].count}),n.push(h),n},[])}var nu=Math.PI/3,nl=[0,nu,2*nu,3*nu,4*nu,5*nu];function Lc(e){return e[0]}function Dc(e){return e[1]}function Xl(){var e=0,r=0,t=1,n=1,i=Lc,a=Dc,o,s,l;function h(g){var y={},E=[],b,w=g.length;for(b=0;b<w;++b)if(!(isNaN(ee=+i.call(null,F=g[b],b,g))||isNaN(se=+a.call(null,F,b,g)))){var F,ee,se,ge=Math.round(se=se/l),Ee=Math.round(ee=ee/s-(ge&1)/2),je=se-ge;if(Math.abs(je)*3>1){var Ve=ee-Ee,rt=Ee+(ee<Ee?-1:1)/2,Et=ge+(se<ge?-1:1),zt=ee-rt,er=se-Et;Ve*Ve+je*je>zt*zt+er*er&&(Ee=rt+(ge&1?1:-1)/2,ge=Et)}var Rt=Ee+"-"+ge,pr=y[Rt];pr?pr.push(F):(E.push(pr=y[Rt]=[F]),pr.x=(Ee+(ge&1)/2)*s,pr.y=ge*l)}return E}function d(g){var y=0,E=0;return nl.map(function(b){var w=Math.sin(b)*g,F=-Math.cos(b)*g,ee=w-y,se=F-E;return y=w,E=F,[ee,se]})}return h.hexagon=function(g){return"m"+d(g==null?o:+g).join("l")+"z"},h.centers=function(){for(var g=[],y=Math.round(r/l),E=Math.round(e/s),b=y*l;b<n+o;b+=l,++y)for(var w=E*s+(y&1)*s/2;w<t+s/2;w+=s)g.push([w,b]);return g},h.mesh=function(){var g=d(o).slice(0,4).join("l");return h.centers().map(function(y){return"M"+y+"m"+g}).join("")},h.x=function(g){return arguments.length?(i=g,h):i},h.y=function(g){return arguments.length?(a=g,h):a},h.radius=function(g){return arguments.length?(o=+g,s=o*2*Math.sin(nu),l=o*1.5,h):o},h.size=function(g){return arguments.length?(e=r=0,t=+g[0],n=+g[1],h):[t-e,n-r]},h.extent=function(g){return arguments.length?(e=+g[0][0],r=+g[0][1],t=+g[1][0],n=+g[1][1],h):[[e,r],[t,n]]},h.radius(1)}function gs(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function _s(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?gs(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gs(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Yl=6378e3;function il(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,o=a===void 0?"sum":a,s=i/(2*Math.PI*Yl)*(256<<20)/2,l=t.map(function(y){var E=Ia(y.coordinates),b=(0,Rn.Z)(E,2),w=b[0],F=b[1];return _s(_s({},y),{},{coordinates:[w,F]})}),h=Xl().radius(s).x(function(y){return y.coordinates[0]}).y(function(y){return y.coordinates[1]}),d=h(l),g={dataArray:d.map(function(y,E){var b;if(r.field&&o){var w=tu(y,r.field);y[o]=Tu[o](w)}return b={},(0,p.Z)(b,r.method,y[o]),(0,p.Z)(b,"count",y.length),(0,p.Z)(b,"rawData",y),(0,p.Z)(b,"coordinates",[y.x,y.y]),(0,p.Z)(b,"_id",E),b}),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return g}function $l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Li(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?$l(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$l(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ra(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(o){a[o[t]]=o}),e.dataArray=e.dataArray.map(function(o){var s=o[n];return Li(Li({},o),a[s])}),e}function yh(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}ne("geojson",Wu),ne("image",os),ne("csv",sn),ne("json",Mt),ne("raster",us),pe("cluster",gf),pe("filter",gh),pe("join",ra),pe("map",yh),pe("grid",tl),pe("hexagon",il);var Ef=Sr,Fc=gr,al=yf,m0=T(28660),Ut=T(86700),Eh=T(84879),Qe={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},ys=T(31745),Kl=T.n(ys);function xf(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Sf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?xf(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ro(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ql(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function ql(e,r){if(!!e){if(typeof e=="string")return Du(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Du(e,r)}}function Du(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var sa=30;function Nc(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,o=e.mapping,s=o===void 0?{}:o,l=e.xOffset,h=l===void 0?0:l,d=e.yOffset,g=d===void 0?0:d,y=0,E=h;Array.from(r).forEach(function(w,F){if(!s[w]){var ee=t(w,F);E+sa>a&&(E=0,y++),s[w]={x:E,y:g+y*sa,width:sa,height:sa,advance:ee},E+=sa}});var b=n+i*2;return{mapping:s,xOffset:E,yOffset:g+y*b,canvasHeight:kc(g+(y+1)*b)}}function ol(e,r,t){var n=0,i=0,a=0,o=[],s={},l=ro(e),h;try{for(l.s();!(h=l.n()).done;){var d=h.value;if(!s[d.id]){var g=d.size;n+g+r>t&&(Ql(s,o,i),n=0,i=a+i+r,a=0,o=[]),o.push({icon:d,xOffset:n}),n=n+g+r,a=Math.max(a,g)}}}catch(E){l.e(E)}finally{l.f()}o.length>0&&Ql(s,o,i);var y=kc(a+i+r);return{mapping:s,canvasHeight:y}}function Ql(e,r,t){var n=ro(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.icon,s=a.xOffset;e[o.id]=Sf(Sf({},o),{},{x:s,y:t,image:o.image,width:o.width,height:o.height})}}catch(l){n.e(l)}finally{n.f()}}function kc(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var ui,Zo;function oi(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=xa(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function xa(e,r){if(!!e){if(typeof e=="string")return Bc(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Bc(e,r)}}function Bc(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Uo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Zc(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Uo(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Uo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var xh=zc(),g0="sans-serif",Cf="normal",_0=24,y0=3,iu=.25,Af=8,Uc=1024,Gc=1,ul=1,Es=3,Wr=null;function zc(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function Jl(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function Fu(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var S=(ui=(0,Ut.b2)(),ui(Zo=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"fontAtlas",void 0),(0,p.Z)(this,"iconFontMap",void 0),(0,p.Z)(this,"iconFontGlyphs",{}),(0,p.Z)(this,"fontOptions",void 0),(0,p.Z)(this,"key",void 0),(0,p.Z)(this,"cache",new po(Es))}return(0,mt.Z)(e,[{key:"scale",get:function(){return ul}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:g0,fontWeight:Cf,characterSet:xh,fontSize:_0,buffer:y0,sdf:!0,cutoff:iu,radius:Af,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var n=this;t.forEach(function(i){n.iconFontGlyphs[i.name]=i.unicode})}},{key:"addIconFont",value:function(t,n){this.iconFontMap.set(t,n)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=Zc(Zc({},this.fontOptions),t),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(!(i&&n.length===0)){var a=this.generateFontAtlas(this.key,n,i);this.fontAtlas=a,this.cache.set(this.key,a)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,n,i){var a=this.fontOptions,o=a.fontFamily,s=a.fontWeight,l=a.fontSize,h=a.buffer,d=a.sdf,g=a.radius,y=a.cutoff,E=a.iconfont,b=i&&i.data;b||(b=Wt.document.createElement("canvas"),b.width=Uc);var w=b.getContext("2d");Jl(w,o,l,s);var F=Nc(Zc({getFontWidth:function(oa){return w.measureText(oa).width},fontHeight:l*ul,buffer:h,characterSet:n,maxCanvasWidth:Uc},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),ee=F.mapping,se=F.canvasHeight,ge=F.xOffset,Ee=F.yOffset,je=w.getImageData(0,0,b.width,b.height);if(b.height=se,w.putImageData(je,0,0),Jl(w,o,l,s),d){var Ve=new(Kl())(l,h,g,y,o,s),rt=w.getImageData(0,0,Ve.size,Ve.size),Et=oi(n),zt;try{for(Et.s();!(zt=Et.n()).done;){var er=zt.value;if(E){var Rt=String.fromCharCode(parseInt(er.replace("&#x","").replace(";",""),16)),pr=Ve.draw(Rt);Fu(pr,rt)}else Fu(Ve.draw(er),rt);w.putImageData(rt,ee[er].x,ee[er].y)}}catch(_i){Et.e(_i)}finally{Et.f()}}else{var xr=oi(n),Ur;try{for(xr.s();!(Ur=xr.n()).done;){var ti=Ur.value;w.fillText(ti,ee[ti].x,ee[ti].y+l*Gc)}}catch(_i){xr.e(_i)}finally{xr.f()}}return{xOffset:ge,yOffset:Ee,mapping:ee,data:b,width:b.width,height:b.height}}},{key:"getKey",value:function(){return"key";var t,n,i,a,o,s,l,h}},{key:"getNewChars",value:function(t,n){var i=this.cache.get(t);if(!i)return n;var a=[],o=i.mapping,s=new Set(Object.keys(o)),l=new Set(n);return l.forEach(function(h){s.has(h)||a.push(h)}),a}}]),e}())||Zo),G,ie;function De(e){var r=pt();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function pt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ze=3,tt=1024,gt=64,bt=(G=(0,Ut.b2)(),G(ie=function(e){(0,lr.Z)(t,e);var r=De(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"canvasHeight",128),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"canvas",void 0),(0,p.Z)((0,z.Z)(n),"iconData",void 0),(0,p.Z)((0,z.Z)(n),"iconMap",void 0),(0,p.Z)((0,z.Z)(n),"ctx",void 0),(0,p.Z)((0,z.Z)(n),"loadingImageCount",0),n}return(0,mt.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Wt.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(i,a){var o=this,s=new Image;if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:gt}),this.updateIconMap(),this.loadImage(a).then(function(l){s=l;var h=o.iconData.find(function(d){return d.id===i});h&&(h.image=s,h.width=s.width,h.height=s.height),o.update()})}},{key:"addImageMini",value:function(i,a,o){var s=this,l=o.getSceneConfig().canvas,h=l.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:gt}),this.updateIconMap(),this.loadImageMini(a,l).then(function(d){h=d;var g=s.iconData.find(function(y){return y.id===i});g&&(g.image=h,g.width=h.width,g.height=h.height),s.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,o){if(i instanceof HTMLImageElement){a(i);return}var s=new Image;s.crossOrigin="anonymous",s.onload=function(){a(s)},s.onerror=function(){o(new Error("Could not load image at "+i))},s.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=tt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var o=i.iconMap[a],s=o.x,l=o.y,h=o.image,d=o.width,g=d===void 0?64:d,y=o.height,E=y===void 0?64:y,b=Math.max(g,E),w=b/gt,F=E/w,ee=g/w;h&&i.ctx.drawImage(h,s+(gt-ee)/2,l+(gt-F)/2,ee,F)})}},{key:"updateIconMap",value:function(){var i=ol(this.iconData,ze,tt),a=i.mapping,o=i.canvasHeight;this.iconMap=a,this.canvasHeight=o}},{key:"loadImageMini",value:function(i,a){return new Promise(function(o,s){var l=a.createImage();l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i})}}]),t}(Ki.EventEmitter))||ie),vt=1e-6,At=typeof Float32Array!="undefined"?Float32Array:Array,Ft=Math.random;function kt(e){At=e}var _t=Math.PI/180;function Dt(e){return e*_t}function Ce(e,r){return Math.abs(e-r)<=vt*Math.max(1,Math.abs(e),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function He(){var e=new At(16);return At!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function wt(e){var r=new At(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function tr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function yt(e,r,t,n,i,a,o,s,l,h,d,g,y,E,b,w){var F=new At(16);return F[0]=e,F[1]=r,F[2]=t,F[3]=n,F[4]=i,F[5]=a,F[6]=o,F[7]=s,F[8]=l,F[9]=h,F[10]=d,F[11]=g,F[12]=y,F[13]=E,F[14]=b,F[15]=w,F}function Qt(e,r,t,n,i,a,o,s,l,h,d,g,y,E,b,w,F){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=h,e[9]=d,e[10]=g,e[11]=y,e[12]=E,e[13]=b,e[14]=w,e[15]=F,e}function Kt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function br(e,r){if(e===r){var t=r[1],n=r[2],i=r[3],a=r[6],o=r[7],s=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=a,e[11]=r[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function ht(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],l=r[6],h=r[7],d=r[8],g=r[9],y=r[10],E=r[11],b=r[12],w=r[13],F=r[14],ee=r[15],se=t*s-n*o,ge=t*l-i*o,Ee=t*h-a*o,je=n*l-i*s,Ve=n*h-a*s,rt=i*h-a*l,Et=d*w-g*b,zt=d*F-y*b,er=d*ee-E*b,Rt=g*F-y*w,pr=g*ee-E*w,xr=y*ee-E*F,Ur=se*xr-ge*pr+Ee*Rt+je*er-Ve*zt+rt*Et;return Ur?(Ur=1/Ur,e[0]=(s*xr-l*pr+h*Rt)*Ur,e[1]=(i*pr-n*xr-a*Rt)*Ur,e[2]=(w*rt-F*Ve+ee*je)*Ur,e[3]=(y*Ve-g*rt-E*je)*Ur,e[4]=(l*er-o*xr-h*zt)*Ur,e[5]=(t*xr-i*er+a*zt)*Ur,e[6]=(F*Ee-b*rt-ee*ge)*Ur,e[7]=(d*rt-y*Ee+E*ge)*Ur,e[8]=(o*pr-s*er+h*Et)*Ur,e[9]=(n*er-t*pr-a*Et)*Ur,e[10]=(b*Ve-w*Ee+ee*se)*Ur,e[11]=(g*Ee-d*Ve-E*se)*Ur,e[12]=(s*zt-o*Rt-l*Et)*Ur,e[13]=(t*Rt-n*zt+i*Et)*Ur,e[14]=(w*ge-b*je-F*se)*Ur,e[15]=(d*je-g*ge+y*se)*Ur,e):null}function st(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],l=r[6],h=r[7],d=r[8],g=r[9],y=r[10],E=r[11],b=r[12],w=r[13],F=r[14],ee=r[15];return e[0]=s*(y*ee-E*F)-g*(l*ee-h*F)+w*(l*E-h*y),e[1]=-(n*(y*ee-E*F)-g*(i*ee-a*F)+w*(i*E-a*y)),e[2]=n*(l*ee-h*F)-s*(i*ee-a*F)+w*(i*h-a*l),e[3]=-(n*(l*E-h*y)-s*(i*E-a*y)+g*(i*h-a*l)),e[4]=-(o*(y*ee-E*F)-d*(l*ee-h*F)+b*(l*E-h*y)),e[5]=t*(y*ee-E*F)-d*(i*ee-a*F)+b*(i*E-a*y),e[6]=-(t*(l*ee-h*F)-o*(i*ee-a*F)+b*(i*h-a*l)),e[7]=t*(l*E-h*y)-o*(i*E-a*y)+d*(i*h-a*l),e[8]=o*(g*ee-E*w)-d*(s*ee-h*w)+b*(s*E-h*g),e[9]=-(t*(g*ee-E*w)-d*(n*ee-a*w)+b*(n*E-a*g)),e[10]=t*(s*ee-h*w)-o*(n*ee-a*w)+b*(n*h-a*s),e[11]=-(t*(s*E-h*g)-o*(n*E-a*g)+d*(n*h-a*s)),e[12]=-(o*(g*F-y*w)-d*(s*F-l*w)+b*(s*y-l*g)),e[13]=t*(g*F-y*w)-d*(n*F-i*w)+b*(n*y-i*g),e[14]=-(t*(s*F-l*w)-o*(n*F-i*w)+b*(n*l-i*s)),e[15]=t*(s*y-l*g)-o*(n*y-i*g)+d*(n*l-i*s),e}function or(e){var r=e[0],t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],h=e[8],d=e[9],g=e[10],y=e[11],E=e[12],b=e[13],w=e[14],F=e[15],ee=r*o-t*a,se=r*s-n*a,ge=r*l-i*a,Ee=t*s-n*o,je=t*l-i*o,Ve=n*l-i*s,rt=h*b-d*E,Et=h*w-g*E,zt=h*F-y*E,er=d*w-g*b,Rt=d*F-y*b,pr=g*F-y*w;return ee*pr-se*Rt+ge*er+Ee*zt-je*Et+Ve*rt}function Bt(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],h=r[6],d=r[7],g=r[8],y=r[9],E=r[10],b=r[11],w=r[12],F=r[13],ee=r[14],se=r[15],ge=t[0],Ee=t[1],je=t[2],Ve=t[3];return e[0]=ge*n+Ee*s+je*g+Ve*w,e[1]=ge*i+Ee*l+je*y+Ve*F,e[2]=ge*a+Ee*h+je*E+Ve*ee,e[3]=ge*o+Ee*d+je*b+Ve*se,ge=t[4],Ee=t[5],je=t[6],Ve=t[7],e[4]=ge*n+Ee*s+je*g+Ve*w,e[5]=ge*i+Ee*l+je*y+Ve*F,e[6]=ge*a+Ee*h+je*E+Ve*ee,e[7]=ge*o+Ee*d+je*b+Ve*se,ge=t[8],Ee=t[9],je=t[10],Ve=t[11],e[8]=ge*n+Ee*s+je*g+Ve*w,e[9]=ge*i+Ee*l+je*y+Ve*F,e[10]=ge*a+Ee*h+je*E+Ve*ee,e[11]=ge*o+Ee*d+je*b+Ve*se,ge=t[12],Ee=t[13],je=t[14],Ve=t[15],e[12]=ge*n+Ee*s+je*g+Ve*w,e[13]=ge*i+Ee*l+je*y+Ve*F,e[14]=ge*a+Ee*h+je*E+Ve*ee,e[15]=ge*o+Ee*d+je*b+Ve*se,e}function Ot(e,r,t){var n=t[0],i=t[1],a=t[2],o,s,l,h,d,g,y,E,b,w,F,ee;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],l=r[2],h=r[3],d=r[4],g=r[5],y=r[6],E=r[7],b=r[8],w=r[9],F=r[10],ee=r[11],e[0]=o,e[1]=s,e[2]=l,e[3]=h,e[4]=d,e[5]=g,e[6]=y,e[7]=E,e[8]=b,e[9]=w,e[10]=F,e[11]=ee,e[12]=o*n+d*i+b*a+r[12],e[13]=s*n+g*i+w*a+r[13],e[14]=l*n+y*i+F*a+r[14],e[15]=h*n+E*i+ee*a+r[15]),e}function Xt(e,r,t){var n=t[0],i=t[1],a=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Yt(e,r,t,n){var i=n[0],a=n[1],o=n[2],s=Math.hypot(i,a,o),l,h,d,g,y,E,b,w,F,ee,se,ge,Ee,je,Ve,rt,Et,zt,er,Rt,pr,xr,Ur,ti;return s<vt?null:(s=1/s,i*=s,a*=s,o*=s,l=Math.sin(t),h=Math.cos(t),d=1-h,g=r[0],y=r[1],E=r[2],b=r[3],w=r[4],F=r[5],ee=r[6],se=r[7],ge=r[8],Ee=r[9],je=r[10],Ve=r[11],rt=i*i*d+h,Et=a*i*d+o*l,zt=o*i*d-a*l,er=i*a*d-o*l,Rt=a*a*d+h,pr=o*a*d+i*l,xr=i*o*d+a*l,Ur=a*o*d-i*l,ti=o*o*d+h,e[0]=g*rt+w*Et+ge*zt,e[1]=y*rt+F*Et+Ee*zt,e[2]=E*rt+ee*Et+je*zt,e[3]=b*rt+se*Et+Ve*zt,e[4]=g*er+w*Rt+ge*pr,e[5]=y*er+F*Rt+Ee*pr,e[6]=E*er+ee*Rt+je*pr,e[7]=b*er+se*Rt+Ve*pr,e[8]=g*xr+w*Ur+ge*ti,e[9]=y*xr+F*Ur+Ee*ti,e[10]=E*xr+ee*Ur+je*ti,e[11]=b*xr+se*Ur+Ve*ti,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function Nr(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[4],o=r[5],s=r[6],l=r[7],h=r[8],d=r[9],g=r[10],y=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*i+h*n,e[5]=o*i+d*n,e[6]=s*i+g*n,e[7]=l*i+y*n,e[8]=h*i-a*n,e[9]=d*i-o*n,e[10]=g*i-s*n,e[11]=y*i-l*n,e}function Mr(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],s=r[2],l=r[3],h=r[8],d=r[9],g=r[10],y=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i-h*n,e[1]=o*i-d*n,e[2]=s*i-g*n,e[3]=l*i-y*n,e[8]=a*n+h*i,e[9]=o*n+d*i,e[10]=s*n+g*i,e[11]=l*n+y*i,e}function $t(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],s=r[2],l=r[3],h=r[4],d=r[5],g=r[6],y=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+h*n,e[1]=o*i+d*n,e[2]=s*i+g*n,e[3]=l*i+y*n,e[4]=h*i-a*n,e[5]=d*i-o*n,e[6]=g*i-s*n,e[7]=y*i-l*n,e}function Jt(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Or(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ir(e,r,t){var n=t[0],i=t[1],a=t[2],o=Math.hypot(n,i,a),s,l,h;return o<vt?null:(o=1/o,n*=o,i*=o,a*=o,s=Math.sin(r),l=Math.cos(r),h=1-l,e[0]=n*n*h+l,e[1]=i*n*h+a*s,e[2]=a*n*h-i*s,e[3]=0,e[4]=n*i*h-a*s,e[5]=i*i*h+l,e[6]=a*i*h+n*s,e[7]=0,e[8]=n*a*h+i*s,e[9]=i*a*h-n*s,e[10]=a*a*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function en(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function An(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Un(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tn(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],s=n+n,l=i+i,h=a+a,d=n*s,g=n*l,y=n*h,E=i*l,b=i*h,w=a*h,F=o*s,ee=o*l,se=o*h;return e[0]=1-(E+w),e[1]=g+se,e[2]=y-ee,e[3]=0,e[4]=g-se,e[5]=1-(d+w),e[6]=b+F,e[7]=0,e[8]=y+ee,e[9]=b-F,e[10]=1-(d+E),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ti(e,r){var t=new At(3),n=-r[0],i=-r[1],a=-r[2],o=r[3],s=r[4],l=r[5],h=r[6],d=r[7],g=n*n+i*i+a*a+o*o;return g>0?(t[0]=(s*o+d*n+l*a-h*i)*2/g,t[1]=(l*o+d*i+h*n-s*a)*2/g,t[2]=(h*o+d*a+s*i-l*n)*2/g):(t[0]=(s*o+d*n+l*a-h*i)*2,t[1]=(l*o+d*i+h*n-s*a)*2,t[2]=(h*o+d*a+s*i-l*n)*2),tn(e,r,t),e}function jn(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function Ei(e,r){var t=r[0],n=r[1],i=r[2],a=r[4],o=r[5],s=r[6],l=r[8],h=r[9],d=r[10];return e[0]=Math.hypot(t,n,i),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(l,h,d),e}function pi(e,r){var t=new At(3);Ei(t,r);var n=1/t[0],i=1/t[1],a=1/t[2],o=r[0]*n,s=r[1]*i,l=r[2]*a,h=r[4]*n,d=r[5]*i,g=r[6]*a,y=r[8]*n,E=r[9]*i,b=r[10]*a,w=o+d+b,F=0;return w>0?(F=Math.sqrt(w+1)*2,e[3]=.25*F,e[0]=(g-E)/F,e[1]=(y-l)/F,e[2]=(s-h)/F):o>d&&o>b?(F=Math.sqrt(1+o-d-b)*2,e[3]=(g-E)/F,e[0]=.25*F,e[1]=(s+h)/F,e[2]=(y+l)/F):d>b?(F=Math.sqrt(1+d-o-b)*2,e[3]=(y-l)/F,e[0]=(s+h)/F,e[1]=.25*F,e[2]=(g+E)/F):(F=Math.sqrt(1+b-o-d)*2,e[3]=(s-h)/F,e[0]=(y+l)/F,e[1]=(g+E)/F,e[2]=.25*F),e}function Mi(e,r,t,n){var i=r[0],a=r[1],o=r[2],s=r[3],l=i+i,h=a+a,d=o+o,g=i*l,y=i*h,E=i*d,b=a*h,w=a*d,F=o*d,ee=s*l,se=s*h,ge=s*d,Ee=n[0],je=n[1],Ve=n[2];return e[0]=(1-(b+F))*Ee,e[1]=(y+ge)*Ee,e[2]=(E-se)*Ee,e[3]=0,e[4]=(y-ge)*je,e[5]=(1-(g+F))*je,e[6]=(w+ee)*je,e[7]=0,e[8]=(E+se)*Ve,e[9]=(w-ee)*Ve,e[10]=(1-(g+b))*Ve,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Di(e,r,t,n,i){var a=r[0],o=r[1],s=r[2],l=r[3],h=a+a,d=o+o,g=s+s,y=a*h,E=a*d,b=a*g,w=o*d,F=o*g,ee=s*g,se=l*h,ge=l*d,Ee=l*g,je=n[0],Ve=n[1],rt=n[2],Et=i[0],zt=i[1],er=i[2],Rt=(1-(w+ee))*je,pr=(E+Ee)*je,xr=(b-ge)*je,Ur=(E-Ee)*Ve,ti=(1-(y+ee))*Ve,_i=(F+se)*Ve,oa=(b+ge)*rt,bo=(F-se)*rt,so=(1-(y+w))*rt;return e[0]=Rt,e[1]=pr,e[2]=xr,e[3]=0,e[4]=Ur,e[5]=ti,e[6]=_i,e[7]=0,e[8]=oa,e[9]=bo,e[10]=so,e[11]=0,e[12]=t[0]+Et-(Rt*Et+Ur*zt+oa*er),e[13]=t[1]+zt-(pr*Et+ti*zt+bo*er),e[14]=t[2]+er-(xr*Et+_i*zt+so*er),e[15]=1,e}function Zi(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t+t,s=n+n,l=i+i,h=t*o,d=n*o,g=n*s,y=i*o,E=i*s,b=i*l,w=a*o,F=a*s,ee=a*l;return e[0]=1-g-b,e[1]=d+ee,e[2]=y-F,e[3]=0,e[4]=d-ee,e[5]=1-h-b,e[6]=E+w,e[7]=0,e[8]=y+F,e[9]=E-w,e[10]=1-h-g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vi(e,r,t,n,i,a,o){var s=1/(t-r),l=1/(i-n),h=1/(a-o);return e[0]=a*2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*l,e[6]=0,e[7]=0,e[8]=(t+r)*s,e[9]=(i+n)*l,e[10]=(o+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*h,e[15]=0,e}function jr(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}var Oi=jr;function bn(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(o=1/(n-i),e[10]=i*o,e[14]=i*n*o):(e[10]=-1,e[14]=-n),e}function Ri(e,r,t,n){var i=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),o=Math.tan(r.leftDegrees*Math.PI/180),s=Math.tan(r.rightDegrees*Math.PI/180),l=2/(o+s),h=2/(i+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((o-s)*l*.5),e[9]=(i-a)*h*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function Rr(e,r,t,n,i,a,o){var s=1/(r-t),l=1/(n-i),h=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(r+t)*s,e[13]=(i+n)*l,e[14]=(o+a)*h,e[15]=1,e}var qr=Rr;function Pn(e,r,t,n,i,a,o){var s=1/(r-t),l=1/(n-i),h=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(r+t)*s,e[13]=(i+n)*l,e[14]=a*h,e[15]=1,e}function mi(e,r,t,n){var i,a,o,s,l,h,d,g,y,E,b=r[0],w=r[1],F=r[2],ee=n[0],se=n[1],ge=n[2],Ee=t[0],je=t[1],Ve=t[2];return Math.abs(b-Ee)<vt&&Math.abs(w-je)<vt&&Math.abs(F-Ve)<vt?Kt(e):(d=b-Ee,g=w-je,y=F-Ve,E=1/Math.hypot(d,g,y),d*=E,g*=E,y*=E,i=se*y-ge*g,a=ge*d-ee*y,o=ee*g-se*d,E=Math.hypot(i,a,o),E?(E=1/E,i*=E,a*=E,o*=E):(i=0,a=0,o=0),s=g*o-y*a,l=y*i-d*o,h=d*a-g*i,E=Math.hypot(s,l,h),E?(E=1/E,s*=E,l*=E,h*=E):(s=0,l=0,h=0),e[0]=i,e[1]=s,e[2]=d,e[3]=0,e[4]=a,e[5]=l,e[6]=g,e[7]=0,e[8]=o,e[9]=h,e[10]=y,e[11]=0,e[12]=-(i*b+a*w+o*F),e[13]=-(s*b+l*w+h*F),e[14]=-(d*b+g*w+y*F),e[15]=1,e)}function au(e,r,t,n){var i=r[0],a=r[1],o=r[2],s=n[0],l=n[1],h=n[2],d=i-t[0],g=a-t[1],y=o-t[2],E=d*d+g*g+y*y;E>0&&(E=1/Math.sqrt(E),d*=E,g*=E,y*=E);var b=l*y-h*g,w=h*d-s*y,F=s*g-l*d;return E=b*b+w*w+F*F,E>0&&(E=1/Math.sqrt(E),b*=E,w*=E,F*=E),e[0]=b,e[1]=w,e[2]=F,e[3]=0,e[4]=g*F-y*w,e[5]=y*b-d*F,e[6]=d*w-g*b,e[7]=0,e[8]=d,e[9]=g,e[10]=y,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function te(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ye(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ne(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function nr(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function on(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function q(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function N(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function ue(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],h=e[7],d=e[8],g=e[9],y=e[10],E=e[11],b=e[12],w=e[13],F=e[14],ee=e[15],se=r[0],ge=r[1],Ee=r[2],je=r[3],Ve=r[4],rt=r[5],Et=r[6],zt=r[7],er=r[8],Rt=r[9],pr=r[10],xr=r[11],Ur=r[12],ti=r[13],_i=r[14],oa=r[15];return Math.abs(t-se)<=vt*Math.max(1,Math.abs(t),Math.abs(se))&&Math.abs(n-ge)<=vt*Math.max(1,Math.abs(n),Math.abs(ge))&&Math.abs(i-Ee)<=vt*Math.max(1,Math.abs(i),Math.abs(Ee))&&Math.abs(a-je)<=vt*Math.max(1,Math.abs(a),Math.abs(je))&&Math.abs(o-Ve)<=vt*Math.max(1,Math.abs(o),Math.abs(Ve))&&Math.abs(s-rt)<=vt*Math.max(1,Math.abs(s),Math.abs(rt))&&Math.abs(l-Et)<=vt*Math.max(1,Math.abs(l),Math.abs(Et))&&Math.abs(h-zt)<=vt*Math.max(1,Math.abs(h),Math.abs(zt))&&Math.abs(d-er)<=vt*Math.max(1,Math.abs(d),Math.abs(er))&&Math.abs(g-Rt)<=vt*Math.max(1,Math.abs(g),Math.abs(Rt))&&Math.abs(y-pr)<=vt*Math.max(1,Math.abs(y),Math.abs(pr))&&Math.abs(E-xr)<=vt*Math.max(1,Math.abs(E),Math.abs(xr))&&Math.abs(b-Ur)<=vt*Math.max(1,Math.abs(b),Math.abs(Ur))&&Math.abs(w-ti)<=vt*Math.max(1,Math.abs(w),Math.abs(ti))&&Math.abs(F-_i)<=vt*Math.max(1,Math.abs(F),Math.abs(_i))&&Math.abs(ee-oa)<=vt*Math.max(1,Math.abs(ee),Math.abs(oa))}var _e=Bt,We=nr,de,fe,me=(de=(0,Ut.b2)(),de(fe=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"viewport",void 0),(0,p.Z)(this,"overridedViewProjectionMatrix",void 0),(0,p.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,p.Z)(this,"jitteredProjectionMatrix",void 0),(0,p.Z)(this,"viewMatrixInverse",void 0),(0,p.Z)(this,"cameraPosition",void 0)}return(0,mt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=He(),ht(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,Rn.Z)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=Jt(He(),[t,n,0]);this.jitteredProjectionMatrix=Bt(He(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Bt(He(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||fe),H,ae;function J(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Se(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function Se(e,r){if(!!e){if(typeof e=="string")return Le(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Le(e,r)}}function Le(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var xt=(H=(0,Ut.b2)(),H(ae=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"container",void 0),(0,p.Z)(this,"controlCorners",void 0),(0,p.Z)(this,"controlContainer",void 0),(0,p.Z)(this,"scene",void 0),(0,p.Z)(this,"mapsService",void 0),(0,p.Z)(this,"controls",[]),(0,p.Z)(this,"unAddControls",[])}return(0,mt.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Qe.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Qe.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=J(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=Cn("div",n+"control-container",this.container);function a(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=o.map(function(l){return n+l}).join(" ");t[o.join("")]=Cn("div",s,i)}a(["top","left"]),a(["top","right"]),a(["bottom","left"]),a(["bottom","right"]),a(["top","center"]),a(["right","center"]),a(["left","center"]),a(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&qo(this.controlCorners[t]);this.controlContainer&&qo(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||ae),Ht,jt,qt=(Ht=(0,Ut.b2)(),Ht(jt=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"container",void 0),(0,p.Z)(this,"scene",void 0),(0,p.Z)(this,"mapsService",void 0),(0,p.Z)(this,"markers",[]),(0,p.Z)(this,"markerLayers",[]),(0,p.Z)(this,"unAddMarkers",[]),(0,p.Z)(this,"unAddMarkerLayers",[])}return(0,mt.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Qe.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||jt),Gt,fr,rr=(Gt=(0,Ut.b2)(),Gt(fr=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"scene",void 0),(0,p.Z)(this,"popup",void 0),(0,p.Z)(this,"mapsService",void 0),(0,p.Z)(this,"unAddPopup",void 0)}return(0,mt.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Qe.IMapService)}}]),e}())||fr),ur=T(82492),sr=T.n(ur),hr={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Pr=hr,Gn,Pi;function Go(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function yo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Go(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Go(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var ou={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},na={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},zo=(Gn=(0,Ut.b2)(),Gn(Pi=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"sceneConfigCache",{}),(0,p.Z)(this,"layerConfigCache",{})}return(0,mt.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Pr[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=yo(yo({},ou),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=yo({},sr()({},this.sceneConfigCache[t],na,i))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Pi);function wr(e,r,t,n){!t||Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Xr(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(o,s){return s(e,r,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}function Sa(){var e=new At(4);return At!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Sh(e){var r=new glMatrix.ARRAY_TYPE(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function bv(e,r,t,n){var i=new At(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function Cg(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Ag(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function bg(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function Tg(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function Mg(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function Og(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function Rg(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Tv(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function Pg(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function E0(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function wg(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function Ig(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Lg(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function Dg(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,i,a)}function Fg(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+i*i+a*a}function Ng(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function kg(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function Bg(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function Zg(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function Ug(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t*t+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function Gg(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function zg(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],o=t[0]*n[3]-t[3]*n[0],s=t[1]*n[2]-t[2]*n[1],l=t[1]*n[3]-t[3]*n[1],h=t[2]*n[3]-t[3]*n[2],d=r[0],g=r[1],y=r[2],E=r[3];return e[0]=g*h-y*l+E*s,e[1]=-(d*h)+y*o-E*a,e[2]=d*l-g*o+E*i,e[3]=-(d*s)+g*a-y*i,e}function Hg(e,r,t,n){var i=r[0],a=r[1],o=r[2],s=r[3];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e[3]=s+n*(t[3]-s),e}function jg(e,r){r=r||1;var t,n,i,a,o,s;do t=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,o=t*t+n*n;while(o>=1);do i=glMatrix.RANDOM()*2-1,a=glMatrix.RANDOM()*2-1,s=i*i+a*a;while(s>=1);var l=Math.sqrt((1-o)/s);return e[0]=r*t,e[1]=r*n,e[2]=r*i*l,e[3]=r*a*l,e}function pd(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*o,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*o,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*o,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*o,e}function Vg(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],s=t[1],l=t[2],h=t[3],d=h*n+s*a-l*i,g=h*i+l*n-o*a,y=h*a+o*i-s*n,E=-o*n-s*i-l*a;return e[0]=d*h+E*-o+g*-l-y*-s,e[1]=g*h+E*-s+y*-o-d*-l,e[2]=y*h+E*-l+d*-s-g*-o,e[3]=r[3],e}function Mv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ov(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Wg(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Xg(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=r[0],s=r[1],l=r[2],h=r[3];return Math.abs(t-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(n-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))}var Yg=null,$g=null,x0=null,Kg=null,qg=null,Qg=null,Jg=null,e_=function(){var e=Sa();return function(r,t,n,i,a,o){var s,l;for(t||(t=4),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],e[3]=r[s+3],a(e,e,o),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2],r[s+3]=e[3];return r}}(),S0=Math.PI/180,Rv=512,vd=4003e4;function md(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,o=e.highPrecision,s=o===void 0?!1:o,l=e.flipY,h=l===void 0?!1:l;a=a!==void 0?a:Math.pow(2,i);var d={},g=Rv*a,y=Math.cos(t*S0),E=g/360,b=E/y,w=g/vd/y;if(d.pixelsPerMeter=[w,-w,w],d.metersPerPixel=[1/w,-1/w,1/w],d.pixelsPerDegree=[E,-b,w],d.degreesPerPixel=[1/E,-1/b,1/w],s){var F=S0*Math.tan(t*S0)/y,ee=E*F/2,se=g/vd*F,ge=se/b*w;d.pixelsPerDegree2=[0,-ee,se],d.pixelsPerMeter2=[ge,0,ge],h&&(d.pixelsPerDegree2[1]=-d.pixelsPerDegree2[1],d.pixelsPerMeter2[1]=-d.pixelsPerMeter2[1])}return h&&(d.pixelsPerMeter[1]=-d.pixelsPerMeter[1],d.metersPerPixel[1]=-d.metersPerPixel[1],d.pixelsPerDegree[1]=-d.pixelsPerDegree[1],d.degreesPerPixel[1]=-d.degreesPerPixel[1]),d}var sl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(sl||(sl={}));var ec={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},bf,gd,C0,Ch,Ah,_d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],yd=(bf=(0,Ut.b2)(),gd=(0,Ut.f3)(Qe.ICameraService),bf(C0=(Ch=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"needRefresh",!0),wr(this,"cameraService",Ah,this),(0,p.Z)(this,"coordinateSystem",void 0),(0,p.Z)(this,"viewportCenter",void 0),(0,p.Z)(this,"viewportCenterProjection",void 0),(0,p.Z)(this,"pixelsPerDegree",void 0),(0,p.Z)(this,"pixelsPerDegree2",void 0),(0,p.Z)(this,"pixelsPerMeter",void 0)}return(0,mt.Z)(e,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),i=this.cameraService.getCenter(),a=md({latitude:i[1],zoom:t}),o=a.pixelsPerMeter,s=a.pixelsPerDegree;this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=s,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===sl.LNGLAT||this.coordinateSystem===sl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===sl.LNGLAT_OFFSET?this.calculateLnglatOffset(i,t):this.coordinateSystem===sl.P20_OFFSET&&this.calculateLnglatOffset(i,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var o=md({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),s=o.pixelsPerMeter,l=o.pixelsPerDegree,h=o.pixelsPerDegree2,d=this.cameraService.getViewMatrix(),g=this.cameraService.getProjectionMatrix(),y=Bt([],g,d),E=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=pd([],[E[0],E[1],0,1],y),d=this.cameraService.getViewMatrixUncentered()||d,y=Bt([],g,d),y=Bt([],y,_d),this.cameraService.setViewProjectionMatrix(y),this.pixelsPerMeter=s,this.pixelsPerDegree=l,this.pixelsPerDegree2=h}}]),e}(),Ah=Xr(Ch.prototype,"cameraService",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch))||C0),Ed=T(20396),Hc=T.n(Ed),la;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(la||(la={}));var xd,Sd,Tf,jc,Cd;function Pv(e){var r=A0();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function A0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ad={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},wv=(xd=(0,Ut.b2)(),Sd=(0,Ut.f3)(Qe.IMapService),xd(Tf=(jc=function(e){(0,lr.Z)(t,e);var r=Pv(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"indragging",!1),wr((0,z.Z)(n),"mapService",Cd,(0,z.Z)(n)),(0,p.Z)((0,z.Z)(n),"hammertime",void 0),(0,p.Z)((0,z.Z)(n),"lastClickTime",0),(0,p.Z)((0,z.Z)(n),"lastClickXY",[-1,-1]),(0,p.Z)((0,z.Z)(n),"clickTimer",void 0),(0,p.Z)((0,z.Z)(n),"$containter",void 0),(0,p.Z)((0,z.Z)(n),"onDrag",function(s){var l=n.interactionEvent(s);l.type=Ad[l.type],l.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(la.Drag,l)}),(0,p.Z)((0,z.Z)(n),"onHammer",function(s){s.srcEvent.stopPropagation();var l=n.interactionEvent(s);n.emit(la.Hover,l)}),(0,p.Z)((0,z.Z)(n),"onTouch",function(s){var l=s.touches[0];n.onHover({x:l.pageX,y:l.pageY,type:"touch"})}),(0,p.Z)((0,z.Z)(n),"onHover",function(s){var l=s.clientX,h=s.clientY,d=l,g=h,y=s.type,E=n.mapService.getMapContainer();if(E)if(lt)d=d-E.left-0,g=g-E.top-0;else{var b=E.getBoundingClientRect(),w=b.top,F=b.left;d=d-F-E.clientLeft,g=g-w-E.clientTop}var ee=n.mapService.containerToLngLat([d,g]);if(y==="click"){if(!lt&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(d,g,ee);return}if(y==="touch"){n.isDoubleTap(d,g,ee);return}y!=="click"&&y!=="dblclick"&&n.emit(la.Hover,{x:d,y:g,lngLat:ee,type:y,target:s})}),n}return(0,mt.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(la.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,o=i.y;this.emit(la.Hover,{x:a,y:o})}},{key:"triggerSelect",value:function(i){this.emit(la.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(la.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i)if(lt)Wt.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=new(Hc()).Manager(i);a.add(new(Hc()).Tap({event:"dblclick",taps:2})),a.add(new(Hc()).Tap({event:"click"})),a.add(new(Hc()).Pan({threshold:0,pointers:0})),a.add(new(Hc()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){if(lt)Wt.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(i){var a=i.type,o=i.pointerType,s,l;o==="touch"?(l=Math.floor(i.pointers[0].clientY),s=Math.floor(i.pointers[0].clientX)):(l=Math.floor(i.srcEvent.y),s=Math.floor(i.srcEvent.x));var h=this.mapService.getMapContainer();if(h){var d=h.getBoundingClientRect(),g=d.top,y=d.left;s-=y,l-=g}var E=this.mapService.containerToLngLat([s,l]);return{x:s,y:l,lngLat:E,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,o){var s=this,l=new Date().getTime(),h="click";l-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),h="dblclick",this.emit(la.Hover,{x:i,y:a,lngLat:o,type:h})):(this.lastClickTime=l,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){h="click",s.emit(la.Hover,{x:i,y:a,lngLat:o,type:h})},400))}}]),t}(Iu()),Cd=Xr(jc.prototype,"mapService",[Sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc))||Tf),ca=T(92137),Iv=T(87757),Ln=T.n(Iv),Lv=0;function Dv(e){if(lt)return null;var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Lv++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function Fv(e){var r,t,n=!0;return e==null||(r=e.target)===null||r===void 0||(t=r.path)===null||t===void 0||t.map(function(i){if(i!=null&&i.classList){var a;i==null||(a=i.classList)===null||a===void 0||a.forEach(function(o){(o==="l7-marker"||o==="l7-popup")&&(n=!1)})}}),n}var M;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(M||(M={}));var bd,Td,Md,Od,Ho,Rd,Pd,Eo,pn,wd,Ba,wi,Id;function xs(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function bh(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?xs(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xs(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Nv=(bd=(0,Ut.b2)(),Td=(0,Ut.f3)(Qe.IMapService),Md=(0,Ut.f3)(Qe.IRendererService),Od=(0,Ut.f3)(Qe.IGlobalConfigService),Ho=(0,Ut.f3)(Qe.IInteractionService),Rd=(0,Ut.f3)(Qe.ILayerService),bd(Pd=(Eo=function(){function e(){var r=this;(0,ft.Z)(this,e),wr(this,"mapService",pn,this),wr(this,"rendererService",wd,this),wr(this,"configService",Ba,this),wr(this,"interactionService",wi,this),wr(this,"layerService",Id,this),(0,p.Z)(this,"pickingFBO",void 0),(0,p.Z)(this,"width",0),(0,p.Z)(this,"height",0),(0,p.Z)(this,"alreadyInPicking",!1),(0,p.Z)(this,"pickBufferScale",1),(0,p.Z)(this,"lastPickTime",new Date().getTime()),(0,p.Z)(this,"pickFromPickingFBO",function(t,n){var i,a=n.x,o=n.y,s=n.lngLat,l=n.type,h=n.target,d=!1,g=r.rendererService,y=g.getViewportSize,E=g.readPixels,b=g.getContainer,w=r.getContainerSize(b()),F=w.width,ee=w.height;F*=Qn,ee*=Qn;var se=t.getLayerConfig(),ge=se.enableHighlight,Ee=se.enableSelect,je=a*Qn,Ve=o*Qn;if(je>F-1*Qn||je<0||Ve>ee-1*Qn||Ve<0)return!1;var rt;if(rt=E({x:Math.floor(je/r.pickBufferScale),y:Math.floor((ee-(o+1)*Qn)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),rt[0]!==0||rt[1]!==0||rt[2]!==0){var Et=Vs(rt),zt=t.getSource().getFeatureById(Et);Et!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var er={x:a,y:o,type:l,lngLat:s,featureId:Et,feature:zt,target:h};zt&&(d=!0,t.setCurrentPickId(Et),r.triggerHoverOnLayer(t,er))}else{var Rt={x:a,y:o,lngLat:s,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:h,feature:null};r.triggerHoverOnLayer(t,bh(bh({},Rt),{},{type:"unpick"})),r.triggerHoverOnLayer(t,Rt),t.setCurrentPickId(null)}if(ge&&r.highlightPickedFeature(t,rt),Ee&&l==="click"&&((i=rt)===null||i===void 0?void 0:i.toString())!==[0,0,0,0].toString()){var pr=Vs(rt);t.getCurrentSelectedId()===null||pr!==t.getCurrentSelectedId()?(r.selectFeature(t,rt),t.setCurrentSelectedId(pr)):(r.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return d})}return(0,mt.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,o=n.getViewportSize,s=n.getContainer,l=this.getContainerSize(s()),h=l.width,d=l.height;h*=Qn,d*=Qn,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=a({color:i({width:Math.round(h/this.pickBufferScale),height:Math.round(d/this.pickBufferScale),wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})}),this.interactionService.on(la.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=(0,ca.Z)(Ln().mark(function n(i,a,o){var s=this,l,h,d,g;return Ln().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:l=this.rendererService,h=l.useFramebuffer,d=l.clear,g=l.getContainer,this.resizePickingFBO(),h(this.pickingFBO,function(){d({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels(),i.hooks.afterPickingEncode.call();var b=s.pickBox(i,a);o(b)});case 3:case"end":return E.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,a=n.map(function(Rt){var pr=Rt<0?0:Rt;return Math.floor(pr*Qn/i.pickBufferScale)}),o=(0,Rn.Z)(a,4),s=o[0],l=o[1],h=o[2],d=o[3],g=this.rendererService,y=g.getViewportSize,E=g.readPixels,b=g.getContainer,w=this.getContainerSize(b()),F=w.width,ee=w.height;if(F*=Qn,ee*=Qn,s>(F-1)*Qn/this.pickBufferScale||h<0||l>(ee-1)*Qn/this.pickBufferScale||d<0)return[];var se,ge=Math.min(F/this.pickBufferScale,h)-s,Ee=Math.min(ee/this.pickBufferScale,d)-l;se=E({x:s,y:Math.floor(ee/this.pickBufferScale-(d+1)),width:ge,height:Ee,data:new Uint8Array(ge*Ee*4),framebuffer:this.pickingFBO});for(var je=[],Ve={},rt=0;rt<se.length/4;rt=rt+1){var Et=se.slice(rt*4,rt*4+4),zt=Vs(Et);if(zt!==-1&&!Ve[zt]){var er=t.getSource().getFeatureById(zt);je.push(bh(bh({},er),{},{pickedFeatureIdx:zt})),Ve[zt]=!0}}return je}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,o=a===void 0?"":a,s=i.cursorEnabled;if(s){var l=this.mapService.version,h=l==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),d=h==null?void 0:h.style.getPropertyValue("cursor");n==="unmousemove"&&d!==""?h==null||h.style.setProperty("cursor",""):n==="mousemove"&&(h==null||h.style.setProperty("cursor",o))}}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Qn,height:t.height/Qn}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=(0,ca.Z)(Ln().mark(function n(i){var a;return Ln().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){s.next=2;break}return s.abrupt("return");case 2:if(this.alreadyInPicking=!0,a=new Date().getTime(),!(a-this.lastPickTime>10||i.type==="contextmenu"||i.type==="click")){s.next=7;break}return s.next=7,this.pickingLayers(i);case 7:this.lastPickTime=a,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=Qn,a*=Qn,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=(0,ca.Z)(Ln().mark(function n(i){var a=this,o,s,l,h,d;return Ln().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:o=this.rendererService,s=o.getViewportSize,l=o.useFramebuffer,h=o.clear,d=o.getContainer,this.resizePickingFBO(),l(this.pickingFBO,function(){var E=a.layerService.getRenderList();E.filter(function(b){return b.needPick(i.type)}).reverse().some(function(b){h({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),b.hooks.beforePickingEncode.call(),b.renderModels(!0),b.hooks.afterPickingEncode.call();var w=a.pickFromPickingFBO(b,i);return w&&!b.getLayerConfig().enablePropagation})});case 3:case"end":return y.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Fv(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(t,n){var i=(0,Rn.Z)(n,3),a=i[0],o=i[1],s=i[2];t.hooks.beforeHighlight.call([a,o,s])}},{key:"selectFeature",value:function(t,n){var i=(0,Rn.Z)(n,3),a=i[0],o=i[1],s=i[2];t.hooks.beforeSelect.call([a,o,s])}}]),e}(),pn=Xr(Eo.prototype,"mapService",[Td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=Xr(Eo.prototype,"rendererService",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ba=Xr(Eo.prototype,"configService",[Od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi=Xr(Eo.prototype,"interactionService",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=Xr(Eo.prototype,"layerService",[Rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eo))||Pd),kv=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ft.Z)(this,e),(0,p.Z)(this,"autoStart",void 0),(0,p.Z)(this,"startTime",0),(0,p.Z)(this,"oldTime",0),(0,p.Z)(this,"running",!1),(0,p.Z)(this,"elapsedTime",0),this.autoStart=r}return(0,mt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),Ld,Dd,Th,Fd,Nu,Vc,Mf,xi,Ai;function Nd(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Bv(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function Bv(e,r){if(!!e){if(typeof e=="string")return kd(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kd(e,r)}}function kd(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Zv=(Ld=(0,Ut.b2)(),Dd=(0,Ut.f3)(Qe.IRendererService),Th=(0,Ut.f3)(Qe.IMapService),Fd=(0,Ut.f3)(Qe.IGlobalConfigService),Ld(Nu=(Vc=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"clock",new kv),(0,p.Z)(this,"alreadyInRendering",!1),(0,p.Z)(this,"layers",[]),(0,p.Z)(this,"layerList",[]),(0,p.Z)(this,"layerRenderID",void 0),(0,p.Z)(this,"sceneInited",!1),(0,p.Z)(this,"animateInstanceCount",0),(0,p.Z)(this,"shaderPicking",!0),(0,p.Z)(this,"enableRender",!0),wr(this,"renderService",Mf,this),wr(this,"mapService",xi,this),wr(this,"configService",Ai,this)}return(0,mt.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(n){return n.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(n){return n.name===t})}},{key:"cleanRemove",value:function(t,n){if(n){var i=n.layerChildren.indexOf(t);i>-1&&n.layerChildren.splice(i,1)}else{var a=this.layers.indexOf(t);a>-1&&this.layers.splice(a,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(t,n){if(n){var i=n.layerChildren.indexOf(t);i>-1&&n.layerChildren.splice(i,1)}else{var a=this.layers.indexOf(t);a>-1&&this.layers.splice(a,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var r=(0,ca.Z)(Ln().mark(function n(){var i,a,o;return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){l.next=2;break}return l.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),i=Nd(this.layerList),l.prev=5,i.s();case 7:if((a=i.n()).done){l.next=20;break}if(o=a.value,o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),!o.getLayerConfig().enableMultiPassRenderer){l.next=16;break}return l.next=14,o.renderMultiPass();case 14:l.next=17;break;case 16:o.render();case 17:o.hooks.afterRender.call();case 18:l.next=7;break;case 20:l.next=25;break;case 22:l.prev=22,l.t0=l.catch(5),i.e(l.t0);case 25:return l.prev=25,i.f(),l.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return l.stop()}},n,this,[[5,22,25,28]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){t.layerList.push(n),n.layerChildren.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).forEach(function(i){t.layerList.push(i)})}),this.layerList.sort(function(n,i){return n.zIndex-i.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.layerChildren&&(t.layerChildren.forEach(function(n){return n.destroy()}),t.layerChildren=[]),t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Wt.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var t=Zn(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){Wt.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Mf=Xr(Vc.prototype,"renderService",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi=Xr(Vc.prototype,"mapService",[Th],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=Xr(Vc.prototype,"configService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vc))||Nu),Of=T(81253),Uv=T(14293),Ss=T.n(Uv),Bd=function(){function e(r){var t=this;(0,ft.Z)(this,e),(0,p.Z)(this,"name",void 0),(0,p.Z)(this,"type",void 0),(0,p.Z)(this,"scale",void 0),(0,p.Z)(this,"descriptor",void 0),(0,p.Z)(this,"featureBufferLayout",[]),(0,p.Z)(this,"needRescale",!1),(0,p.Z)(this,"needRemapping",!1),(0,p.Z)(this,"needRegenerateVertices",!1),(0,p.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,p.Z)(this,"vertexAttribute",void 0),(0,p.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,o){var s,l=(s=t.scale)===null||s===void 0?void 0:s.scalers[o].func,h=l(a);return h})}),this.setProps(r)}return(0,mt.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,B.Z)(t));if(!Ss()(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Rf=["buffer","update","name"],tc,Zd,b0,Pf,Za,rc;function Ud(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function T0(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ud(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ud(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function t_(e){return new Promise(function(r){return setTimeout(r,e)})}var Gv=(tc={},(0,p.Z)(tc,M.FLOAT,4),(0,p.Z)(tc,M.UNSIGNED_BYTE,1),(0,p.Z)(tc,M.UNSIGNED_SHORT,2),tc),zv=(Zd=(0,Ut.b2)(),b0=(0,Ut.f3)(Qe.IRendererService),Zd(Pf=(Za=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"attributesAndIndices",void 0),wr(this,"rendererService",rc,this),(0,p.Z)(this,"attributes",[]),(0,p.Z)(this,"triangulation",void 0),(0,p.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,mt.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Bd(t),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute(T0(T0({},n),{},{name:t})));var o=n.scale;o&&a&&(a.scale=o,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,o=this.attributes.find(function(Ee){return Ee.name===t});if(o&&o.descriptor){var s=o.descriptor,l=s.update,h=s.buffer,d=s.size,g=d===void 0?0:d,y=Gv[h.type||M.FLOAT];if(l){var E=this.featureLayout,b=E.elements,w=E.sizePerElement,F=b.slice(i,a);if(!F.length)return;var ee=F[0].offset,se=ee*g*y,ge=F.map(function(Ee,je){for(var Ve=Ee.featureIdx,rt=Ee.vertices,Et=Ee.normals,zt=rt.length/w,er=[],Rt=0;Rt<zt;Rt++){var pr=Et?Et.slice(Rt*3,Rt*3+3):[];er.push.apply(er,(0,B.Z)(l(n[Ve],Ve,rt.slice(Rt*w,Rt*w+w),je,pr)))}return er}).reduce(function(Ee,je){return Ee.push.apply(Ee,(0,B.Z)(je)),Ee},[]);o.vertexAttribute.updateBuffer({data:ge,offset:se})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(se){return se.resetDescriptor(),se.descriptor}),s=0,l=[],h=[],d=[],g=3;t.forEach(function(se,ge){var Ee=a.triangulation(se,i),je=Ee.indices,Ve=Ee.vertices,rt=Ee.normals,Et=Ee.size;je.forEach(function(pr){h.push(pr+s)}),g=Et;var zt=Ve.length/Et;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:ge,vertices:Ve,normals:rt,offset:s}),s+=zt;for(var er=function(xr){var Ur=(rt==null?void 0:rt.slice(xr*3,xr*3+3))||[],ti=Ve.slice(xr*Et,xr*Et+Et);o.forEach(function(_i,oa){if(_i&&_i.update){var bo;(bo=_i.buffer.data).push.apply(bo,(0,B.Z)(_i.update(se,ge,ti,xr,Ur)))}})},Rt=0;Rt<zt;Rt++)er(Rt)});var y=this.rendererService,E=y.createAttribute,b=y.createBuffer,w=y.createElements,F={};o.forEach(function(se,ge){if(se){var Ee=se.buffer,je=se.update,Ve=se.name,rt=(0,Of.Z)(se,Rf),Et=E(T0({buffer:b(Ee)},rt));F[se.name||""]=Et,a.attributes[ge].vertexAttribute=Et}});var ee=w({data:h,type:M.UNSIGNED_INT,count:h.length});return this.attributesAndIndices={attributes:F,elements:ee},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),rc=Xr(Za.prototype,"rendererService",[b0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za))||Pf),M0=T(67709),Cs=T.n(M0),gn,O0,xo,R0,Gd,Vn,zd,P0,wf,Hd,jd,Vd,Wd,Xd,Yd,$d,Kd,fa,qd,Qd,Jd,ep,Mh,tp,Oh,rp,np,ip,qi,Ua,ap,op,up;function sp(e){var r=Hv();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Hv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jv=(gn=(0,Ut.b2)(),O0=(0,Ut.f3)(Qe.SceneID),xo=(0,Ut.f3)(Qe.IIconService),R0=(0,Ut.f3)(Qe.IFontService),Gd=(0,Ut.f3)(Qe.IControlService),Vn=(0,Ut.f3)(Qe.IGlobalConfigService),zd=(0,Ut.f3)(Qe.IMapService),P0=(0,Ut.f3)(Qe.ICoordinateSystemService),wf=(0,Ut.f3)(Qe.IRendererService),Hd=(0,Ut.f3)(Qe.ILayerService),jd=(0,Ut.f3)(Qe.ICameraService),Vd=(0,Ut.f3)(Qe.IInteractionService),Wd=(0,Ut.f3)(Qe.IPickingService),Xd=(0,Ut.f3)(Qe.IShaderModuleService),Yd=(0,Ut.f3)(Qe.IMarkerService),$d=(0,Ut.f3)(Qe.IPopupService),gn(Kd=(fa=function(e){(0,lr.Z)(t,e);var r=sp(t);function t(){var n;return(0,ft.Z)(this,t),n=r.call(this),(0,p.Z)((0,z.Z)(n),"destroyed",!1),(0,p.Z)((0,z.Z)(n),"loaded",!1),(0,p.Z)((0,z.Z)(n),"loadFont",!1),(0,p.Z)((0,z.Z)(n),"fontFamily",""),wr((0,z.Z)(n),"id",qd,(0,z.Z)(n)),wr((0,z.Z)(n),"iconService",Qd,(0,z.Z)(n)),wr((0,z.Z)(n),"fontService",Jd,(0,z.Z)(n)),wr((0,z.Z)(n),"controlService",ep,(0,z.Z)(n)),wr((0,z.Z)(n),"configService",Mh,(0,z.Z)(n)),wr((0,z.Z)(n),"map",tp,(0,z.Z)(n)),wr((0,z.Z)(n),"coordinateSystemService",Oh,(0,z.Z)(n)),wr((0,z.Z)(n),"rendererService",rp,(0,z.Z)(n)),wr((0,z.Z)(n),"layerService",np,(0,z.Z)(n)),wr((0,z.Z)(n),"cameraService",ip,(0,z.Z)(n)),wr((0,z.Z)(n),"interactionService",qi,(0,z.Z)(n)),wr((0,z.Z)(n),"pickingService",Ua,(0,z.Z)(n)),wr((0,z.Z)(n),"shaderModuleService",ap,(0,z.Z)(n)),wr((0,z.Z)(n),"markerService",op,(0,z.Z)(n)),wr((0,z.Z)(n),"popupService",up,(0,z.Z)(n)),(0,p.Z)((0,z.Z)(n),"inited",!1),(0,p.Z)((0,z.Z)(n),"initPromise",void 0),(0,p.Z)((0,z.Z)(n),"rendering",!1),(0,p.Z)((0,z.Z)(n),"$container",void 0),(0,p.Z)((0,z.Z)(n),"canvas",void 0),(0,p.Z)((0,z.Z)(n),"markerContainer",void 0),(0,p.Z)((0,z.Z)(n),"hooks",void 0),(0,p.Z)((0,z.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),qa(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,p.Z)((0,z.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new zl},n}return(0,mt.Z)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ca.Z)(Ln().mark(function o(){return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,new Promise(function(h){a.map.onCameraChanged(function(d){a.cameraService.init(),a.cameraService.update(d),a.map.version!=="GAODE2.x"&&h()}),a.map.version!=="GAODE2.x"?a.map.init():h()});case 2:if(!(a.map.version==="GAODE2.x"&&a.map.initViewPort)){l.next=6;break}return l.next=5,a.map.init();case 5:a.map.initViewPort();case 6:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(la.Drag,a.addSceneEvent.bind(a));case 13:case"end":return l.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",(0,ca.Z)(Ln().mark(function o(){var s,l;return Ln().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=Dv(a.configService.getSceneConfig(a.id).id||""),a.$container=s,!s){d.next=11;break}return a.canvas=Cn("canvas","",s),a.setCanvas(),d.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id));case 7:Cs()(a.$container,a.handleWindowResized),Wt.matchMedia&&((l=Wt.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||l===void 0||l.addListener(a.handleWindowResized)),d.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:a.pickingService.init(a.id);case 13:case"end":return d.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ca.Z)(Ln().mark(function o(){return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,new Promise(function(h){a.map.onCameraChanged(function(d){a.cameraService.init(),a.cameraService.update(d),a.map.version!=="GAODE2.x"&&h()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(la.Drag,a.addSceneEvent.bind(a));case 5:case"end":return l.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",(0,ca.Z)(Ln().mark(function o(){var s;return Ln().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(s=i.canvas,a.$container=s||null,!a.$container){h.next=7;break}return h.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id));case 5:h.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return h.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i),this.render()}},{key:"render",value:function(){var n=(0,ca.Z)(Ln().mark(function a(){return Ln().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(this.rendering||this.destroyed)){s.next=2;break}return s.abrupt("return");case 2:if(this.rendering=!0,this.inited){s.next=23;break}return s.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){s.next=18;break}return s.prev=8,s.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:s.next=18;break;case 13:s.prev=13,s.t0=s.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(s.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return s.stop()}},a,this,[[8,13]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontFamily=i;var o=document.createElement("style");o.type="text/css",o.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(o),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(i){var a,o=(a=this.$container)===null||a===void 0?void 0:a.getElementsByTagName("canvas")[0];this.render();var s=i==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return s}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=Cn("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a,o;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){i.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(a=this.$container)===null||a===void 0||(o=a.parentNode)===null||o===void 0||o.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,M0.unbind)(this.$container,this.handleWindowResized),Wt.matchMedia){var s;(s=Wt.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var i,a,o=Qn,s=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,l=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,h=this.canvas;h&&(h.width=s*o,h.height=l*o),this.rendererService.viewport({x:0,y:0,width:o*s,height:o*l})}},{key:"setCanvas",value:function(){var i,a,o=Qn,s=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,l=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,h=this.canvas;h.width=s*o,h.height=l*o,h.style.width="100%",h.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(Ki.EventEmitter),qd=Xr(fa.prototype,"id",[O0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd=Xr(fa.prototype,"iconService",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=Xr(fa.prototype,"fontService",[R0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=Xr(fa.prototype,"controlService",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mh=Xr(fa.prototype,"configService",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tp=Xr(fa.prototype,"map",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oh=Xr(fa.prototype,"coordinateSystemService",[P0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=Xr(fa.prototype,"rendererService",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np=Xr(fa.prototype,"layerService",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ip=Xr(fa.prototype,"cameraService",[jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qi=Xr(fa.prototype,"interactionService",[Vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=Xr(fa.prototype,"pickingService",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ap=Xr(fa.prototype,"shaderModuleService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),op=Xr(fa.prototype,"markerService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=Xr(fa.prototype,"popupService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fa))||Kd),Vv=T(44908),w0=T.n(Vv);function Wv(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var Xv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function lp(e){var r={};return e=e.replace(Xv,function(t,n,i){var a=i.split(":"),o=a[0].trim(),s="";switch(a.length>1&&(s=a[1].trim()),n){case"bool":s=s==="true";break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s?s=s.replace("[","").replace("]","").split(",").reduce(function(l,h){return l.push(Number(h.trim())),l},[]):s=new Array(Wv(n)).fill(0);break;default:}return r[o]=s,"uniform ".concat(n," ").concat(o,`;
`)}),{content:e,uniforms:r}}var I0,L0;function cp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function If(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?cp(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):cp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var fp="#define PI 3.14159265359",Yv=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Wc=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,$v=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Kv=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,qv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Qv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Jv=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,hp=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,dp=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,em=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,tm=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,rm=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,nm=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,im=/precision\s+(high|low|medium)p\s+float/,am=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,om=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,um=(I0=(0,Ut.b2)(),I0(L0=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"moduleCache",{}),(0,p.Z)(this,"rawContentCache",{})}return(0,mt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:fp,fs:fp}),this.registerModule("decode",{vs:Yv,fs:""}),this.registerModule("projection",{vs:Jv,fs:""}),this.registerModule("project",{vs:Qv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:hp}),this.registerModule("lighting",{vs:$v,fs:""}),this.registerModule("light",{vs:Wc,fs:""}),this.registerModule("picking",{vs:qv,fs:Kv}),this.registerModule("styleMapping",{vs:dp,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:nm,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:em,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:tm,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:rm,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var i=n.vs,a=n.fs,o=n.uniforms,s=lp(i),l=s.content,h=s.uniforms,d=lp(a),g=d.content,y=d.uniforms;this.rawContentCache[t]={fs:g,uniforms:If(If(If({},h),y),o),vs:l}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,o=this.processModule(i,[],"vs"),s=o.content,l=o.includeList,h=this.processModule(a,[],"fs"),d=h.content,g=h.includeList,y=d,E=w0()(l.concat(g).concat(t)).reduce(function(b,w){return If(If({},b),n.rawContentCache[w].uniforms)},{});return im.test(d)||(y=am+d),this.moduleCache[t]={fs:y.trim(),uniforms:E,vs:s.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,o=t.replace(om,function(s,l){var h=l.split(" "),d=h[0].replace(/"/g,"");if(n.indexOf(d)>-1)return"";var g=a.rawContentCache[d][i];n.push(d);var y=a.processModule(g,n,i),E=y.content;return E});return{content:o,includeList:n}}}]),e}())||L0);function sm(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=(0,Xe.Z)(e),e!==null););return e}function nc(){return typeof Reflect!="undefined"&&Reflect.get?nc=Reflect.get:nc=function(r,t,n){var i=sm(r,t);if(!!i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?r:n):a.value}},nc.apply(this,arguments)}var ll;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(ll||(ll={}));var pp,vp,Rh=(pp=(0,Ut.b2)(),pp(vp=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"shaderModuleService",void 0),(0,p.Z)(this,"rendererService",void 0),(0,p.Z)(this,"cameraService",void 0),(0,p.Z)(this,"mapService",void 0),(0,p.Z)(this,"interactionService",void 0),(0,p.Z)(this,"layerService",void 0),(0,p.Z)(this,"config",void 0)}return(0,mt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return ll.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Qe.IRendererService),this.cameraService=t.getContainer().get(Qe.ICameraService),this.mapService=t.getContainer().get(Qe.IMapService),this.interactionService=t.getContainer().get(Qe.IInteractionService),this.layerService=t.getContainer().get(Qe.ILayerService),this.shaderModuleService=t.getContainer().get(Qe.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||vp),mp,gp;function lm(e){var r=cm();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function cm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fm=(mp=(0,Ut.b2)(),mp(gp=function(e){(0,lr.Z)(t,e);var r=lm(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){nc((0,Xe.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Rh))||gp),_p,yp,Ep,D0,xp;function hm(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=F0(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function F0(e,r){if(!!e){if(typeof e=="string")return N0(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return N0(e,r)}}function N0(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Sp=(_p=(0,Ut.b2)(),yp=(0,Ut.f3)(Qe.IPostProcessor),_p(Ep=(D0=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"passes",[]),wr(this,"postProcessor",xp,this),(0,p.Z)(this,"layer",void 0),(0,p.Z)(this,"renderFlag",void 0),(0,p.Z)(this,"width",0),(0,p.Z)(this,"height",0)}return(0,mt.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=(0,ca.Z)(Ln().mark(function n(){var i,a,o;return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i=hm(this.passes),l.prev=1,i.s();case 3:if((a=i.n()).done){l.next=9;break}return o=a.value,l.next=7,o.render(this.layer);case 7:l.next=3;break;case 9:l.next=14;break;case 11:l.prev=11,l.t0=l.catch(1),i.e(l.t0);case 14:return l.prev=14,i.f(),l.finish(14);case 17:return l.next=19,this.postProcessor.render(this.layer);case 19:case"end":return l.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===ll.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),xp=Xr(D0.prototype,"postProcessor",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0))||Ep),Cp,Ap;function bp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ph(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?bp(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function dm(e){var r=pm();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function pm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vm=(Cp=(0,Ut.b2)(),Cp(Ap=function(e){(0,lr.Z)(t,e);var r=dm(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"pickingFBO",void 0),(0,p.Z)((0,z.Z)(n),"layer",void 0),(0,p.Z)((0,z.Z)(n),"width",0),(0,p.Z)((0,z.Z)(n),"height",0),(0,p.Z)((0,z.Z)(n),"alreadyInRendering",!1),(0,p.Z)((0,z.Z)(n),"pickFromPickingFBO",function(s){var l=s.x,h=s.y,d=s.lngLat,g=s.type;if(!(!n.layer.isVisible()||!n.layer.needPick(g))){var y=n.rendererService,E=y.getViewportSize,b=y.readPixels,w=y.useFramebuffer,F=E(),ee=F.width,se=F.height,ge=n.layer.getLayerConfig(),Ee=ge.enableHighlight,je=ge.enableSelect,Ve=l*Qn,rt=h*Qn;if(!(Ve>ee||Ve<0||rt>se||rt<0)){var Et;w(n.pickingFBO,function(){var zt;if(Et=b({x:Math.round(Ve),y:Math.round(se-(h+1)*Qn),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Et[0]!==0||Et[1]!==0||Et[2]!==0){var er=Vs(Et),Rt=n.layer.getSource().getFeatureById(er),pr={x:l,y:h,type:g,lngLat:d,featureId:er,feature:Rt};Rt&&(n.layer.setCurrentPickId(er),n.triggerHoverOnLayer(pr))}else{var xr={x:l,y:h,lngLat:d,type:n.layer.getCurrentPickId()===null?"un"+g:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Ph(Ph({},xr),{},{type:"unpick"})),n.triggerHoverOnLayer(xr),n.layer.setCurrentPickId(null)}Ee&&n.highlightPickedFeature(Et),je&&g==="click"&&((zt=Et)===null||zt===void 0?void 0:zt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Et)})}}}),n}return(0,mt.Z)(t,[{key:"getType",value:function(){return ll.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){nc((0,Xe.Z)(t.prototype),"init",this).call(this,i,a),this.layer=i;var o=this.rendererService,s=o.createTexture2D,l=o.createFramebuffer,h=o.getViewportSize,d=h(),g=d.width,y=d.height;this.pickingFBO=l({color:s({width:g,height:y,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})}),this.interactionService.on(la.Hover,this.pickFromPickingFBO),this.interactionService.on(la.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(la.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var o=this.rendererService,s=o.getViewportSize,l=o.useFramebuffer,h=o.clear,d=s(),g=d.width,y=d.height;this.alreadyInRendering=!0,(this.width!==g||this.height!==y)&&(this.pickingFBO.resize({width:g,height:y}),this.width=g,this.height=y),l(this.pickingFBO,function(){h({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var E=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(E),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,Rn.Z)(i,3),o=a[0],s=a[1],l=a[2];this.layer.hooks.beforeHighlight.call([o,s,l]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,Rn.Z)(i,3),o=a[0],s=a[1],l=a[2];this.layer.hooks.beforeSelect.call([o,s,l]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,o=Ws(a);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,o=Ws(a);this.highlightPickedFeature(new Uint8Array(o))}}]),t}(Rh))||Ap),no=T(11700),k0=T.n(no),mm=T(68929),gm=T.n(mm),Tp,Mp,wh,B0,Ih;function Op(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Lf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Op(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Op(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var _m=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,As=(Tp=(0,Ut.b2)(),Mp=(0,Ut.f3)(Qe.IShaderModuleService),Tp(wh=(B0=function(){function e(){(0,ft.Z)(this,e),wr(this,"shaderModuleService",Ih,this),(0,p.Z)(this,"rendererService",void 0),(0,p.Z)(this,"config",void 0),(0,p.Z)(this,"quad",_m),(0,p.Z)(this,"enabled",!0),(0,p.Z)(this,"renderToScreen",!1),(0,p.Z)(this,"model",void 0),(0,p.Z)(this,"name",void 0),(0,p.Z)(this,"optionsToUpdate",{})}return(0,mt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return ll.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Qe.IRendererService),this.shaderModuleService=t.getContainer().get(Qe.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,o=i.createBuffer,s=i.createModel,l=this.setupShaders(),h=l.vs,d=l.fs,g=l.uniforms;this.model=s({vs:h,fs:d,attributes:{a_Position:a({buffer:o({data:[-4,-4,4,-4,0,4],type:M.FLOAT}),size:2})},uniforms:Lf(Lf({u_Texture:null},g),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),o=this.rendererService,s=o.useFramebuffer,l=o.getViewportSize,h=o.clear,d=l(),g=d.width,y=d.height;s(this.renderToScreen?null:a.getWriteFBO(),function(){h({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var E=Lf({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[g,y]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(E.u_BloomFinal=1,E.u_Texture2=n),i.model.draw({uniforms:E})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=Lf(Lf({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){Ss()(t[i])||(n["u_".concat(k0()(gm()(i)))]=t[i])}),n}}]),e}(),Ih=Xr(B0.prototype,"shaderModuleService",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B0))||wh),Z0,Rp;function Pp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function wp(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Pp(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Pp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function U0(e){var r=G0();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function G0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ym=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Em=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xm=(Z0=(0,Ut.b2)(),Z0(Rp=function(e){(0,lr.Z)(t,e);var r=U0(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Em,fs:ym});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,s=i.uniforms,l=this.rendererService.getViewportSize(),h=l.width,d=l.height;return{vs:a,fs:o,uniforms:wp(wp({},s),{},{u_ViewportSize:[h,d]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Ss()(i.bloomRadius)||(a.u_radius=i.bloomRadius),Ss()(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),Ss()(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(As))||Rp),Ip,Lp;function Dp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Fp(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Dp(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Dp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Sm(e){var r=Cm();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Cm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Am=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,bm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Tm=(Ip=(0,Ut.b2)(),Ip(Lp=function(e){(0,lr.Z)(t,e);var r=Sm(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:bm,fs:Am});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,s=i.uniforms,l=this.rendererService.getViewportSize(),h=l.width,d=l.height;return{vs:a,fs:o,uniforms:Fp(Fp({},s),{},{u_ViewportSize:[h,d]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Ss()(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(As))||Lp),Np,kp;function Bp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Zp(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Bp(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Bp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Mm(e){var r=Om();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Om(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Pm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wm=(Np=(0,Ut.b2)(),Np(kp=function(e){(0,lr.Z)(t,e);var r=Mm(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Pm,fs:Rm});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,s=i.uniforms,l=this.rendererService.getViewportSize(),h=l.width,d=l.height;return{vs:a,fs:o,uniforms:Zp(Zp({},s),{},{u_ViewportSize:[h,d]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Ss()(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(As))||kp),u,c;function v(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function x(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?v(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function P(e){var r=Y();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Y(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ce=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ye=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ze=(u=(0,Ut.b2)(),u(c=function(e){(0,lr.Z)(t,e);var r=P(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ye,fs:ce});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,o=i.fs,s=i.uniforms,l=this.rendererService.getViewportSize(),h=l.width,d=l.height;return{vs:a,fs:o,uniforms:x(x({},s),{},{u_ViewportSize:[h,d]})}}}]),t}(As))||c),It,Lt;function Vt(e){var r=_r();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function _r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Kr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yn=(It=(0,Ut.b2)(),It(Lt=function(e){(0,lr.Z)(t,e);var r=Vt(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Kr,fs:Lr}),this.shaderModuleService.getModule("copy-pass")}}]),t}(As))||Lt),Yr,xn;function Mn(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function io(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Mn(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Mn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ga(e){var r=So();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fi=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,uu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bs=(Yr=(0,Ut.b2)(),Yr(xn=function(e){(0,lr.Z)(t,e);var r=Ga(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:uu,fs:Fi});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,o=i.fs,s=i.uniforms,l=this.rendererService.getViewportSize(),h=l.width,d=l.height;return{vs:a,fs:o,uniforms:io(io({},s),{},{u_ViewportSize:[h,d]})}}}]),t}(As))||xn),z0,r_;function n_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function i_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?n_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function uS(e){var r=sS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function sS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,cS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fS=(z0=(0,Ut.b2)(),z0(r_=function(e){(0,lr.Z)(t,e);var r=uS(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:cS,fs:lS});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,o=i.fs,s=i.uniforms,l=this.rendererService.getViewportSize(),h=l.width,d=l.height;return{vs:a,fs:o,uniforms:i_(i_({},s),{},{u_ViewportSize:[h,d]})}}}]),t}(As))||r_),a_,o_;function hS(e){var r=dS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,vS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mS=(a_=(0,Ut.b2)(),a_(o_=function(e){(0,lr.Z)(t,e);var r=hS(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:vS,fs:pS}),this.shaderModuleService.getModule("noise-pass")}}]),t}(As))||o_),u_,s_;function gS(e){var r=_S();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ES=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,xS=(u_=(0,Ut.b2)(),u_(s_=function(e){(0,lr.Z)(t,e);var r=gS(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:yS,fs:ES}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(As))||s_),l_,c_,f_,h_,Lh,d_,SS=(l_=(0,Ut.b2)(),c_=(0,Ut.f3)(Qe.IRendererService),f_=(0,Ut.zY)(),l_(h_=(Lh=function(){function e(){(0,ft.Z)(this,e),wr(this,"rendererService",d_,this),(0,p.Z)(this,"passes",[]),(0,p.Z)(this,"readFBO",void 0),(0,p.Z)(this,"writeFBO",void 0)}return(0,mt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),o=a.width,s=a.height;return i({x:0,y:0,width:o,height:s,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i,a){n(t.readFBO,(0,ca.Z)(Ln().mark(function o(){return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var r=(0,ca.Z)(Ln().mark(function n(i,a){var o,s;return Ln().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.getReadFBOTex();case 2:o=h.sent,s=0;case 4:if(!(s<4)){h.next=11;break}return h.next=7,a.render(i,o);case 7:this.swap(),s++,h.next=4;break;case 11:case"end":return h.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=(0,ca.Z)(Ln().mark(function n(i){var a,o;return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:a=0;case 1:if(!(a<this.passes.length)){l.next=15;break}if(o=this.passes[a],o.setRenderToScreen(this.isLastEnabledPass(a)),o.getName()!=="bloom"){l.next=9;break}return l.next=7,this.renderBloomPass(i,o);case 7:l.next=12;break;case 9:return l.next=11,o.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,l.next=1;break;case 15:case"end":return l.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),d_=Xr(Lh.prototype,"rendererService",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xr(Lh.prototype,"init",[f_],Object.getOwnPropertyDescriptor(Lh.prototype,"init"),Lh.prototype),Lh))||h_),p_,v_;function CS(e){var r=AS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=(p_=(0,Ut.b2)(),p_(v_=function(e){(0,lr.Z)(t,e);var r=CS(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getType",value:function(){return ll.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){nc((0,Xe.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,o=a.useFramebuffer,s=a.clear,l=i.multiPassRenderer.getPostProcessor().getReadFBO();o(l,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(h){h.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Rh))||v_),m_,g_,__,Im,y_;function E_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function x_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?E_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function TS(e){var r=MS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OS=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,S_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,RS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function C_(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var PS=1,wS=(m_=(0,Ut.b2)(),g_=(0,Ut.f3)(Qe.IShaderModuleService),m_(__=(Im=function(e){(0,lr.Z)(t,e);var r=TS(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),wr((0,z.Z)(n),"shaderModuleService",y_,(0,z.Z)(n)),(0,p.Z)((0,z.Z)(n),"haltonSequence",[]),(0,p.Z)((0,z.Z)(n),"accumulatingId",0),(0,p.Z)((0,z.Z)(n),"frame",0),(0,p.Z)((0,z.Z)(n),"timer",void 0),(0,p.Z)((0,z.Z)(n),"sampleRenderTarget",void 0),(0,p.Z)((0,z.Z)(n),"prevRenderTarget",void 0),(0,p.Z)((0,z.Z)(n),"outputRenderTarget",void 0),(0,p.Z)((0,z.Z)(n),"copyRenderTarget",void 0),(0,p.Z)((0,z.Z)(n),"blendModel",void 0),(0,p.Z)((0,z.Z)(n),"outputModel",void 0),(0,p.Z)((0,z.Z)(n),"copyModel",void 0),n}return(0,mt.Z)(t,[{key:"getType",value:function(){return ll.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){nc((0,Xe.Z)(t.prototype),"init",this).call(this,i,a);var o=this.rendererService,s=o.createFramebuffer,l=o.createTexture2D;this.sampleRenderTarget=s({color:l({width:1,height:1,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})}),this.prevRenderTarget=s({color:l({width:1,height:1,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})}),this.outputRenderTarget=s({color:l({width:1,height:1,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})}),this.copyRenderTarget=s({color:l({width:1,height:1,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE})});for(var h=0;h<30;h++)this.haltonSequence.push([C_(h,2),C_(h,3)]);this.blendModel=this.createTriangleModel("blend-pass",OS),this.outputModel=this.createTriangleModel("copy-pass",S_,{blend:{enable:!0,func:{srcRGB:M.ONE,dstRGB:M.ONE_MINUS_SRC_ALPHA,srcAlpha:M.ONE,dstAlpha:M.ONE_MINUS_SRC_ALPHA},equation:{rgb:M.FUNC_ADD,alpha:M.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",S_)}},{key:"render",value:function(i){var a=this,o=this.rendererService,s=o.clear,l=o.getViewportSize,h=o.useFramebuffer,d=l(),g=d.width,y=d.height;this.sampleRenderTarget.resize({width:g,height:y}),this.prevRenderTarget.resize({width:g,height:y}),this.outputRenderTarget.resize({width:g,height:y}),this.copyRenderTarget.resize({width:g,height:y}),this.resetFrame(),this.stopAccumulating();var E=i.multiPassRenderer.getPostProcessor().getReadFBO();h(E,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:E}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var b=function w(F){!a.accumulatingId||F!==a.accumulatingId||a.isFinished()||(a.doRender(i),Wt.requestAnimationFrame(function(){w(F)}))};this.accumulatingId=PS++,this.timer=Wt.setTimeout(function(){b(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,o=this.rendererService,s=o.clear,l=o.getViewportSize,h=o.useFramebuffer,d=l(),g=d.width,y=d.height,E=i.getLayerConfig(),b=E.jitterScale,w=b===void 0?1:b,F=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((F[0]*2-1)/g*w,(F[1]*2-1)/y*w),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),h(this.sampleRenderTarget,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var ee=i.getLayerConfig();h(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:ee.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(h(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),h(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var se=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=se,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Wt.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,o){this.shaderModuleService.registerModule(i,{vs:RS,fs:a});var s=this.shaderModuleService.getModule(i),l=s.vs,h=s.fs,d=s.uniforms,g=this.rendererService,y=g.createAttribute,E=g.createBuffer,b=g.createModel;return b(x_({vs:l,fs:h,attributes:{a_Position:y({buffer:E({data:[-4,-4,4,-4,0,4],type:M.FLOAT}),size:2})},uniforms:x_({},d),depth:{enable:!1},count:3},o))}}]),t}(Rh),y_=Xr(Im.prototype,"shaderModuleService",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im))||__),H0=new Ut.W2;H0.bind(Qe.IGlobalConfigService).to(zo).inSingletonScope(),(0,Ut.GW)((0,Ut.b2)(),Ki.EventEmitter),H0.bind(Qe.IEventEmitter).to(Ki.EventEmitter);var A_=(0,Eh.Z)(H0,!1),Lm=function(r){var t=A_.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Q5=function(r){var t=A_.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},su=H0,IS=0;function LS(){var e=new Ut.W2;return e.parent=H0,e.bind(Qe.SceneID).toConstantValue("".concat(IS++)),e.bind(Qe.IShaderModuleService).to(um).inSingletonScope(),e.bind(Qe.ILayerService).to(Zv).inSingletonScope(),e.bind(Qe.ISceneService).to(jv).inSingletonScope(),e.bind(Qe.ICameraService).to(me).inSingletonScope(),e.bind(Qe.ICoordinateSystemService).to(yd).inSingletonScope(),e.bind(Qe.IInteractionService).to(wv).inSingletonScope(),e.bind(Qe.IPickingService).to(Nv).inSingletonScope(),e.bind(Qe.IControlService).to(xt).inSingletonScope(),e.bind(Qe.IMarkerService).to(qt).inSingletonScope(),e.bind(Qe.IIconService).to(bt).inSingletonScope(),e.bind(Qe.IFontService).to(S).inSingletonScope(),e.bind(Qe.IPopupService).to(rr).inSingletonScope(),e.bind(Qe.INormalPass).to(fm).whenTargetNamed("clear"),e.bind(Qe.INormalPass).to(vm).whenTargetNamed("pixelPicking"),e.bind(Qe.INormalPass).to(bS).whenTargetNamed("render"),e.bind(Qe.INormalPass).to(wS).whenTargetNamed("taa"),e.bind(Qe.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Qe.INormalPass,t)}}),e.bind(Qe.IPostProcessingPass).to(yn).whenTargetNamed("copy"),e.bind(Qe.IPostProcessingPass).to(xm).whenTargetNamed("bloom"),e.bind(Qe.IPostProcessingPass).to(Tm).whenTargetNamed("blurH"),e.bind(Qe.IPostProcessingPass).to(wm).whenTargetNamed("blurV"),e.bind(Qe.IPostProcessingPass).to(mS).whenTargetNamed("noise"),e.bind(Qe.IPostProcessingPass).to(xS).whenTargetNamed("sepia"),e.bind(Qe.IPostProcessingPass).to(Ze).whenTargetNamed("colorHalftone"),e.bind(Qe.IPostProcessingPass).to(bs).whenTargetNamed("hexagonalPixelate"),e.bind(Qe.IPostProcessingPass).to(fS).whenTargetNamed("ink"),e.bind(Qe.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Qe.IPostProcessingPass,t);return n.setName(t),n}}),e}function DS(e){var r=new Ut.W2;return r.parent=e,r.bind(Qe.IStyleAttributeService).to(zv).inSingletonScope(),r.bind(Qe.IMultiPassRenderer).to(Sp).inSingletonScope(),r.bind(Qe.IPostProcessor).to(SS).inSingletonScope(),r}var J5=T(74691),FS=null;function ew(e){return FS.indexOf(e)}var NS=2,tw=4,kS=64,rw=128,BS=256,ZS=512,nw=8192,iw=16384,aw=32768,US=null,b_=131072,ow=262144,GS=524288,uw=1048576,zS=2097152,sw=4194304,HS=8388608,jS=16777216,VS=null;function Up(e,r){return e=_clamp(Math.floor(e),0,255),r=_clamp(Math.floor(r),0,255),256*e+r}function lw(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,o=e.opacity,s=e.stroke,l=e.strokeWidth,h=e.strokeOpacity,d=[],g=[],y=[],E=[Up(r[0],r[1]),Up(r[2],r[3])],b=[Up(s[0],s[1]),Up(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(w){var F=_slicedToArray(w,2),ee=F[0],se=F[1];d.push([].concat(E,[(ee+1)*HS+(se+1)*zS+getShapeIndex(a)*b_+t,(n+512)*GS+(i+512)*kS])),g.push([].concat(b,[l,h])),y.push([o,0,0,0])}),{packedBuffer:d,packedBuffer2:g,packedBuffer3:y}}function cw(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*VS+t*jS+n*b_+t*US+n*ZS+t*BS+n*NS+t}var ku;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(ku||(ku={}));var ha;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(ha||(ha={}));var Xc;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Xc||(Xc={}));var Er;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Er||(Er={}));var T_=["mapload","mapchange","mapAfterFrameChange"],Df={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Dm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Yc;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Yc||(Yc={}));function M_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function O_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?M_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function WS(e){var r=XS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=0,Gp=function(e){(0,lr.Z)(t,e);var r=WS(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this),(0,p.Z)((0,z.Z)(i),"controlOption",void 0),(0,p.Z)((0,z.Z)(i),"container",void 0),(0,p.Z)((0,z.Z)(i),"sceneContainer",void 0),(0,p.Z)((0,z.Z)(i),"mapsService",void 0),(0,p.Z)((0,z.Z)(i),"renderService",void 0),(0,p.Z)((0,z.Z)(i),"layerService",void 0),(0,p.Z)((0,z.Z)(i),"controlService",void 0),(0,p.Z)((0,z.Z)(i),"isShow",void 0),i.controlOption=O_(O_({},i.getDefault()),n||{}),i}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{position:Yc.TOPRIGHT,name:"".concat(YS++)}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yc.BOTTOMRIGHT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(i){this.mapsService=i.get(Qe.IMapService),this.renderService=i.get(Qe.IRendererService),this.layerService=i.get(Qe.ILayerService),this.controlService=i.get(Qe.IControlService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd();var a=this.container,o=this.controlOption.position,s=this.controlService.controlCorners[o];return qu(a,"l7-control"),o.indexOf("bottom")!==-1?s.insertBefore(a,s.firstChild):s.appendChild(a),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var i=this.container;qu(i,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var i=this.container;wo(i,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;qo(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}}]),t}(Ki.EventEmitter);function $S(e){var r=KS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=function(e){(0,lr.Z)(t,e);var r=$S(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this,n),(0,p.Z)((0,z.Z)(i),"layerControlInputs",void 0),(0,p.Z)((0,z.Z)(i),"layers",void 0),(0,p.Z)((0,z.Z)(i),"lastZIndex",void 0),(0,p.Z)((0,z.Z)(i),"handlingClick",void 0),(0,p.Z)((0,z.Z)(i),"layersLink",void 0),(0,p.Z)((0,z.Z)(i),"baseLayersList",void 0),(0,p.Z)((0,z.Z)(i),"separator",void 0),(0,p.Z)((0,z.Z)(i),"overlaysList",void 0),(0,p.Z)((0,z.Z)(i),"form",void 0),i.layerControlInputs=[],i.layers=[],i.lastZIndex=0,i.handlingClick=!1,i.initLayers(),rs(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,z.Z)(i)),i}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:Yc.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var i=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(a){a.layer.on("remove",i.onLayerChange),a.layer.on("add",i.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(i,a){return this.addLayer(i,a,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var i=this.renderService.getViewportSize(),a=i.height;qu(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var o=a-(this.container.offsetTop+50);return o<this.form.clientHeight?(qu(this.form,"l7-control-layers-scrollbar"),this.form.style.height=o+"px"):wo(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return wo(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var i=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(a){a.layer.off("remove",i.onLayerChange),a.layer.off("add",i.onLayerChange)}))}},{key:"initLayout",value:function(){var i="l7-control-layers",a=this.container=Cn("div",i),o=this.controlOption.collapsed;a.setAttribute("aria-haspopup","true");var s=this.form=Cn("form",i+"-list");o&&(this.mapsService.on("click",this.collapse),a.addEventListener("mouseenter",this.expand),a.addEventListener("mouseleave",this.collapse)),this.layersLink=Cn("a",i+"-toggle",a);var l=this.layersLink;l.title="Layers",o||this.expand(),this.baseLayersList=Cn("div",i+"-base",s),this.separator=Cn("div",i+"-separator",s),this.overlaysList=Cn("div",i+"-overlays",s),a.appendChild(s)}},{key:"initLayers",value:function(){var i=this,a=this.controlOption,o=a.baseLayers,s=o===void 0?{}:o,l=a.overlayers,h=l===void 0?{}:l;Object.keys(s).forEach(function(d,g){i.addLayer(s[d],d,!1)}),Object.keys(h).forEach(function(d,g){i.addLayer(h[d],d,!0)})}},{key:"update",value:function(){if(!this.container)return this;Bs(this.baseLayersList),Bs(this.overlaysList),this.layerControlInputs=[];var i,a,o,s,l=0;for(o=0;o<this.layers.length;o++)s=this.layers[o],this.addItem(s),a=a||s.overlay,i=i||!s.overlay,l+=s.overlay?0:1;return this.controlOption.hideSingleBase&&(i=i&&l>1,this.baseLayersList.style.display=i?"":"none"),this.separator.style.display=a&&i?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var i=this.layerControlInputs,a,o,s=this.mapsService.getZoom(),l=i.length-1;l>=0;l--)if(a=i[l],o=this.layerService.getLayer(a.layerId),o&&o.inited){var h=o.getMinZoom(),d=o.getMaxZoom();a.disabled=s<h||s>d}}},{key:"addLayer",value:function(i,a,o){this.mapsService&&(i.on("add",this.onLayerChange),i.on("remove",this.onLayerChange)),this.layers.push({layer:i,name:a,overlay:o});var s=this.controlOption,l=s.sortLayers,h=s.sortFunction,d=s.autoZIndex;l&&this.layers.sort(function(g,y){return h(g.layer,y.layer,g.name,y.name)}),d&&i.setZIndex&&(this.lastZIndex++,i.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(i){this.handlingClick||this.update();var a=this.layerService.getLayer(i.target.layerId),o=a!=null&&a.overlay?i.type==="add"?"overlayadd":"overlayremove":i.type==="add"?"baselayerchange":null;o&&this.emit(o,a)}},{key:"createRadioElement",value:function(i,a){var o='<input type="radio" class="l7-control-layers-selector" name="'+i+'"'+(a?' checked="checked"':"")+"/>",s=document.createElement("div");return s.innerHTML=o,s.firstChild}},{key:"addItem",value:function(i){var a=document.createElement("label"),o=this.layerService.getLayer(i.layer.id),s=o&&o.inited&&i.layer.isVisible(),l;i.overlay?(l=document.createElement("input"),l.type="checkbox",l.className="l7-control-layers-selector",l.defaultChecked=s):l=this.createRadioElement("l7-base-layers",s),this.layerControlInputs.push(l),l.layerId=i.layer.id,l.addEventListener("click",this.onInputClick);var h=document.createElement("span");h.innerHTML=" "+i.name;var d=document.createElement("div");a.appendChild(d),d.appendChild(l),d.appendChild(h);var g=i.overlay?this.overlaysList:this.baseLayersList;return g.appendChild(a),this.checkDisabledLayers(),a}},{key:"onInputClick",value:function(){var i=this.layerControlInputs,a,o,s=[],l=[];this.handlingClick=!0;for(var h=i.length-1;h>=0;h--)a=i[h],o=this.layerService.getLayer(a.layerId),a.checked?s.push(o):a.checked||l.push(o);l.forEach(function(d){d.hide()}),s.forEach(function(d){d.show()}),this.handlingClick=!1}}]),t}(Gp);function qS(e){var r=QS();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function QS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=function(e){(0,lr.Z)(t,e);var r=qS(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{position:Yc.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var i="l7-control-logo",a=Cn("div",i),o=Cn("a","l7-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://antv.alipay.com/l7",o.setAttribute("aria-label","AntV logo"),o.setAttribute("rel","noopener nofollow"),a.appendChild(o),a}},{key:"onRemove",value:function(){return null}}]),t}(Gp);function eC(e){var r=tC();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hw=function(e){(0,lr.Z)(t,e);var r=eC(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this,n),(0,p.Z)((0,z.Z)(i),"mScale",void 0),(0,p.Z)((0,z.Z)(i),"iScale",void 0),rs(["update"],(0,z.Z)(i)),i}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{position:Yc.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var i="l7-control-scale",a=Cn("div",i);this.addScales(i+"-line",a);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),this.update(),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var i=this.mapsService,a=this.controlOption.maxWidth,o=i.getSize()[1]/2,s=i.containerToLngLat([0,o]),l=i.containerToLngLat([a,o]),h=xu([s.lng,s.lat],[l.lng,l.lat]);this.updateScales(h)}},{key:"updateScales",value:function(i){var a=this.controlOption,o=a.metric,s=a.imperial;o&&i&&this.updateMetric(i),s&&i&&this.updateImperial(i)}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),o=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,o,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,o,s,l;a>5280?(o=a/5280,s=this.getRoundNum(o),this.updateScale(this.iScale,s+" mi",s/o)):(l=this.getRoundNum(a),this.updateScale(this.iScale,l+" ft",l/a))}},{key:"updateScale",value:function(i,a,o){var s=this.controlOption.maxWidth;i.style.width=Math.round(s*o)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),o=i/a;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,a*o}},{key:"addScales",value:function(i,a){var o=this.controlOption,s=o.metric,l=o.imperial;s&&(this.mScale=Cn("div",i,a)),l&&(this.iScale=Cn("div",i,a))}}]),t}(Gp);function rC(e){var r=nC();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dw=function(e){(0,lr.Z)(t,e);var r=rC(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this,n),(0,p.Z)((0,z.Z)(i),"disabled",void 0),(0,p.Z)((0,z.Z)(i),"zoomInButton",void 0),(0,p.Z)((0,z.Z)(i),"zoomOutButton",void 0),rs(["updateDisabled","zoomIn","zoomOut"],(0,z.Z)(i)),i}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{position:Yc.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var i="l7-control-zoom",a=Cn("div",i+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,i+"-in",a,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,i+"-out",a,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),a}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(i,a,o,s,l){var h=Cn("a",o,s);return h.innerHTML=i,h.title=a,h.href="javascript:void(0)",h.addEventListener("click",l),h}},{key:"updateDisabled",value:function(){var i=this.mapsService,a="l7-disabled";wo(this.zoomInButton,a),wo(this.zoomOutButton,a),(this.disabled||i.getZoom()<=i.getMinZoom())&&qu(this.zoomOutButton,a),(this.disabled||i.getZoom()>=i.getMaxZoom())&&qu(this.zoomInButton,a)}}]),t}(Gp);function R_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function P_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?R_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function iC(e){var r=aC();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w_=function(e){(0,lr.Z)(t,e);var r=iC(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this),(0,p.Z)((0,z.Z)(i),"markerOption",void 0),(0,p.Z)((0,z.Z)(i),"defaultMarker",void 0),(0,p.Z)((0,z.Z)(i),"popup",void 0),(0,p.Z)((0,z.Z)(i),"mapsService",void 0),(0,p.Z)((0,z.Z)(i),"sceneSerive",void 0),(0,p.Z)((0,z.Z)(i),"lngLat",void 0),(0,p.Z)((0,z.Z)(i),"scene",void 0),(0,p.Z)((0,z.Z)(i),"added",!1),(0,p.Z)((0,z.Z)(i),"eventHandle",function(a){i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=P_(P_({},i.getDefault()),n),rs(["update","onMove","onUp","addDragHandler","onMapClick"],(0,z.Z)(i)),i.init(),i}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ys.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Qe.IMapService),this.sceneSerive=i.get(Qe.ISceneService);var a=this.markerOption,o=a.element,s=a.draggable;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&qo(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var o=this.markerOption.element;return o&&qo(o),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.anchor;this.updatePosition(),Eu(a,"".concat(as[o]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.offsets,s=this.lngLat,l=s.lng,h=s.lat,d=this.mapsService.getBounds(),g=this.mapsService.lngLatToContainer([l,h]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var y=this.mapsService.getContainer(),E=0,b=0;if(y&&(E=y.scrollWidth,b=y.scrollHeight),Math.abs(d[0][0])>180||Math.abs(d[1][0])>180){if(g.x>E){var w=this.mapsService.lngLatToContainer([l-360,h]);g.x=w.x}if(g.x<0){var F=this.mapsService.lngLatToContainer([l+360,h]);g.x=F.x}}(g.x>E||g.x<0||g.y>b||g.y<0)&&(a.style.display="none"),a.style.left=g.x+o[0]+"px",a.style.top=g.y-o[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,o=this.markerOption,s=o.color,l=o.anchor;if(!a){this.defaultMarker=!0,a=Cn("div"),this.markerOption.element=a;var h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height","48px"),h.setAttributeNS(null,"width","48px"),h.setAttributeNS(null,"viewBox","0 0 1024 1024");var d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),d.setAttributeNS(null,"fill",s),h.appendChild(d),a.appendChild(h)}qu(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(g){var y,E,b=((y=i.markerOption)===null||y===void 0?void 0:y.style)&&((E=i.markerOption)===null||E===void 0?void 0:E.style[g]);a&&(a.style[g]=b)}),a.addEventListener("click",function(g){i.onMapClick(g)}),a.addEventListener("click",this.eventHandle),ch(a,l,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(i){throw new Error("Method not implemented.")}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(Ki.EventEmitter);function I_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function L_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?I_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function oC(e){var r=uC();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function uC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=function(e){(0,lr.Z)(t,e);var r=oC(t);function t(n){var i,a;return(0,ft.Z)(this,t),a=r.call(this),(0,p.Z)((0,z.Z)(a),"markers",[]),(0,p.Z)((0,z.Z)(a),"markerLayerOption",void 0),(0,p.Z)((0,z.Z)(a),"clusterIndex",void 0),(0,p.Z)((0,z.Z)(a),"points",[]),(0,p.Z)((0,z.Z)(a),"clusterMarkers",[]),(0,p.Z)((0,z.Z)(a),"mapsService",void 0),(0,p.Z)((0,z.Z)(a),"scene",void 0),(0,p.Z)((0,z.Z)(a),"zoom",void 0),(0,p.Z)((0,z.Z)(a),"bbox",void 0),a.markerLayerOption=sr()(a.getDefault(),n),rs(["update"],(0,z.Z)(a)),a.zoom=((i=a.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,a}return(0,mt.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(Qe.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(i){var a=this.markerLayerOption.cluster;a&&this.addPoint(i,this.markers.length),this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var a=this.markers.indexOf(i);a>-1&&this.markers.splice(a,1)}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(a){a.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(i,a){var o=i.getLnglat(),s=o.lng,l=o.lat,h={geometry:{type:"Point",coordinates:[s,l]},properties:L_(L_({},i.getExtData()),{},{marker_id:a})};this.points.push(h)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,a=i.radius,o=i.minZoom,s=o===void 0?0:o,l=i.maxZoom;this.clusterIndex=new(Rc())({radius:a,minZoom:s,maxZoom:l}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,a){var o=this,s=i[0].concat(i[1]),l=this.clusterIndex.getClusters(s,a);this.clusterMarkers.forEach(function(h){h.remove()}),this.clusterMarkers=[],l.forEach(function(h){var d,g=o.markerLayerOption.clusterOption,y=g.field,E=g.method;if(h.properties&&(d=h.properties)!==null&&d!==void 0&&d.cluster_id){var b,w=o.getLeaves((b=h.properties)===null||b===void 0?void 0:b.cluster_id);if(h.properties.clusterData=w,y&&E){var F=w==null?void 0:w.map(function(je){var Ve=(0,p.Z)({},y,je.properties[y]);return Ve}),ee=tu(F,y),se=$i(E,ee),ge="point_"+E;h.properties[ge]=se.toFixed(2)}}var Ee=o.clusterMarker(h);o.clusterMarkers.push(Ee),Ee.addTo(o.scene)})}},{key:"getLeaves",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,a,o):null}},{key:"clusterMarker",value:function(i){var a=this.markerLayerOption.clusterOption,o=a,s=o.element,l=s===void 0?this.generateElement.bind(this):s,h=new w_({element:l(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return h}},{key:"normalMarker",value:function(i){var a=i.properties.marker_id;return this.markers[a]}},{key:"update",value:function(){var i=this.mapsService.getZoom(),a=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!Nl(this.bbox,a))&&(this.bbox=Su(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(i){var a=Cn("div","l7-marker-cluster"),o=Cn("div","",a),s=Cn("span","",o),l=this.markerLayerOption.clusterOption,h=l.field,d=l.method;i.properties.point_count=i.properties.point_count||1;var g=h&&d?i.properties["point_"+d]||i.properties[h]:i.properties.point_count;return s.textContent=g,a}}]),t}(Ki.EventEmitter);function D_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function F_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?D_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function sC(e){var r=lC();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N_=function(e){(0,lr.Z)(t,e);var r=sC(t);function t(n){var i;return(0,ft.Z)(this,t),i=r.call(this),(0,p.Z)((0,z.Z)(i),"popupOption",void 0),(0,p.Z)((0,z.Z)(i),"mapsService",void 0),(0,p.Z)((0,z.Z)(i),"sceneSerive",void 0),(0,p.Z)((0,z.Z)(i),"lngLat",void 0),(0,p.Z)((0,z.Z)(i),"content",void 0),(0,p.Z)((0,z.Z)(i),"closeButton",void 0),(0,p.Z)((0,z.Z)(i),"timeoutInstance",void 0),(0,p.Z)((0,z.Z)(i),"container",void 0),(0,p.Z)((0,z.Z)(i),"tip",void 0),(0,p.Z)((0,z.Z)(i),"scene",void 0),i.popupOption=F_(F_({},i.getdefault()),n),rs(["update","onClickClose","remove"],(0,z.Z)(i)),i}return(0,mt.Z)(t,[{key:"addTo",value:function(i){var a=this;return this.mapsService=i.get(Qe.IMapService),this.sceneSerive=i.get(Qe.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){a.mapsService.on("click",a.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(i){var a=window.document.createDocumentFragment(),o=window.document.createElement("body"),s;for(o.innerHTML=i;s=o.firstChild,!!s;)a.appendChild(s);return this.setDOMContent(a)}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(i){return this.setDOMContent(window.document.createTextNode(i))}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"setDOMContent",value:function(i){return this.createContent(),this.content.appendChild(i),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&qo(this.content),this.content=Cn("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Cn("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(i,a,o){var s=window.document.createElement(i);return a!==void 0&&(s.className=a),o&&o.appendChild(s),s}},{key:"removeDom",value:function(i){i.parentNode&&i.parentNode.removeChild(i)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ys.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(i){i.stopPropagation&&i.stopPropagation(),this.remove()}},{key:"update",value:function(){var i=this,a=this.lngLat,o=this.popupOption,s=o.className,l=o.maxWidth,h=o.anchor;if(!(!this.mapsService||!a||!this.content)){var d=this.mapsService.getMarkerContainer();if(!this.container&&d){this.container=this.creatDom("div","l7-popup",d),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),s&&s.split(" ").forEach(function(y){return i.container.classList.add(y)});var g=this.popupOption.stopPropagation;g&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(y){i.container.addEventListener(y,function(E){E.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}l&&this.container.style.maxWidth!==l&&(this.container.style.maxWidth=l),this.updatePosition(),Eu(this.container,"".concat(as[h])),ch(this.container,h,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.lngLat,a=i.lng,o=i.lat,s=this.popupOption.offsets,l=this.mapsService.lngLatToContainer([a,o]);this.container.style.left=l.x+s[0]+"px",this.container.style.top=l.y-s[1]+"px"}}}]),t}(Ki.EventEmitter);function cC(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}cC(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var fC=T(88307),hC=T.n(fC),dC=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"attribute",void 0),(0,p.Z)(this,"buffer",void 0);var n=t.buffer,i=t.offset,a=t.stride,o=t.normalized,s=t.size,l=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:l||0},s&&(this.attribute.size=s)}return(0,mt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),ic,j0,ac,Bu,V0,$c,W0,zp,cl,Ff,za,fl,hl,Hp,pC=(ic={},(0,p.Z)(ic,M.POINTS,"points"),(0,p.Z)(ic,M.LINES,"lines"),(0,p.Z)(ic,M.LINE_LOOP,"line loop"),(0,p.Z)(ic,M.LINE_STRIP,"line strip"),(0,p.Z)(ic,M.TRIANGLES,"triangles"),(0,p.Z)(ic,M.TRIANGLE_FAN,"triangle fan"),(0,p.Z)(ic,M.TRIANGLE_STRIP,"triangle strip"),ic),k_=(j0={},(0,p.Z)(j0,M.STATIC_DRAW,"static"),(0,p.Z)(j0,M.DYNAMIC_DRAW,"dynamic"),(0,p.Z)(j0,M.STREAM_DRAW,"stream"),j0),Fm=(ac={},(0,p.Z)(ac,M.BYTE,"int8"),(0,p.Z)(ac,M.UNSIGNED_INT,"int16"),(0,p.Z)(ac,M.INT,"int32"),(0,p.Z)(ac,M.UNSIGNED_BYTE,"uint8"),(0,p.Z)(ac,M.UNSIGNED_SHORT,"uint16"),(0,p.Z)(ac,M.UNSIGNED_INT,"uint32"),(0,p.Z)(ac,M.FLOAT,"float"),ac),vC=(Bu={},(0,p.Z)(Bu,M.ALPHA,"alpha"),(0,p.Z)(Bu,M.LUMINANCE,"luminance"),(0,p.Z)(Bu,M.LUMINANCE_ALPHA,"luminance alpha"),(0,p.Z)(Bu,M.RGB,"rgb"),(0,p.Z)(Bu,M.RGBA,"rgba"),(0,p.Z)(Bu,M.RGBA4,"rgba4"),(0,p.Z)(Bu,M.RGB5_A1,"rgb5 a1"),(0,p.Z)(Bu,M.RGB565,"rgb565"),(0,p.Z)(Bu,M.DEPTH_COMPONENT,"depth"),(0,p.Z)(Bu,M.DEPTH_STENCIL,"depth stencil"),Bu),mC=(V0={},(0,p.Z)(V0,M.DONT_CARE,"dont care"),(0,p.Z)(V0,M.NICEST,"nice"),(0,p.Z)(V0,M.FASTEST,"fast"),V0),B_=($c={},(0,p.Z)($c,M.NEAREST,"nearest"),(0,p.Z)($c,M.LINEAR,"linear"),(0,p.Z)($c,M.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,p.Z)($c,M.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,p.Z)($c,M.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,p.Z)($c,M.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),$c),Z_=(W0={},(0,p.Z)(W0,M.REPEAT,"repeat"),(0,p.Z)(W0,M.CLAMP_TO_EDGE,"clamp"),(0,p.Z)(W0,M.MIRRORED_REPEAT,"mirror"),W0),gC=(zp={},(0,p.Z)(zp,M.NONE,"none"),(0,p.Z)(zp,M.BROWSER_DEFAULT_WEBGL,"browser"),zp),_C=(cl={},(0,p.Z)(cl,M.NEVER,"never"),(0,p.Z)(cl,M.ALWAYS,"always"),(0,p.Z)(cl,M.LESS,"less"),(0,p.Z)(cl,M.LEQUAL,"lequal"),(0,p.Z)(cl,M.GREATER,"greater"),(0,p.Z)(cl,M.GEQUAL,"gequal"),(0,p.Z)(cl,M.EQUAL,"equal"),(0,p.Z)(cl,M.NOTEQUAL,"notequal"),cl),U_=(Ff={},(0,p.Z)(Ff,M.FUNC_ADD,"add"),(0,p.Z)(Ff,M.MIN_EXT,"min"),(0,p.Z)(Ff,M.MAX_EXT,"max"),(0,p.Z)(Ff,M.FUNC_SUBTRACT,"subtract"),(0,p.Z)(Ff,M.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ff),jp=(za={},(0,p.Z)(za,M.ZERO,"zero"),(0,p.Z)(za,M.ONE,"one"),(0,p.Z)(za,M.SRC_COLOR,"src color"),(0,p.Z)(za,M.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,p.Z)(za,M.SRC_ALPHA,"src alpha"),(0,p.Z)(za,M.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,p.Z)(za,M.DST_COLOR,"dst color"),(0,p.Z)(za,M.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,p.Z)(za,M.DST_ALPHA,"dst alpha"),(0,p.Z)(za,M.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,p.Z)(za,M.CONSTANT_COLOR,"constant color"),(0,p.Z)(za,M.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,p.Z)(za,M.CONSTANT_ALPHA,"constant alpha"),(0,p.Z)(za,M.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,p.Z)(za,M.SRC_ALPHA_SATURATE,"src alpha saturate"),za),yC=(fl={},(0,p.Z)(fl,M.NEVER,"never"),(0,p.Z)(fl,M.ALWAYS,"always"),(0,p.Z)(fl,M.LESS,"less"),(0,p.Z)(fl,M.LEQUAL,"lequal"),(0,p.Z)(fl,M.GREATER,"greater"),(0,p.Z)(fl,M.GEQUAL,"gequal"),(0,p.Z)(fl,M.EQUAL,"equal"),(0,p.Z)(fl,M.NOTEQUAL,"notequal"),fl),Dh=(hl={},(0,p.Z)(hl,M.ZERO,"zero"),(0,p.Z)(hl,M.KEEP,"keep"),(0,p.Z)(hl,M.REPLACE,"replace"),(0,p.Z)(hl,M.INVERT,"invert"),(0,p.Z)(hl,M.INCR,"increment"),(0,p.Z)(hl,M.DECR,"decrement"),(0,p.Z)(hl,M.INCR_WRAP,"increment wrap"),(0,p.Z)(hl,M.DECR_WRAP,"decrement wrap"),hl),EC=(Hp={},(0,p.Z)(Hp,M.FRONT,"front"),(0,p.Z)(Hp,M.BACK,"back"),Hp),xC=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"buffer",void 0);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:k_[i||M.STATIC_DRAW],type:Fm[a||M.UNSIGNED_BYTE]})}return(0,mt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),SC=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"elements",void 0);var n=t.data,i=t.usage,a=t.type,o=t.count;this.elements=r.elements({data:n,usage:k_[i||M.STATIC_DRAW],type:Fm[a||M.UNSIGNED_BYTE],count:o})}return(0,mt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),CC=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"framebuffer",void 0);var n=t.width,i=t.height,a=t.color,o=t.colors,s=t.depth,l=t.stencil,h={width:n,height:i};Array.isArray(o)&&(h.colors=o.map(function(d){return d.get()})),a&&typeof a!="boolean"&&(h.color=a.get()),this.framebuffer=r.framebuffer(h)}return(0,mt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),AC=T(36719),bC=T.n(AC),TC=T(68630),MC=T.n(TC);function G_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function dl(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?G_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):G_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var OC=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"reGl",void 0),(0,p.Z)(this,"destroyed",!1),(0,p.Z)(this,"drawCommand",void 0),(0,p.Z)(this,"drawPickCommand",void 0),(0,p.Z)(this,"drawParams",void 0),(0,p.Z)(this,"options",void 0),(0,p.Z)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,o=t.uniforms,s=t.primitive,l=t.count,h=t.elements,d=t.depth,g=t.blend,y=t.stencil,E=t.cull,b=t.instances,w={};this.options=t,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach(function(ge){w[ge]=r.prop(ge)}));var F={};Object.keys(a).forEach(function(ge){F[ge]=a[ge].get()});var ee={attributes:F,frag:i,uniforms:w,vert:n,blend:{},primitive:pC[s===void 0?M.TRIANGLES:s]};b&&(ee.instances=b),l&&(ee.count=l),h&&(ee.elements=h.get()),this.initDepthDrawParams({depth:d},ee),this.initBlendDrawParams({blend:g},ee),this.initStencilDrawParams({stencil:y},ee),this.initCullDrawParams({cull:E},ee),this.drawCommand=r(ee);var se=hi()(ee);se.blend=dl(dl({},se.blend),{},{enable:!1}),se.stencil=dl(dl({},se.stencil),{},{enable:!1}),this.drawPickCommand=r(se),this.drawParams=ee}return(0,mt.Z)(e,[{key:"addUniforms",value:function(t){this.uniforms=dl(dl({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=dl(dl({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(o){var s=(0,Me.Z)(i[o]);s==="boolean"||s==="number"||Array.isArray(i[o])||i[o].BYTES_PER_ELEMENT?a[o]=i[o]:a[o]=i[o].get()}),n?this.drawPickCommand(a):this.drawCommand(a)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:_C[i.func||M.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var i=t.blend;if(i){var a=i.enable,o=i.func,s=i.equation,l=i.color,h=l===void 0?[0,0,0,0]:l;n.blend={enable:!!a,func:{srcRGB:jp[o&&o.srcRGB||M.SRC_ALPHA],srcAlpha:jp[o&&o.srcAlpha||M.SRC_ALPHA],dstRGB:jp[o&&o.dstRGB||M.ONE_MINUS_SRC_ALPHA],dstAlpha:jp[o&&o.dstAlpha||M.ONE_MINUS_SRC_ALPHA]},equation:{rgb:U_[s&&s.rgb||M.FUNC_ADD],alpha:U_[s&&s.alpha||M.FUNC_ADD]},color:h}}}},{key:"initStencilDrawParams",value:function(t,n){var i=t.stencil;if(i){var a=i.enable,o=i.mask,s=o===void 0?-1:o,l=i.func,h=l===void 0?{cmp:M.ALWAYS,ref:0,mask:-1}:l,d=i.opFront,g=d===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:d,y=i.opBack,E=y===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:y;n.stencil={enable:!!a,mask:s,func:dl(dl({},h),{},{cmp:yC[h.cmp]}),opFront:{fail:Dh[g.fail],zfail:Dh[g.zfail],zpass:Dh[g.zpass]},opBack:{fail:Dh[E.fail],zfail:Dh[E.zfail],zpass:Dh[E.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,o=i.face,s=o===void 0?M.BACK:o;n.cull={enable:!!a,face:EC[s]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||bC()(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}MC()(n)&&Object.keys(n).forEach(function(s){o.extractUniformsRecursively(s,n[s],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(s,l){Object.keys(s).forEach(function(h){o.extractUniformsRecursively(h,s[h],i,"".concat(a&&a+".").concat(t,"[").concat(l,"]"))})})}}]),e}(),RC=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"texture",void 0),(0,p.Z)(this,"width",void 0),(0,p.Z)(this,"height",void 0),(0,p.Z)(this,"isDistroy",!1);var n=t.data,i=t.type,a=i===void 0?M.UNSIGNED_BYTE:i,o=t.width,s=t.height,l=t.flipY,h=l===void 0?!1:l,d=t.format,g=d===void 0?M.RGBA:d,y=t.mipmap,E=y===void 0?!1:y,b=t.wrapS,w=b===void 0?M.CLAMP_TO_EDGE:b,F=t.wrapT,ee=F===void 0?M.CLAMP_TO_EDGE:F,se=t.aniso,ge=se===void 0?0:se,Ee=t.alignment,je=Ee===void 0?1:Ee,Ve=t.premultiplyAlpha,rt=Ve===void 0?!1:Ve,Et=t.mag,zt=Et===void 0?M.NEAREST:Et,er=t.min,Rt=er===void 0?M.NEAREST:er,pr=t.colorSpace,xr=pr===void 0?M.BROWSER_DEFAULT_WEBGL:pr,Ur=t.x,ti=Ur===void 0?0:Ur,_i=t.y,oa=_i===void 0?0:_i,bo=t.copy,so=bo===void 0?!1:bo;this.width=o,this.height=s;var $h={width:o,height:s,type:Fm[a],format:vC[g],wrapS:Z_[w],wrapT:Z_[ee],mag:B_[zt],min:B_[Rt],alignment:je,flipY:h,colorSpace:gC[xr],premultiplyAlpha:rt,aniso:ge,x:ti,y:oa,copy:so};n&&($h.data=n),typeof E=="number"?$h.mipmap=mC[E]:typeof E=="boolean"&&($h.mipmap=E),this.texture=r.texture($h)}return(0,mt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),z_,H_,PC=(z_=(0,Ut.b2)(),z_(H_=function(){function e(){var r=this;(0,ft.Z)(this,e),(0,p.Z)(this,"extensionObject",void 0),(0,p.Z)(this,"gl",void 0),(0,p.Z)(this,"$container",void 0),(0,p.Z)(this,"canvas",void 0),(0,p.Z)(this,"width",void 0),(0,p.Z)(this,"height",void 0),(0,p.Z)(this,"isDirty",void 0),(0,p.Z)(this,"createModel",function(t){return new OC(r.gl,t)}),(0,p.Z)(this,"createAttribute",function(t){return new dC(r.gl,t)}),(0,p.Z)(this,"createBuffer",function(t){return new xC(r.gl,t)}),(0,p.Z)(this,"createElements",function(t){return new SC(r.gl,t)}),(0,p.Z)(this,"createTexture2D",function(t){return new RC(r.gl,t)}),(0,p.Z)(this,"createFramebuffer",function(t){return new CC(r.gl,t)}),(0,p.Z)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),(0,p.Z)(this,"clear",function(t){var n=t.color,i=t.depth,a=t.stencil,o=t.framebuffer,s=o===void 0?null:o,l={color:n,depth:i,stencil:a};l.framebuffer=s===null?s:s.get(),r.gl.clear(l)}),(0,p.Z)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,o=t.height;r.gl._gl.viewport(n,i,a,o),r.width=a,r.height=o,r.gl._refresh()}),(0,p.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,o=t.width,s=t.height,l={x:i,y:a,width:o,height:s};return n&&(l.framebuffer=n.get()),r.gl.read(l)}),(0,p.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,p.Z)(this,"getContainer",function(){if(lt)return r.canvas;var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,p.Z)(this,"getCanvas",function(){return r.canvas}),(0,p.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,p.Z)(this,"destroy",function(){r.gl.destroy()})}return(0,mt.Z)(e,[{key:"init",value:function(){var r=(0,ca.Z)(Ln().mark(function n(i,a){var o=this;return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.canvas=i,l.next=3,new Promise(function(h,d){hC()({canvas:o.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(y,E){(y||!E)&&d(y),h(E)}})});case 3:this.gl=l.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||H_);function j_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function V_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?j_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var wC=function(){function e(r){(0,ft.Z)(this,e),(0,p.Z)(this,"sceneService",void 0),(0,p.Z)(this,"mapService",void 0),(0,p.Z)(this,"controlService",void 0),(0,p.Z)(this,"layerService",void 0),(0,p.Z)(this,"iconService",void 0),(0,p.Z)(this,"markerService",void 0),(0,p.Z)(this,"popupService",void 0),(0,p.Z)(this,"fontService",void 0),(0,p.Z)(this,"interactionService",void 0),(0,p.Z)(this,"container",void 0);var t=r.id,n=r.map,i=r.canvas,a=r.hasBaseMap,o=LS();this.container=o,n.setContainer(o,t,i,a),o.bind(Qe.IRendererService).to(PC).inSingletonScope(),this.sceneService=o.get(Qe.ISceneService),this.mapService=o.get(Qe.IMapService),this.iconService=o.get(Qe.IIconService),this.fontService=o.get(Qe.IFontService),this.controlService=o.get(Qe.IControlService),this.layerService=o.get(Qe.ILayerService),this.markerService=o.get(Qe.IMarkerService),this.interactionService=o.get(Qe.IInteractionService),this.popupService=o.get(Qe.IPopupService),lt?this.sceneService.initMiniScene(r):(this.initComponent(t),this.sceneService.init(r),this.initControl())}return(0,mt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=DS(this.container);t.setContainer(n,this.container),this.sceneService.addLayer(t)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,n){this.layerService.remove(t,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=(0,Rn.Z)(i,2),o=a[0],s=a[1];n.fontService.addIconFont(o,s)})}},{key:"addFontFace",value:function(t,n){this.sceneService.addFontFace(t,n)}},{key:"addImage",value:function(t,n){lt?this.iconService.addImageMini(t,n,this.sceneService):this.iconService.addImage(t,n)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,n){Dm.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.on(t,n)}},{key:"once",value:function(t,n){Dm.indexOf(t)===-1?this.mapService.once(t,n):this.sceneService.once(t,n)}},{key:"off",value:function(t,n){Dm.indexOf(t)===-1?this.mapService.off(t,n):this.sceneService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,o=i.animate;this.mapService.fitBounds(t,n||V_(V_({},a),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Qe.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:ei(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new JS({position:i}))}}]),e}(),IC=T(52353),LC=T.n(IC),DC=T(13218),ao=T.n(DC),Kc,W_=(Kc={},(0,p.Z)(Kc,ku.additive,{enable:!0,func:{srcRGB:M.ONE,dstRGB:M.ONE,srcAlpha:1,dstAlpha:1}}),(0,p.Z)(Kc,ku.none,{enable:!1}),(0,p.Z)(Kc,ku.normal,{enable:!0,func:{srcRGB:M.SRC_ALPHA,dstRGB:M.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,p.Z)(Kc,ku.subtractive,{enable:!0,func:{srcRGB:M.ONE,dstRGB:M.ONE,srcAlpha:M.ZERO,dstAlpha:M.ONE_MINUS_SRC_COLOR},equation:{rgb:M.FUNC_SUBTRACT,alpha:M.FUNC_SUBTRACT}}),(0,p.Z)(Kc,ku.max,{enable:!0,func:{srcRGB:M.ONE,dstRGB:M.ONE},equation:{rgb:M.MAX_EXT}}),(0,p.Z)(Kc,ku.min,{enable:!0,func:{srcRGB:M.ONE,dstRGB:M.ONE},equation:{rgb:M.MIN_EXT}}),Kc),FC=T(81763),Sn=T.n(FC),NC=T(1469),Nf=T.n(NC),vw=1024;function Co(e,r,t,n,i){r.updateStyleAttribute(e,t,n,i)}function kC(e,r){e.opacity&&Vp("opacity",r,e.opacity),e.strokeWidth&&Vp("strokeWidth",r,e.strokeWidth),e.strokeOpacity&&Vp("strokeOpacity",r,e.strokeOpacity),e.stroke&&BC("stroke",r,e.stroke),e.offsets&&X_("offsets",r,e.offsets),e.textOffset&&X_("textOffset",r,e.textOffset),e.thetaOffset&&Vp("thetaOffset",r,e.thetaOffset)}function Vp(e,r,t){Na()(t)?Co(e,r,t,function(n){return n}):Sn()(t)?Co(e,r,[t],void 0):Nf()(t)&&t.length===2?Na()(t[0])&&ru()(t[1])||Na()(t[0])&&Nf()(t[1])&&Sn()(t[1][0])&&Sn()(t[1][1])?Co(e,r,t[0],t[1]):Co(e,r,[1],void 0):Co(e,r,[1],void 0)}function X_(e,r,t){Na()(t)?Co(e,r,t,function(n){return n}):Nf()(t)&&t.length===2&&Na()(t[0])&&ru()(t[1])?Co(e,r,t[0],t[1]):Nf()(t)&&t.length===2&&Sn()(t[0])&&Sn()(t[1])?Co(e,r,t,void 0):Co(e,r,[0,0],void 0)}function BC(e,r,t){Na()(t)?Co(e,r,t,void 0):Nf()(t)&&t.length===2&&(Na()(t[0])&&ru()(t[1])||Na()(t[0])&&Nf()(t[1])&&t[1].length>0)?Co(e,r,t[0],t[1]):Co(e,r,"#fff",void 0)}function Y_(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function $_(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),o=a.enablePicking,s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),Y_(r).forEach(function(l){var h=(0,Rn.Z)(l,2),d=h[0],g=h[1];i.add(t(d),g)}),i.add(t("copy")),i}var ZC=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function UC(e,r,t){typeof r=="string"&&typeof t=="string"&&r!==t&&ZC.map(function(n){n.includes(r)&&n.includes(t)&&(e.dataState.dataSourceNeedUpdate=!0)})}var GC=["passes"],zC=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],K_,Nm,q_;function HC(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=jC(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function jC(e,r){if(!!e){if(typeof e=="string")return Q_(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Q_(e,r)}}function Q_(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function J_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function oo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?J_(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):J_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function VC(e){var r=WC();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ey=0,kf=(K_=Lm(Qe.IGlobalConfigService),Nm=function(e){(0,lr.Z)(t,e);var r=VC(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ft.Z)(this,t),n=r.call(this),(0,p.Z)((0,z.Z)(n),"id","".concat(ey++)),(0,p.Z)((0,z.Z)(n),"name","".concat(ey)),(0,p.Z)((0,z.Z)(n),"type",void 0),(0,p.Z)((0,z.Z)(n),"visible",!0),(0,p.Z)((0,z.Z)(n),"zIndex",0),(0,p.Z)((0,z.Z)(n),"minZoom",void 0),(0,p.Z)((0,z.Z)(n),"maxZoom",void 0),(0,p.Z)((0,z.Z)(n),"inited",!1),(0,p.Z)((0,z.Z)(n),"layerModelNeedUpdate",!1),(0,p.Z)((0,z.Z)(n),"pickedFeatureID",null),(0,p.Z)((0,z.Z)(n),"selectedFeatureID",null),(0,p.Z)((0,z.Z)(n),"styleNeedUpdate",!1),(0,p.Z)((0,z.Z)(n),"rendering",void 0),(0,p.Z)((0,z.Z)(n),"clusterZoom",0),(0,p.Z)((0,z.Z)(n),"layerType",void 0),(0,p.Z)((0,z.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,p.Z)((0,z.Z)(n),"hooks",{init:new ps,afterInit:new ps,beforeRender:new ps,beforeRenderData:new vf,afterRender:new ua,beforePickingEncode:new ua,afterPickingEncode:new ua,beforeHighlight:new ua(["pickedColor"]),afterHighlight:new ua,beforeSelect:new ua(["pickedColor"]),afterSelect:new ua,beforeDestroy:new ua,afterDestroy:new ua}),(0,p.Z)((0,z.Z)(n),"models",[]),(0,p.Z)((0,z.Z)(n),"multiPassRenderer",void 0),(0,p.Z)((0,z.Z)(n),"plugins",void 0),(0,p.Z)((0,z.Z)(n),"sourceOption",void 0),(0,p.Z)((0,z.Z)(n),"layerModel",void 0),(0,p.Z)((0,z.Z)(n),"shapeOption",void 0),(0,p.Z)((0,z.Z)(n),"sceneContainer",void 0),(0,p.Z)((0,z.Z)(n),"layerChildren",[]),wr((0,z.Z)(n),"configService",q_,(0,z.Z)(n)),(0,p.Z)((0,z.Z)(n),"shaderModuleService",void 0),(0,p.Z)((0,z.Z)(n),"cameraService",void 0),(0,p.Z)((0,z.Z)(n),"coordinateService",void 0),(0,p.Z)((0,z.Z)(n),"iconService",void 0),(0,p.Z)((0,z.Z)(n),"fontService",void 0),(0,p.Z)((0,z.Z)(n),"pickingService",void 0),(0,p.Z)((0,z.Z)(n),"rendererService",void 0),(0,p.Z)((0,z.Z)(n),"layerService",void 0),(0,p.Z)((0,z.Z)(n),"interactionService",void 0),(0,p.Z)((0,z.Z)(n),"mapService",void 0),(0,p.Z)((0,z.Z)(n),"styleAttributeService",void 0),(0,p.Z)((0,z.Z)(n),"layerSource",void 0),(0,p.Z)((0,z.Z)(n),"postProcessingPassFactory",void 0),(0,p.Z)((0,z.Z)(n),"normalPassFactory",void 0),(0,p.Z)((0,z.Z)(n),"animateOptions",{enable:!1}),(0,p.Z)((0,z.Z)(n),"container",void 0),(0,p.Z)((0,z.Z)(n),"encodedData",void 0),(0,p.Z)((0,z.Z)(n),"configSchema",void 0),(0,p.Z)((0,z.Z)(n),"currentPickId",null),(0,p.Z)((0,z.Z)(n),"rawConfig",void 0),(0,p.Z)((0,z.Z)(n),"needUpdateConfig",void 0),(0,p.Z)((0,z.Z)(n),"pendingStyleAttributes",[]),(0,p.Z)((0,z.Z)(n),"scaleOptions",{}),(0,p.Z)((0,z.Z)(n),"animateStartTime",void 0),(0,p.Z)((0,z.Z)(n),"aniamateStatus",!1),(0,p.Z)((0,z.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,p.Z)((0,z.Z)(n),"isDestroied",!1),(0,p.Z)((0,z.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig(),o=a.autoFit,s=a.fitBoundsOptions;o&&n.fitBounds(s),n.reRender()}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,mt.Z)(t,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){if(!this.inited)this.needUpdateConfig=oo(oo({},this.needUpdateConfig),i);else{var a=this.container.get(Qe.SceneID);kC(i,this),this.configService.setLayerConfig(a,this.id,oo(oo(oo({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(i){this.bottomColor=i}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var i=this,a=this.container.get(Qe.SceneID);this.configService.setLayerConfig(a,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Qe.IIconService),this.fontService=this.container.get(Qe.IFontService),this.rendererService=this.container.get(Qe.IRendererService),this.layerService=this.container.get(Qe.ILayerService),this.interactionService=this.container.get(Qe.IInteractionService),this.pickingService=this.container.get(Qe.IPickingService),this.mapService=this.container.get(Qe.IMapService);var o=this.getLayerConfig(),s=o.enableMultiPassRenderer,l=o.passes;s&&l!==null&&l!==void 0&&l.length&&l.length>0&&this.mapService.on("mapAfterFrameChange",function(){i.renderLayers()}),this.cameraService=this.container.get(Qe.ICameraService),this.coordinateService=this.container.get(Qe.ICoordinateSystemService),this.shaderModuleService=this.container.get(Qe.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Qe.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Qe.IFactoryNormalPass),this.styleAttributeService=this.container.get(Qe.IStyleAttributeService),this.multiPassRenderer=this.container.get(Qe.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(y){var E=y.attributeName,b=y.attributeField,w=y.attributeValues,F=y.updateOptions;i.styleAttributeService.updateStyleAttribute(E,{scale:oo({field:b},i.splitValuesAndCallbackInAttribute(w,i.getLayerConfig()[E]))},F)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Qe.ILayerPlugin);var h=HC(this.plugins),d;try{for(h.s();!(d=h.n()).done;){var g=d.value;g.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(y){h.e(y)}finally{h.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(oo(oo({},this.getDefaultConfig()),this.rawConfig));var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(i,a,o){return this.updateStyleAttribute("color",i,a,o),this}},{key:"texture",value:function(i,a,o){return this.updateStyleAttribute("texture",i,a,o),this}},{key:"rotate",value:function(i,a,o){return this.updateStyleAttribute("rotate",i,a,o),this}},{key:"size",value:function(i,a,o){return this.updateStyleAttribute("size",i,a,o),this}},{key:"filter",value:function(i,a,o){return this.updateStyleAttribute("filter",i,a,o),this}},{key:"shape",value:function(i,a,o){var s,l,h,d=(s=this.styleAttributeService)===null||s===void 0||(l=s.getLayerStyleAttribute("shape"))===null||l===void 0||(h=l.scale)===null||h===void 0?void 0:h.field,g=i;return this.shapeOption={field:i,values:a},this.updateStyleAttribute("shape",i,a,o),UC(this,d,g),this}},{key:"label",value:function(i,a,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:o}),this}},{key:"animate",value:function(i){var a={};return ao()(i)?(a.enable=!0,a=oo(oo({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return i!=null&&i.data?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var o=this;return this.inited?this.layerSource.setData(i,a):this.on("inited",function(){o.layerSource.setData(i,a)}),this}},{key:"style",value:function(i){var a=this,o=i.passes,s=(0,Of.Z)(i,GC);return o&&Y_(o).forEach(function(l){var h=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(l[0]);h&&h.updateOptions(l[1])}),this.rawConfig=oo(oo({},this.rawConfig),s),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(i,a){return ao()(i)?this.scaleOptions=oo(oo({},this.scaleOptions),i):this.scaleOptions[i]=a,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,ca.Z)(Ln().mark(function a(){return Ln().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(this.getEncodedData().length===0){s.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){s.next=6;break}return s.next=4,this.multiPassRenderer.render();case 4:s.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return s.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=ao()(i)?!0:i,ao()(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var o=this;if(ao()(i)){var s=i.x,l=s===void 0?0:s,h=i.y,d=h===void 0?0:h;this.updateLayerConfig({highlightColor:ao()(a)?a.color:this.getLayerConfig().highlightColor,activeMix:ao()(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:l,y:d})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:ao()(a)?a.color:this.getLayerConfig().highlightColor,activeMix:ao()(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ws(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=ao()(i)?!0:i,ao()(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var o=this;if(ao()(i)){var s=i.x,l=s===void 0?0:s,h=i.y,d=h===void 0?0:h;this.updateLayerConfig({selectColor:ao()(a)?a.color:this.getLayerConfig().selectColor,selectMix:ao()(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:l,y:d})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:ao()(a)?a.color:this.getLayerConfig().selectColor,selectMix:ao()(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ws(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),o=a.visible,s=a.minZoom,l=s===void 0?-Infinity:s,h=a.maxZoom,d=h===void 0?Infinity:h;return!!o&&i>=l&&i<=d}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var o=this.getLayerConfig(),s=o.passes,l=s===void 0?[]:s;this.multiPassRenderer=$_(this,l,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var h=this.rendererService.getViewportSize(),d=h.width,g=h.height;this.multiPassRenderer.resize(d,g)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),o=a.extent,s=o.some(function(l){return Math.abs(l)===Infinity});return s?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],i),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(i){return i.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var a=this.mapService.getZoom();this.layerSource.updateClusterData(a)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var o=a.range().map(function(h){return(0,p.Z)({value:a.invertExtent(h)},i,h)});return o}else if(a.ticks){var s=a.ticks().map(function(h){return(0,p.Z)({value:h},i,a(h))});return s}else if(a!=null&&a.domain){var l=a.domain().filter(function(h){return!LC()(h)}).map(function(h){return(0,p.Z)({value:h},i,a(h))});return l}return[]}},{key:"pick",value:function(i){var a=i.x,o=i.y;this.interactionService.triggerHover({x:a,y:o})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(i){var a=i.moduleName,o=i.vertexShader,s=i.fragmentShader,l=i.triangulation,h=i.segmentNumber,d=(0,Of.Z)(i,zC);this.shaderModuleService.registerModule(a,{vs:o,fs:s});var g=this.shaderModuleService.getModule(a),y=g.vs,E=g.fs,b=g.uniforms,w=this.rendererService.createModel,F=this.styleAttributeService.createAttributesAndIndices(this.encodedData,l,h),ee=F.attributes,se=F.elements;return w(oo({attributes:ee,uniforms:b,fs:E,vs:y,elements:se,blend:W_[ku.normal]},d))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),o=a.enableHighlight,s=o===void 0?!0:o,l=a.enableSelect,h=l===void 0?!0:l,d=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&h&&(d=!0),i==="mousemove"&&(s||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(d=!0),this.isVisible()&&d}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,ca.Z)(Ln().mark(function a(o){return Ln().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,o.render();case 2:case"end":return l.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(i){var a=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(o){o.draw({uniforms:a.layerModel.getUninforms()},i)})),this}},{key:"updateStyleAttribute",value:function(i,a,o,s){this.inited?this.styleAttributeService.updateStyleAttribute(i,{scale:oo({field:a},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[a]))},s):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:o,updateOptions:s})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(i,a){return{values:ru()(i)?void 0:i||a,callback:ru()(i)?i:void 0}}}]),t}(Ki.EventEmitter),q_=Xr(Nm.prototype,"configService",[K_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm),XC=T(18446),Fh=T.n(XC),ty,km,ry;function YC(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$C(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function $C(e,r){if(!!e){if(typeof e=="string")return ny(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ny(e,r)}}function ny(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var gi=(ty=Lm(Qe.IGlobalConfigService),km=function(){function e(r){(0,ft.Z)(this,e),(0,p.Z)(this,"triangulation",void 0),(0,p.Z)(this,"createTexture2D",void 0),(0,p.Z)(this,"layer",void 0),(0,p.Z)(this,"dataTexture",void 0),(0,p.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,p.Z)(this,"rowCount",void 0),(0,p.Z)(this,"cacheStyleProperties",void 0),(0,p.Z)(this,"cellLength",void 0),(0,p.Z)(this,"cellProperties",void 0),(0,p.Z)(this,"cellTypeLayout",void 0),(0,p.Z)(this,"stylePropertyesExist",void 0),(0,p.Z)(this,"dataTextureTest",void 0),wr(this,"configService",ry,this),(0,p.Z)(this,"shaderModuleService",void 0),(0,p.Z)(this,"rendererService",void 0),(0,p.Z)(this,"iconService",void 0),(0,p.Z)(this,"fontService",void 0),(0,p.Z)(this,"styleAttributeService",void 0),(0,p.Z)(this,"mapService",void 0),(0,p.Z)(this,"cameraService",void 0),(0,p.Z)(this,"layerService",void 0),this.layer=r,this.rendererService=r.getContainer().get(Qe.IRendererService),this.shaderModuleService=r.getContainer().get(Qe.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Qe.IStyleAttributeService),this.mapService=r.getContainer().get(Qe.IMapService),this.iconService=r.getContainer().get(Qe.IIconService),this.fontService=r.getContainer().get(Qe.IFontService),this.cameraService=r.getContainer().get(Qe.ICameraService),this.layerService=r.getContainer().get(Qe.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:M.NEAREST,min:M.NEAREST,width:1,height:1}))}return(0,mt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return Fh()(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),Fh()(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),Fh()(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),Fh()(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),Fh()(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),Fh()(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!Sn()(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!Sn()(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!Sn()(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!Sn()(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return Na()(t)?!!Au(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=Zn(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Nf()(t)&&t.length===2&&Sn()(t[0])&&Sn()(t[1]))}},{key:"patchMod",value:function(t,n){for(var i=0;i<n;i++)t.push(-1)}},{key:"patchData",value:function(t,n,i){var a=YC(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,l=s.attr,h=s.count,d=n[l];d!==void 0?l==="stroke"?t.push.apply(t,(0,B.Z)(Zn(d))):l==="offsets"?this.isOffsetStatic(d)?t.push(-d[0],d[1]):t.push(0,0):t.push(Sn()(d)?d:1):this.patchMod(t,h)}}catch(g){a.e(g)}finally{a.f()}}},{key:"calDataFrame",value:function(t,n,i){for(var a=n.length,o=Math.ceil(a*t/this.DATA_TEXTURE_WIDTH),s=o*this.DATA_TEXTURE_WIDTH,l=[],h=0;h<a;h++){var d=n[h];this.patchData(l,d,i)}for(var g=l.length;g<s;g++)l.push(-1);return{data:l,width:this.DATA_TEXTURE_WIDTH,height:o}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return W_[ku[i]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),ry=Xr(km.prototype,"configService",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km),KC=T(9187),pl=T.n(KC),iy=100,mw=36,gw=40;function ay(e){return e/180*Math.acos(-1)}function oy(e){var r=ay(e[0])+Math.PI/2,t=ay(e[1]),n=iy+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),o=n*Math.sin(t);return[a,o,i]}function _w(e,r){var t=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var o=typeof r.segments!="undefined"?r.segments:32,s=2+o,l=2*s,h=[],d=[],g=[],y=[],E=[],b=[],w=0;w<=s;w++){for(var F=w/s,ee=F*Math.PI,se=0;se<=l;se++){var ge=se/l,Ee=ge*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-ee),mat4.identity(t),mat4.rotateY(t,t,Ee),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,t),vec3.scale(a,a,-e),g.push(a.slice()),y.push.apply(y,_toConsumableArray(a.slice())),vec3.normalize(a,a),E.push.apply(E,_toConsumableArray(a.slice())),b.push([ge,1-F]),y.push(ge,1-F)}if(w>0)for(var je=g.length,Ve=je-2*(l+1);Ve+l+2<je;Ve++)h.push([Ve,Ve+1,Ve+l+1]),d.push(Ve,Ve+1,Ve+l+1),h.push([Ve+l+1,Ve+1,Ve+l+2]),d.push(Ve+l+1,Ve+1,Ve+l+2)}return{cells:h,positions:g,uvs:b,positionsArr:y,indicesArr:d,normalArr:E}}function ia(){var e=new At(2);return At!=Float32Array&&(e[0]=0,e[1]=0),e}function yw(e){var r=new glMatrix.ARRAY_TYPE(2);return r[0]=e[0],r[1]=e[1],r}function Bm(e,r){var t=new At(2);return t[0]=e,t[1]=r,t}function X0(e,r){return e[0]=r[0],e[1]=r[1],e}function qC(e,r,t){return e[0]=r,e[1]=t,e}function vl(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function Wp(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function Ew(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e}function xw(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e}function Sw(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function Cw(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Aw(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e}function bw(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e}function Tw(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function Mw(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e}function Ow(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e}function Rw(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.hypot(t,n)}function Pw(e,r){var t=r[0]-e[0],n=r[1]-e[1];return t*t+n*n}function ww(e){var r=e[0],t=e[1];return Math.hypot(r,t)}function Iw(e){var r=e[0],t=e[1];return r*r+t*t}function Lw(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Dw(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function Y0(e,r){var t=r[0],n=r[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e}function Xp(e,r){return e[0]*r[0]+e[1]*r[1]}function Fw(e,r,t){var n=r[0]*t[1]-r[1]*t[0];return e[0]=e[1]=0,e[2]=n,e}function Nw(e,r,t,n){var i=r[0],a=r[1];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e}function kw(e,r){r=r||1;var t=glMatrix.RANDOM()*2*Math.PI;return e[0]=Math.cos(t)*r,e[1]=Math.sin(t)*r,e}function Bw(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i,e[1]=t[1]*n+t[3]*i,e}function Zw(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i+t[4],e[1]=t[1]*n+t[3]*i+t[5],e}function Uw(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[3]*i+t[6],e[1]=t[1]*n+t[4]*i+t[7],e}function Gw(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[4]*i+t[12],e[1]=t[1]*n+t[5]*i+t[13],e}function zw(e,r,t,n){var i=r[0]-t[0],a=r[1]-t[1],o=Math.sin(n),s=Math.cos(n);return e[0]=i*s-a*o+t[0],e[1]=i*o+a*s+t[1],e}function Hw(e,r){var t=e[0],n=e[1],i=r[0],a=r[1],o=Math.sqrt(t*t+n*n)*Math.sqrt(i*i+a*a),s=o&&(t*i+n*a)/o;return Math.acos(Math.min(Math.max(s,-1),1))}function jw(e){return e[0]=0,e[1]=0,e}function Vw(e){return"vec2("+e[0]+", "+e[1]+")"}function Ww(e,r){return e[0]===r[0]&&e[1]===r[1]}function Xw(e,r){var t=e[0],n=e[1],i=r[0],a=r[1];return Math.abs(t-i)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-a)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))}var Yw=null,Zm=Wp,$w=null,Kw=null,qw=null,Qw=null,Jw=null,e4=function(){var e=ia();return function(r,t,n,i,a,o){var s,l;for(t||(t=2),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],a(e,e,o),r[s]=e[0],r[s+1]=e[1];return r}}(),Yp=ia(),t4=ia(),aa=ia(),qc=ia(),Nh=ia();function Um(e,r,t,n,i){vl(e,t,n),Y0(e,e),r=Bm(-e[1],e[0]);var a=Bm(-t[1],t[0]);return[i/Xp(r,a),r]}function Qc(e,r){return qC(e,-r[1],r[0])}function kh(e,r,t){return Zm(e,r,t),Y0(e,e),e}function Gm(e,r){return e[0]===r[0]&&e[1]===r[1]}function r4(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var uy=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ft.Z)(this,e),(0,p.Z)(this,"complex",void 0),(0,p.Z)(this,"join",void 0),(0,p.Z)(this,"cap",void 0),(0,p.Z)(this,"miterLimit",void 0),(0,p.Z)(this,"thickness",void 0),(0,p.Z)(this,"normal",void 0),(0,p.Z)(this,"lastFlip",-1),(0,p.Z)(this,"miter",Bm(0,0)),(0,p.Z)(this,"started",!1),(0,p.Z)(this,"dash",!1),(0,p.Z)(this,"totalDistance",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,mt.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,s=1;s<a;s++){var l,h,d,g=t[s-1];g.push((l=n[s-1][2])!==null&&l!==void 0?l:0);var y=n[s-1],E=t[s];E.push((h=n[s][2])!==null&&h!==void 0?h:0);var b=n[s],w=s<t.length-1?[].concat((0,B.Z)(t[s+1]),[(d=n[s+1][2])!==null&&d!==void 0?d:0]):null,F=s<n.length-1?n[s+1]:null,ee=this.segment_gaode2(i,o,g,E,w,y,b,F);o+=ee}if(this.dash)for(var se=0;se<i.positions.length/6;se++)i.positions[se*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,s=1;s<a;s++){var l,h,d,g=t[s-1];g.push((l=n[s-1][2])!==null&&l!==void 0?l:0);var y=n[s-1],E=t[s];E.push((h=n[s][2])!==null&&h!==void 0?h:0);var b=n[s],w=s<t.length-1?[].concat((0,B.Z)(t[s+1]),[(d=n[s+1][2])!==null&&d!==void 0?d:0]):null,F=s<n.length-1?n[s+1]:null,ee=this.simpleSegment(i,o,g,E,w,y,b,F);o+=ee}if(this.dash)for(var se=0;se<i.positions.length/6;se++)i.positions[se*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var s=t[o-1],l=t[o],h=o<t.length-1?t[o+1]:null,d=this.segment(n,a,s,l,h);a+=d}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[g*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var s=t[o-1],l=t[o],h=o<t.length-1?t[o+1]:null,d=this.simpleSegment(n,a,s,l,h);a+=d}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[g*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,o,s,l,h){var d=0,g=t.indices,y=t.positions,E=t.normals,b=this.cap==="square",w=this.join==="bevel",F=Ia([l[0],l[1]]),ee=Ia([s[0],s[1]]);kh(aa,a,i);var se=0;if(this.dash&&(se=this.lineSegmentDistance(F,ee),this.totalDistance+=se),this.normal||(this.normal=ia(),Qc(this.normal,aa)),!this.started)if(this.started=!0,b){var ge=ia(),Ee=ia();vl(ge,this.normal,aa),vl(Ee,this.normal,aa),E.push(Ee[0],Ee[1],0),E.push(ge[0],ge[1],0),y.push(i[0],i[1],i[2]|0,this.totalDistance-se,-this.thickness,i[2]|0),y.push(i[0],i[1],i[2]|0,this.totalDistance-se,this.thickness,i[2]|0)}else this.extrusions(y,E,i,this.normal,this.thickness,this.totalDistance-se);if(g.push(n+0,n+1,n+2),o){Gm(a,o)&&vl(o,a,Y0(o,Wp(o,a,i))),kh(qc,o,a);var rt=Um(Nh,ia(),aa,qc,this.thickness),Et=(0,Rn.Z)(rt,2),zt=Et[0],er=Et[1],Rt=Xp(Nh,this.normal)<0?-1:1,pr=w;if(!pr&&this.join==="miter"){var xr=zt;xr>this.miterLimit&&(pr=!0)}pr?(E.push(this.normal[0],this.normal[1],0),E.push(er[0],er[1],0),y.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Rt,a[2]|0),y.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Rt,a[2]|0),g.push.apply(g,(0,B.Z)(this.lastFlip!==-Rt?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),Qc(Yp,qc),X0(this.normal,Yp),E.push(this.normal[0],this.normal[1],0),y.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Rt,a[2]|0),d+=3):(this.extrusions(y,E,a,er,zt,this.totalDistance),g.push.apply(g,(0,B.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Rt=-1,X0(this.normal,er),d+=2),this.lastFlip=Rt}else{if(Qc(this.normal,aa),b){var je=ia(),Ve=ia();Zm(Ve,aa,this.normal),vl(je,aa,this.normal),E.push(Ve[0],Ve[1],0),E.push(je[0],je[1],0),y.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),y.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0)}else this.extrusions(y,E,a,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,B.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),d+=2}return d}},{key:"simpleSegment",value:function(t,n,i,a,o){var s=0,l=t.indices,h=t.positions,d=t.normals,g=Ia([a[0],a[1]]),y=Ia([i[0],i[1]]);kh(aa,g,y);var E=0;if(this.dash&&(E=this.lineSegmentDistance(g,y),this.totalDistance+=E),this.normal||(this.normal=ia(),Qc(this.normal,aa)),this.started||(this.started=!0,this.extrusions(h,d,i,this.normal,this.thickness,this.totalDistance-E)),l.push(n+0,n+1,n+2),!o)Qc(this.normal,aa),this.extrusions(h,d,a,this.normal,this.thickness,this.totalDistance),l.push.apply(l,(0,B.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),s+=2;else{var b=Ia([o[0],o[1]]);Gm(g,b)&&vl(b,g,Y0(b,Wp(b,g,y))),kh(qc,b,g);var w=Um(Nh,ia(),aa,qc,this.thickness),F=(0,Rn.Z)(w,2),ee=F[0],se=F[1],ge=Xp(Nh,this.normal)<0?-1:1;this.extrusions(h,d,a,se,ee,this.totalDistance),l.push.apply(l,(0,B.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ge=-1,X0(this.normal,se),s+=2,this.lastFlip=ge}return s}},{key:"segment",value:function(t,n,i,a,o){var s=0,l=t.indices,h=t.positions,d=t.normals,g=this.cap==="square",y=this.join==="bevel",E=Ia([a[0],a[1]]),b=Ia([i[0],i[1]]);kh(aa,E,b);var w=0;if(this.dash&&(w=this.lineSegmentDistance(E,b),this.totalDistance+=w),this.normal||(this.normal=ia(),Qc(this.normal,aa)),!this.started)if(this.started=!0,g){var F=ia(),ee=ia();vl(F,this.normal,aa),vl(ee,this.normal,aa),d.push(ee[0],ee[1],0),d.push(F[0],F[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-w,-this.thickness,i[2]|0),h.push(i[0],i[1],i[2]|0,this.totalDistance-w,this.thickness,i[2]|0)}else this.extrusions(h,d,i,this.normal,this.thickness,this.totalDistance-w);if(l.push(n+0,n+1,n+2),o){var Ee=Ia([o[0],o[1]]);Gm(E,Ee)&&vl(Ee,E,Y0(Ee,Wp(Ee,E,b))),kh(qc,Ee,E);var je=Um(Nh,ia(),aa,qc,this.thickness),Ve=(0,Rn.Z)(je,2),rt=Ve[0],Et=Ve[1],zt=Xp(Nh,this.normal)<0?-1:1,er=y;if(!er&&this.join==="miter"){var Rt=rt;Rt>this.miterLimit&&(er=!0)}er?(d.push(this.normal[0],this.normal[1],0),d.push(Et[0],Et[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*zt,a[2]|0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*zt,a[2]|0),l.push.apply(l,(0,B.Z)(this.lastFlip!==-zt?[n,n+2,n+3]:[n+2,n+1,n+3])),l.push(n+2,n+3,n+4),Qc(Yp,qc),X0(this.normal,Yp),d.push(this.normal[0],this.normal[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*zt,a[2]|0),s+=3):(this.extrusions(h,d,a,Et,rt,this.totalDistance),l.push.apply(l,(0,B.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),zt=-1,X0(this.normal,Et),s+=2),this.lastFlip=zt}else{if(Qc(this.normal,aa),g){var se=ia(),ge=ia();Zm(ge,aa,this.normal),vl(se,aa,this.normal),d.push(ge[0],ge[1],0),d.push(se[0],se[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0)}else this.extrusions(h,d,a,this.normal,this.thickness,this.totalDistance);l.push.apply(l,(0,B.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),s+=2}return s}},{key:"extrusions",value:function(t,n,i,a,o,s){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,s,-o,i[2]|0),t.push(i[0],i[1],i[2]|0,s,o,i[2]|0)}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function Bf(e){if(Sn()(e[0]))return e;if(Sn()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Sn()(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(o){t+=o[0],n+=o[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function QC(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,o=0,s=0,l=0;l<e.length;l+=2){var h=e[l],d=e[l+1];h&&d&&(r=Math.max(h,r),t=Math.max(d,t),n=Math.min(h,n),i=Math.min(d,i),a+=h,o+=d,s++)}return{center:[a/s,o/s],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function Bh(){var e=new At(3);return At!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function JC(e){var r=new At(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function sy(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function uo(e,r,t){var n=new At(3);return n[0]=e,n[1]=r,n[2]=t,n}function eA(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function tA(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function rA(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function ly(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function cy(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function fy(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function nA(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function iA(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function aA(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function oA(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function uA(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function sA(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function lA(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function hy(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function dy(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function py(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function cA(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function fA(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function Zh(e,r){var t=r[0],n=r[1],i=r[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function vy(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function gy(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],s=t[1],l=t[2];return e[0]=i*l-a*s,e[1]=a*o-n*l,e[2]=n*s-i*o,e}function hA(e,r,t,n){var i=r[0],a=r[1],o=r[2];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e}function dA(e,r,t,n,i,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,h=o*(a-1),d=o*(3-2*a);return e[0]=r[0]*s+t[0]*l+n[0]*h+i[0]*d,e[1]=r[1]*s+t[1]*l+n[1]*h+i[1]*d,e[2]=r[2]*s+t[2]*l+n[2]*h+i[2]*d,e}function pA(e,r,t,n,i,a){var o=1-a,s=o*o,l=a*a,h=s*o,d=3*a*s,g=3*l*o,y=l*a;return e[0]=r[0]*h+t[0]*d+n[0]*g+i[0]*y,e[1]=r[1]*h+t[1]*d+n[1]*g+i[1]*y,e[2]=r[2]*h+t[2]*d+n[2]*g+i[2]*y,e}function vA(e,r){r=r||1;var t=Ft()*2*Math.PI,n=Ft()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function $0(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[3]*n+t[7]*i+t[11]*a+t[15];return o=o||1,e[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/o,e[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/o,e[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/o,e}function mA(e,r,t){var n=r[0],i=r[1],a=r[2];return e[0]=n*t[0]+i*t[3]+a*t[6],e[1]=n*t[1]+i*t[4]+a*t[7],e[2]=n*t[2]+i*t[5]+a*t[8],e}function gA(e,r,t){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],h=r[2],d=i*h-a*l,g=a*s-n*h,y=n*l-i*s,E=i*y-a*g,b=a*d-n*y,w=n*g-i*d,F=o*2;return d*=F,g*=F,y*=F,E*=2,b*=2,w*=2,e[0]=s+d+E,e[1]=l+g+b,e[2]=h+y+w,e}function _A(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function yA(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function EA(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function zm(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],s=r[2],l=Math.sqrt(t*t+n*n+i*i),h=Math.sqrt(a*a+o*o+s*s),d=l*h,g=d&&vy(e,r)/d;return Math.acos(Math.min(Math.max(g,-1),1))}function xA(e){return e[0]=0,e[1]=0,e[2]=0,e}function SA(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function CA(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function AA(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],s=r[2];return Math.abs(t-a)<=vt*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-o)<=vt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=vt*Math.max(1,Math.abs(i),Math.abs(s))}var Hm=ly,bA=cy,TA=fy,MA=hy,OA=dy,RA=sy,PA=py,wA=function(){var e=Bh();return function(r,t,n,i,a,o){var s,l;for(t||(t=3),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],a(e,e,o),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2];return r}}();function IA(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=pl().flatten(e),a=i.vertices,o=i.dimensions,s=[],l=[],h=0;h<a.length/o;h++)o===2?s.push(a[h*2],a[h*2+1],1):s.push(a[h*3],a[h*3+1],1);var d=pl()(i.vertices,i.holes,i.dimensions);l.push.apply(l,(0,B.Z)(d));for(var g=function(b){var w=i.vertices.slice(b*o,(b+1)*o),F=i.vertices.slice((b+1)*o,(b+2)*o);F.length===0&&(F=i.vertices.slice(0,o));var ee=s.length/3;s.push(w[0],w[1],1,F[0],F[1],1,w[0],w[1],0,F[0],F[1],0),l.push.apply(l,(0,B.Z)([0,2,1,2,3,1].map(function(se){return se+ee})))},y=0;y<n;y++)g(y);return{positions:s,index:l}}function LA(e){var r=pl().flatten(e),t=pl()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function _y(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=pl().flatten(e),o=a.vertices,s=a.dimensions,l=[],h=[],d=[],g=0;g<o.length/s;g++)s===2?l.push(o[g*2],o[g*2+1],1,-1,-1):l.push(o[g*3],o[g*3+1],1,-1,-1),d.push(0,0,1);var y=pl()(a.vertices,a.holes,a.dimensions);h.push.apply(h,(0,B.Z)(y));for(var E=function(F){var ee=a.vertices.slice(F*s,(F+1)*s),se=a.vertices.slice((F+1)*s,(F+2)*s);se.length===0&&(se=a.vertices.slice(0,s));var ge=l.length/5;l.push(ee[0],ee[1],1,0,0,se[0],se[1],1,.1,0,ee[0],ee[1],0,0,.8,se[0],se[1],0,.1,.8);var Ee=DA([se[0],se[1],1],[ee[0],ee[1],0],[ee[0],ee[1],1],r);d.push.apply(d,(0,B.Z)(Ee).concat((0,B.Z)(Ee),(0,B.Z)(Ee),(0,B.Z)(Ee))),h.push.apply(h,(0,B.Z)([1,2,0,3,2,1].map(function(je){return je+ge})))},b=0;b<i;b++)E(b);return{positions:l,index:h,normals:d}}function DA(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=Bh(),a=Bh(),o=Bh();n&&(e=_c(e),r=_c(r),t=_c(t));var s=uo.apply(A,(0,B.Z)(e)),l=uo.apply(A,(0,B.Z)(r)),h=uo.apply(A,(0,B.Z)(t));Hm(i,h,l),Hm(a,s,l),gy(o,i,a);var d=Bh();return Zh(d,o),d}var Zu,Zf;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Zf||(Zf={}));var Uf;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Uf||(Uf={}));function K0(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(o){var s=Math.sin(o+Math.PI/4),l=Math.cos(o+Math.PI/4);return[s,l,0]});return a}function yy(){return K0(30)}function Ey(){return K0(4)}function xy(){return K0(3)}function Sy(){return K0(6,1)}function Cy(){return K0(5)}var Uh=(Zu={},(0,p.Z)(Zu,Uf.CIRCLE,yy),(0,p.Z)(Zu,Uf.HEXAGON,Sy),(0,p.Z)(Zu,Uf.TRIANGLE,xy),(0,p.Z)(Zu,Uf.SQUARE,Ey),(0,p.Z)(Zu,Uf.PENTAGON,Cy),(0,p.Z)(Zu,Zf.CYLINDER,yy),(0,p.Z)(Zu,Zf.HEXAGONCOLUMN,Sy),(0,p.Z)(Zu,Zf.TRIANGLECOLUMN,xy),(0,p.Z)(Zu,Zf.SQUARECOLUMN,Ey),(0,p.Z)(Zu,Zf.PENTAGONCOLUMN,Cy),Zu),$p={};function Gh(e){var r=Bf(e.coordinates);return{vertices:[].concat((0,B.Z)(r),(0,B.Z)(r),(0,B.Z)(r),(0,B.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function FA(e){var r=Bf(e.coordinates),t=oy(r);return{vertices:[].concat((0,B.Z)(t),(0,B.Z)(t),(0,B.Z)(t),(0,B.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Ay(e){var r=e.shape,t=UA(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function by(e){var r=Bf(e.coordinates);return{vertices:(0,B.Z)(r),indices:[0],size:r.length}}function Ty(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new uy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var s=0;s<a.length;s++){var l=a[s],h=o[s];i.extrude_gaode2(l,h)}}else{var d=r;d[0]&&!Array.isArray(d[0][0])&&(d=[r]),d.forEach(function(y){i.extrude(y)})}var g=i.complex;return{vertices:g.positions,indices:g.indices,normals:g.normals,size:6}}function NA(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new uy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var s=0;s<a.length;s++){var l=a[s],h=o[s];i.simpleExtrude_gaode2(l,h)}}else{var d=r;d[0]&&!Array.isArray(d[0][0])&&(d=[r]),d.forEach(function(y){i.simpleExtrude(y)})}var g=i.complex;return{vertices:g.positions,indices:g.indices,normals:g.normals,size:6}}function jm(e){var r=e.coordinates,t=pl().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:pl()(n,a,i),vertices:n,size:i}}function kA(e){var r=e.coordinates,t=pl().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:pl()(n,a,i),vertices:BA(n),size:i+4}}function BA(e){for(var r=[],t=QC(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var o=e[a],s=e[a+1];r.push.apply(r,[o,s,0].concat((0,B.Z)(n),[i]))}return r}function My(e){var r=e.coordinates,t=_y(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function Oy(e){var r=e.shape,t=zA(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function Ry(e){var r=e.coordinates,t=[].concat((0,B.Z)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],(0,B.Z)(r[1]),[0,1,0],(0,B.Z)(r[0]),[0,0,1],(0,B.Z)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Kp(e,r){for(var t=r||30,n=e.coordinates,i=[],a=[],o=function(h){i.push(h,1,h,n[0][0],n[0][1],n[1][0],n[1][1],h,-1,h,n[0][0],n[0][1],n[1][0],n[1][1]),h!==t-1&&a.push.apply(a,(0,B.Z)([0,1,2,1,3,2].map(function(d){return h*2+d})))},s=0;s<t;s++)o(s);return{vertices:i,indices:a,size:7}}function ZA(e){var r=e.coordinates;r.length===2&&r.push(0);var t=e.size,n=qp(-1,1),i=qp(1,1),a=qp(-1,-1),o=qp(1,-1),s=[].concat((0,B.Z)(r),(0,B.Z)(n),(0,B.Z)(r),(0,B.Z)(a),(0,B.Z)(r),(0,B.Z)(o),(0,B.Z)(r),(0,B.Z)(i)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function UA(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if($p&&$p[e])return $p[e];var t=Uh[e]?Uh[e]():Uh.cylinder(),n=_y([t],r);return $p[e]=n,n}function n4(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,o,s,l=vec3.create(),h=vec3.create(),d=vec3.create(),g=0,y=r.length;g<y;g+=3){a=r[g+0]*3,o=r[g+1]*3,s=r[g+2]*3;var E=[e[a],e[a+1]],b=[e[o],e[o+1]],w=[e[s],e[s+1]];n&&(E=lngLatToMeters(E),b=lngLatToMeters(b),w=lngLatToMeters(w));var F=E,ee=_slicedToArray(F,2),se=ee[0],ge=ee[1],Ee=vec3.fromValues(se,ge,e[a+2]),je=b,Ve=_slicedToArray(je,2),rt=Ve[0],Et=Ve[1],zt=vec3.fromValues(rt,Et,e[o+2]),er=w,Rt=_slicedToArray(er,2),pr=Rt[0],xr=Rt[1],Ur=vec3.fromValues(pr,xr,e[s+2]);vec3.sub(l,Ur,zt),vec3.sub(h,Ee,zt),vec3.cross(d,l,h),i[a]+=l[0],i[a+1]+=l[1],i[a+2]+=l[2],i[o]+=l[0],i[o+1]+=l[1],i[o+2]+=l[2],i[s]+=l[0],i[s+1]+=l[1],i[s+2]+=l[2]}return GA(i),i}function GA(e){for(var r=0,t=e.length;r<t;r+=3){var n=vec3.fromValues(e[r],e[r+1],e[r+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,r)}}function i4(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function zA(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Uh[e]?Uh[e]():Uh.circle(),n=r.indexOf(e)===-1?LA([t]):IA([t]);return n}function qp(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function a4(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function o4(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function HA(e){var r=jA();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function jA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VA=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,WA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,XA=function(e){(0,lr.Z)(t,e);var r=HA(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"cityCenter",void 0),(0,p.Z)((0,z.Z)(n),"cityMinSize",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.baseColor,l=s===void 0?"rgb(16,16,16)":s,h=i.brightColor,d=h===void 0?"rgb(255,176,38)":h,g=i.windowColor,y=g===void 0?"rgb(30,60,89)":g,E=i.time,b=E===void 0?0:E,w=i.sweep,F=w===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:w;return{u_cityCenter:F.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*F.sweepRadius,u_circleSweep:F.enable?1:0,u_circleSweepColor:Zn(F.sweepColor).slice(0,3),u_circleSweepSpeed:F.sweepSpeed,u_opacity:o,u_baseColor:Zn(l),u_brightColor:Zn(d),u_windowColor:Zn(y),u_time:this.layer.getLayerAnimateTime()||b}}},{key:"calCityGeo",value:function(){var i=(0,Rn.Z)(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],l=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(s+a)/2,(l+o)/2]);var h=this.mapService.lngLatToCoord([s,l]),d=this.mapService.lngLatToCoord([a,o]);this.cityMinSize=Math.sqrt(Math.pow(h[0]-d[0],2)+Math.pow(h[1]-d[1],2))/4}else{var g=s-a,y=l-o;this.cityCenter=[(s+a)/2,(l+o)/2],this.cityMinSize=Math.sqrt(Math.pow(g,2)+Math.pow(y,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:WA,fragmentShader:VA,triangulation:My,cull:{enable:!0,face:M.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(a,o,s,l,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size,d=h===void 0?10:h;return Array.isArray(d)?[d[0]]:[d]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_Uv",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){var h=a.size;return[s[3],s[4]]}}})}}]),t}(gi);function YA(e){var r=$A();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KA=function(e){(0,lr.Z)(t,e);var r=YA(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","PolygonLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){this.layerModel=new XA(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(kf);function qA(e){var r=QA();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,e2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,t2=function(e){(0,lr.Z)(t,e);var r=qA(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,s=i.angle;return{u_opacity:a||1,u_coverage:o||.9,u_angle:s||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:JA,fragmentShader:e2,triangulation:Oy,depth:{enable:!1},primitive:M.TRIANGLES,blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Er.Attribute,descriptor:{name:"a_Pos",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(a,o){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(gi);function r2(e){var r=n2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,a2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,o2=function(e){(0,lr.Z)(t,e);var r=r2(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,s=i.angle;return{u_opacity:a||1,u_coverage:o||1,u_angle:s||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:i2,fragmentShader:a2,triangulation:Ay,depth:{enable:!0},blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size;return Array.isArray(h)?[h[0]]:[h]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(a,o,s,l,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Er.Attribute,descriptor:{name:"a_Pos",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(a,o){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(gi);function u2(e,r){for(var t=[],n=[],i=[],a=e+1,o=r+1,s=e/2,l=r/2,h=0;h<o;h++)for(var d=h-l,g=0;g<a;g++){var y=g-s;n.push(y/s,-d/l,0),i.push(g/e),i.push(1-h/r)}for(var E=0;E<r;E++)for(var b=0;b<e;b++){var w=b+a*E,F=b+a*(E+1),ee=b+1+a*(E+1),se=b+1+a*E;t.push(w,F,se),t.push(F,ee,se)}return{vertices:n,indices:t,uvs:i}}var Py,wy;function Iy(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ly(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Iy(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Iy(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s2(e){var r=l2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function l2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,f2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,h2=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,d2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,p2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,v2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Dy=(Py=(0,Ut.b2)(),Py(wy=function(e){(0,lr.Z)(t,e);var r=s2(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"colorTexture",void 0),(0,p.Z)((0,z.Z)(n),"heatmapFramerBuffer",void 0),(0,p.Z)((0,z.Z)(n),"intensityModel",void 0),(0,p.Z)((0,z.Z)(n),"colorModel",void 0),(0,p.Z)((0,z.Z)(n),"shapeType",void 0),n}return(0,mt.Z)(t,[{key:"render",value:function(){var i=this,a=this.rendererService,o=a.clear,s=a.useFramebuffer;s(this.heatmapFramerBuffer,function(){o({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var i,a=this.rendererService,o=a.createFramebuffer,s=a.clear,l=a.getViewportSize,h=a.createTexture2D,d=a.useFramebuffer,g=this.styleAttributeService.getLayerStyleAttribute("shape"),y=(g==null||(i=g.scale)===null||i===void 0?void 0:i.field)||"heatmap";this.shapeType=y,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=y==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var E=l(),b=E.width,w=E.height;return this.heatmapFramerBuffer=o({color:h({width:Math.floor(b/4),height:Math.floor(w/4),wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE,min:M.LINEAR,mag:M.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Er.Attribute,descriptor:{name:"a_Dir",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){return[s[3],s[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size,d=h===void 0?1:h;return[d]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:v2,fragmentShader:p2,triangulation:ZA,depth:{enable:!1},cull:{enable:!0,face:Jo(this.mapService.version)},blend:{enable:!0,func:{srcRGB:M.ONE,srcAlpha:1,dstRGB:M.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;this.shaderModuleService.registerModule("heatmapColor",{vs:d2,fs:h2});var h=this.shaderModuleService.getModule("heatmapColor"),d=h.vs,g=h.fs,y=h.uniforms,E=this.rendererService,b=E.createAttribute,w=E.createElements,F=E.createBuffer,ee=E.createModel;return ee({vs:d,fs:g,attributes:{a_Position:b({buffer:F({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:M.FLOAT}),size:3}),a_Uv:b({buffer:F({data:[0,1,1,1,0,0,1,0],type:M.FLOAT}),size:2})},uniforms:Ly({},y),depth:{enable:!1},blend:this.getBlend(),count:6,elements:w({data:[0,2,1,2,3,1],type:M.UNSIGNED_INT,count:6}),stencil:ai(o,l)})}},{key:"drawIntensityMode",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.intensity,s=o===void 0?10:o,l=i.radius,h=l===void 0?5:l;this.intensityModel.draw({uniforms:{u_opacity:a||1,u_radius:h,u_intensity:s}})}},{key:"drawColorMode",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;this.colorModel.draw({uniforms:{u_opacity:a||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=He();ht(o,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:a||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,B.Z)(o)}})}},{key:"build3dHeatMap",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=this.rendererService.getViewportSize,d=h(),g=d.width,y=d.height,E=u2(g/4,y/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:f2,fs:c2});var b=this.shaderModuleService.getModule("heatmap3dColor"),w=b.vs,F=b.fs,ee=b.uniforms,se=this.rendererService,ge=se.createAttribute,Ee=se.createElements,je=se.createBuffer,Ve=se.createModel;return Ve({vs:w,fs:F,attributes:{a_Position:ge({buffer:je({data:E.vertices,type:M.FLOAT}),size:3}),a_Uv:ge({buffer:je({data:E.uvs,type:M.FLOAT}),size:2})},primitive:M.TRIANGLES,uniforms:Ly({},ee),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:M.SRC_ALPHA,srcAlpha:1,dstRGB:M.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ee({data:E.indices,type:M.UNSIGNED_INT,count:E.indices.length}),stencil:ai(o,l)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),o=a.rampColors,s=Xs(o);this.colorTexture=i({data:new Uint8Array(s.data),width:s.width,height:s.height,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE,min:M.NEAREST,mag:M.NEAREST,flipY:!1})}}]),t}(gi))||wy);function m2(e){var r=g2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function g2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,y2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,E2=function(e){(0,lr.Z)(t,e);var r=m2(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,s=i.angle;return{u_opacity:a||1,u_coverage:o||.9,u_angle:s||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:y2,fragmentShader:_2,triangulation:Oy,depth:{enable:!1},primitive:M.TRIANGLES,blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Er.Attribute,descriptor:{name:"a_Pos",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(a,o){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(gi),x2={heatmap:Dy,heatmap3d:Dy,grid:t2,grid3d:o2,hexagon:E2},S2=x2;function C2(e){var r=A2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function A2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b2=function(e){(0,lr.Z)(t,e);var r=C2(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","HeatMapLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new S2[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var i=this,a=this.getModelType();return a==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(o){return o.draw({uniforms:i.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=this.getLayerConfig(),s=o.shape3d,l=this.getSource(),h=l.data.type,d=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return d==="heatmap"||d==="heatmap3d"?"heatmap":h==="hexagon"?(s==null?void 0:s.indexOf(d))===-1?"hexagon":"grid3d":h==="grid"?(s==null?void 0:s.indexOf(d))===-1?"grid":"grid3d":"heatmap"}}]),t}(kf);function T2(e){var r=M2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function M2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,R2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,P2=function(e){(0,lr.Z)(t,e);var r=T2(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture}}},{key:"initModels",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,l=a.maskInside,h=l===void 0?!0:l,d=this.layer.getSource(),g=this.rendererService.createTexture2D;if(this.texture=g({height:0,width:0}),lt){var y=this.layerService.sceneService.getSceneConfig().canvas,E=y.createImage();E.crossOrigin="anonymous",E.src=d.data.originData,E.onload=function(){i.texture=g({data:E,width:E.width,height:E.height}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()}}else d.data.images.then(function(b){i.texture=g({data:b[0],width:b[0].width,height:b[0].height}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:R2,fragmentShader:O2,triangulation:Ry,primitive:M.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ai(s,h)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_Uv",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){return[s[3],s[4]]}}})}}]),t}(gi),w2={image:P2},I2=w2;function L2(e){var r=D2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F2=function(e){(0,lr.Z)(t,e);var r=L2(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","ImageLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new I2[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(kf);function N2(e){var r=k2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function k2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B2=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,Z2=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,U2=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,G2=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,z2=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,H2=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,j2={solid:0,dash:1},V2=function(e){(0,lr.Z)(t,e);var r=N2(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.NEAREST,min:M.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.textureBlend,h=l===void 0?"normal":l,d=i.lineType,g=d===void 0?"solid":d,y=i.dashArray,E=y===void 0?[10,5]:y,b=i.forward,w=b===void 0?!0:b,F=i.lineTexture,ee=F===void 0?!1:F,se=i.iconStep,ge=se===void 0?100:se,Ee=i.segmentNumber,je=Ee===void 0?30:Ee,Ve=i.thetaOffset,rt=Ve===void 0?.314:Ve;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a,thetaOffset:rt})){this.judgeStyleAttributes({opacity:a,thetaOffset:rt});var Et=this.layer.getEncodedData(),zt=this.calDataFrame(this.cellLength,Et,this.cellProperties),er=zt.data,Rt=zt.width,pr=zt.height;this.rowCount=pr,this.dataTexture=this.cellLength>0&&er.length>0?this.createTexture2D({flipY:!0,data:er,format:M.LUMINANCE,type:M.FLOAT,width:Rt,height:pr}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}E.length===2&&E.push(0,0);var xr=0,Ur=[0,0,0,0],ti=[0,0,0,0];return o&&s&&(Ur=Zn(o),ti=Zn(s),xr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Sn()(rt)?rt:0,u_opacity:Sn()(a)?a:1,u_textureBlend:h==="normal"?0:1,segmentNumber:je,u_line_type:j2[g||"solid"],u_dash_array:E,u_blur:.9,u_lineDir:w?1:-1,u_texture:this.texture,u_line_texture:ee?1:0,u_icon_step:ge,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:xr,u_sourceColor:Ur,u_targetColor:ti}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,s=i.lineType;return s==="dash"?{frag:B2,vert:Z2,type:"dash"}:a&&o?{frag:z2,vert:H2,type:"linear"}:{frag:U2,vert:G2,type:"normal"}}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.segmentNumber,o=a===void 0?30:a,s=i.mask,l=s===void 0?!1:s,h=i.maskInside,d=h===void 0?!0:h,g=this.getShaders(),y=g.frag,E=g.vert,b=g.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+b,vertexShader:E,fragmentShader:y,triangulation:Kp,depth:{enable:!1},blend:this.getBlend(),segmentNumber:o,stencil:ai(l,d)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size,g=d===void 0?1:d;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Er.Attribute,descriptor:{name:"a_Instance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:4,update:function(o,s,l,h){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.iconService.getIconMap(),g=o.texture,y=d[g]||{x:0,y:0},E=y.x,b=y.y;return[E,b]}}})}}]),t}(gi);function W2(e){var r=X2();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,$2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,K2=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,q2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Q2={solid:0,dash:1},J2=function(e){(0,lr.Z)(t,e);var r=W2(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.NEAREST,min:M.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.textureBlend,h=l===void 0?"normal":l,d=i.lineType,g=d===void 0?"solid":d,y=i.dashArray,E=y===void 0?[10,5]:y,b=i.lineTexture,w=b===void 0?!1:b,F=i.iconStep,ee=F===void 0?100:F,se=i.segmentNumber,ge=se===void 0?30:se,Ee=i.globalArcHeight,je=Ee===void 0?10:Ee;E.length===2&&E.push(0,0);var Ve=0,rt=[0,0,0,0],Et=[0,0,0,0];if(o&&s&&(rt=Zn(o),Et=Zn(s),Ve=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a})){this.judgeStyleAttributes({opacity:a});var zt=this.layer.getEncodedData(),er=this.calDataFrame(this.cellLength,zt,this.cellProperties),Rt=er.data,pr=er.width,xr=er.height;this.rowCount=xr,this.dataTexture=this.cellLength>0&&Rt.length>0?this.createTexture2D({flipY:!0,data:Rt,format:M.LUMINANCE,type:M.FLOAT,width:pr,height:xr}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:iy,u_global_height:je,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(a)?a:1,u_textureBlend:h==="normal"?0:1,segmentNumber:ge,u_line_type:Q2[g]||0,u_dash_array:E,u_texture:this.texture,u_line_texture:w?1:0,u_icon_step:ee,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ve,u_sourceColor:rt,u_targetColor:Et}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,s=i.lineType;return a&&o?{frag:K2,vert:q2,type:"linear"}:{frag:Y2,vert:$2,type:"normal"}}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.segmentNumber,o=a===void 0?30:a,s=i.mask,l=s===void 0?!1:s,h=i.maskInside,d=h===void 0?!0:h,g=this.getShaders(),y=g.frag,E=g.vert,b=g.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+b,vertexShader:E,fragmentShader:y,triangulation:Kp,blend:this.getBlend(),segmentNumber:o,stencil:ai(l,d)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size,g=d===void 0?1:d;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Er.Attribute,descriptor:{name:"a_Instance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:4,update:function(o,s,l,h){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.iconService.getIconMap(),g=o.texture,y=d[g]||{x:0,y:0},E=y.x,b=y.y;return[E,b]}}})}}]),t}(gi);function eb(e){var r=tb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rb=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,nb=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,ib=function(e){(0,lr.Z)(t,e);var r=eb(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.forward,h=l===void 0?!0:l,d=i.segmentNumber,g=d===void 0?30:d,y=i.thetaOffset,E=y===void 0?.314:y,b=0,w=[0,0,0,0],F=[0,0,0,0];return o&&s&&(w=Zn(o),F=Zn(s),b=1),{u_thetaOffset:E,u_opacity:Sn()(a)?a:1,segmentNumber:g,u_blur:.9,u_lineDir:h?1:-1,u_linearColor:b,u_sourceColor:w,u_targetColor:F}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.segmentNumber,o=a===void 0?30:a;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:nb,fragmentShader:rb,triangulation:Kp,depth:{enable:!1},blend:this.getBlend(),segmentNumber:o})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size,d=h===void 0?1:h;return Array.isArray(d)?[d[0]]:[d]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Er.Attribute,descriptor:{name:"a_Instance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:4,update:function(a,o,s,l){return[s[3],s[4],s[5],s[6]]}}})}}]),t}(gi);function ab(e){var r=ob();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ub=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,sb=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,lb={solid:0,dash:1},cb=function(e){(0,lr.Z)(t,e);var r=ab(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.NEAREST,min:M.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.textureBlend,h=l===void 0?"normal":l,d=i.lineType,g=d===void 0?"solid":d,y=i.dashArray,E=y===void 0?[10,5]:y,b=i.lineTexture,w=b===void 0?!1:b,F=i.iconStep,ee=F===void 0?100:F,se=i.segmentNumber,ge=se===void 0?30:se;E.length===2&&E.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ee=0,je=[0,0,0,0],Ve=[0,0,0,0];if(o&&s&&(je=Zn(o),Ve=Zn(s),Ee=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a})){this.judgeStyleAttributes({opacity:a});var rt=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,rt,this.cellProperties),zt=Et.data,er=Et.width,Rt=Et.height;this.rowCount=Rt,this.dataTexture=this.cellLength>0&&zt.length>0?this.createTexture2D({flipY:!0,data:zt,format:M.LUMINANCE,type:M.FLOAT,width:er,height:Rt}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(a)?a:1,u_textureBlend:h==="normal"?0:1,segmentNumber:ge,u_line_type:lb[g]||0,u_dash_array:E,u_texture:this.texture,u_line_texture:w?1:0,u_icon_step:ee,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ee,u_sourceColor:je,u_targetColor:Ve}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:sb,fragmentShader:ub,triangulation:Kp,depth:{enable:!1},blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size,g=d===void 0?1:d;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Er.Attribute,descriptor:{name:"a_Instance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:4,update:function(o,s,l,h){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.iconService.getIconMap(),g=o.texture,y=d[g]||{x:0,y:0},E=y.x,b=y.y;return[E,b]}}})}}]),t}(gi);function fb(e){var r=hb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,pb=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,vb=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Fy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  // project_pos.z += u_raisingHeight;
  // if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  //   project_pos.z += u_raisingHeight * mapboxZoomScale;
  // }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y) + h * 0.2 + u_raisingHeight, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      // h *= 2.0/pow(2.0, 20.0 - u_Zoom);
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
    } else {
      h += u_raisingHeight;
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,mb=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,gb={solid:0,dash:1},Ny=function(e){(0,lr.Z)(t,e);var r=fb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.NEAREST,min:M.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.textureBlend,h=l===void 0?"normal":l,d=i.lineType,g=d===void 0?"solid":d,y=i.dashArray,E=y===void 0?[10,5,0,0]:y,b=i.lineTexture,w=b===void 0?!1:b,F=i.iconStep,ee=F===void 0?100:F,se=i.vertexHeightScale,ge=se===void 0?20:se,Ee=i.borderWidth,je=Ee===void 0?0:Ee,Ve=i.borderColor,rt=Ve===void 0?"#ccc":Ve,Et=i.raisingHeight,zt=Et===void 0?0:Et;E.length===2&&E.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var er=0,Rt=[0,0,0,0],pr=[0,0,0,0];if(o&&s&&(Rt=Zn(o),pr=Zn(s),er=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a})){this.judgeStyleAttributes({opacity:a});var xr=this.layer.getEncodedData(),Ur=this.calDataFrame(this.cellLength,xr,this.cellProperties),ti=Ur.data,_i=Ur.width,oa=Ur.height;this.rowCount=oa,this.dataTexture=this.cellLength>0&&ti.length>0?this.createTexture2D({flipY:!0,data:ti,format:M.LUMINANCE,type:M.FLOAT,width:_i,height:oa}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(a)?a:1,u_textureBlend:h==="normal"?0:1,u_line_type:gb[g],u_dash_array:E,u_texture:this.texture,u_line_texture:w?1:0,u_icon_step:ee,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:je,u_borderColor:Zn(rt),u_linearColor:er,u_sourceColor:Rt,u_targetColor:pr,u_vertexScale:ge,u_raisingHeight:Number(zt)}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=i.depth,d=h===void 0?!1:h,g=this.getShaders(),y=g.frag,E=g.vert,b=g.type;return[this.layer.buildLayerModel({moduleName:"line_"+b,vertexShader:E,fragmentShader:y,triangulation:Ty,primitive:M.TRIANGLES,blend:this.getBlend(),depth:{enable:d},stencil:ai(o,l)})]}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,s=i.lineType;return s==="dash"?{frag:db,vert:pb,type:"dash"}:a&&o?{frag:mb,vert:Fy,type:"linear"}:{frag:vb,vert:Fy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Er.Attribute,descriptor:{name:"a_Distance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Er.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=o.size,g=d===void 0?1:d;return Array.isArray(g)?[g[0],g[1]]:[g,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(o,s,l,h,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Er.Attribute,descriptor:{name:"a_Miter",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){return[l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.iconService.getIconMap(),g=o.texture,y=d[g]||{x:0,y:0},E=y.x,b=y.y;return[E,b]}}})}}]),t}(gi);function _b(e){var r=yb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,xb=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,ky=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,Sb=function(e){(0,lr.Z)(t,e);var r=_b(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.vertexHeightScale,h=l===void 0?20:l,d=0,g=[0,0,0,0],y=[0,0,0,0];if(o&&s&&(g=Zn(o),y=Zn(s),d=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a})){this.judgeStyleAttributes({opacity:a});var E=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,E,this.cellProperties),w=b.data,F=b.width,ee=b.height;this.rowCount=ee,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:M.LUMINANCE,type:M.FLOAT,width:F,height:ee}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(a)?a:1,u_linearColor:d,u_sourceColor:g,u_targetColor:y,u_vertexScale:h}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:Eb,vert:ky,type:"linear"}:{frag:xb,vert:ky,type:"normal"}}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=this.getShaders(),d=h.frag,g=h.vert,y=h.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+y,vertexShader:g,fragmentShader:d,triangulation:NA,primitive:M.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:ai(o,l)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Er.Attribute,descriptor:{name:"a_Distance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){return[s[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Er.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){var h=a.size,d=h===void 0?1:h;return Array.isArray(d)?[d[0],d[1]]:[d,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(a,o,s,l,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Er.Attribute,descriptor:{name:"a_Miter",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){return[s[4]]}}})}}]),t}(gi);function Cb(e){var r=Ab();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bb=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,Tb=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Mb=function(e){(0,lr.Z)(t,e);var r=Cb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.NEAREST,min:M.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.sourceColor,s=i.targetColor,l=i.textureBlend,h=l===void 0?"normal":l,d=i.heightfixed,g=d===void 0?!1:d,y=i.lineTexture,E=y===void 0?!1:y,b=i.iconStep,w=b===void 0?100:b,F=i.iconStepCount,ee=F===void 0?1:F;this.rendererService.getDirty()&&this.texture.bind();var se=0,ge=[0,0,0,0],Ee=[0,0,0,0];if(o&&s&&(ge=Zn(o),Ee=Zn(s),se=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a})){this.judgeStyleAttributes({opacity:a});var je=this.layer.getEncodedData(),Ve=this.calDataFrame(this.cellLength,je,this.cellProperties),rt=Ve.data,Et=Ve.width,zt=Ve.height;this.rowCount=zt,this.dataTexture=this.cellLength>0&&rt.length>0?this.createTexture2D({flipY:!0,data:rt,format:M.LUMINANCE,type:M.FLOAT,width:Et,height:zt}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(a)?a:1,u_textureBlend:h==="normal"?0:1,u_texture:this.texture,u_line_texture:E?1:0,u_iconStepCount:ee,u_icon_step:w,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:se,u_sourceColor:ge,u_targetColor:Ee}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:Tb,fragmentShader:bb,triangulation:Ty,primitive:M.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.lineType,s=o===void 0?"solid":o;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Er.Attribute,descriptor:{name:"a_Distance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(h,d,g,y){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Er.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(h,d,g,y){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(h,d,g,y){var E=h.size,b=E===void 0?1:E;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(h,d,g,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Er.Attribute,descriptor:{name:"a_Miter",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(h,d,g,y){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(h,d,g,y){var E=i.iconService.getIconMap(),b=h.texture,w=E[b]||{x:0,y:0},F=w.x,ee=w.y;return[F,ee]}}})}}]),t}(gi),Ob={arc:V2,arcmini:ib,arc3d:J2,greatcircle:cb,wall:Mb,line:Ny,simple:Sb},Rb=Ob;function Pb(e){var r=wb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ib=function(e){(0,lr.Z)(t,e);var r=Pb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","LineLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new Rb[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return a[i]}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o||"line"}}]),t}(kf);function Lb(e){var r=Db();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fb=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Nb=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,By=function(e){(0,lr.Z)(t,e);var r=Lb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"raiseCount",0),(0,p.Z)((0,z.Z)(n),"raiserepeat",0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,s=i.opacity,l=s===void 0?1:s,h=i.sourceColor,d=i.targetColor,g=i.pickLight,y=g===void 0?!1:g,E=i.heightfixed,b=E===void 0?!1:E,w=i.opacityLinear,F=w===void 0?{enable:!1,dir:"up"}:w,ee=i.lightEnable,se=ee===void 0?!0:ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var ge=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,ge,this.cellProperties),je=Ee.data,Ve=Ee.width,rt=Ee.height;this.rowCount=rt,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:M.LUMINANCE,type:M.FLOAT,width:Ve,height:rt}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}var Et=0,zt=[0,0,0,0],er=[0,0,0,0];if(h&&d&&(zt=Zn(h),er=Zn(d),Et=1),this.raiseCount<1&&this.raiserepeat>0&&o.enable){var Rt=o.speed,pr=Rt===void 0?.01:Rt,xr=o.repeat,Ur=xr===void 0?!1:xr;this.raiseCount+=pr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(y),u_heightfixed:Number(b),u_r:o.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(l)?l:1,u_linearColor:Et,u_sourceColor:zt,u_targetColor:er,u_opacitylinear:Number(F.enable),u_opacitylinear_dir:F.dir==="up"?1:0,u_lightEnable:Number(se)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.depth,o=a===void 0?!0:a,s=i.animateOption.repeat,l=s===void 0?1:s;return this.raiserepeat=l,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Nb,fragmentShader:Fb,triangulation:Ay,blend:this.getBlend(),cull:{enable:!0,face:Jo(this.mapService.version)},depth:{enable:o}})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(o,s,l,h){var d=o.size;if(d){var g=[];return Array.isArray(d)&&(g=d.length===2?[d[0],d[0],d[1]]:d),Array.isArray(d)||(g=[d,d,d]),g}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(o,s,l,h,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Er.Attribute,descriptor:{name:"a_Pos",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(o,s){var l=Bf(o.coordinates);return i?oy([l[0],l[1]]):[l[0],l[1],0]}}})}}]),t}(gi),Ha;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Ha||(Ha={}));function kb(e){var r=Bb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zy=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  float r = v_radius / (v_radius + strokeWidth);

  // 'circle'
  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);
 
  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float PI = 3.14159;
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);

  // TODO: \u6839\u636E\u53E0\u52A0\u6C34\u6CE2\u6548\u679C
  gl_FragColor = vec4(v_color.xyz, v_color.a * opacity * intensity);

  if(u_additive > 0.0) {
    gl_FragColor *= gl_FragColor.a;
  } 

  // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6
  if(d < 0.5) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Zb=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Vm=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Uy=function(e){(0,lr.Z)(t,e);var r=kb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"meter2coord",1),(0,p.Z)((0,z.Z)(n),"isMeter",!1),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.strokeOpacity,l=s===void 0?1:s,h=i.strokeWidth,d=h===void 0?0:h,g=i.stroke,y=g===void 0?"rgba(0,0,0,0)":g,E=i.offsets,b=E===void 0?[0,0]:E,w=i.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:l,strokeWidth:d,stroke:y,offsets:b})){this.judgeStyleAttributes({opacity:o,strokeOpacity:l,strokeWidth:d,stroke:y,offsets:b});var F=this.layer.getEncodedData(),ee=this.calDataFrame(this.cellLength,F,this.cellProperties),se=ee.data,ge=ee.width,Ee=ee.height;this.rowCount=Ee,this.dataTexture=this.cellLength>0&&se.length>0?this.createTexture2D({flipY:!0,data:se,format:M.LUMINANCE,type:M.FLOAT,width:ge,height:Ee}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:w==="additive"?1:0,u_globel:this.mapService.version===Ha.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(o)?o:1,u_stroke_opacity:Sn()(l)?l:1,u_stroke_width:Sn()(d)?d:0,u_stroke_color:this.getStrokeColor(y),u_offsets:this.isOffsetStatic(b)?b:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Gh)}},{key:"initModels",value:function(){var i=this.layer.getLayerConfig(),a=i.unit,o=a===void 0?"l7size":a,s=this.mapService.version;return o==="meter"&&s!==Ha.L7MAP&&s!==Ha.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var i=(0,Rn.Z)(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],l=i[3],h=[(a+s)/2,(o+l)/2],d=this.mapService.version;if(d===Ha.MAPBOX&&window.mapboxgl.MercatorCoordinate){var g=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:h[0],lat:h[1]},0),y=1,E=y*g.meterInMercatorCoordinateUnits(),b=new window.mapboxgl.MercatorCoordinate(g.x-E,g.y,g.z),w=b.toLngLat();this.meter2coord=h[0]-w.lng;return}var F=this.mapService.meterToCoord(h,[a,o]),ee=this.mapService.meterToCoord(h,[s===a?s+.1:s,l===o?o+.1:l]);this.meter2coord=(F+ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=i.animateOption,d=h===void 0?{enable:!1}:h,g=this.getShaders(d),y=g.frag,E=g.vert,b=g.type,w=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill_"+b,vertexShader:E,fragmentShader:y,triangulation:w?FA:Gh,depth:{enable:w},blend:this.getBlend(),stencil:ai(o,l),cull:{enable:!0,face:Jo(this.mapService.version)}})]}},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:Zy,vert:Vm,type:"wave"};default:return{frag:Zy,vert:Vm,type:"wave"}}else return{frag:Zb,vert:Vm,type:"normal"}}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this,a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Er.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(s,l,h,d){var g;if(a){var y=(0,Rn.Z)(h,3),E=y[0],b=y[1],w=y[2],F=uo(0,0,1),ee=uo(E,0,w),se=E>=0?zm(F,ee):Math.PI*2-zm(F,ee),ge=Math.PI*2-Math.asin(b/100),Ee=He();Mr(Ee,Ee,se),Nr(Ee,Ee,ge);var je=uo(1,1,0);$0(je,je,Ee),Zh(je,je);var Ve=uo(-1,1,0);$0(Ve,Ve,Ee),Zh(Ve,Ve);var rt=uo(-1,-1,0);$0(rt,rt,Ee),Zh(rt,rt);var Et=uo(1,-1,0);$0(Et,Et,Ee),Zh(Et,Et),g=[].concat((0,B.Z)(je),(0,B.Z)(Ve),(0,B.Z)(rt),(0,B.Z)(Et))}else g=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var zt=d%4*3;return[g[zt],g[zt+1],g[zt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(s,l,h,d){var g=s.size,y=g===void 0?5:g;return Array.isArray(y)?[y[0]*i.meter2coord]:[y*i.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Er.Attribute,descriptor:{name:"a_Shape",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(s,l,h,d){var g=s.shape,y=g===void 0?2:g,E=i.layer.getLayerConfig().shape2d,b=E.indexOf(y);return[b]}}})}}]),t}(gi);function Ub(e){var r=Gb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Gb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zb=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Hb=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,jb=function(e){(0,lr.Z)(t,e);var r=Ub(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"meter2coord",1),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"isMeter",!1),(0,p.Z)((0,z.Z)(n),"radian",0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.LINEAR,min:M.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.strokeOpacity,l=s===void 0?1:s,h=i.strokeWidth,d=h===void 0?0:h,g=i.stroke,y=g===void 0?"rgba(0,0,0,0)":g,E=i.offsets,b=E===void 0?[0,0]:E,w=i.blend,F=i.rotation;this.rendererService.getDirty()&&this.texture.bind();var ee=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(ee=-1),this.radian=F?ee*Math.PI*F/180:ee*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:l,strokeWidth:d,stroke:y,offsets:b})){this.judgeStyleAttributes({opacity:o,strokeOpacity:l,strokeWidth:d,stroke:y,offsets:b});var se=this.layer.getEncodedData(),ge=this.calDataFrame(this.cellLength,se,this.cellProperties),Ee=ge.data,je=ge.width,Ve=ge.height;this.rowCount=Ve,this.dataTexture=this.cellLength>0&&Ee.length>0?this.createTexture2D({flipY:!0,data:Ee,format:M.LUMINANCE,type:M.FLOAT,width:je,height:Ve}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:w==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Sn()(o)?o:1,u_offsets:this.isOffsetStatic(b)?b:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Gh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var i=this.layer.getLayerConfig(),a=i.unit,o=a===void 0?"l7size":a,s=this.mapService.version;return o==="meter"&&s!==Ha.L7MAP&&s!==Ha.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var i=(0,Rn.Z)(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],l=i[3],h=[(a+s)/2,(o+l)/2],d=this.mapService.version;if(d===Ha.MAPBOX&&window.mapboxgl.MercatorCoordinate){var g=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:h[0],lat:h[1]},0),y=1,E=y*g.meterInMercatorCoordinateUnits(),b=new window.mapboxgl.MercatorCoordinate(g.x-E,g.y,g.z),w=b.toLngLat();this.meter2coord=h[0]-w.lng;return}var F=this.mapService.meterToCoord(h,[a,o]),ee=this.mapService.meterToCoord(h,[s===a?s+.1:s,l===o?o+.1:l]);this.meter2coord=(F+ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=this.getShaders(),d=h.frag,g=h.vert,y=h.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+y,vertexShader:g,fragmentShader:d,triangulation:Gh,depth:{enable:!1},blend:this.getBlend(),stencil:ai(o,l),cull:{enable:!0,face:Jo(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:zb,vert:Hb,type:"normal"}}},{key:"clearModels",value:function(){var i,a;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_Uv",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.iconService.getIconMap(),g=o.shape,y=d[g]||{x:0,y:0},E=y.x,b=y.y;return[E,b]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Er.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(o,s,l,h){var d=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],g=h%4*3;return[d[g],d[g+1],d[g+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size,g=d===void 0?5:d;return Array.isArray(g)?[g[0]*i.meter2coord]:[g*i.meter2coord]}}})}}]),t}(gi);function Vb(e){var r=Wb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function Wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xb=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Yb=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,$b=function(e){(0,lr.Z)(t,e);var r=Vb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var i=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){i.updateTexture(),i.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:Yb,fragmentShader:Xb,triangulation:by,primitive:M.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size;return Array.isArray(d)?[d[0]]:[d]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_Uv",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.fontService.mapping,g=o.shape,y=i.fontService.getGlyph(g),E=d[y],b=E.x,w=E.y;return[b,w]}}})}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.fontService.canvas;this.texture=i({data:a,mag:M.LINEAR,min:M.LINEAR,width:a.width,height:a.height})}},{key:"initIconFontGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.fontWeight,s=o===void 0?"normal":o,l=a.fontFamily,h=l===void 0?"sans-serif":l,d=this.layer.getEncodedData(),g=[];d.forEach(function(y){var E=y.shape,b=E===void 0?"":E;b=b.toString();var w=i.fontService.getGlyph(b);g.indexOf(w)===-1&&g.push(w)}),this.fontService.setFontOptions({characterSet:g,fontWeight:s,fontFamily:h,fontSize:48})}}]),t}(gi);function Kb(e){var r=qb();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qb=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Jb=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Gy=function(e){(0,lr.Z)(t,e);var r=Kb(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"updateTexture",function(){var s=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=s({data:n.iconService.getCanvas(),mag:M.LINEAR,min:M.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.offsets,s=o===void 0?[0,0]:o;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a,offsets:s})){this.judgeStyleAttributes({opacity:a,offsets:s});var l=this.layer.getEncodedData(),h=this.calDataFrame(this.cellLength,l,this.cellProperties),d=h.data,g=h.width,y=h.height;this.rowCount=y,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:M.LUMINANCE,type:M.FLOAT,width:g,height:y}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Sn()(a)?a:1,u_offsets:this.isOffsetStatic(s)?s:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Jb,fragmentShader:Qb,triangulation:by,primitive:M.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size,g=d===void 0?5:d;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_Uv",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(o,s,l,h){var d=i.iconService.getIconMap(),g=o.shape,y=d[g]||{x:0,y:0},E=y.x,b=y.y;return[E,b]}}})}}]),t}(gi);function eT(e){var r=tT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function tT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rT=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,nT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function iT(e){var r=e.coordinates;return{vertices:(0,B.Z)(r),indices:[0],size:r.length}}var zy=function(e){(0,lr.Z)(t,e);var r=eT(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.offsets,l=s===void 0?[0,0]:s;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:l})){this.judgeStyleAttributes({opacity:o,offsets:l});var h=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,h,this.cellProperties),g=d.data,y=d.width,E=d.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:M.LUMINANCE,type:M.FLOAT,width:y,height:E}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(o)?o:1,u_offsets:this.isOffsetStatic(l)?l:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:nT,fragmentShader:rT,triangulation:iT,depth:{enable:!1},primitive:M.POINTS,blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size,d=h===void 0?1:h;return Array.isArray(d)?[d[0]]:[d]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:ku.additive}}}]),t}(gi);function aT(e){var r=oT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function oT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uT=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,sT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,lT=function(e){(0,lr.Z)(t,e);var r=aT(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"meter2coord",1),(0,p.Z)((0,z.Z)(n),"isMeter",!1),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.strokeOpacity,l=s===void 0?1:s,h=i.strokeWidth,d=h===void 0?0:h,g=i.stroke,y=g===void 0?"rgba(0,0,0,0)":g,E=i.offsets,b=E===void 0?[0,0]:E,w=i.blend,F=i.speed,ee=F===void 0?1:F;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:l,strokeWidth:d,stroke:y,offsets:b})){this.judgeStyleAttributes({opacity:o,strokeOpacity:l,strokeWidth:d,stroke:y,offsets:b});var se=this.layer.getEncodedData(),ge=this.calDataFrame(this.cellLength,se,this.cellProperties),Ee=ge.data,je=ge.width,Ve=ge.height;this.rowCount=Ve,this.dataTexture=this.cellLength>0&&Ee.length>0?this.createTexture2D({flipY:!0,data:Ee,format:M.LUMINANCE,type:M.FLOAT,width:je,height:Ve}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:ee,u_additive:w==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(o)?o:1,u_offsets:this.isOffsetStatic(b)?b:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Gh)}},{key:"initModels",value:function(){var i=this.layer.getLayerConfig(),a=i.unit,o=a===void 0?"l7size":a,s=this.mapService.version;return o==="meter"&&s!==Ha.L7MAP&&s!==Ha.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var i=(0,Rn.Z)(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],l=i[3],h=[(a+s)/2,(o+l)/2],d=this.mapService.version;if(d===Ha.MAPBOX&&window.mapboxgl.MercatorCoordinate){var g=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:h[0],lat:h[1]},0),y=1,E=y*g.meterInMercatorCoordinateUnits(),b=new window.mapboxgl.MercatorCoordinate(g.x-E,g.y,g.z),w=b.toLngLat();this.meter2coord=h[0]-w.lng;return}var F=this.mapService.meterToCoord(h,[a,o]),ee=this.mapService.meterToCoord(h,[s===a?s+.1:s,l===o?o+.1:l]);this.meter2coord=(F+ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=this.getShaders(),d=h.frag,g=h.vert,y=h.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+y,vertexShader:g,fragmentShader:d,triangulation:Gh,depth:{enable:!1},blend:this.getBlend(),stencil:ai(o,l),cull:{enable:!0,face:Jo(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:uT,vert:sT,type:"radar"}}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Er.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(o,s,l,h){var d;d=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var g=h%4*3;return[d[g],d[g+1],d[g+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.size,g=d===void 0?5:d;return Array.isArray(g)?[g[0]*i.meter2coord]:[g*i.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Er.Attribute,descriptor:{name:"a_Shape",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(o,s,l,h){var d=o.shape,g=d===void 0?2:d,y=i.layer.getLayerConfig().shape2d,E=y.indexOf(g);return[E]}}})}}]),t}(gi);function cT(e){var r=fT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function fT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hT=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,dT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function pT(e){var r=e.coordinates;return{vertices:(0,B.Z)(r),indices:[0],size:r.length}}var vT=function(e){(0,lr.Z)(t,e);var r=cT(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.offsets,l=s===void 0?[0,0]:s,h=i.blend,d=i.strokeOpacity,g=d===void 0?1:d,y=i.strokeWidth,E=y===void 0?0:y,b=i.stroke,w=b===void 0?"#fff":b;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:l})){this.judgeStyleAttributes({opacity:o,offsets:l});var F=this.layer.getEncodedData(),ee=this.calDataFrame(this.cellLength,F,this.cellProperties),se=ee.data,ge=ee.width,Ee=ee.height;this.rowCount=Ee,this.dataTexture=this.cellLength>0&&se.length>0?this.createTexture2D({flipY:!0,data:se,format:M.LUMINANCE,type:M.FLOAT,width:ge,height:Ee}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_additive:h==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(o)?o:1,u_offsets:this.isOffsetStatic(l)?l:[0,0],u_stroke_opacity:Sn()(g)?g:1,u_stroke_width:Sn()(E)?E:0,u_stroke_color:this.getStrokeColor(w)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:dT,fragmentShader:hT,triangulation:pT,depth:{enable:!1},primitive:M.POINTS,blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size,d=h===void 0?1:h;return Array.isArray(d)?[d[0]]:[d]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:ku.additive}}}]),t}(gi);function mT(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=gT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function gT(e,r){if(!!e){if(typeof e=="string")return Hy(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hy(e,r)}}function Hy(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _T=function(){function e(r,t,n){(0,ft.Z)(this,e),(0,p.Z)(this,"boxCells",[]),(0,p.Z)(this,"xCellCount",void 0),(0,p.Z)(this,"yCellCount",void 0),(0,p.Z)(this,"boxKeys",void 0),(0,p.Z)(this,"bboxes",void 0),(0,p.Z)(this,"width",void 0),(0,p.Z)(this,"height",void 0),(0,p.Z)(this,"xScale",void 0),(0,p.Z)(this,"yScale",void 0),(0,p.Z)(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,mt.Z)(e,[{key:"insert",value:function(t,n,i,a,o){this.forEachCell(n,i,a,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o)}},{key:"query",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!1,o)}},{key:"hitTest",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!0,o)}},{key:"insertBoxCell",value:function(t,n,i,a,o,s){this.boxCells[o].push(s)}},{key:"queryHitTest",value:function(t,n,i,a,o,s){if(i<0||t>this.width||a<0||n>this.height)return o?!1:[];var l=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(o)return!0;for(var h=0;h<this.boxKeys.length;h++)l.push({key:this.boxKeys[h],x1:this.bboxes[h*4],y1:this.bboxes[h*4+1],x2:this.bboxes[h*4+2],y2:this.bboxes[h*4+3]});return s?l.filter(s):l}var d={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,l,d,s),o?l.length>0:l}},{key:"queryCell",value:function(t,n,i,a,o,s,l,h){var d=l.seenUids,g=this.boxCells[o];if(g!==null){var y=this.bboxes,E=mT(g),b;try{for(E.s();!(b=E.n()).done;){var w=b.value;if(!d.box[w]){d.box[w]=!0;var F=w*4;if(t<=y[F+2]&&n<=y[F+3]&&i>=y[F+0]&&a>=y[F+1]&&(!h||h(this.boxKeys[w]))){if(l.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[w],x1:y[F],y1:y[F+1],x2:y[F+2],y2:y[F+3]})}}}}catch(ee){E.e(ee)}finally{E.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,o,s,l,h){for(var d=this.convertToXCellCoord(t),g=this.convertToYCellCoord(n),y=this.convertToXCellCoord(i),E=this.convertToYCellCoord(a),b=d;b<=y;b++)for(var w=g;w<=E;w++){var F=this.xCellCount*w+b;if(o.call(this,t,n,i,a,F,s,l,h))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),yT=_T,ET=function(){function e(r,t){(0,ft.Z)(this,e),(0,p.Z)(this,"width",void 0),(0,p.Z)(this,"height",void 0),(0,p.Z)(this,"grid",void 0),(0,p.Z)(this,"viewportPadding",100),(0,p.Z)(this,"screenRightBoundary",void 0),(0,p.Z)(this,"screenBottomBoundary",void 0),(0,p.Z)(this,"gridRightBoundary",void 0),(0,p.Z)(this,"gridBottomBoundary",void 0),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new yT(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,mt.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,o)||this.grid.hitTest(n,i,a,o)?{box:[]}:{box:[n,i,a,o]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=bv(n,i,0,1),o=Sa(),s=yt.apply(W,(0,B.Z)(t));return pd(o,a,s),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function jy(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=xT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function xT(e,r){if(!!e){if(typeof e=="string")return Vy(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vy(e,r)}}function Vy(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Wy(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function Xy(e,r,t,n,i){if(!!i){var a=e[n],o=a.glyph;if(o)for(var s=r[o].advance*a.scale,l=(e[n].x+s)*i,h=t;h<=n;h++)e[h].x-=l}}function Yy(e,r,t,n,i,a,o){var s=(r-t)*i,l=(-n*o+.5)*a,h=jy(e),d;try{for(h.s();!(d=h.n()).done;){var g=d.value;g.x+=s,g.y+=l}}catch(y){h.e(y)}finally{h.f()}}function ST(e,r,t,n,i,a,o){var s=-8,l=0,h=s,d=0,g=e.positionedGlyphs,y=a==="right"?1:a==="left"?0:.5,E=g.length;t.forEach(function(se){if(se.split("").forEach(function(Ee){var je=r[Ee],Ve=0;je&&(g.push({glyph:Ee,x:l,y:h+Ve,vertical:!1,scale:1,metrics:je}),l+=je.advance+o)}),g.length!==E){var ge=l-o;d=Math.max(ge,d),Xy(g,r,E,g.length-1,y)}l=0,h-=n+5});var b=Wy(i),w=b.horizontalAlign,F=b.verticalAlign;Yy(g,y,w,F,d,n,t.length);var ee=h-s;e.top+=-F*ee,e.bottom=e.top-ee,e.left+=-w*d,e.right=e.left+d}function CT(e,r,t,n,i,a,o){var s=-8,l=0,h=s,d=0,g=e.positionedGlyphs,y=a==="right"?1:a==="left"?0:.5,E=g.length;t.forEach(function(se){var ge=r[se],Ee=0;if(ge&&(g.push({glyph:se,x:l,y:h+Ee,vertical:!1,scale:1,metrics:ge}),l+=ge.advance+o),g.length!==E){var je=l-o;d=Math.max(je,d),Xy(g,r,E,g.length-1,y)}l=0,h-=n+5});var b=Wy(i),w=b.horizontalAlign,F=b.verticalAlign;Yy(g,y,w,F,d,n,t.length);var ee=h-s;e.top+=-F*ee,e.bottom=e.top-ee,e.left+=-w*d,e.right=e.left+d}function AT(e,r,t,n,i,a){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,l=e.split(`
`),h=[],d={positionedGlyphs:h,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:l.length,text:e};return s?CT(d,r,l,t,n,i,a):ST(d,r,l,t,n,i,a),h.length?d:!1}function bT(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],o=jy(i),s;try{for(o.s();!(s=o.n()).done;){var l=s.value,h=l.metrics,d=4,g=h.advance*l.scale/2,y=t?[l.x+g,l.y]:[0,0],E=t?[0,0]:[l.x+g+r[0],l.y+r[1]],b=(0-d)*l.scale-g+E[0],w=(0-d)*l.scale+E[1],F=b+h.width*l.scale,ee=w+h.height*l.scale,se={x:b,y:w},ge={x:F,y:w},Ee={x:b,y:ee},je={x:F,y:ee};a.push({tl:se,tr:ge,bl:Ee,br:je,tex:h,glyphOffset:y})}}catch(Ve){o.e(Ve)}finally{o.f()}return a}function TT(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=MT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function MT(e,r){if(!!e){if(typeof e=="string")return $y(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $y(e,r)}}function $y(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function OT(e){var r=RT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function RT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ky=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,qy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Qy(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(s,l){n.push.apply(n,(0,B.Z)(o).concat([s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y],(0,B.Z)(o),[s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y],(0,B.Z)(o),[s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y],(0,B.Z)(o),[s.tex.x,s.tex.y,s.bl.x,s.bl.y])),i.push(0+l*4,1+l*4,2+l*4,2+l*4,3+l*4,0+l*4)}),{vertices:n,indices:i,size:7}}var Jy=function(e){(0,lr.Z)(t,e);var r=OT(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"glyphInfo",void 0),(0,p.Z)((0,z.Z)(n),"glyphInfoMap",{}),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"currentZoom",-1),(0,p.Z)((0,z.Z)(n),"extent",void 0),(0,p.Z)((0,z.Z)(n),"textureHeight",0),(0,p.Z)((0,z.Z)(n),"textCount",0),(0,p.Z)((0,z.Z)(n),"preTextStyle",{}),(0,p.Z)((0,z.Z)(n),"buildModels",function(){var s=n.layer.getLayerConfig(),l=s.mask,h=l===void 0?!1:l,d=s.maskInside,g=d===void 0?!0:d;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:qy,fragmentShader:Ky,triangulation:Qy.bind((0,z.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:ai(h,g)})]}),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.stroke,l=s===void 0?"#fff":s,h=i.strokeWidth,d=h===void 0?0:h,g=i.textAnchor,y=g===void 0?"center":g,E=i.textAllowOverlap,b=E===void 0?!1:E,w=i.halo,F=w===void 0?.5:w,ee=i.gamma,se=ee===void 0?2:ee,ge=i.raisingHeight,Ee=ge===void 0?0:ge,je=this.fontService,Ve=je.canvas,rt=je.mapping;if(Object.keys(rt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(rt).length),this.preTextStyle={textAnchor:y,textAllowOverlap:b},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeWidth:d,stroke:l})){this.judgeStyleAttributes({opacity:o,strokeWidth:d,stroke:l});var Et=this.layer.getEncodedData(),zt=this.calDataFrame(this.cellLength,Et,this.cellProperties),er=zt.data,Rt=zt.width,pr=zt.height;this.rowCount=pr,this.dataTexture=this.cellLength>0&&er.length>0?this.createTexture2D({flipY:!0,data:er,format:M.LUMINANCE,type:M.FLOAT,width:Rt,height:pr}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Ee),u_opacity:Sn()(o)?o:1,u_stroke_width:Sn()(d)?d:0,u_stroke_color:this.getStrokeColor(l),u_sdf_map:this.texture,u_halo_blur:F,u_gamma_scale:se,u_sdf_map_size:[Ve.width,Ve.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var i=this.layer.getLayerConfig(),a=i.textAnchor,o=a===void 0?"center":a,s=i.textAllowOverlap,l=s===void 0?!0:s;return this.preTextStyle={textAnchor:o,textAllowOverlap:l},this.buildModels()}},{key:"needUpdate",value:function(){var i=this.layer.getLayerConfig(),a=i.textAllowOverlap,o=a===void 0?!1:a,s=this.mapService.getZoom(),l=this.mapService.getBounds(),h=Nl(this.extent,l);return!o&&(Math.abs(this.currentZoom-s)>1||!h)||o!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Er.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.rotate,d=h===void 0?0:h;return Array.isArray(d)?[d[0]]:[d]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Er.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){return[s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(a,o,s,l){var h=a.size,d=h===void 0?12:h;return Array.isArray(d)?[d[0]]:[d]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Er.Attribute,descriptor:{name:"a_tex",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){return[s[3],s[4]]}}})}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Su(i,.5)}},{key:"initTextFont",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,s=i.fontFamily,l=s===void 0?"sans-serif":s,h=this.layer.getEncodedData(),d=[];h.forEach(function(g){var y=g.shape,E=y===void 0?"":y;E=E.toString();var b=TT(E),w;try{for(b.s();!(w=b.n()).done;){var F=w.value;d.indexOf(F)===-1&&d.push(F)}}catch(ee){b.e(ee)}finally{b.f()}}),this.fontService.setFontOptions({characterSet:d,fontWeight:o,fontFamily:l,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,s=i.fontFamily,l=s===void 0?"sans-serif":s,h=this.layer.getEncodedData(),d=[];h.forEach(function(g){var y=g.shape,E=y===void 0?"":y;E="".concat(E),d.indexOf(E)===-1&&d.push(E)}),this.fontService.setFontOptions({characterSet:d,fontWeight:o,fontFamily:l,iconfont:!0})}},{key:"generateGlyphLayout",value:function(i){var a=this,o=this.fontService.mapping,s=this.layer.getLayerConfig(),l=s.spacing,h=l===void 0?2:l,d=s.textAnchor,g=d===void 0?"center":d,y=this.layer.getEncodedData();this.glyphInfo=y.map(function(E){var b=E.shape,w=b===void 0?"":b,F=E.id,ee=E.size,se=ee===void 0?1:ee,ge=E.textOffset,Ee=ge===void 0?[0,0]:ge,je=AT(w.toString(),o,se,g,"left",h,Ee,i),Ve=bT(je,Ee,!1);return E.shaping=je,E.glyphQuads=Ve,E.centroid=Bf(E.coordinates),E.originCentroid=E.version==="GAODE2.x"?Bf(E.originCoordinates):E.originCentroid=E.centroid,a.glyphInfoMap[F]={shaping:je,glyphQuads:Ve,centroid:Bf(E.coordinates)},E})}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,s=o===void 0?[4,4]:o,l=a.textAllowOverlap,h=l===void 0?!1:l;if(!h){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var d=this.rendererService.getViewportSize(),g=d.width,y=d.height,E=new ET(g,y),b=this.glyphInfo.filter(function(w){var F=w.shaping,ee=w.id,se=ee===void 0?0:ee,ge=w.version==="GAODE2.x"?w.originCentroid:w.centroid,Ee=w.size,je=Ee/24,Ve=i.mapService.lngLatToContainer(ge),rt=E.placeCollisionBox({x1:F.left*je-s[0],x2:F.right*je+s[0],y1:F.top*je-s[1],y2:F.bottom*je+s[1],anchorPointX:Ve.x,anchorPointY:Ve.y}),Et=rt.box;return Et&&Et.length?(E.insertCollisionBox(Et,se),!0):!1});b.forEach(function(w){i.glyphInfoMap[w.id]=w})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,o=a===void 0?!1:a;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.fontService.canvas;this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:M.LINEAR,min:M.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:qy,fragmentShader:Ky,triangulation:Qy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:ai(o,l)})]}}]),t}(gi),PT={fillImage:jb,fill:Uy,radar:lT,image:Gy,normal:zy,simplePoint:vT,extrude:By,text:Jy,icon:$b},wT=PT;function IT(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=LT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,s=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function LT(e,r){if(!!e){if(typeof e=="string")return e1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return e1(e,r)}}function e1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function DT(e){var r=FT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NT=function(e){(0,lr.Z)(t,e);var r=DT(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","PointLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new wT[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,o=i.values,s=this.getLayerConfig(),l=s.shape2d,h=s.shape3d,d=this.iconService.getIconMap();if(a&&(l==null?void 0:l.indexOf(a))!==-1)return"fill";if(o&&o instanceof Array){var g=IT(o),y;try{for(g.s();!(y=g.n()).done;){var E=y.value;if(typeof E=="string"&&d.hasOwnProperty(E))return"image"}}catch(b){g.e(b)}finally{g.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return a[i]}},{key:"getModelType",value:function(){var i=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&i.includes(this.layerType))return this.layerType;var a=this.getEncodedData(),o=this.getLayerConfig(),s=o.shape2d,l=o.shape3d,h=this.iconService.getIconMap(),d=a.find(function(y){return y.hasOwnProperty("shape")});if(d){var g=d.shape;return g==="dot"?"normal":g==="simple"?"simplePoint":g==="radar"?"radar":g==="fillImage"?"fillImage":(s==null?void 0:s.indexOf(g))!==-1?"fill":(l==null?void 0:l.indexOf(g))!==-1?"extrude":h.hasOwnProperty(g)?"image":this.fontService.getGlyph(g)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(kf);function kT(e){var r=BT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function BT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZT=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,UT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,GT=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
// varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    gl_FragColor = mix(u_targetColor, u_sourceColor, sidey);
  } else {
    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }

  // gl_FragColor = v_Color;
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,zT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  // float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  // v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,HT=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,jT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,VT=function(e){(0,lr.Z)(t,e);var r=kT(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.heightfixed,l=s===void 0?!1:s,h=i.raisingHeight,d=h===void 0?0:h,g=i.sourceColor,y=i.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var E=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,E,this.cellProperties),w=b.data,F=b.width,ee=b.height;this.rowCount=ee,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:M.LUMINANCE,type:M.FLOAT,width:F,height:ee}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}var se=[1,1,1,1],ge=[1,1,1,1];return g&&y&&(se=Zn(g),ge=Zn(y)),{u_heightfixed:Number(l),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(d),u_opacity:Sn()(o)?o:1,u_sourceColor:se,u_targetColor:ge,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=this.getShaders(),d=h.frag,g=h.vert,y=h.type;return[this.layer.buildLayerModel({moduleName:y,vertexShader:g,fragmentShader:d,triangulation:My,stencil:ai(o,l),cull:{enable:!0,face:M.BACK}})]}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,o=i.mapTexture;return o?{frag:GT,vert:zT,type:"polygonExtrudeTexture"}:a?{frag:HT,vert:jT,type:"polygonExtrude"}:{frag:ZT,vert:UT,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i,a;(i=this.dataTexture)===null||i===void 0||i.destroy(),(a=this.texture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.mapTexture;if(a){var o=this.layer.getSource().extent,s=(0,Rn.Z)(o,4),l=s[0],h=s[1],d=s[2],g=s[3],y=d-l,E=g-h;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Er.Attribute,descriptor:{name:"a_uvs",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(w,F,ee,se,ge){var Ee=ee[0],je=ee[1];return[(Ee-l)/y,(je-h)/E,ee[4]]}}})}this.styleAttributeService.registerStyleAttribute({name:"normal",type:Er.Attribute,descriptor:{name:"a_Normal",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(w,F,ee,se,ge){return ge}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Er.Attribute,descriptor:{name:"a_Size",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(w,F,ee,se){var ge=w.size,Ee=ge===void 0?10:ge;return Array.isArray(Ee)?[Ee[0]]:[Ee]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.mapTexture,s=this.rendererService.createTexture2D;if(this.texture=s({height:0,width:0}),o){var l=new Image;l.crossOrigin="",l.src=o,l.onload=function(){i.texture=s({data:l,width:l.width,height:l.height,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE,min:M.LINEAR,mag:M.LINEAR}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()}}}}]),t}(gi);function WT(e){var r=XT();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function XT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YT=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$T=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,KT=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,qT=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,QT=function(e){(0,lr.Z)(t,e);var r=WT(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.opacityLinear,l=s===void 0?{enable:!1,dir:"in"}:s;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var h=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,h,this.cellProperties),g=d.data,y=d.width,E=d.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:M.LUMINANCE,type:M.FLOAT,width:y,height:E}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(o)?o:1,u_opacitylinear:Number(l.enable),u_dir:l.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1,dir:"in"}:a,s=i.mask,l=s===void 0?!1:s,h=i.maskInside,d=h===void 0?!0:h;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:o.enable?KT:qT,fragmentShader:o.enable?$T:YT,triangulation:o.enable?kA:jm,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:M.BACK},stencil:ai(l,d)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1,dir:"in"}:a;o.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Er.Attribute,descriptor:{name:"a_linear",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:3,update:function(l,h,d,g,y){return[d[3],d[4],d[5]]}}})}}]),t}(gi);function JT(e){var r=eM();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function eM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tM=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,rM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,nM=function(e){(0,lr.Z)(t,e);var r=JT(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture1",void 0),(0,p.Z)((0,z.Z)(n),"texture2",void 0),(0,p.Z)((0,z.Z)(n),"texture3",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.watercolor,l=s===void 0?"#6D99A8":s,h=i.watercolor2,d=h===void 0?"#0F121C":h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,g,this.cellProperties),E=y.data,b=y.width,w=y.height;this.rowCount=w,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:M.LUMINANCE,type:M.FLOAT,width:b,height:w}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Zn(l),u_watercolor2:Zn(d),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Sn()(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:rM,fragmentShader:tM,triangulation:jm,depth:{enable:!1},stencil:ai(o,l)})]}},{key:"clearModels",value:function(){var i;this.texture1.destroy(),this.texture2.destroy(),this.texture3.destroy(),(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,Rn.Z)(i,4),o=a[0],s=a[1],l=a[2],h=a[3],d=l-o,g=h-s;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Er.Attribute,descriptor:{name:"a_uv",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(E,b,w,F,ee){var se=(0,Rn.Z)(w,2),ge=se[0],Ee=se[1];return[(ge-o)/d,(Ee-s)/g]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,o={height:0,width:0};this.texture1=a(o),this.texture2=a(o),this.texture3=a(o),s(function(h){i.texture1=l(h[0]),i.texture2=l(h[1]),i.texture3=l(h[2]),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()});function s(h){var d=0,g=[],y=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];y.map(function(E){var b=new Image;b.crossOrigin="",b.src=E,g.push(b),b.onload=function(){d++,d===3&&h(g)}})}function l(h){return a({data:h,width:h.width,height:h.height,wrapS:M.MIRRORED_REPEAT,wrapT:M.MIRRORED_REPEAT,min:M.LINEAR,mag:M.LINEAR})}}}]),t}(gi);function iM(e){var r=aM();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function aM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oM=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,uM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,sM=function(e){(0,lr.Z)(t,e);var r=iM(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.speed,l=s===void 0?.5:s;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var h=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,h,this.cellProperties),g=d.data,y=d.width,E=d.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:M.LUMINANCE,type:M.FLOAT,width:y,height:E}):this.createTexture2D({flipY:!0,data:[1],format:M.LUMINANCE,type:M.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:l,u_opacity:Sn()(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:uM,fragmentShader:oM,triangulation:jm,depth:{enable:!1},stencil:ai(o,l)})]}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,Rn.Z)(i,4),o=a[0],s=a[1],l=a[2],h=a[3],d=l-o,g=h-s;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Er.Attribute,descriptor:{name:"a_uv",buffer:{usage:M.STATIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(E,b,w,F,ee){var se=(0,Rn.Z)(w,2),ge=se[0],Ee=se[1];return[(ge-o)/d,(Ee-s)/g]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.waterTexture,s=this.rendererService.createTexture2D;this.texture=s({height:0,width:0});var l=new Image;l.crossOrigin="",o?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),l.src=o):l.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",l.onload=function(){i.texture=s({data:l,width:l.width,height:l.height,wrapS:M.MIRRORED_REPEAT,wrapT:M.MIRRORED_REPEAT,min:M.LINEAR,mag:M.LINEAR}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()}}}]),t}(gi),lM={fill:QT,line:Ny,extrude:VT,text:Jy,point_fill:Uy,point_image:Gy,point_normal:zy,point_extrude:By,water:sM,ocean:nM},cM=lM;function fM(e){var r=hM();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function hM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t1=function(e){(0,lr.Z)(t,e);var r=fM(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","PolygonLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new cM[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o==="fill"?"fill":o==="extrude"?"extrude":o==="water"?"water":o==="ocean"?"ocean":o==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,s=a.shape3d,l=this.iconService.getIconMap(),h=i.find(function(g){return g.hasOwnProperty("shape")});if(h){var d=h.shape;return d==="dot"?"point_normal":(o==null?void 0:o.indexOf(d))!==-1?"point_fill":(s==null?void 0:s.indexOf(d))!==-1?"point_extrude":l.hasOwnProperty(d)?"point_image":"text"}else return"fill"}}]),t}(kf);function dM(e){var r=pM();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function pM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,mM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,r1=function(e){(0,lr.Z)(t,e);var r=dM(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"texture",void 0),(0,p.Z)((0,z.Z)(n),"colorTexture",void 0),n}return(0,mt.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.clampLow,l=s===void 0?!0:s,h=i.clampHigh,d=h===void 0?!0:h,g=i.noDataValue,y=g===void 0?-9999999:g,E=i.domain,b=E===void 0?[0,1]:E;return this.updateColorTexure(),{u_opacity:o||1,u_texture:this.texture,u_domain:b,u_clampLow:l,u_clampHigh:typeof d!="undefined"?d:l,u_noDataValue:y,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var i=this.layer.getLayerConfig(),a=i.mask,o=a===void 0?!1:a,s=i.maskInside,l=s===void 0?!0:s,h=this.layer.getSource(),d=this.rendererService.createTexture2D,g=h.data.dataArray[0];this.texture=d({data:g.data,width:g.width,height:g.height,format:M.LUMINANCE,type:M.FLOAT});var y=this.layer.getLayerConfig(),E=y.rampColors,b=Xs(E);return this.colorTexture=d({data:b.data,width:b.width,height:b.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:mM,fragmentShader:vM,triangulation:Ry,primitive:M.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ai(o,l)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Er.Attribute,descriptor:{name:"a_Uv",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:2,update:function(a,o,s,l){return[s[3],s[4]]}}})}},{key:"updateColorTexure",value:function(){var i=this.rendererService.createTexture2D,a=this.layer.getLayerConfig(),o=a.rampColors,s=Xs(o);this.colorTexture=i({data:s.data,width:s.width,height:s.height,flipY:!1})}}]),t}(gi),gM={raster:r1,raster3d:r1},_M=gM;function yM(e){var r=EM();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xM=function(e){(0,lr.Z)(t,e);var r=yM(t);function t(){var n;(0,ft.Z)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,p.Z)((0,z.Z)(n),"type","RasterLayer"),n}return(0,mt.Z)(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new _M[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},raster3d:{}};return a[i]}},{key:"getModelType",value:function(){return"raster"}}]),t}(kf),n1,i1,a1,o1,u1,q0,s1,l1,c1;function f1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function SM(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?f1(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var CM=(n1=(0,Ut.b2)(),i1=(0,Ut.f3)(Qe.IGlobalConfigService),a1=(0,Ut.f3)(Qe.IMapService),o1=(0,Ut.f3)(Qe.IFontService),n1(u1=(q0=function(){function e(){(0,ft.Z)(this,e),wr(this,"configService",s1,this),wr(this,"mapService",l1,this),wr(this,"fontService",c1,this)}return(0,mt.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){i.generateMaping(t,{styleAttributeService:a})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return t.dataState.dataMappingNeedUpdate=!1,i.generateMaping(t,{styleAttributeService:a}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!t.layerModelNeedUpdate){var o=t.getBottomColor(),s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),h=t.getSource().data.dataArray,d=s.filter(function(y){return y.needRemapping}),g=h;l!=null&&l.needRemapping&&l!==null&&l!==void 0&&l.scale&&(g=h.filter(function(y){return i.applyAttributeMapping(l,y,o)[0]})),d.length&&(l!=null&&l.needRemapping?(t.setEncodedData(i.mapping(s,g,void 0,o)),l.needRemapping=!1):t.setEncodedData(i.mapping(d,g,t.getEncodedData(),o)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,o=t.getBottomColor(),s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),h=t.getSource().data.dataArray,d=h;l!=null&&l.scale&&(d=h.filter(function(g){return i.applyAttributeMapping(l,g,o)[0]})),t.setEncodedData(this.mapping(s,d,void 0,o)),t.emit("dataUpdate",null)}},{key:"mapping",value:function(t,n,i,a){var o=this,s=n.map(function(l,h){var d=i?i[h]:{},g=SM({id:l._id,coordinates:l.coordinates},d);return t.filter(function(y){return y.scale!==void 0}).forEach(function(y){var E=o.applyAttributeMapping(y,l,a);y.needRemapping=!1,y.name==="color"&&(E=E.map(function(b){return Zn(b)})),g[y.name]=Array.isArray(E)&&E.length===1?E[0]:E,y.name==="shape"&&(g.shape=o.fontService.getIconFontKey(g[y.name]))}),g});return this.adjustData2Amap2Coordinates(s),this.adjustData2SimpleCoordinates(s),s}},{key:"adjustData2Amap2Coordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===Ha["GAODE2.x"]&&(typeof t[0].coordinates[0]=="number"?t.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=Ha["GAODE2.x"],i.originCoordinates=hi()(i.coordinates),i.coordinates=n.mapService.lngLatToCoord(i.coordinates)}):t.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=Ha["GAODE2.x"],i.originCoordinates=hi()(i.coordinates),i.coordinates=n.mapService.lngLatToCoords(i.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===Ha.SIMPLE&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(o){var s=[];o.map(function(l){s.push(n.mapService.simpleMapCoord.unproject(l))}),i.push(s)}),i}else{var a=[];return t.map(function(o){a.push(n.mapService.simpleMapCoord.unproject(o))}),a}}},{key:"applyAttributeMapping",value:function(t,n,i){var a;if(!t.scale)return[];var o=(t==null||(a=t.scale)===null||a===void 0?void 0:a.scalers)||[],s=[];o.forEach(function(h){var d,g=h.field;(n.hasOwnProperty(g)||((d=t.scale)===null||d===void 0?void 0:d.type)==="variable")&&s.push(n[g])});var l=t.mapping?t.mapping(s):[];return t.name==="color"&&!js(l[0])?[i]:l}}]),e}(),s1=Xr(q0.prototype,"configService",[i1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l1=Xr(q0.prototype,"mapService",[a1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c1=Xr(q0.prototype,"fontService",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q0))||u1),h1,d1,AM=(h1=(0,Ut.b2)(),h1(d1=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"mapService",void 0)}return(0,mt.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Qe.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var i=t.getSource();if(!i){var a=t.sourceOption||{data:Ef,options:Fc},o=a.data,s=a.options;t.setSource(new al(o,s))}n.updateClusterData(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var i=n.updateClusterData(t),a=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||a})}},{key:"updateClusterData",value:function(t){var n=t.getSource(),i=n.cluster,a=n.clusterOptions,o=a.zoom,s=o===void 0?0:o,l=a.maxZoom,h=l===void 0?16:l,d=this.mapService.getZoom()-1,g=t.dataState.dataSourceNeedUpdate;return i&&(g||Math.abs(t.clusterZoom-d)>=1)?(s!==Math.floor(d)&&n.updateClusterData(Math.floor(d)),t.clusterZoom=d,!0):!1}}]),e}())||d1);function Wm(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function p1(e){return e.length===1&&(e=bM(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function bM(e){return function(r,t){return Wm(e(r),t)}}var v1=p1(Wm),TM=v1.right,u4=v1.left,Qp=TM;function MM(e,r){var t=e.length,n=-1,i,a,o;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=o=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),o<i&&(o=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=o=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),o<i&&(o=i));return[a,o]}var m1=Array.prototype,s4=m1.slice,l4=m1.map,Xm=Math.sqrt(50),Ym=Math.sqrt(10),$m=Math.sqrt(2);function g1(e,r,t){var n,i=-1,a,o,s;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(s=Jp(e,r,t))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),r=Math.floor(r/s),o=new Array(a=Math.ceil(r-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),r=Math.ceil(r*s),o=new Array(a=Math.ceil(e-r+1));++i<a;)o[i]=(e-i)/s;return n&&o.reverse(),o}function Jp(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=Xm?10:a>=Ym?5:a>=$m?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Xm?10:a>=Ym?5:a>=$m?2:1)}function Km(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=Xm?i*=10:a>=Ym?i*=5:a>=$m&&(i*=2),r<e?-i:i}function c4(){var e=identity,r=extent,t=sturges;function n(i){var a,o=i.length,s,l=new Array(o);for(a=0;a<o;++a)l[a]=e(i[a],a,i);var h=r(l),d=h[0],g=h[1],y=t(l,d,g);Array.isArray(y)||(y=tickStep(d,g,y),y=range(Math.ceil(d/y)*y,g,y));for(var E=y.length;y[0]<=d;)y.shift(),--E;for(;y[E-1]>g;)y.pop(),--E;var b=new Array(E+1),w;for(a=0;a<=E;++a)w=b[a]=[],w.x0=a>0?y[a-1]:d,w.x1=a<E?y[a]:g;for(a=0;a<o;++a)s=l[a],d<=s&&s<=g&&b[bisect(y,s,0,E)].push(i[a]);return b}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function f4(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function OM(e){return e===null?NaN:+e}function RM(e,r,t){if(t==null&&(t=OM),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),o=+t(e[a],a,e),s=+t(e[a+1],a+1,e);return o+(s-o)*(i-a)}}var Uu="$";function ev(){}ev.prototype=_1.prototype={constructor:ev,has:function(e){return Uu+e in this},get:function(e){return this[Uu+e]},set:function(e,r){return this[Uu+e]=r,this},remove:function(e){var r=Uu+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===Uu&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===Uu&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===Uu&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===Uu&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===Uu&&++e;return e},empty:function(){for(var e in this)if(e[0]===Uu)return!1;return!0},each:function(e){for(var r in this)r[0]===Uu&&e(this[r],r.slice(1),this)}};function _1(e,r){var t=new ev;if(e instanceof ev)e.each(function(s,l){t.set(l,s)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var o in e)t.set(o,e[o]);return t}var qm=_1;function h4(){var e=[],r=[],t,n,i;function a(s,l,h,d){if(l>=e.length)return t!=null&&s.sort(t),n!=null?n(s):s;for(var g=-1,y=s.length,E=e[l++],b,w,F=map(),ee,se=h();++g<y;)(ee=F.get(b=E(w=s[g])+""))?ee.push(w):F.set(b,[w]);return F.each(function(ge,Ee){d(se,Ee,a(ge,l,h,d))}),se}function o(s,l){if(++l>e.length)return s;var h,d=r[l-1];return n!=null&&l>=e.length?h=s.entries():(h=[],s.each(function(g,y){h.push({key:y,values:o(g,l)})})),d!=null?h.sort(function(g,y){return d(g.key,y.key)}):h}return i={object:function(s){return a(s,0,PM,wM)},map:function(s){return a(s,0,y1,E1)},entries:function(s){return o(a(s,0,y1,E1),0)},key:function(s){return e.push(s),i},sortKeys:function(s){return r[e.length-1]=s,i},sortValues:function(s){return t=s,i},rollup:function(s){return n=s,i}}}function PM(){return{}}function wM(e,r,t){e[r]=t}function y1(){return map()}function E1(e,r,t){e.set(r,t)}function tv(){}var Gf=qm.prototype;tv.prototype=IM.prototype={constructor:tv,has:Gf.has,add:function(e){return e+="",this[Uu+e]=e,this},remove:Gf.remove,clear:Gf.clear,values:Gf.keys,size:Gf.size,empty:Gf.empty,each:Gf.each};function IM(e,r){var t=new tv;if(e instanceof tv)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var d4=null,x1=Array.prototype,rv=x1.map,zf=x1.slice;function Jc(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function p4(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var S1={name:"implicit"};function nv(){var e=qm(),r=[],t=[],n=S1;function i(a){var o=a+"",s=e.get(o);if(!s){if(n!==S1)return n;e.set(o,s=r.push(a))}return t[(s-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=qm();for(var o=-1,s=a.length,l,h;++o<s;)e.has(h=(l=a[o])+"")||e.set(h,r.push(l));return i},i.range=function(a){return arguments.length?(t=zf.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return nv(r,t).unknown(n)},Jc.apply(i,arguments),i}function C1(){var e=ordinal().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,o=!1,s=0,l=0,h=.5;delete e.unknown;function d(){var g=r().length,y=n[1]<n[0],E=n[y-0],b=n[1-y];i=(b-E)/Math.max(1,g-s+l*2),o&&(i=Math.floor(i)),E+=(b-E-i*(g-s))*h,a=i*(1-s),o&&(E=Math.round(E),a=Math.round(a));var w=sequence(g).map(function(F){return E+i*F});return t(y?w.reverse():w)}return e.domain=function(g){return arguments.length?(r(g),d()):r()},e.range=function(g){return arguments.length?(n=[+g[0],+g[1]],d()):n.slice()},e.rangeRound=function(g){return n=[+g[0],+g[1]],o=!0,d()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(g){return arguments.length?(o=!!g,d()):o},e.padding=function(g){return arguments.length?(s=Math.min(1,l=+g),d()):s},e.paddingInner=function(g){return arguments.length?(s=Math.min(1,g),d()):s},e.paddingOuter=function(g){return arguments.length?(l=+g,d()):l},e.align=function(g){return arguments.length?(h=Math.max(0,Math.min(1,g)),d()):h},e.copy=function(){return C1(r(),n).round(o).paddingInner(s).paddingOuter(l).align(h)},initRange.apply(d(),arguments)}function A1(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return A1(r())},e}function v4(){return A1(C1.apply(null,arguments).paddingInner(1))}function b1(e,r,t,n,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*r+(4-6*a+3*o)*t+(1+3*e+3*a-3*o)*n+o*i)/6}function LM(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],o=n>0?e[n-1]:2*i-a,s=n<r-1?e[n+2]:2*a-i;return b1((t-n/r)*r,o,i,a,s)}}function DM(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],o=e[(n+1)%r],s=e[(n+2)%r];return b1((t-n/r)*r,i,a,o,s)}}function Qm(e){return function(){return e}}function T1(e,r){return function(t){return e+t*r}}function FM(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function m4(e,r){var t=r-e;return t?T1(e,t>180||t<-180?t-360*Math.round(t/360):t):constant(isNaN(e)?r:e)}function NM(e){return(e=+e)==1?M1:function(r,t){return t-r?FM(r,t,e):Qm(isNaN(r)?t:r)}}function M1(e,r){var t=r-e;return t?T1(e,t):Qm(isNaN(e)?r:e)}var O1=function e(r){var t=NM(r);function n(i,a){var o=t((i=eo(i)).r,(a=eo(a)).r),s=t(i.g,a.g),l=t(i.b,a.b),h=M1(i.opacity,a.opacity);return function(d){return i.r=o(d),i.g=s(d),i.b=l(d),i.opacity=h(d),i+""}}return n.gamma=e,n}(1);function R1(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),o,s;for(o=0;o<t;++o)s=eo(r[o]),n[o]=s.r||0,i[o]=s.g||0,a[o]=s.b||0;return n=e(n),i=e(i),a=e(a),s.opacity=1,function(l){return s.r=n(l),s.g=i(l),s.b=a(l),s+""}}}var g4=R1(LM),_4=R1(DM);function y4(e,r){return(isNumberArray(r)?numberArray:P1)(e,r)}function P1(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),o;for(o=0;o<n;++o)i[o]=tg(e[o],r[o]);for(;o<t;++o)a[o]=r[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function kM(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}}function iv(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}}function BM(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=tg(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}}var Jm=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,eg=new RegExp(Jm.source,"g");function ZM(e){return function(){return e}}function UM(e){return function(r){return e(r)+""}}function GM(e,r){var t=Jm.lastIndex=eg.lastIndex=0,n,i,a,o=-1,s=[],l=[];for(e=e+"",r=r+"";(n=Jm.exec(e))&&(i=eg.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:iv(n,i)})),t=eg.lastIndex;return t<r.length&&(a=r.slice(t),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?UM(l[0].x):ZM(r):(r=l.length,function(h){for(var d=0,g;d<r;++d)s[(g=l[d]).i]=g.x(h);return s.join("")})}function zM(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}}function HM(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function tg(e,r){var t=typeof r,n;return r==null||t==="boolean"?Qm(r):(t==="number"?iv:t==="string"?(n=Au(r))?(r=n,O1):GM:r instanceof Au?O1:r instanceof Date?kM:HM(r)?zM:Array.isArray(r)?P1:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?BM:iv)(e,r)}function jM(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function VM(e){return function(){return e}}function rg(e){return+e}var w1=[0,1];function Gu(e){return e}function ng(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:VM(isNaN(r)?NaN:.5)}function I1(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function WM(e,r,t){var n=e[0],i=e[1],a=r[0],o=r[1];return i<n?(n=ng(i,n),a=t(o,a)):(n=ng(n,i),a=t(a,o)),function(s){return a(n(s))}}function XM(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++o<n;)i[o]=ng(e[o],e[o+1]),a[o]=t(r[o],r[o+1]);return function(s){var l=Qp(e,s,1,n)-1;return a[l](i[l](s))}}function av(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ig(){var e=w1,r=w1,t=tg,n,i,a,o=Gu,s,l,h;function d(){return s=Math.min(e.length,r.length)>2?XM:WM,l=h=null,g}function g(y){return isNaN(y=+y)?a:(l||(l=s(e.map(n),r,t)))(n(o(y)))}return g.invert=function(y){return o(i((h||(h=s(r,e.map(n),iv)))(y)))},g.domain=function(y){return arguments.length?(e=rv.call(y,rg),o===Gu||(o=I1(e)),d()):e.slice()},g.range=function(y){return arguments.length?(r=zf.call(y),d()):r.slice()},g.rangeRound=function(y){return r=zf.call(y),t=jM,d()},g.clamp=function(y){return arguments.length?(o=y?I1(e):Gu,g):o!==Gu},g.interpolate=function(y){return arguments.length?(t=y,d()):t},g.unknown=function(y){return arguments.length?(a=y,g):a},function(y,E){return n=y,i=E,d()}}function L1(e,r){return ig()(e,r)}var YM=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ov(e){if(!(r=YM.exec(e)))throw new Error("invalid format: "+e);var r;return new ag({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}ov.prototype=ag.prototype;function ag(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ag.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $M(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function uv(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function zh(e){return e=uv(Math.abs(e)),e?e[1]:NaN}function KM(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(zh(r)/3)))*3-zh(Math.abs(e)))}function qM(e,r){return function(t,n){for(var i=t.length,a=[],o=0,s=e[0],l=0;i>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),a.push(t.substring(i-=s,i+s)),!((l+=s+1)>n));)s=e[o=(o+1)%e.length];return a.reverse().join(r)}}function QM(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}function JM(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var D1;function eO(e,r){var t=uv(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(D1=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+uv(e,Math.max(0,r+a-1))[0]}function F1(e,r){var t=uv(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var N1={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:$M,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return F1(e*100,r)},r:F1,s:eO,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function k1(e){return e}var B1=Array.prototype.map,Z1=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function tO(e){var r=e.grouping===void 0||e.thousands===void 0?k1:qM(B1.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?k1:QM(B1.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function h(g){g=ov(g);var y=g.fill,E=g.align,b=g.sign,w=g.symbol,F=g.zero,ee=g.width,se=g.comma,ge=g.precision,Ee=g.trim,je=g.type;je==="n"?(se=!0,je="g"):N1[je]||(ge===void 0&&(ge=12),Ee=!0,je="g"),(F||y==="0"&&E==="=")&&(F=!0,y="0",E="=");var Ve=w==="$"?t:w==="#"&&/[boxX]/.test(je)?"0"+je.toLowerCase():"",rt=w==="$"?n:/[%p]/.test(je)?o:"",Et=N1[je],zt=/[defgprs%]/.test(je);ge=ge===void 0?6:/[gprs]/.test(je)?Math.max(1,Math.min(21,ge)):Math.max(0,Math.min(20,ge));function er(Rt){var pr=Ve,xr=rt,Ur,ti,_i;if(je==="c")xr=Et(Rt)+xr,Rt="";else{Rt=+Rt;var oa=Rt<0||1/Rt<0;if(Rt=isNaN(Rt)?l:Et(Math.abs(Rt),ge),Ee&&(Rt=JM(Rt)),oa&&+Rt==0&&b!=="+"&&(oa=!1),pr=(oa?b==="("?b:s:b==="-"||b==="("?"":b)+pr,xr=(je==="s"?Z1[8+D1/3]:"")+xr+(oa&&b==="("?")":""),zt){for(Ur=-1,ti=Rt.length;++Ur<ti;)if(_i=Rt.charCodeAt(Ur),48>_i||_i>57){xr=(_i===46?i+Rt.slice(Ur+1):Rt.slice(Ur))+xr,Rt=Rt.slice(0,Ur);break}}}se&&!F&&(Rt=r(Rt,Infinity));var bo=pr.length+Rt.length+xr.length,so=bo<ee?new Array(ee-bo+1).join(y):"";switch(se&&F&&(Rt=r(so+Rt,so.length?ee-xr.length:Infinity),so=""),E){case"<":Rt=pr+Rt+xr+so;break;case"=":Rt=pr+so+Rt+xr;break;case"^":Rt=so.slice(0,bo=so.length>>1)+pr+Rt+xr+so.slice(bo);break;default:Rt=so+pr+Rt+xr;break}return a(Rt)}return er.toString=function(){return g+""},er}function d(g,y){var E=h((g=ov(g),g.type="f",g)),b=Math.max(-8,Math.min(8,Math.floor(zh(y)/3)))*3,w=Math.pow(10,-b),F=Z1[8+b/3];return function(ee){return E(w*ee)+F}}return{format:h,formatPrefix:d}}var sv,og,U1;rO({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function rO(e){return sv=tO(e),og=sv.format,U1=sv.formatPrefix,sv}function nO(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,zh(r)-zh(e))+1}function iO(e){return Math.max(0,-zh(Math.abs(e)))}function aO(e,r,t,n){var i=Km(e,r,t),a;switch(n=ov(n==null?",f":n),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=KM(i,o))&&(n.precision=a),U1(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=nO(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=iO(i))&&(n.precision=a-(n.type==="%")*2);break}}return og(n)}function lv(e){var r=e.domain;return e.ticks=function(t){var n=r();return g1(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return aO(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,o=n[i],s=n[a],l;return s<o&&(l=o,o=s,s=l,l=i,i=a,a=l),l=Jp(o,s,t),l>0?(o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l,l=Jp(o,s,t)):l<0&&(o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l,l=Jp(o,s,t)),l>0?(n[i]=Math.floor(o/l)*l,n[a]=Math.ceil(s/l)*l,r(n)):l<0&&(n[i]=Math.ceil(o*l)/l,n[a]=Math.floor(s*l)/l,r(n)),e},e}function G1(){var e=L1(Gu,Gu);return e.copy=function(){return av(e,G1())},Jc.apply(e,arguments),lv(e)}function z1(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=rv.call(n,rg),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return z1(e).unknown(r)},e=arguments.length?rv.call(e,rg):[0,1],lv(t)}function H1(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],o;return a<i&&(o=t,t=n,n=o,o=i,i=a,a=o),e[t]=r.floor(i),e[n]=r.ceil(a),e}function j1(e){return Math.log(e)}function V1(e){return Math.exp(e)}function oO(e){return-Math.log(-e)}function uO(e){return-Math.exp(-e)}function sO(e){return isFinite(e)?+("1e"+e):e<0?0:e}function lO(e){return e===10?sO:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function cO(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function W1(e){return function(r){return-e(-r)}}function fO(e){var r=e(j1,V1),t=r.domain,n=10,i,a;function o(){return i=cO(n),a=lO(n),t()[0]<0?(i=W1(i),a=W1(a),e(oO,uO)):e(j1,V1),r}return r.base=function(s){return arguments.length?(n=+s,o()):n},r.domain=function(s){return arguments.length?(t(s),o()):t()},r.ticks=function(s){var l=t(),h=l[0],d=l[l.length-1],g;(g=d<h)&&(y=h,h=d,d=y);var y=i(h),E=i(d),b,w,F,ee=s==null?10:+s,se=[];if(!(n%1)&&E-y<ee){if(y=Math.round(y)-1,E=Math.round(E)+1,h>0){for(;y<E;++y)for(w=1,b=a(y);w<n;++w)if(F=b*w,!(F<h)){if(F>d)break;se.push(F)}}else for(;y<E;++y)for(w=n-1,b=a(y);w>=1;--w)if(F=b*w,!(F<h)){if(F>d)break;se.push(F)}}else se=g1(y,E,Math.min(E-y,ee)).map(a);return g?se.reverse():se},r.tickFormat=function(s,l){if(l==null&&(l=n===10?".0e":","),typeof l!="function"&&(l=og(l)),s===Infinity)return l;s==null&&(s=10);var h=Math.max(1,n*s/r.ticks().length);return function(d){var g=d/a(Math.round(i(d)));return g*n<n-.5&&(g*=n),g<=h?l(d):""}},r.nice=function(){return t(H1(t(),{floor:function(s){return a(Math.floor(i(s)))},ceil:function(s){return a(Math.ceil(i(s)))}}))},r}function X1(){var e=fO(ig()).domain([1,10]);return e.copy=function(){return av(e,X1()).base(e.base())},Jc.apply(e,arguments),e}function Y1(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function $1(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function hO(e){var r=1,t=e(Y1(r),$1(r));return t.constant=function(n){return arguments.length?e(Y1(r=+n),$1(r)):r},linearish(t)}function dO(){var e=hO(transformer());return e.copy=function(){return copy(e,dO()).constant(e.constant())},initRange.apply(e,arguments)}function K1(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function pO(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function vO(e){return e<0?-e*e:e*e}function mO(e){var r=e(Gu,Gu),t=1;function n(){return t===1?e(Gu,Gu):t===.5?e(pO,vO):e(K1(t),K1(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},lv(r)}function ug(){var e=mO(ig());return e.copy=function(){return av(e,ug()).exponent(e.exponent())},Jc.apply(e,arguments),e}function E4(){return ug.apply(null,arguments).exponent(.5)}function q1(){var e=[],r=[],t=[],n;function i(){var o=0,s=Math.max(1,r.length);for(t=new Array(s-1);++o<s;)t[o-1]=RM(e,o/s);return a}function a(o){return isNaN(o=+o)?n:r[Qp(t,o)]}return a.invertExtent=function(o){var s=r.indexOf(o);return s<0?[NaN,NaN]:[s>0?t[s-1]:e[0],s<t.length?t[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(var s=0,l=o.length,h;s<l;++s)h=o[s],h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(Wm),i()},a.range=function(o){return arguments.length?(r=zf.call(o),i()):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return q1().domain(e).range(r).unknown(n)},Jc.apply(a,arguments)}function Q1(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function o(l){return l<=l?i[Qp(n,l,0,t)]:a}function s(){var l=-1;for(n=new Array(t);++l<t;)n[l]=((l+1)*r-(l-t)*e)/(t+1);return o}return o.domain=function(l){return arguments.length?(e=+l[0],r=+l[1],s()):[e,r]},o.range=function(l){return arguments.length?(t=(i=zf.call(l)).length-1,s()):i.slice()},o.invertExtent=function(l){var h=i.indexOf(l);return h<0?[NaN,NaN]:h<1?[e,n[0]]:h>=t?[n[t-1],r]:[n[h-1],n[h]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return n.slice()},o.copy=function(){return Q1().domain([e,r]).range(i).unknown(a)},Jc.apply(lv(o),arguments)}function J1(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[Qp(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=zf.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=zf.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var o=r.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return J1().domain(e).range(r).unknown(t)},Jc.apply(i,arguments)}var sg=new Date,lg=new Date;function Ao(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var o=i(a),s=i.ceil(a);return a-o<s-a?o:s},i.offset=function(a,o){return r(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,s){var l=[],h;if(a=i.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(h=new Date(+a)),r(a,s),e(a);while(h<a&&a<o);return l},i.filter=function(a){return Ao(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;r(o,-1),!a(o););else for(;--s>=0;)for(;r(o,1),!a(o););})},t&&(i.count=function(a,o){return sg.setTime(+a),lg.setTime(+o),e(sg),e(lg),Math.floor(t(sg,lg))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(o){return n(o)%a==0}:function(o){return i.count(0,o)%a==0}):i}),i}var cg=Ao(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});cg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ao(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var Hh=cg,x4=cg.range,eE=Ao(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),gO=eE,S4=eE.range,cv=1e3,Q0=6e4,tE=36e5,rE=864e5,nE=6048e5;function Hf(e){return Ao(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*Q0)/nE})}var fg=Hf(0),fv=Hf(1),_O=Hf(2),yO=Hf(3),jh=Hf(4),EO=Hf(5),xO=Hf(6),C4=fg.range,A4=fv.range,b4=_O.range,T4=yO.range,M4=jh.range,O4=EO.range,R4=xO.range,iE=Ao(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*Q0)/rE},function(e){return e.getDate()-1}),hg=iE,P4=iE.range,aE=Ao(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*cv-e.getMinutes()*Q0)},function(e,r){e.setTime(+e+r*tE)},function(e,r){return(r-e)/tE},function(e){return e.getHours()}),SO=aE,w4=aE.range,oE=Ao(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*cv)},function(e,r){e.setTime(+e+r*Q0)},function(e,r){return(r-e)/Q0},function(e){return e.getMinutes()}),CO=oE,I4=oE.range,uE=Ao(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*cv)},function(e,r){return(r-e)/cv},function(e){return e.getUTCSeconds()}),AO=uE,L4=uE.range,hv=Ao(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});hv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ao(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):hv};var bO=hv,D4=hv.range;function jf(e){return Ao(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/nE})}var sE=jf(0),dv=jf(1),TO=jf(2),MO=jf(3),Vh=jf(4),OO=jf(5),RO=jf(6),F4=sE.range,N4=dv.range,k4=TO.range,B4=MO.range,Z4=Vh.range,U4=OO.range,G4=RO.range,lE=Ao(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/rE},function(e){return e.getUTCDate()-1}),cE=lE,z4=lE.range,dg=Ao(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});dg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ao(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var J0=dg,H4=dg.range;function pg(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function vg(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ed(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function PO(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,h=td(i),d=rd(i),g=td(a),y=rd(a),E=td(o),b=rd(o),w=td(s),F=rd(s),ee=td(l),se=rd(l),ge={a:oa,A:bo,b:so,B:$h,c:null,d:mE,e:mE,f:JO,g:lR,G:fR,H:KO,I:qO,j:QO,L:gE,m:eR,M:tR,p:j5,q:V5,Q:CE,s:AE,S:rR,u:nR,U:iR,V:aR,w:oR,W:uR,x:null,X:null,y:sR,Y:cR,Z:hR,"%":SE},Ee={a:W5,A:X5,b:Y5,B:$5,c:null,d:yE,e:yE,f:mR,g:TR,G:OR,H:dR,I:pR,j:vR,L:EE,m:gR,M:_R,p:K5,q:q5,Q:CE,s:AE,S:yR,u:ER,U:xR,V:SR,w:CR,W:AR,x:null,X:null,y:bR,Y:MR,Z:RR,"%":SE},je={a:er,A:Rt,b:pr,B:xr,c:Ur,d:pE,e:pE,f:WO,g:dE,G:hE,H:vE,I:vE,j:zO,L:VO,m:GO,M:HO,p:zt,q:UO,Q:YO,s:$O,S:jO,u:FO,U:NO,V:kO,w:DO,W:BO,x:ti,X:_i,y:dE,Y:hE,Z:ZO,"%":XO};ge.x=Ve(t,ge),ge.X=Ve(n,ge),ge.c=Ve(r,ge),Ee.x=Ve(t,Ee),Ee.X=Ve(n,Ee),Ee.c=Ve(r,Ee);function Ve(Dr,Dn){return function(Yn){var ir=[],jo=-1,Si=0,lu=Dr.length,cu,Vf,oS;for(Yn instanceof Date||(Yn=new Date(+Yn));++jo<lu;)Dr.charCodeAt(jo)===37&&(ir.push(Dr.slice(Si,jo)),(Vf=fE[cu=Dr.charAt(++jo)])!=null?cu=Dr.charAt(++jo):Vf=cu==="e"?" ":"0",(oS=Dn[cu])&&(cu=oS(Yn,Vf)),ir.push(cu),Si=jo+1);return ir.push(Dr.slice(Si,jo)),ir.join("")}}function rt(Dr,Dn){return function(Yn){var ir=ed(1900,void 0,1),jo=Et(ir,Dr,Yn+="",0),Si,lu;if(jo!=Yn.length)return null;if("Q"in ir)return new Date(ir.Q);if("s"in ir)return new Date(ir.s*1e3+("L"in ir?ir.L:0));if(Dn&&!("Z"in ir)&&(ir.Z=0),"p"in ir&&(ir.H=ir.H%12+ir.p*12),ir.m===void 0&&(ir.m="q"in ir?ir.q:0),"V"in ir){if(ir.V<1||ir.V>53)return null;"w"in ir||(ir.w=1),"Z"in ir?(Si=vg(ed(ir.y,0,1)),lu=Si.getUTCDay(),Si=lu>4||lu===0?dv.ceil(Si):dv(Si),Si=cE.offset(Si,(ir.V-1)*7),ir.y=Si.getUTCFullYear(),ir.m=Si.getUTCMonth(),ir.d=Si.getUTCDate()+(ir.w+6)%7):(Si=pg(ed(ir.y,0,1)),lu=Si.getDay(),Si=lu>4||lu===0?fv.ceil(Si):fv(Si),Si=hg.offset(Si,(ir.V-1)*7),ir.y=Si.getFullYear(),ir.m=Si.getMonth(),ir.d=Si.getDate()+(ir.w+6)%7)}else("W"in ir||"U"in ir)&&("w"in ir||(ir.w="u"in ir?ir.u%7:"W"in ir?1:0),lu="Z"in ir?vg(ed(ir.y,0,1)).getUTCDay():pg(ed(ir.y,0,1)).getDay(),ir.m=0,ir.d="W"in ir?(ir.w+6)%7+ir.W*7-(lu+5)%7:ir.w+ir.U*7-(lu+6)%7);return"Z"in ir?(ir.H+=ir.Z/100|0,ir.M+=ir.Z%100,vg(ir)):pg(ir)}}function Et(Dr,Dn,Yn,ir){for(var jo=0,Si=Dn.length,lu=Yn.length,cu,Vf;jo<Si;){if(ir>=lu)return-1;if(cu=Dn.charCodeAt(jo++),cu===37){if(cu=Dn.charAt(jo++),Vf=je[cu in fE?Dn.charAt(jo++):cu],!Vf||(ir=Vf(Dr,Yn,ir))<0)return-1}else if(cu!=Yn.charCodeAt(ir++))return-1}return ir}function zt(Dr,Dn,Yn){var ir=h.exec(Dn.slice(Yn));return ir?(Dr.p=d[ir[0].toLowerCase()],Yn+ir[0].length):-1}function er(Dr,Dn,Yn){var ir=E.exec(Dn.slice(Yn));return ir?(Dr.w=b[ir[0].toLowerCase()],Yn+ir[0].length):-1}function Rt(Dr,Dn,Yn){var ir=g.exec(Dn.slice(Yn));return ir?(Dr.w=y[ir[0].toLowerCase()],Yn+ir[0].length):-1}function pr(Dr,Dn,Yn){var ir=ee.exec(Dn.slice(Yn));return ir?(Dr.m=se[ir[0].toLowerCase()],Yn+ir[0].length):-1}function xr(Dr,Dn,Yn){var ir=w.exec(Dn.slice(Yn));return ir?(Dr.m=F[ir[0].toLowerCase()],Yn+ir[0].length):-1}function Ur(Dr,Dn,Yn){return Et(Dr,r,Dn,Yn)}function ti(Dr,Dn,Yn){return Et(Dr,t,Dn,Yn)}function _i(Dr,Dn,Yn){return Et(Dr,n,Dn,Yn)}function oa(Dr){return o[Dr.getDay()]}function bo(Dr){return a[Dr.getDay()]}function so(Dr){return l[Dr.getMonth()]}function $h(Dr){return s[Dr.getMonth()]}function j5(Dr){return i[+(Dr.getHours()>=12)]}function V5(Dr){return 1+~~(Dr.getMonth()/3)}function W5(Dr){return o[Dr.getUTCDay()]}function X5(Dr){return a[Dr.getUTCDay()]}function Y5(Dr){return l[Dr.getUTCMonth()]}function $5(Dr){return s[Dr.getUTCMonth()]}function K5(Dr){return i[+(Dr.getUTCHours()>=12)]}function q5(Dr){return 1+~~(Dr.getUTCMonth()/3)}return{format:function(Dr){var Dn=Ve(Dr+="",ge);return Dn.toString=function(){return Dr},Dn},parse:function(Dr){var Dn=rt(Dr+="",!1);return Dn.toString=function(){return Dr},Dn},utcFormat:function(Dr){var Dn=Ve(Dr+="",Ee);return Dn.toString=function(){return Dr},Dn},utcParse:function(Dr){var Dn=rt(Dr+="",!0);return Dn.toString=function(){return Dr},Dn}}}var fE={"-":"",_:" ","0":"0"},Ca=/^\s*\d+/,wO=/^%/,IO=/[\\^$*+?|[\]().{}]/g;function Xn(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function LO(e){return e.replace(IO,"\\$&")}function td(e){return new RegExp("^(?:"+e.map(LO).join("|")+")","i")}function rd(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function DO(e,r,t){var n=Ca.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function FO(e,r,t){var n=Ca.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function NO(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function kO(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function BO(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function hE(e,r,t){var n=Ca.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function dE(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function ZO(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function UO(e,r,t){var n=Ca.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function GO(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function pE(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function zO(e,r,t){var n=Ca.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function vE(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function HO(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function jO(e,r,t){var n=Ca.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function VO(e,r,t){var n=Ca.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function WO(e,r,t){var n=Ca.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function XO(e,r,t){var n=wO.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function YO(e,r,t){var n=Ca.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function $O(e,r,t){var n=Ca.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function mE(e,r){return Xn(e.getDate(),r,2)}function KO(e,r){return Xn(e.getHours(),r,2)}function qO(e,r){return Xn(e.getHours()%12||12,r,2)}function QO(e,r){return Xn(1+hg.count(Hh(e),e),r,3)}function gE(e,r){return Xn(e.getMilliseconds(),r,3)}function JO(e,r){return gE(e,r)+"000"}function eR(e,r){return Xn(e.getMonth()+1,r,2)}function tR(e,r){return Xn(e.getMinutes(),r,2)}function rR(e,r){return Xn(e.getSeconds(),r,2)}function nR(e){var r=e.getDay();return r===0?7:r}function iR(e,r){return Xn(fg.count(Hh(e)-1,e),r,2)}function _E(e){var r=e.getDay();return r>=4||r===0?jh(e):jh.ceil(e)}function aR(e,r){return e=_E(e),Xn(jh.count(Hh(e),e)+(Hh(e).getDay()===4),r,2)}function oR(e){return e.getDay()}function uR(e,r){return Xn(fv.count(Hh(e)-1,e),r,2)}function sR(e,r){return Xn(e.getFullYear()%100,r,2)}function lR(e,r){return e=_E(e),Xn(e.getFullYear()%100,r,2)}function cR(e,r){return Xn(e.getFullYear()%1e4,r,4)}function fR(e,r){var t=e.getDay();return e=t>=4||t===0?jh(e):jh.ceil(e),Xn(e.getFullYear()%1e4,r,4)}function hR(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Xn(r/60|0,"0",2)+Xn(r%60,"0",2)}function yE(e,r){return Xn(e.getUTCDate(),r,2)}function dR(e,r){return Xn(e.getUTCHours(),r,2)}function pR(e,r){return Xn(e.getUTCHours()%12||12,r,2)}function vR(e,r){return Xn(1+cE.count(J0(e),e),r,3)}function EE(e,r){return Xn(e.getUTCMilliseconds(),r,3)}function mR(e,r){return EE(e,r)+"000"}function gR(e,r){return Xn(e.getUTCMonth()+1,r,2)}function _R(e,r){return Xn(e.getUTCMinutes(),r,2)}function yR(e,r){return Xn(e.getUTCSeconds(),r,2)}function ER(e){var r=e.getUTCDay();return r===0?7:r}function xR(e,r){return Xn(sE.count(J0(e)-1,e),r,2)}function xE(e){var r=e.getUTCDay();return r>=4||r===0?Vh(e):Vh.ceil(e)}function SR(e,r){return e=xE(e),Xn(Vh.count(J0(e),e)+(J0(e).getUTCDay()===4),r,2)}function CR(e){return e.getUTCDay()}function AR(e,r){return Xn(dv.count(J0(e)-1,e),r,2)}function bR(e,r){return Xn(e.getUTCFullYear()%100,r,2)}function TR(e,r){return e=xE(e),Xn(e.getUTCFullYear()%100,r,2)}function MR(e,r){return Xn(e.getUTCFullYear()%1e4,r,4)}function OR(e,r){var t=e.getUTCDay();return e=t>=4||t===0?Vh(e):Vh.ceil(e),Xn(e.getUTCFullYear()%1e4,r,4)}function RR(){return"+0000"}function SE(){return"%"}function CE(e){return+e}function AE(e){return Math.floor(+e/1e3)}var Wh,bE,PR,wR,IR;LR({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function LR(e){return Wh=PO(e),bE=Wh.format,PR=Wh.parse,wR=Wh.utcFormat,IR=Wh.utcParse,Wh}var nd=1e3,id=nd*60,ad=id*60,od=ad*24,DR=od*7,TE=od*30,mg=od*365;function FR(e){return new Date(e)}function NR(e){return e instanceof Date?+e:+new Date(+e)}function ME(e,r,t,n,i,a,o,s,l){var h=L1(Gu,Gu),d=h.invert,g=h.domain,y=l(".%L"),E=l(":%S"),b=l("%I:%M"),w=l("%I %p"),F=l("%a %d"),ee=l("%b %d"),se=l("%B"),ge=l("%Y"),Ee=[[o,1,nd],[o,5,5*nd],[o,15,15*nd],[o,30,30*nd],[a,1,id],[a,5,5*id],[a,15,15*id],[a,30,30*id],[i,1,ad],[i,3,3*ad],[i,6,6*ad],[i,12,12*ad],[n,1,od],[n,2,2*od],[t,1,DR],[r,1,TE],[r,3,3*TE],[e,1,mg]];function je(rt){return(o(rt)<rt?y:a(rt)<rt?E:i(rt)<rt?b:n(rt)<rt?w:r(rt)<rt?t(rt)<rt?F:ee:e(rt)<rt?se:ge)(rt)}function Ve(rt,Et,zt,er){if(rt==null&&(rt=10),typeof rt=="number"){var Rt=Math.abs(zt-Et)/rt,pr=p1(function(xr){return xr[2]}).right(Ee,Rt);pr===Ee.length?(er=Km(Et/mg,zt/mg,rt),rt=e):pr?(pr=Ee[Rt/Ee[pr-1][2]<Ee[pr][2]/Rt?pr-1:pr],er=pr[1],rt=pr[0]):(er=Math.max(Km(Et,zt,rt),1),rt=s)}return er==null?rt:rt.every(er)}return h.invert=function(rt){return new Date(d(rt))},h.domain=function(rt){return arguments.length?g(rv.call(rt,NR)):g().map(FR)},h.ticks=function(rt,Et){var zt=g(),er=zt[0],Rt=zt[zt.length-1],pr=Rt<er,xr;return pr&&(xr=er,er=Rt,Rt=xr),xr=Ve(rt,er,Rt,Et),xr=xr?xr.range(er,Rt+1):[],pr?xr.reverse():xr},h.tickFormat=function(rt,Et){return Et==null?je:l(Et)},h.nice=function(rt,Et){var zt=g();return(rt=Ve(rt,zt[0],zt[zt.length-1],Et))?g(H1(zt,rt)):h},h.copy=function(){return av(h,ME(e,r,t,n,i,a,o,s,l))},h}function kR(){return Jc.apply(ME(Hh,gO,fg,hg,SO,CO,AO,bO,bE).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function j4(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function pv(){var e=0,r=1,t,n,i,a,o=identity,s=!1,l;function h(d){return isNaN(d=+d)?l:o(i===0?.5:(d=(a(d)-t)*i,s?Math.max(0,Math.min(1,d)):d))}return h.domain=function(d){return arguments.length?(t=a(e=+d[0]),n=a(r=+d[1]),i=t===n?0:1/(n-t),h):[e,r]},h.clamp=function(d){return arguments.length?(s=!!d,h):s},h.interpolator=function(d){return arguments.length?(o=d,h):o},h.unknown=function(d){return arguments.length?(l=d,h):l},function(d){return a=d,t=d(e),n=d(r),i=t===n?0:1/(n-t),h}}function vv(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function BR(){var e=linearish(pv()(identity));return e.copy=function(){return vv(e,BR())},initInterpolator.apply(e,arguments)}function ZR(){var e=loggish(pv()).domain([1,10]);return e.copy=function(){return vv(e,ZR()).base(e.base())},initInterpolator.apply(e,arguments)}function UR(){var e=symlogish(pv());return e.copy=function(){return vv(e,UR()).constant(e.constant())},initInterpolator.apply(e,arguments)}function OE(){var e=powish(pv());return e.copy=function(){return vv(e,OE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function V4(){return OE.apply(null,arguments).exponent(.5)}function GR(){var e=[],r=identity;function t(n){if(!isNaN(n=+n))return r((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,o;i<a;++i)o=n[i],o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return GR(r).domain(e)},initInterpolator.apply(t,arguments)}function mv(){var e=0,r=.5,t=1,n,i,a,o,s,l=identity,h,d=!1,g;function y(E){return isNaN(E=+E)?g:(E=.5+((E=+h(E))-i)*(E<i?o:s),l(d?Math.max(0,Math.min(1,E)):E))}return y.domain=function(E){return arguments.length?(n=h(e=+E[0]),i=h(r=+E[1]),a=h(t=+E[2]),o=n===i?0:.5/(i-n),s=i===a?0:.5/(a-i),y):[e,r,t]},y.clamp=function(E){return arguments.length?(d=!!E,y):d},y.interpolator=function(E){return arguments.length?(l=E,y):l},y.unknown=function(E){return arguments.length?(g=E,y):g},function(E){return h=E,n=E(e),i=E(r),a=E(t),o=n===i?0:.5/(i-n),s=i===a?0:.5/(a-i),y}}function zR(){var e=linearish(mv()(identity));return e.copy=function(){return copy(e,zR())},initInterpolator.apply(e,arguments)}function HR(){var e=loggish(mv()).domain([.1,1,10]);return e.copy=function(){return copy(e,HR()).base(e.base())},initInterpolator.apply(e,arguments)}function jR(){var e=symlogish(mv());return e.copy=function(){return copy(e,jR()).constant(e.constant())},initInterpolator.apply(e,arguments)}function RE(){var e=powish(mv());return e.copy=function(){return copy(e,RE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function W4(){return RE.apply(null,arguments).exponent(.5)}var Ts,PE,wE,IE,gg,LE,VR=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,WR=(Ts={},(0,p.Z)(Ts,ha.LINEAR,G1),(0,p.Z)(Ts,ha.POWER,ug),(0,p.Z)(Ts,ha.LOG,X1),(0,p.Z)(Ts,ha.IDENTITY,z1),(0,p.Z)(Ts,ha.TIME,kR),(0,p.Z)(Ts,ha.QUANTILE,q1),(0,p.Z)(Ts,ha.QUANTIZE,Q1),(0,p.Z)(Ts,ha.THRESHOLD,J1),(0,p.Z)(Ts,ha.CAT,nv),Ts),XR=(PE=(0,Ut.b2)(),wE=(0,Ut.f3)(Qe.IGlobalConfigService),PE(IE=(gg=function(){function e(){(0,ft.Z)(this,e),wr(this,"configService",LE,this),(0,p.Z)(this,"scaleCache",{}),(0,p.Z)(this,"scaleOptions",{})}return(0,mt.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes(),s=t.getSource().data.dataArray;s.length!==0&&i.caculateScalesForAttributes(o||[],s)}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes(),s=t.getSource().data.dataArray;return i.caculateScalesForAttributes(o||[],s),t.layerModelNeedUpdate=!0,!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes();if(o){var s=t.getSource().data.dataArray;if(s.length===0)return;var l=o.filter(function(h){return h.needRescale});l.length&&i.caculateScalesForAttributes(l,s)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;this.scaleCache={},t.forEach(function(a){if(a.scale){var o=a.scale,s=a.name;o.names=i.parseFields(a.scale.field||[]);var l=[];o.names.forEach(function(h){l.push(i.getOrCreateScale(h,a,n))}),l.some(function(h){return h.type===Xc.VARIABLE})?(o.type=Xc.VARIABLE,l.forEach(function(h){if(!o.callback){var d;if(o.values&&o.values!=="text"){var g;if(((g=h.option)===null||g===void 0?void 0:g.type)==="linear"&&o.values.length>2){var y=h.scale.ticks(o.values.length);s==="color"&&h.scale.domain(y)}h.scale.range(o.values)}else((d=h.option)===null||d===void 0?void 0:d.type)==="cat"&&h.scale.range(h.option.domain)}})):(o.type=Xc.CONSTANT,o.defaultValues=l.map(function(h,d){return h.scale(o.names[d])})),o.scalers=l.map(function(h){return{field:h.field,func:h.scale,option:h.option}}),a.needRescale=!1}})}},{key:"getOrCreateScale",value:function(t,n,i){var a,o=[t,n.name].join("_"),s=(a=n.scale)===null||a===void 0?void 0:a.values,l=this.createScale(t,n.name,s,i);return l}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:Na()(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var o,s,l=this.scaleOptions[n]&&((o=this.scaleOptions[n])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],h={field:t,scale:void 0,type:Xc.VARIABLE,option:l};if(!a||!a.length)return l&&l.type?h.scale=this.createDefaultScale(l):(h.scale=nv([t]),h.type=Xc.CONSTANT),h;var d=(s=a.find(function(E){return!Ss()(E[t])}))===null||s===void 0?void 0:s[t];if(this.isNumber(t)||Ss()(d)&&!l)h.scale=nv([t]),h.type=Xc.CONSTANT;else{var g=l&&l.type||this.getDefaultType(d);i==="text"&&(g=ha.CAT);var y=this.createDefaultScaleConfig(g,t,a);Object.assign(y,l),h.scale=this.createDefaultScale(y),h.option=y}return h}},{key:"getDefaultType",value:function(t){var n=ha.LINEAR;return typeof t=="string"&&(n=VR.test(t)?ha.TIME:ha.CAT),n}},{key:"createDefaultScaleConfig",value:function(t,n,i){var a={type:t},o=(i==null?void 0:i.map(function(s){return s[n]}))||[];return t!==ha.CAT&&t!==ha.QUANTILE?a.domain=MM(o):t===ha.CAT?a.domain=w0()(o):t===ha.QUANTILE&&(a.domain=o),a}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=WR[n]();return i&&a.domain(i),a}}]),e}(),LE=Xr(gg.prototype,"configService",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gg))||IE),DE,FE,NE,kE,gv,BE,ZE;function UE(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function YR(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?UE(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):UE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var $R=(DE=(0,Ut.b2)(),FE=(0,Ut.f3)(Qe.ICameraService),NE=(0,Ut.f3)(Qe.IRendererService),DE(kE=(gv=function(){function e(){(0,ft.Z)(this,e),wr(this,"cameraService",BE,this),wr(this,"rendererService",ZE,this)}return(0,mt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(n){n.addUniforms(YR({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),BE=Xr(gv.prototype,"cameraService",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZE=Xr(gv.prototype,"rendererService",[NE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv))||kE),GE,zE,KR=(GE=(0,Ut.b2)(),GE(zE=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t){t.hooks.init.tap("LayerModelPlugin",function(){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1,!1})}}]),e}())||zE),HE,jE,qR=(HE=(0,Ut.b2)(),HE(jE=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&setTimeout(function(){t.fitBounds(a)},100)})}}]),e}())||jE),VE,WE,QR=["type"];function XE(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ud(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?XE(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):XE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var YE={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},JR={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},eP={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},tP={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},X4=null;function rP(e){var r={u_DirectionalLights:new Array(3).fill(ud({},eP)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(ud({},tP)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[JR]),e.forEach(function(t,n){var i=t.type,a=i===void 0?"directional":i,o=(0,Of.Z)(t,QR),s=YE[a].lights,l=YE[a].num,h=r[l];r[s][h]=ud(ud({},r[s][h]),o),r[l]++}),r}var nP=(VE=(0,Ut.b2)(),VE(WE=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms(ud({},rP()))})})}}]),e}())||WE),$E,KE,qE,_g,QE,iP=($E=(0,Ut.b2)(),KE=(0,Ut.f3)(Qe.IGlobalConfigService),$E(qE=(_g=function(){function e(){(0,ft.Z)(this,e),wr(this,"configService",QE,this),(0,p.Z)(this,"enabled",void 0)}return(0,mt.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,o=n.postProcessingPassFactory,s=n.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var l=t.getLayerConfig(),h=l.enableMultiPassRenderer,d=l.passes,g=d===void 0?[]:d;i.enabled=!!h&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=$_(t,g,o,s),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var l=a.getViewportSize(),h=l.width,d=l.height;t.multiPassRenderer.resize(h,d)}})}}]),e}(),QE=Xr(_g.prototype,"configService",[KE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g))||qE),JE,ex,_v={NONE:0,ENCODE:1,HIGHLIGHT:2},aP=(JE=(0,Ut.b2)(),JE(ex=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t,n){var i=n.rendererService,a=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var o=!0;a.registerStyleAttribute({name:"pickingColor",type:Er.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:M.FLOAT},size:3,update:function(l,h){var d=l.id;return o?Ws(d):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=t.getLayerConfig(),s=o.enablePicking;s&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:_v.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=t.getLayerConfig(),s=o.enablePicking;s&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:_v.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var s=t.getLayerConfig(),l=s.highlightColor,h=s.activeMix,d=h===void 0?0:h,g=typeof l=="string"?Zn(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Vs(new Uint8Array(o))}),t.models.forEach(function(y){return y.addUniforms({u_PickingStage:_v.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:g.map(function(E){return E*255}),u_activeMix:d})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var s=t.getLayerConfig(),l=s.selectColor,h=s.selectMix,d=h===void 0?0:h,g=typeof l=="string"?Zn(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Vs(new Uint8Array(o))}),t.models.forEach(function(y){return y.addUniforms({u_PickingStage:_v.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:g.map(function(E){return E*255}),u_activeMix:d,u_CurrentSelectedId:o,u_SelectColor:g.map(function(E){return E*255}),u_EnableSelect:1})})})}}]),e}())||ex),tx,rx,oP=(tx=(0,Ut.b2)(),tx(rx=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){i.registerBuiltinAttributes(a)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:Er.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:M.FLOAT},size:3,update:function(i,a,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}}),t.registerStyleAttribute({name:"filter",type:Er.Attribute,descriptor:{name:"filter",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(i,a){var o=i.filter;return o?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:Er.Attribute,descriptor:{name:"a_Color",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:4,update:function(i,a){var o=i.color;return!o||!o.length?[1,1,1,1]:o}}}),t.registerStyleAttribute({name:"vertexId",type:Er.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:M.DYNAMIC_DRAW,data:[],type:M.FLOAT},size:1,update:function(i,a,o,s){return[a]}}})}}]),e}())||rx),nx,ix,ax,ox,ux,sx,Xh,lx,cx,fx,hx,uP=(nx=(0,Ut.b2)(),ix=(0,Ut.f3)(Qe.ICameraService),ax=(0,Ut.f3)(Qe.ICoordinateSystemService),ox=(0,Ut.f3)(Qe.IRendererService),ux=(0,Ut.f3)(Qe.IMapService),nx(sx=(Xh=function(){function e(){(0,ft.Z)(this,e),wr(this,"cameraService",lx,this),wr(this,"coordinateSystemService",cx,this),wr(this,"rendererService",fx,this),wr(this,"mapService",hx,this)}return(0,mt.Z)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),i==="GAODE2.x"&&(a=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter());var s=n.rendererService.getViewportSize(),l=s.width,h=s.height;t.models.forEach(function(d){var g;d.addUniforms((g={},(0,p.Z)(g,Df.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,p.Z)(g,Df.ViewMatrix,n.cameraService.getViewMatrix()),(0,p.Z)(g,Df.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,p.Z)(g,Df.Zoom,n.cameraService.getZoom()),(0,p.Z)(g,Df.ZoomScale,n.cameraService.getZoomScale()),(0,p.Z)(g,Df.FocalDistance,n.cameraService.getFocalDistance()),(0,p.Z)(g,Df.CameraPosition,n.cameraService.getCameraPosition()),(0,p.Z)(g,ec.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,p.Z)(g,ec.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,p.Z)(g,ec.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,p.Z)(g,ec.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,p.Z)(g,ec.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,p.Z)(g,ec.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,p.Z)(g,ec.Mvp,a),(0,p.Z)(g,"u_SceneCenterMKT",o),(0,p.Z)(g,"u_ViewportSize",[l,h]),(0,p.Z)(g,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,p.Z)(g,"u_DevicePixelRatio",Wt.devicePixelRatio),(0,p.Z)(g,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,p.Z)(g,"u_shaderPick",Number(t.getShaderPickStat())),g))})})}}]),e}(),lx=Xr(Xh.prototype,"cameraService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cx=Xr(Xh.prototype,"coordinateSystemService",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fx=Xr(Xh.prototype,"rendererService",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hx=Xr(Xh.prototype,"mapService",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh))||sx),dx,px,sP=(dx=(0,Ut.b2)(),dx(px=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||px),vx,mx,lP=(vx=(0,Ut.b2)(),vx(mx=function(){function e(){(0,ft.Z)(this,e)}return(0,mt.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||i.updateStyleAtrribute(t,{styleAttributeService:a})})}},{key:"updateStyleAtrribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],o=i.getLayerStyleAttribute("filter"),s=i.getLayerStyleAttribute("shape");if(o&&o.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){i.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),e}())||mx);su.bind(Qe.ILayerPlugin).to(AM).inRequestScope(),su.bind(Qe.ILayerPlugin).to(oP).inRequestScope(),su.bind(Qe.ILayerPlugin).to(XR).inRequestScope(),su.bind(Qe.ILayerPlugin).to(CM).inRequestScope(),su.bind(Qe.ILayerPlugin).to(qR).inRequestScope(),su.bind(Qe.ILayerPlugin).to(lP).inRequestScope(),su.bind(Qe.ILayerPlugin).to(sP).inRequestScope(),su.bind(Qe.ILayerPlugin).to(iP).inRequestScope(),su.bind(Qe.ILayerPlugin).to(uP).inRequestScope(),su.bind(Qe.ILayerPlugin).to($R).inRequestScope(),su.bind(Qe.ILayerPlugin).to(nP).inRequestScope(),su.bind(Qe.ILayerPlugin).to(aP).inRequestScope(),su.bind(Qe.ILayerPlugin).to(KR).inRequestScope();var Y4="2.8.18",gx,yg,_x;function yx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ex(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?yx(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):yx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var cP=(gx=Lm(Qe.IGlobalConfigService),yg=function(){function e(r){(0,ft.Z)(this,e),wr(this,"configService",_x,this),(0,p.Z)(this,"config",void 0),this.config=r}return(0,mt.Z)(e,[{key:"setContainer",value:function(t,n,i,a){t.bind(Qe.MapConfig).toConstantValue(Ex(Ex({},this.config),{},{id:n,canvas:i,hasBaseMap:a})),t.bind(Qe.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),_x=Xr(yg.prototype,"configService",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yg),fP=T(81618),hP=T.n(fP),dP=function(){function e(r){(0,ft.Z)(this,e),(0,p.Z)(this,"size",1e4),this.size=r||1e4}return(0,mt.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}();function xx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Sx(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?xx(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Cx(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return Sx(Sx({},r),e)}var Ax={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},bx=Math.PI/180,pP=function(){function e(){(0,ft.Z)(this,e),(0,p.Z)(this,"projectionMatrix",He()),(0,p.Z)(this,"viewMatrix",He()),(0,p.Z)(this,"viewProjectionMatrix",He()),(0,p.Z)(this,"ViewProjectionMatrixUncentered",He()),(0,p.Z)(this,"viewUncenteredMatrix",He()),(0,p.Z)(this,"zoom",void 0),(0,p.Z)(this,"center",void 0)}return(0,mt.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,a=t.pitch,o=a===void 0?0:a,s=t.bearing,l=s===void 0?0:s,h=t.center,d=h===void 0?[0,0]:h,g=t.offsetOrigin,y=g===void 0?[0,0]:g,E=t.cameraHeight,b=E===void 0?1:E,w=t.aspect,F=w===void 0?1:w,ee=t.near,se=ee===void 0?.1:ee,ge=t.far,Ee=ge===void 0?1e3:ge,je=t.fov,Ve=je===void 0?0:je;this.zoom=i,this.center=d;var rt=o*bx,Et=(360-l)*bx;Oi(this.projectionMatrix,Ve,F,se,Ee);var zt=uo(b*Math.sin(rt)*Math.sin(Et),-b*Math.sin(rt)*Math.cos(Et),b*Math.cos(rt)),er=uo(-Math.cos(rt)*Math.sin(Et),Math.cos(rt)*Math.cos(Et),Math.sin(rt));mi(this.viewMatrix,zt,uo(0,0,0),er),this.viewUncenteredMatrix=wt(this.viewMatrix),Ot(this.viewMatrix,this.viewMatrix,uo(-y[0],y[1],0)),Bt(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Bt(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=(0,Rn.Z)(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,a=Math.max(Math.min(i,t[1]),-i),o=256<<20,s=Math.PI/180,l=t[0]*s,h=a*s;h=Math.log(Math.tan(Math.PI/4+h/2));var d=.5/Math.PI,g=.5,y=-.5/Math.PI;return s=.5,l=o*(d*l+g)-215440491,h=-(o*(y*h+s)-106744817),[l,h]}}]),e}(),vP=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],Tx,Mx,Ox,Rx,Px,Ix,Yh,Lx,Dx,Fx,Nx;function kx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function mP(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?kx(Object(t),!0).forEach(function(n){(0,p.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function gP(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}gP(`.amap-logo{
 display: none !important;
}
`);var _P=0;window.forceWebGL=!0;var Bx="15cd8a57710d40c9b7c0e3cc120f1200",yP="1.4.15",EP="amap-script",Eg=!1,yv=[],xP=12,SP=(Tx=(0,Ut.b2)(),Mx=(0,Ut.f3)(Qe.IGlobalConfigService),Ox=(0,Ut.f3)(Qe.MapConfig),Rx=(0,Ut.f3)(Qe.ICoordinateSystemService),Px=(0,Ut.f3)(Qe.IEventEmitter),Tx(Ix=(Yh=function(){function e(){var r=this;(0,ft.Z)(this,e),(0,p.Z)(this,"version",Ha["GAODE1.x"]),(0,p.Z)(this,"simpleMapCoord",new dP),(0,p.Z)(this,"map",void 0),(0,p.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),wr(this,"configService",Lx,this),wr(this,"config",Dx,this),wr(this,"coordinateSystemService",Fx,this),wr(this,"eventEmitter",Nx,this),(0,p.Z)(this,"markerContainer",void 0),(0,p.Z)(this,"$mapContainer",void 0),(0,p.Z)(this,"viewport",void 0),(0,p.Z)(this,"cameraChangedCallback",void 0),(0,p.Z)(this,"handleCameraChanged",function(t){var n=t.camera,i=n.fov,a=n.near,o=n.far,s=n.height,l=n.pitch,h=n.rotation,d=n.aspect,g=n.position,y=r.getCenter(),E=y.lng,b=y.lat;if(r.emit("mapchange"),r.cameraChangedCallback){r.viewport.syncWithMapCamera({aspect:d,bearing:360-h,far:o,fov:i,cameraHeight:s,near:a,pitch:l,zoom:r.map.getZoom()-1,center:[E,b],offsetOrigin:[g.x,g.y]});var w=r.config.offsetZoom,F=w===void 0?xP:w;r.viewport.getZoom()>F?r.coordinateSystemService.setCoordinateSystem(sl.P20_OFFSET):r.coordinateSystemService.setCoordinateSystem(sl.P20),r.cameraChangedCallback(r.viewport)}})}return(0,mt.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];this.markerContainer=Cn("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){T_.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){T_.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),a=(0,Rn.Z)(i,2),o=a[0],s=a[1],l=Cx(t.padding),h=this.lngLatToPixel([n.lng,n.lat]),d=[(l.right-l.left)/2,(l.bottom-l.top)/2],g=this.pixelToLngLat([h.x-d[0],h.y-d[1]]);return g}var y=this.map.getCenter();return{lng:y.getLng(),lat:y.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=Cx(n.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],s=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([s.lng,s.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),n=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>n.getLng()||a.lng<i.getLng()?180-n.getLng():n.getLng(),s=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[s,i.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToCoord",value:function(t){var n=this.map.lngLatToGeodeticCoord(t),i=n.x,a=n.y;return[i,-a]}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},s=this.viewport.projectFlat(t),l=He();return Ot(l,l,uo(s[0],s[1],n)),Xt(l,l,uo(a[0],a[1],a[2])),Nr(l,l,i[0]),Mr(l,l,i[1]),$t(l,l,i[2]),l}},{key:"init",value:function(){var r=(0,ca.Z)(Ln().mark(function n(){var i=this,a,o,s,l,h,d,g,y,E,b,w,F,ee,se;return Ln().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return a=this.config,o=a.id,s=a.style,l=s===void 0?"light":s,h=a.minZoom,d=h===void 0?0:h,g=a.maxZoom,y=g===void 0?18:g,E=a.token,b=E===void 0?Bx:E,w=a.mapInstance,F=a.plugin,ee=F===void 0?[]:F,se=(0,Of.Z)(a,vP),Ee.next=3,new Promise(function(je){var Ve=function(){if(w)i.map=w,i.$mapContainer=i.map.getContainer(),setTimeout(function(){i.map.on("camerachange",i.handleCameraChanged),je()},30);else{i.$mapContainer=i.creatAmapContainer(o);var Et=mP({mapStyle:i.getMapStyle(l),zooms:[d,y],viewMode:"3D"},se);Et.zoom&&(Et.zoom+=1);var zt=new AMap.Map(i.$mapContainer,Et);zt.on("camerachange",i.handleCameraChanged),zt.on("camerachange",function(){setTimeout(function(){return i.handleAfterMapChange()})}),i.map=zt,setTimeout(function(){je()},10)}};!Eg&&!w?(b===Bx&&console.warn(i.configService.getSceneWarninfo("MapToken")),Eg=!0,ee.push("Map3D"),hP().load({key:b,version:yP,plugins:ee}).then(function(rt){Ve(),yv.length&&(yv.forEach(function(Et){return Et()}),yv=[])}).catch(function(rt){throw new Error(rt)})):Eg&&window.AMap||w?Ve():yv.push(Ve)});case 3:this.viewport=new pP;case 4:case"end":return Ee.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(Lo(AMap.LngLat,(0,B.Z)(t)),Lo(AMap.LngLat,(0,B.Z)(n))),a=this.lngLatToCoord(t),o=(0,Rn.Z)(a,2),s=o[0],l=o[1],h=this.lngLatToCoord(n),d=(0,Rn.Z)(h,2),g=d[0],y=d[1],E=Math.sqrt(Math.pow(s-g,2)+Math.pow(l-y,2));return E/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(EP);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"getMapStyle",value:function(t){return Ax[t]?Ax[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+_P++,n.appendChild(i),i}}]),e}(),Lx=Xr(Yh.prototype,"configService",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=Xr(Yh.prototype,"config",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=Xr(Yh.prototype,"coordinateSystemService",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nx=Xr(Yh.prototype,"eventEmitter",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yh))||Ix);function CP(e){var r=AP();return function(){var n=(0,Xe.Z)(e),i;if(r){var a=(0,Xe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cr.Z)(this,i)}}function AP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bP=function(e){(0,lr.Z)(t,e);var r=CP(t);function t(){return(0,ft.Z)(this,t),r.apply(this,arguments)}return(0,mt.Z)(t,[{key:"getServiceConstructor",value:function(){return SP}}]),t}(cP);function Zx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ux(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Zx(Object(t),!0).forEach(function(n){TP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Zx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function TP(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function MP(e,r){return wP(e)||PP(e,r)||RP(e,r)||OP()}function OP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RP(e,r){if(!!e){if(typeof e=="string")return Gx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Gx(e,r)}}function Gx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function PP(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function wP(e){if(Array.isArray(e))return e}var IP=$.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,s=(0,$.useRef)(null),l=(0,$.useState)(),h=MP(l,2),d=h[0],g=h[1];return(0,$.useEffect)(function(){var y=new wC(Ux(Ux({id:s.current},i),{},{map:new bP(n)}));return y.on("loaded",function(){g(y),a&&a(y)}),function(){y.destroy()}},[]),(0,$.useEffect)(function(){d&&n.style&&d.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,$.useEffect)(function(){d&&n.zoom&&d.setZoom(n.zoom)},[n.zoom]),(0,$.useEffect)(function(){d&&n.center&&d.setCenter(n.center)},[JSON.stringify(n.center)]),(0,$.useEffect)(function(){d&&n.pitch&&d.setPitch(n.pitch)},[n.pitch]),(0,$.useEffect)(function(){d&&n.rotation&&d.setRotation(n.rotation)},[n.rotation]),$.createElement(k.Provider,{value:d},$.createElement("div",{ref:s,className:t,style:r},d&&o))}),LP=IP;function zx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function $4(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?zx(Object(t),!0).forEach(function(n){DP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function DP(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function K4(e,r){return BP(e)||kP(e,r)||NP(e,r)||FP()}function FP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NP(e,r){if(!!e){if(typeof e=="string")return Hx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hx(e,r)}}function Hx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function kP(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function BP(e){if(Array.isArray(e))return e}var q4=null,Q4=null;function jx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function J4(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?jx(Object(t),!0).forEach(function(n){ZP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):jx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ZP(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function eI(e,r){return HP(e)||zP(e,r)||GP(e,r)||UP()}function UP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GP(e,r){if(!!e){if(typeof e=="string")return Vx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vx(e,r)}}function Vx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function zP(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function HP(e){if(Array.isArray(e))return e}var tI=null,rI=null;function Wx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function nI(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Wx(Object(t),!0).forEach(function(n){jP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Wx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jP(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function iI(e,r){return YP(e)||XP(e,r)||WP(e,r)||VP()}function VP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WP(e,r){if(!!e){if(typeof e=="string")return Xx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xx(e,r)}}function Xx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function XP(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function YP(e){if(Array.isArray(e))return e}var aI=null,oI=null;function uI(e,r){return QP(e)||qP(e,r)||KP(e,r)||$P()}function $P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KP(e,r){if(!!e){if(typeof e=="string")return Yx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Yx(e,r)}}function Yx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function qP(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function QP(e){if(Array.isArray(e))return e}var sI=null,lI=null;function $x(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function cI(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?$x(Object(t),!0).forEach(function(n){JP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$x(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function JP(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function fI(e,r){if(e==null)return{};var t=e5(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function e5(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var hI=null,Kx=T(73935);function qx(e,r){return i5(e)||n5(e,r)||r5(e,r)||t5()}function t5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r5(e,r){if(!!e){if(typeof e=="string")return Qx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qx(e,r)}}function Qx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function n5(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function i5(e){if(Array.isArray(e))return e}var Jx=$.useEffect,eS=$.useState,a5=/\B([A-Z])/g,o5=function(r){return r.replace(a5,"-$1").toLowerCase()};function dI(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=eS(),o=qx(a,2),s=o[0],l=o[1],h=useSceneValue(),d=eS(function(){return document.createElement("div")}),g=qx(d,1),y=g[0];return Jx(function(){var E=new Control({position:i});return E.onAdd=function(){if(r&&(y.className=r),t){var b=Object.keys(t).map(function(w){return"".concat(o5(w),":").concat(t[w])}).join(";");y.style.cssText=b}return y},E.onRemove=function(){},l(E),h.addControl(E),function(){h.removeControl(E)}},[]),Jx(function(){s&&s.setPosition(i||"bottomleft")},[i]),createPortal(n,y)}var tS=(0,$.createContext)({});function pI(){return useContext(tS)}var ml=T(96486),vI=$.useEffect,u5=$.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},ml.isEqual),mI=$.useEffect,s5=$.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},ml.isEqual),gI=$.useEffect,l5=$.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},ml.isEqual),c5=$.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},ml.isEqual),f5=$.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},ml.isEqual),_I=$.useEffect,h5=$.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},ml.isEqual),d5=$.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},ml.isEqual),p5=$.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},ml.isEqual),v5=["data"];function m5(e,r){if(e==null)return{};var t=g5(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function g5(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var _5=$.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=m5(n,v5);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},ml.isEqual),yI=$.useEffect,y5=$.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},ml.isEqual);function E5(e,r){return A5(e)||C5(e,r)||S5(e,r)||x5()}function x5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S5(e,r){if(!!e){if(typeof e=="string")return rS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rS(e,r)}}function rS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function C5(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,s;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(l){a=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw s}}return n}}function A5(e){if(Array.isArray(e))return e}var sd=$.useEffect,b5=$.useState;function T5(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,o=r.size,s=r.scale,l=r.active,h=r.select,d=r.filter,g=r.animate,y=r.options,E=r.onLayerLoaded,b=L(),w=b5(function(){var se;switch(e){case"polygonLayer":se=new t1(y);break;case"lineLayer":se=new Ib(y);break;case"pointLayer":se=new NT(y);break;case"heatmapLayer":se=new b2(y);break;case"rasterLayer":se=new xM(y);break;case"imageLayer":se=new F2(y);break;case"citybuildingLayer":se=new KA(y);break;default:se=new t1(y)}return se.on("inited",function(){E&&E(se,b)}),se}),F=E5(w,1),ee=F[0];return sd(function(){return b.addLayer(ee),function(){b.removeLayer(ee)}},[]),sd(function(){ee.inited&&y&&ee.updateLayerConfig(y)},[y==null?void 0:y.minZoom,y==null?void 0:y.maxZoom,y==null?void 0:y.visible]),sd(function(){ee.inited&&(y==null?void 0:y.zIndex)&&ee.setIndex(y.zIndex)},[y==null?void 0:y.zIndex]),sd(function(){ee.inited&&(y==null?void 0:y.blend)&&ee.setBlend(y.blend)},[y==null?void 0:y.blend]),sd(function(){b.render()}),$.createElement(tS.Provider,{value:ee},$.createElement(_5,{layer:ee,source:t}),s&&$.createElement(f5,{layer:ee,scale:s}),n&&$.createElement(l5,{layer:ee,color:n}),o&&$.createElement(p5,{layer:ee,size:o}),i&&$.createElement(d5,{layer:ee,shape:i}),a&&$.createElement(y5,{layer:ee,style:a}),l&&$.createElement(u5,{layer:ee,active:l}),h&&$.createElement(h5,{layer:ee,select:h}),d&&$.createElement(c5,{layer:ee,filter:d}),g&&$.createElement(s5,{layer:ee,animate:g}),r.children)}var EI=null,M5=$.memo(function(r){return T5("lineLayer",r)}),xI=null,SI=null,CI=null,AI=null,bI=null,TI=$.useEffect,MI=null,OI=null;function Ev(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ev=function(t){return typeof t}:Ev=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ev(e)}function nS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function xv(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?nS(Object(t),!0).forEach(function(n){O5(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function O5(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function R5(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function iS(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function P5(e,r,t){return r&&iS(e.prototype,r),t&&iS(e,t),e}function w5(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&xg(e,r)}function xg(e,r){return xg=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},xg(e,r)}function I5(e){var r=F5();return function(){var n=Sv(e),i;if(r){var a=Sv(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return L5(this,i)}}function L5(e,r){if(r&&(Ev(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D5(e)}function D5(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Sv(e){return Sv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Sv(e)}var RI=function(e){w5(t,e);var r=I5(t);function t(n){var i;return R5(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return P5(t,[{key:"componentDidMount",value:function(){var i,a=this.props,o=a.lnglat,s=a.children,l=a.option,h=a.lngLat,d=new N_(xv(xv({},l),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));o&&d.setLnglat(o),h&&d.setLnglat(h),s&&d.setDOMContent(this.el),this.popup=d,this.scene.addPopup(d)}},{key:"componentDidUpdate",value:function(i){var a,o,s,l,h,d,g=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(o=i.lnglat)===null||o===void 0?void 0:o.lat],y=Array.isArray(this.props.lnglat)?this.props.lnglat:[(s=this.props)===null||s===void 0||(l=s.lnglat)===null||l===void 0?void 0:l.lng,(h=this.props)===null||h===void 0||(d=h.lnglat)===null||d===void 0?void 0:d.lat],E=g.toString()!==y.toString();if(E){var b;this.popup.remove(),this.popup=new N_(xv(xv({},this.props.option),{},{stopPropagation:(b=this.props.option)===null||b===void 0?void 0:b.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return $.createElement(k.Consumer,{},function(a){return a&&(i.scene=a),(0,Kx.createPortal)(i.props.children,i.el)})}}]),t}($.PureComponent);function Cv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cv=function(t){return typeof t}:Cv=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cv(e)}function N5(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function aS(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k5(e,r,t){return r&&aS(e.prototype,r),t&&aS(e,t),e}function B5(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&Sg(e,r)}function Sg(e,r){return Sg=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Sg(e,r)}function Z5(e){var r=z5();return function(){var n=Av(e),i;if(r){var a=Av(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return U5(this,i)}}function U5(e,r){if(r&&(Cv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return G5(e)}function G5(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Av(e){return Av=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Av(e)}var H5=function(e){B5(t,e);var r=Z5(t);function t(n){var i;return N5(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return k5(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,o=i.children,s=i.option,l=i.onMarkerLoaded,h=new w_(s);a&&h.setLnglat(a),o&&h.setElement(this.el),this.marker=h,l&&l(h),this.scene.addMarker(h)}},{key:"componentDidUpdate",value:function(i){var a,o=(i==null?void 0:i.lnglat.toString())!==((a=this.props)===null||a===void 0?void 0:a.lnglat.toString());o&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return $.createElement(k.Consumer,{},function(a){return a&&(i.scene=a),(0,Kx.createPortal)(i.props.children,i.el)})}}]),t}($.PureComponent),PI=$.useEffect,wI=null,II=null,LI=$.useEffect,DI=null},31795:function(et,I,T){var W=T(75752);et.exports.geometry=A,et.exports.ring=k;function A(U){var re=0,K;switch(U.type){case"Polygon":return $(U.coordinates);case"MultiPolygon":for(K=0;K<U.coordinates.length;K++)re+=$(U.coordinates[K]);return re;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(K=0;K<U.geometries.length;K++)re+=A(U.geometries[K]);return re}}function $(U){var re=0;if(U&&U.length>0){re+=Math.abs(k(U[0]));for(var K=1;K<U.length;K++)re-=Math.abs(k(U[K]))}return re}function k(U){var re,K,ne,le,pe,xe,it,nt=0,we=U.length;if(we>2){for(it=0;it<we;it++)it===we-2?(le=we-2,pe=we-1,xe=0):it===we-1?(le=we-1,pe=0,xe=1):(le=it,pe=it+1,xe=it+2),re=U[le],K=U[pe],ne=U[xe],nt+=(L(ne[0])-L(re[0]))*Math.sin(L(K[1]));nt=nt*W.RADIUS*W.RADIUS/2}return nt}function L(U){return U*Math.PI/180}},38163:function(et,I,T){var W=T(31795);et.exports=A;function A(K,ne){switch(K&&K.type||null){case"FeatureCollection":return K.features=K.features.map($(A,ne)),K;case"GeometryCollection":return K.geometries=K.geometries.map($(A,ne)),K;case"Feature":return K.geometry=A(K.geometry,ne),K;case"Polygon":case"MultiPolygon":return k(K,ne);default:return K}}function $(K,ne){return function(le){return K(le,ne)}}function k(K,ne){return K.type==="Polygon"?K.coordinates=L(K.coordinates,ne):K.type==="MultiPolygon"&&(K.coordinates=K.coordinates.map($(L,ne))),K}function L(K,ne){ne=!!ne,K[0]=U(K[0],ne);for(var le=1;le<K.length;le++)K[le]=U(K[le],!ne);return K}function U(K,ne){return re(K)===ne?K:K.reverse()}function re(K){return W.ring(K)>=0}},52953:function(){},4914:function(et,I,T){"use strict";T.d(I,{K:function(){return O},Z:function(){return ct}});var W=T(96156),A=T(28481),$=T(90484),k=T(67294),L=T(94184),U=T.n(L),re=T(50344),K=T(24308),ne=T(21687),le=T(65632),pe=T(22122);function xe(ut){return ut!=null}var it=function(St){var Tt=St.itemPrefixCls,Q=St.component,p=St.span,B=St.className,be=St.style,Te=St.labelStyle,Ge=St.contentStyle,$e=St.bordered,Mt=St.label,Sr=St.content,gr=St.colon,sn=Q;if($e){var Cr;return k.createElement(sn,{className:U()((Cr={},(0,W.Z)(Cr,"".concat(Tt,"-item-label"),xe(Mt)),(0,W.Z)(Cr,"".concat(Tt,"-item-content"),xe(Sr)),Cr),B),style:be,colSpan:p},xe(Mt)&&k.createElement("span",{style:Te},Mt),xe(Sr)&&k.createElement("span",{style:Ge},Sr))}return k.createElement(sn,{className:U()("".concat(Tt,"-item"),B),style:be,colSpan:p},k.createElement("div",{className:"".concat(Tt,"-item-container")},Mt&&k.createElement("span",{className:U()("".concat(Tt,"-item-label"),(0,W.Z)({},"".concat(Tt,"-item-no-colon"),!gr)),style:Te},Mt),Sr&&k.createElement("span",{className:U()("".concat(Tt,"-item-content")),style:Ge},Sr)))},nt=it;function we(ut,St,Tt){var Q=St.colon,p=St.prefixCls,B=St.bordered,be=Tt.component,Te=Tt.type,Ge=Tt.showLabel,$e=Tt.showContent,Mt=Tt.labelStyle,Sr=Tt.contentStyle;return ut.map(function(gr,sn){var Cr=gr.props,Br=Cr.label,Zr=Cr.children,kr=Cr.prefixCls,Jn=kr===void 0?p:kr,Tn=Cr.className,rn=Cr.style,En=Cr.labelStyle,Gr=Cr.contentStyle,Fn=Cr.span,si=Fn===void 0?1:Fn,zn=gr.key;return typeof be=="string"?k.createElement(nt,{key:"".concat(Te,"-").concat(zn||sn),className:Tn,style:rn,labelStyle:(0,pe.Z)((0,pe.Z)({},Mt),En),contentStyle:(0,pe.Z)((0,pe.Z)({},Sr),Gr),span:si,colon:Q,component:be,itemPrefixCls:Jn,bordered:B,label:Ge?Br:null,content:$e?Zr:null}):[k.createElement(nt,{key:"label-".concat(zn||sn),className:Tn,style:(0,pe.Z)((0,pe.Z)((0,pe.Z)({},Mt),rn),En),span:1,colon:Q,component:be[0],itemPrefixCls:Jn,bordered:B,label:Br}),k.createElement(nt,{key:"content-".concat(zn||sn),className:Tn,style:(0,pe.Z)((0,pe.Z)((0,pe.Z)({},Sr),rn),Gr),span:si*2-1,component:be[1],itemPrefixCls:Jn,bordered:B,content:Zr})]})}var Ke=function(St){var Tt=k.useContext(O),Q=St.prefixCls,p=St.vertical,B=St.row,be=St.index,Te=St.bordered;return p?k.createElement(k.Fragment,null,k.createElement("tr",{key:"label-".concat(be),className:"".concat(Q,"-row")},we(B,St,(0,pe.Z)({component:"th",type:"label",showLabel:!0},Tt))),k.createElement("tr",{key:"content-".concat(be),className:"".concat(Q,"-row")},we(B,St,(0,pe.Z)({component:"td",type:"content",showContent:!0},Tt)))):k.createElement("tr",{key:be,className:"".concat(Q,"-row")},we(B,St,(0,pe.Z)({component:Te?["th","td"]:"td",type:"item",showLabel:!0,showContent:!0},Tt)))},ke=Ke,Oe=function(St){var Tt=St.children;return Tt},Re=Oe,Je=T(96159),O=k.createContext({}),at={xxl:3,xl:3,lg:3,md:3,sm:2,xs:1};function Pe(ut,St){if(typeof ut=="number")return ut;if((0,$.Z)(ut)==="object")for(var Tt=0;Tt<K.c4.length;Tt++){var Q=K.c4[Tt];if(St[Q]&&ut[Q]!==void 0)return ut[Q]||at[Q]}return 3}function ve(ut,St,Tt){var Q=ut;return(St===void 0||St>Tt)&&(Q=(0,Je.Tm)(ut,{span:Tt}),(0,ne.Z)(St===void 0,"Descriptions","Sum of column `span` in a line not match `column` of Descriptions.")),Q}function Be(ut,St){var Tt=(0,re.Z)(ut).filter(function(be){return be}),Q=[],p=[],B=St;return Tt.forEach(function(be,Te){var Ge,$e=(Ge=be.props)===null||Ge===void 0?void 0:Ge.span,Mt=$e||1;if(Te===Tt.length-1){p.push(ve(be,$e,B)),Q.push(p);return}Mt<B?(B-=Mt,p.push(be)):(p.push(ve(be,Mt,B)),Q.push(p),B=St,p=[])}),Q}function Ae(ut){var St,Tt=ut.prefixCls,Q=ut.title,p=ut.extra,B=ut.column,be=B===void 0?at:B,Te=ut.colon,Ge=Te===void 0?!0:Te,$e=ut.bordered,Mt=ut.layout,Sr=ut.children,gr=ut.className,sn=ut.style,Cr=ut.size,Br=ut.labelStyle,Zr=ut.contentStyle,kr=k.useContext(le.E_),Jn=kr.getPrefixCls,Tn=kr.direction,rn=Jn("descriptions",Tt),En=k.useState({}),Gr=(0,A.Z)(En,2),Fn=Gr[0],si=Gr[1],zn=Pe(be,Fn);k.useEffect(function(){var On=K.ZP.subscribe(function(cn){(0,$.Z)(be)==="object"&&si(cn)});return function(){K.ZP.unsubscribe(On)}},[]);var Nn=Be(Sr,zn),_n=k.useMemo(function(){return{labelStyle:Br,contentStyle:Zr}},[Br,Zr]);return k.createElement(O.Provider,{value:_n},k.createElement("div",{className:U()(rn,(St={},(0,W.Z)(St,"".concat(rn,"-").concat(Cr),Cr&&Cr!=="default"),(0,W.Z)(St,"".concat(rn,"-bordered"),!!$e),(0,W.Z)(St,"".concat(rn,"-rtl"),Tn==="rtl"),St),gr),style:sn},(Q||p)&&k.createElement("div",{className:"".concat(rn,"-header")},Q&&k.createElement("div",{className:"".concat(rn,"-title")},Q),p&&k.createElement("div",{className:"".concat(rn,"-extra")},p)),k.createElement("div",{className:"".concat(rn,"-view")},k.createElement("table",null,k.createElement("tbody",null,Nn.map(function(On,cn){return k.createElement(ke,{key:cn,index:cn,colon:Ge,prefixCls:rn,vertical:Mt==="vertical",bordered:$e,row:On})}))))))}Ae.Item=Re;var ct=Ae},98858:function(et,I,T){"use strict";var W=T(38663),A=T.n(W),$=T(52953),k=T.n($)},9187:function(et){"use strict";et.exports=I,et.exports.default=I;function I(Q,p,B){B=B||2;var be=p&&p.length,Te=be?p[0]*B:Q.length,Ge=T(Q,0,Te,B,!0),$e=[];if(!Ge||Ge.next===Ge.prev)return $e;var Mt,Sr,gr,sn,Cr,Br,Zr;if(be&&(Ge=re(Q,p,Ge,B)),Q.length>80*B){Mt=gr=Q[0],Sr=sn=Q[1];for(var kr=B;kr<Te;kr+=B)Cr=Q[kr],Br=Q[kr+1],Cr<Mt&&(Mt=Cr),Br<Sr&&(Sr=Br),Cr>gr&&(gr=Cr),Br>sn&&(sn=Br);Zr=Math.max(gr-Mt,sn-Sr),Zr=Zr!==0?1/Zr:0}return A(Ge,$e,B,Mt,Sr,Zr),$e}function T(Q,p,B,be,Te){var Ge,$e;if(Te===Tt(Q,p,B,be)>0)for(Ge=p;Ge<B;Ge+=be)$e=ct(Ge,Q[Ge],Q[Ge+1],$e);else for(Ge=B-be;Ge>=p;Ge-=be)$e=ct(Ge,Q[Ge],Q[Ge+1],$e);return $e&&Re($e,$e.next)&&(ut($e),$e=$e.next),$e}function W(Q,p){if(!Q)return Q;p||(p=Q);var B=Q,be;do if(be=!1,!B.steiner&&(Re(B,B.next)||Oe(B.prev,B,B.next)===0)){if(ut(B),B=p=B.prev,B===B.next)break;be=!0}else B=B.next;while(be||B!==p);return p}function A(Q,p,B,be,Te,Ge,$e){if(!!Q){!$e&&Ge&&xe(Q,be,Te,Ge);for(var Mt=Q,Sr,gr;Q.prev!==Q.next;){if(Sr=Q.prev,gr=Q.next,Ge?k(Q,be,Te,Ge):$(Q)){p.push(Sr.i/B),p.push(Q.i/B),p.push(gr.i/B),ut(Q),Q=gr.next,Mt=gr.next;continue}if(Q=gr,Q===Mt){$e?$e===1?(Q=L(W(Q),p,B),A(Q,p,B,be,Te,Ge,2)):$e===2&&U(Q,p,B,be,Te,Ge):A(W(Q),p,B,be,Te,Ge,1);break}}}}function $(Q){var p=Q.prev,B=Q,be=Q.next;if(Oe(p,B,be)>=0)return!1;for(var Te=Q.next.next;Te!==Q.prev;){if(Ke(p.x,p.y,B.x,B.y,be.x,be.y,Te.x,Te.y)&&Oe(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function k(Q,p,B,be){var Te=Q.prev,Ge=Q,$e=Q.next;if(Oe(Te,Ge,$e)>=0)return!1;for(var Mt=Te.x<Ge.x?Te.x<$e.x?Te.x:$e.x:Ge.x<$e.x?Ge.x:$e.x,Sr=Te.y<Ge.y?Te.y<$e.y?Te.y:$e.y:Ge.y<$e.y?Ge.y:$e.y,gr=Te.x>Ge.x?Te.x>$e.x?Te.x:$e.x:Ge.x>$e.x?Ge.x:$e.x,sn=Te.y>Ge.y?Te.y>$e.y?Te.y:$e.y:Ge.y>$e.y?Ge.y:$e.y,Cr=nt(Mt,Sr,p,B,be),Br=nt(gr,sn,p,B,be),Zr=Q.prevZ,kr=Q.nextZ;Zr&&Zr.z>=Cr&&kr&&kr.z<=Br;){if(Zr!==Q.prev&&Zr!==Q.next&&Ke(Te.x,Te.y,Ge.x,Ge.y,$e.x,$e.y,Zr.x,Zr.y)&&Oe(Zr.prev,Zr,Zr.next)>=0||(Zr=Zr.prevZ,kr!==Q.prev&&kr!==Q.next&&Ke(Te.x,Te.y,Ge.x,Ge.y,$e.x,$e.y,kr.x,kr.y)&&Oe(kr.prev,kr,kr.next)>=0))return!1;kr=kr.nextZ}for(;Zr&&Zr.z>=Cr;){if(Zr!==Q.prev&&Zr!==Q.next&&Ke(Te.x,Te.y,Ge.x,Ge.y,$e.x,$e.y,Zr.x,Zr.y)&&Oe(Zr.prev,Zr,Zr.next)>=0)return!1;Zr=Zr.prevZ}for(;kr&&kr.z<=Br;){if(kr!==Q.prev&&kr!==Q.next&&Ke(Te.x,Te.y,Ge.x,Ge.y,$e.x,$e.y,kr.x,kr.y)&&Oe(kr.prev,kr,kr.next)>=0)return!1;kr=kr.nextZ}return!0}function L(Q,p,B){var be=Q;do{var Te=be.prev,Ge=be.next.next;!Re(Te,Ge)&&Je(Te,be,be.next,Ge)&&ve(Te,Ge)&&ve(Ge,Te)&&(p.push(Te.i/B),p.push(be.i/B),p.push(Ge.i/B),ut(be),ut(be.next),be=Q=Ge),be=be.next}while(be!==Q);return W(be)}function U(Q,p,B,be,Te,Ge){var $e=Q;do{for(var Mt=$e.next.next;Mt!==$e.prev;){if($e.i!==Mt.i&&ke($e,Mt)){var Sr=Ae($e,Mt);$e=W($e,$e.next),Sr=W(Sr,Sr.next),A($e,p,B,be,Te,Ge),A(Sr,p,B,be,Te,Ge);return}Mt=Mt.next}$e=$e.next}while($e!==Q)}function re(Q,p,B,be){var Te=[],Ge,$e,Mt,Sr,gr;for(Ge=0,$e=p.length;Ge<$e;Ge++)Mt=p[Ge]*be,Sr=Ge<$e-1?p[Ge+1]*be:Q.length,gr=T(Q,Mt,Sr,be,!1),gr===gr.next&&(gr.steiner=!0),Te.push(we(gr));for(Te.sort(K),Ge=0;Ge<Te.length;Ge++)B=ne(Te[Ge],B),B=W(B,B.next);return B}function K(Q,p){return Q.x-p.x}function ne(Q,p){var B=le(Q,p);if(!B)return p;var be=Ae(B,Q),Te=W(B,B.next);return W(be,be.next),p===B?Te:p}function le(Q,p){var B=p,be=Q.x,Te=Q.y,Ge=-Infinity,$e;do{if(Te<=B.y&&Te>=B.next.y&&B.next.y!==B.y){var Mt=B.x+(Te-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(Mt<=be&&Mt>Ge){if(Ge=Mt,Mt===be){if(Te===B.y)return B;if(Te===B.next.y)return B.next}$e=B.x<B.next.x?B:B.next}}B=B.next}while(B!==p);if(!$e)return null;if(be===Ge)return $e;var Sr=$e,gr=$e.x,sn=$e.y,Cr=Infinity,Br;B=$e;do be>=B.x&&B.x>=gr&&be!==B.x&&Ke(Te<sn?be:Ge,Te,gr,sn,Te<sn?Ge:be,Te,B.x,B.y)&&(Br=Math.abs(Te-B.y)/(be-B.x),ve(B,Q)&&(Br<Cr||Br===Cr&&(B.x>$e.x||B.x===$e.x&&pe($e,B)))&&($e=B,Cr=Br)),B=B.next;while(B!==Sr);return $e}function pe(Q,p){return Oe(Q.prev,Q,p.prev)<0&&Oe(p.next,Q,Q.next)<0}function xe(Q,p,B,be){var Te=Q;do Te.z===null&&(Te.z=nt(Te.x,Te.y,p,B,be)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==Q);Te.prevZ.nextZ=null,Te.prevZ=null,it(Te)}function it(Q){var p,B,be,Te,Ge,$e,Mt,Sr,gr=1;do{for(B=Q,Q=null,Ge=null,$e=0;B;){for($e++,be=B,Mt=0,p=0;p<gr&&(Mt++,be=be.nextZ,!!be);p++);for(Sr=gr;Mt>0||Sr>0&&be;)Mt!==0&&(Sr===0||!be||B.z<=be.z)?(Te=B,B=B.nextZ,Mt--):(Te=be,be=be.nextZ,Sr--),Ge?Ge.nextZ=Te:Q=Te,Te.prevZ=Ge,Ge=Te;B=be}Ge.nextZ=null,gr*=2}while($e>1);return Q}function nt(Q,p,B,be,Te){return Q=32767*(Q-B)*Te,p=32767*(p-be)*Te,Q=(Q|Q<<8)&16711935,Q=(Q|Q<<4)&252645135,Q=(Q|Q<<2)&858993459,Q=(Q|Q<<1)&1431655765,p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,Q|p<<1}function we(Q){var p=Q,B=Q;do(p.x<B.x||p.x===B.x&&p.y<B.y)&&(B=p),p=p.next;while(p!==Q);return B}function Ke(Q,p,B,be,Te,Ge,$e,Mt){return(Te-$e)*(p-Mt)-(Q-$e)*(Ge-Mt)>=0&&(Q-$e)*(be-Mt)-(B-$e)*(p-Mt)>=0&&(B-$e)*(Ge-Mt)-(Te-$e)*(be-Mt)>=0}function ke(Q,p){return Q.next.i!==p.i&&Q.prev.i!==p.i&&!Pe(Q,p)&&(ve(Q,p)&&ve(p,Q)&&Be(Q,p)&&(Oe(Q.prev,Q,p.prev)||Oe(Q,p.prev,p))||Re(Q,p)&&Oe(Q.prev,Q,Q.next)>0&&Oe(p.prev,p,p.next)>0)}function Oe(Q,p,B){return(p.y-Q.y)*(B.x-p.x)-(p.x-Q.x)*(B.y-p.y)}function Re(Q,p){return Q.x===p.x&&Q.y===p.y}function Je(Q,p,B,be){var Te=at(Oe(Q,p,B)),Ge=at(Oe(Q,p,be)),$e=at(Oe(B,be,Q)),Mt=at(Oe(B,be,p));return!!(Te!==Ge&&$e!==Mt||Te===0&&O(Q,B,p)||Ge===0&&O(Q,be,p)||$e===0&&O(B,Q,be)||Mt===0&&O(B,p,be))}function O(Q,p,B){return p.x<=Math.max(Q.x,B.x)&&p.x>=Math.min(Q.x,B.x)&&p.y<=Math.max(Q.y,B.y)&&p.y>=Math.min(Q.y,B.y)}function at(Q){return Q>0?1:Q<0?-1:0}function Pe(Q,p){var B=Q;do{if(B.i!==Q.i&&B.next.i!==Q.i&&B.i!==p.i&&B.next.i!==p.i&&Je(B,B.next,Q,p))return!0;B=B.next}while(B!==Q);return!1}function ve(Q,p){return Oe(Q.prev,Q,Q.next)<0?Oe(Q,p,Q.next)>=0&&Oe(Q,Q.prev,p)>=0:Oe(Q,p,Q.prev)<0||Oe(Q,Q.next,p)<0}function Be(Q,p){var B=Q,be=!1,Te=(Q.x+p.x)/2,Ge=(Q.y+p.y)/2;do B.y>Ge!=B.next.y>Ge&&B.next.y!==B.y&&Te<(B.next.x-B.x)*(Ge-B.y)/(B.next.y-B.y)+B.x&&(be=!be),B=B.next;while(B!==Q);return be}function Ae(Q,p){var B=new St(Q.i,Q.x,Q.y),be=new St(p.i,p.x,p.y),Te=Q.next,Ge=p.prev;return Q.next=p,p.prev=Q,B.next=Te,Te.prev=B,be.next=B,B.prev=be,Ge.next=be,be.prev=Ge,be}function ct(Q,p,B,be){var Te=new St(Q,p,B);return be?(Te.next=be.next,Te.prev=be,be.next.prev=Te,be.next=Te):(Te.prev=Te,Te.next=Te),Te}function ut(Q){Q.next.prev=Q.prev,Q.prev.next=Q.next,Q.prevZ&&(Q.prevZ.nextZ=Q.nextZ),Q.nextZ&&(Q.nextZ.prevZ=Q.prevZ)}function St(Q,p,B){this.i=Q,this.x=p,this.y=B,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}I.deviation=function(Q,p,B,be){var Te=p&&p.length,Ge=Te?p[0]*B:Q.length,$e=Math.abs(Tt(Q,0,Ge,B));if(Te)for(var Mt=0,Sr=p.length;Mt<Sr;Mt++){var gr=p[Mt]*B,sn=Mt<Sr-1?p[Mt+1]*B:Q.length;$e-=Math.abs(Tt(Q,gr,sn,B))}var Cr=0;for(Mt=0;Mt<be.length;Mt+=3){var Br=be[Mt]*B,Zr=be[Mt+1]*B,kr=be[Mt+2]*B;Cr+=Math.abs((Q[Br]-Q[kr])*(Q[Zr+1]-Q[Br+1])-(Q[Br]-Q[Zr])*(Q[kr+1]-Q[Br+1]))}return $e===0&&Cr===0?0:Math.abs((Cr-$e)/$e)};function Tt(Q,p,B,be){for(var Te=0,Ge=p,$e=B-be;Ge<B;Ge+=be)Te+=(Q[$e]-Q[Ge])*(Q[Ge+1]+Q[$e+1]),$e=Ge;return Te}I.flatten=function(Q){for(var p=Q[0][0].length,B={vertices:[],holes:[],dimensions:p},be=0,Te=0;Te<Q.length;Te++){for(var Ge=0;Ge<Q[Te].length;Ge++)for(var $e=0;$e<p;$e++)B.vertices.push(Q[Te][Ge][$e]);Te>0&&(be+=Q[Te-1].length,B.holes.push(be))}return B}},67709:function(et){function I(W){var A=W.target||W.srcElement;A.__resizeRAF__&&cancelAnimationFrame(A.__resizeRAF__),A.__resizeRAF__=requestAnimationFrame(function(){var $=A.__resizeTrigger__,k=$&&$.__resizeListeners__;k&&k.forEach(function(L){L.call($,W)})})}var T=function(A,$){var k=this,L=k.document,U,re=L.attachEvent;typeof navigator!="undefined"&&(U=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function K(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",I)}if(!A.__resizeListeners__)if(A.__resizeListeners__=[],re)A.__resizeTrigger__=A,A.attachEvent("onresize",I);else{getComputedStyle(A).position==="static"&&(A.style.position="relative");var ne=A.__resizeTrigger__=L.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=A,ne.onload=K,ne.type="text/html",U&&A.appendChild(ne),ne.data="about:blank",U||A.appendChild(ne)}A.__resizeListeners__.push($)};et.exports=typeof window=="undefined"?T:T.bind(window),et.exports.unbind=function(W,A){var $=document.attachEvent,k=W.__resizeListeners__||[];if(A){var L=k.indexOf(A);L!==-1&&k.splice(L,1)}else k=W.__resizeListeners__=[];if(!k.length){if($)W.detachEvent("onresize",I);else if(W.__resizeTrigger__){var U=W.__resizeTrigger__.contentDocument,re=U&&U.defaultView;re&&(re.removeEventListener("resize",I),delete re.__resizeTrigger__),W.__resizeTrigger__=!W.removeChild(W.__resizeTrigger__)}delete W.__resizeListeners__}}},26729:function(et){"use strict";var I=Object.prototype.hasOwnProperty,T="~";function W(){}Object.create&&(W.prototype=Object.create(null),new W().__proto__||(T=!1));function A(U,re,K){this.fn=U,this.context=re,this.once=K||!1}function $(U,re,K,ne,le){if(typeof K!="function")throw new TypeError("The listener must be a function");var pe=new A(K,ne||U,le),xe=T?T+re:re;return U._events[xe]?U._events[xe].fn?U._events[xe]=[U._events[xe],pe]:U._events[xe].push(pe):(U._events[xe]=pe,U._eventsCount++),U}function k(U,re){--U._eventsCount==0?U._events=new W:delete U._events[re]}function L(){this._events=new W,this._eventsCount=0}L.prototype.eventNames=function(){var re=[],K,ne;if(this._eventsCount===0)return re;for(ne in K=this._events)I.call(K,ne)&&re.push(T?ne.slice(1):ne);return Object.getOwnPropertySymbols?re.concat(Object.getOwnPropertySymbols(K)):re},L.prototype.listeners=function(re){var K=T?T+re:re,ne=this._events[K];if(!ne)return[];if(ne.fn)return[ne.fn];for(var le=0,pe=ne.length,xe=new Array(pe);le<pe;le++)xe[le]=ne[le].fn;return xe},L.prototype.listenerCount=function(re){var K=T?T+re:re,ne=this._events[K];return ne?ne.fn?1:ne.length:0},L.prototype.emit=function(re,K,ne,le,pe,xe){var it=T?T+re:re;if(!this._events[it])return!1;var nt=this._events[it],we=arguments.length,Ke,ke;if(nt.fn){switch(nt.once&&this.removeListener(re,nt.fn,void 0,!0),we){case 1:return nt.fn.call(nt.context),!0;case 2:return nt.fn.call(nt.context,K),!0;case 3:return nt.fn.call(nt.context,K,ne),!0;case 4:return nt.fn.call(nt.context,K,ne,le),!0;case 5:return nt.fn.call(nt.context,K,ne,le,pe),!0;case 6:return nt.fn.call(nt.context,K,ne,le,pe,xe),!0}for(ke=1,Ke=new Array(we-1);ke<we;ke++)Ke[ke-1]=arguments[ke];nt.fn.apply(nt.context,Ke)}else{var Oe=nt.length,Re;for(ke=0;ke<Oe;ke++)switch(nt[ke].once&&this.removeListener(re,nt[ke].fn,void 0,!0),we){case 1:nt[ke].fn.call(nt[ke].context);break;case 2:nt[ke].fn.call(nt[ke].context,K);break;case 3:nt[ke].fn.call(nt[ke].context,K,ne);break;case 4:nt[ke].fn.call(nt[ke].context,K,ne,le);break;default:if(!Ke)for(Re=1,Ke=new Array(we-1);Re<we;Re++)Ke[Re-1]=arguments[Re];nt[ke].fn.apply(nt[ke].context,Ke)}}return!0},L.prototype.on=function(re,K,ne){return $(this,re,K,ne,!1)},L.prototype.once=function(re,K,ne){return $(this,re,K,ne,!0)},L.prototype.removeListener=function(re,K,ne,le){var pe=T?T+re:re;if(!this._events[pe])return this;if(!K)return k(this,pe),this;var xe=this._events[pe];if(xe.fn)xe.fn===K&&(!le||xe.once)&&(!ne||xe.context===ne)&&k(this,pe);else{for(var it=0,nt=[],we=xe.length;it<we;it++)(xe[it].fn!==K||le&&!xe[it].once||ne&&xe[it].context!==ne)&&nt.push(xe[it]);nt.length?this._events[pe]=nt.length===1?nt[0]:nt:k(this,pe)}return this},L.prototype.removeAllListeners=function(re){var K;return re?(K=T?T+re:re,this._events[K]&&k(this,K)):(this._events=new W,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=T,L.EventEmitter=L,et.exports=L},7375:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0});var T=Symbol.for("INJECTION");function W(U,re,K,ne){function le(){return ne&&!Reflect.hasMetadata(T,this,re)&&Reflect.defineMetadata(T,K(),this,re),Reflect.hasMetadata(T,this,re)?Reflect.getMetadata(T,this,re):K()}function pe(xe){Reflect.defineMetadata(T,xe,this,re)}Object.defineProperty(U,re,{configurable:!0,enumerable:!0,get:le,set:pe})}function A(U,re){return function(K){return function(ne,le){var pe=function(){return U.get(K)};W(ne,le,pe,re)}}}I.makePropertyInjectDecorator=A;function $(U,re){return function(K,ne){return function(le,pe){var xe=function(){return U.getNamed(K,ne)};W(le,pe,xe,re)}}}I.makePropertyInjectNamedDecorator=$;function k(U,re){return function(K,ne,le){return function(pe,xe){var it=function(){return U.getTagged(K,ne,le)};W(pe,xe,it,re)}}}I.makePropertyInjectTaggedDecorator=k;function L(U,re){return function(K){return function(ne,le){var pe=function(){return U.getAll(K)};W(ne,le,pe,re)}}}I.makePropertyMultiInjectDecorator=L},84879:function(et,I,T){"use strict";var W;W={value:!0};var A=T(7375);function $(k,L){L===void 0&&(L=!0);var U=A.makePropertyInjectDecorator(k,L),re=A.makePropertyInjectNamedDecorator(k,L),K=A.makePropertyInjectTaggedDecorator(k,L),ne=A.makePropertyMultiInjectDecorator(k,L);return{lazyInject:U,lazyInjectNamed:re,lazyInjectTagged:K,lazyMultiInject:ne}}I.Z=$},99934:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.tagProperty=I.tagParameter=I.decorate=void 0;var W=T(16674),A=T(6867);function $(ne,le,pe,xe){var it=A.TAGGED;L(it,ne,le,xe,pe)}I.tagParameter=$;function k(ne,le,pe){var xe=A.TAGGED_PROP;L(xe,ne.constructor,le,pe)}I.tagProperty=k;function L(ne,le,pe,xe,it){var nt={},we=typeof it=="number",Ke=it!==void 0&&we?it.toString():pe;if(we&&pe!==void 0)throw new Error(W.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,le)&&(nt=Reflect.getMetadata(ne,le));var ke=nt[Ke];if(!Array.isArray(ke))ke=[];else for(var Oe=0,Re=ke;Oe<Re.length;Oe++){var Je=Re[Oe];if(Je.key===xe.key)throw new Error(W.DUPLICATED_METADATA+" "+Je.key.toString())}ke.push(xe),nt[Ke]=ke,Reflect.defineMetadata(ne,nt,le)}function U(ne,le){Reflect.decorate(ne,le)}function re(ne,le){return function(pe,xe){le(pe,xe,ne)}}function K(ne,le,pe){typeof pe=="number"?U([re(pe,ne)],le):typeof pe=="string"?Reflect.decorate([ne],le,pe):U([ne],le)}I.decorate=K},5744:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.inject=I.LazyServiceIdentifer=void 0;var W=T(16674),A=T(6867),$=T(47738),k=T(99934),L=function(){function re(K){this._cb=K}return re.prototype.unwrap=function(){return this._cb()},re}();I.LazyServiceIdentifer=L;function U(re){return function(K,ne,le){if(re===void 0)throw new Error(W.UNDEFINED_INJECT_ANNOTATION(K.name));var pe=new $.Metadata(A.INJECT_TAG,re);typeof le=="number"?k.tagParameter(K,ne,le,pe):k.tagProperty(K,ne,pe)}}I.inject=U},64315:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.injectable=void 0;var W=T(16674),A=T(6867);function $(){return function(k){if(Reflect.hasOwnMetadata(A.PARAM_TYPES,k))throw new Error(W.DUPLICATED_INJECTABLE_DECORATOR);var L=Reflect.getMetadata(A.DESIGN_PARAM_TYPES,k)||[];return Reflect.defineMetadata(A.PARAM_TYPES,L,k),k}}I.injectable=$},71693:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.multiInject=void 0;var W=T(6867),A=T(47738),$=T(99934);function k(L){return function(U,re,K){var ne=new A.Metadata(W.MULTI_INJECT_TAG,L);typeof K=="number"?$.tagParameter(U,re,K,ne):$.tagProperty(U,re,ne)}}I.multiInject=k},38085:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.named=void 0;var W=T(6867),A=T(47738),$=T(99934);function k(L){return function(U,re,K){var ne=new A.Metadata(W.NAMED_TAG,L);typeof K=="number"?$.tagParameter(U,re,K,ne):$.tagProperty(U,re,ne)}}I.named=k},6515:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.optional=void 0;var W=T(6867),A=T(47738),$=T(99934);function k(){return function(L,U,re){var K=new A.Metadata(W.OPTIONAL_TAG,!0);typeof re=="number"?$.tagParameter(L,U,re,K):$.tagProperty(L,U,K)}}I.optional=k},7014:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.postConstruct=void 0;var W=T(16674),A=T(6867),$=T(47738);function k(){return function(L,U,re){var K=new $.Metadata(A.POST_CONSTRUCT,U);if(Reflect.hasOwnMetadata(A.POST_CONSTRUCT,L.constructor))throw new Error(W.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(A.POST_CONSTRUCT,K,L.constructor)}}I.postConstruct=k},32052:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.tagged=void 0;var W=T(47738),A=T(99934);function $(k,L){return function(U,re,K){var ne=new W.Metadata(k,L);typeof K=="number"?A.tagParameter(U,re,K,ne):A.tagProperty(U,re,ne)}}I.tagged=$},55638:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.targetName=void 0;var W=T(6867),A=T(47738),$=T(99934);function k(L){return function(U,re,K){var ne=new A.Metadata(W.NAME_TAG,L);$.tagParameter(U,re,K,ne)}}I.targetName=k},86757:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.unmanaged=void 0;var W=T(6867),A=T(47738),$=T(99934);function k(){return function(L,U,re){var K=new A.Metadata(W.UNMANAGED_TAG,!0);$.tagParameter(L,U,re,K)}}I.unmanaged=k},44290:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Binding=void 0;var W=T(28421),A=T(37791),$=function(){function k(L,U){this.id=A.id(),this.activated=!1,this.serviceIdentifier=L,this.scope=U,this.type=W.BindingTypeEnum.Invalid,this.constraint=function(re){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return k.prototype.clone=function(){var L=new k(this.serviceIdentifier,this.scope);return L.activated=L.scope===W.BindingScopeEnum.Singleton?this.activated:!1,L.implementationType=this.implementationType,L.dynamicValue=this.dynamicValue,L.scope=this.scope,L.type=this.type,L.factory=this.factory,L.provider=this.provider,L.constraint=this.constraint,L.onActivation=this.onActivation,L.cache=this.cache,L},k}();I.Binding=$},23184:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingCount=void 0;var T={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};I.BindingCount=T},16674:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.STACK_OVERFLOW=I.CIRCULAR_DEPENDENCY_IN_FACTORY=I.POST_CONSTRUCT_ERROR=I.MULTIPLE_POST_CONSTRUCT_METHODS=I.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=I.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=I.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=I.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=I.ARGUMENTS_LENGTH_MISMATCH=I.INVALID_DECORATOR_OPERATION=I.INVALID_TO_SELF_VALUE=I.INVALID_FUNCTION_BINDING=I.INVALID_MIDDLEWARE_RETURN=I.NO_MORE_SNAPSHOTS_AVAILABLE=I.INVALID_BINDING_TYPE=I.NOT_IMPLEMENTED=I.CIRCULAR_DEPENDENCY=I.UNDEFINED_INJECT_ANNOTATION=I.MISSING_INJECT_ANNOTATION=I.MISSING_INJECTABLE_ANNOTATION=I.NOT_REGISTERED=I.CANNOT_UNBIND=I.AMBIGUOUS_MATCH=I.KEY_NOT_FOUND=I.NULL_ARGUMENT=I.DUPLICATED_METADATA=I.DUPLICATED_INJECTABLE_DECORATOR=void 0,I.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",I.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",I.NULL_ARGUMENT="NULL argument",I.KEY_NOT_FOUND="Key Not Found",I.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",I.CANNOT_UNBIND="Could not unbind serviceIdentifier:",I.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",I.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",I.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var T=function(k){return"@inject called with undefined this could mean that the class "+k+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};I.UNDEFINED_INJECT_ANNOTATION=T,I.CIRCULAR_DEPENDENCY="Circular dependency found:",I.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",I.INVALID_BINDING_TYPE="Invalid binding type:",I.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",I.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",I.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",I.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",I.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var W=function(){for(var k=[],L=0;L<arguments.length;L++)k[L]=arguments[L];return"The number of constructor arguments in the derived class "+(k[0]+" must be >= than the number of constructor arguments of its base class.")};I.ARGUMENTS_LENGTH_MISMATCH=W,I.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",I.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",I.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",I.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",I.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var A=function(){for(var k=[],L=0;L<arguments.length;L++)k[L]=arguments[L];return"@postConstruct error in class "+k[0]+": "+k[1]};I.POST_CONSTRUCT_ERROR=A;var $=function(){for(var k=[],L=0;L<arguments.length;L++)k[L]=arguments[L];return"It looks like there is a circular dependency "+("in one of the '"+k[0]+"' bindings. Please investigate bindings with")+("service identifier '"+k[1]+"'.")};I.CIRCULAR_DEPENDENCY_IN_FACTORY=$,I.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.TargetTypeEnum=I.BindingTypeEnum=I.BindingScopeEnum=void 0;var T={Request:"Request",Singleton:"Singleton",Transient:"Transient"};I.BindingScopeEnum=T;var W={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};I.BindingTypeEnum=W;var A={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};I.TargetTypeEnum=A},6867:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.NON_CUSTOM_TAG_KEYS=I.POST_CONSTRUCT=I.DESIGN_PARAM_TYPES=I.PARAM_TYPES=I.TAGGED_PROP=I.TAGGED=I.MULTI_INJECT_TAG=I.INJECT_TAG=I.OPTIONAL_TAG=I.UNMANAGED_TAG=I.NAME_TAG=I.NAMED_TAG=void 0,I.NAMED_TAG="named",I.NAME_TAG="name",I.UNMANAGED_TAG="unmanaged",I.OPTIONAL_TAG="optional",I.INJECT_TAG="inject",I.MULTI_INJECT_TAG="multi_inject",I.TAGGED="inversify:tagged",I.TAGGED_PROP="inversify:tagged_props",I.PARAM_TYPES="inversify:paramtypes",I.DESIGN_PARAM_TYPES="design:paramtypes",I.POST_CONSTRUCT="post_construct";function T(){return[I.INJECT_TAG,I.MULTI_INJECT_TAG,I.NAME_TAG,I.UNMANAGED_TAG,I.NAMED_TAG,I.OPTIONAL_TAG]}I.NON_CUSTOM_TAG_KEYS=T()},51389:function(et,I,T){"use strict";var W=this&&this.__awaiter||function(ke,Oe,Re,Je){function O(at){return at instanceof Re?at:new Re(function(Pe){Pe(at)})}return new(Re||(Re=Promise))(function(at,Pe){function ve(ct){try{Ae(Je.next(ct))}catch(ut){Pe(ut)}}function Be(ct){try{Ae(Je.throw(ct))}catch(ut){Pe(ut)}}function Ae(ct){ct.done?at(ct.value):O(ct.value).then(ve,Be)}Ae((Je=Je.apply(ke,Oe||[])).next())})},A=this&&this.__generator||function(ke,Oe){var Re={label:0,sent:function(){if(at[0]&1)throw at[1];return at[1]},trys:[],ops:[]},Je,O,at,Pe;return Pe={next:ve(0),throw:ve(1),return:ve(2)},typeof Symbol=="function"&&(Pe[Symbol.iterator]=function(){return this}),Pe;function ve(Ae){return function(ct){return Be([Ae,ct])}}function Be(Ae){if(Je)throw new TypeError("Generator is already executing.");for(;Re;)try{if(Je=1,O&&(at=Ae[0]&2?O.return:Ae[0]?O.throw||((at=O.return)&&at.call(O),0):O.next)&&!(at=at.call(O,Ae[1])).done)return at;switch(O=0,at&&(Ae=[Ae[0]&2,at.value]),Ae[0]){case 0:case 1:at=Ae;break;case 4:return Re.label++,{value:Ae[1],done:!1};case 5:Re.label++,O=Ae[1],Ae=[0];continue;case 7:Ae=Re.ops.pop(),Re.trys.pop();continue;default:if(at=Re.trys,!(at=at.length>0&&at[at.length-1])&&(Ae[0]===6||Ae[0]===2)){Re=0;continue}if(Ae[0]===3&&(!at||Ae[1]>at[0]&&Ae[1]<at[3])){Re.label=Ae[1];break}if(Ae[0]===6&&Re.label<at[1]){Re.label=at[1],at=Ae;break}if(at&&Re.label<at[2]){Re.label=at[2],Re.ops.push(Ae);break}at[2]&&Re.ops.pop(),Re.trys.pop();continue}Ae=Oe.call(ke,Re)}catch(ct){Ae=[6,ct],O=0}finally{Je=at=0}if(Ae[0]&5)throw Ae[1];return{value:Ae[0]?Ae[1]:void 0,done:!0}}},$=this&&this.__spreadArray||function(ke,Oe){for(var Re=0,Je=Oe.length,O=ke.length;Re<Je;Re++,O++)ke[O]=Oe[Re];return ke};Object.defineProperty(I,"__esModule",{value:!0}),I.Container=void 0;var k=T(44290),L=T(16674),U=T(28421),re=T(6867),K=T(51377),ne=T(86311),le=T(31927),pe=T(51860),xe=T(37791),it=T(55800),nt=T(85700),we=T(80175),Ke=function(){function ke(Oe){this._appliedMiddleware=[];var Re=Oe||{};if(typeof Re!="object")throw new Error(""+L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Re.defaultScope===void 0)Re.defaultScope=U.BindingScopeEnum.Transient;else if(Re.defaultScope!==U.BindingScopeEnum.Singleton&&Re.defaultScope!==U.BindingScopeEnum.Transient&&Re.defaultScope!==U.BindingScopeEnum.Request)throw new Error(""+L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Re.autoBindInjectable===void 0)Re.autoBindInjectable=!1;else if(typeof Re.autoBindInjectable!="boolean")throw new Error(""+L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Re.skipBaseClassChecks===void 0)Re.skipBaseClassChecks=!1;else if(typeof Re.skipBaseClassChecks!="boolean")throw new Error(""+L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Re.autoBindInjectable,defaultScope:Re.defaultScope,skipBaseClassChecks:Re.skipBaseClassChecks},this.id=xe.id(),this._bindingDictionary=new we.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new K.MetadataReader}return ke.merge=function(Oe,Re){for(var Je=[],O=2;O<arguments.length;O++)Je[O-2]=arguments[O];var at=new ke,Pe=$([Oe,Re],Je).map(function(Ae){return ne.getBindingDictionary(Ae)}),ve=ne.getBindingDictionary(at);function Be(Ae,ct){Ae.traverse(function(ut,St){St.forEach(function(Tt){ct.add(Tt.serviceIdentifier,Tt.clone())})})}return Pe.forEach(function(Ae){Be(Ae,ve)}),at},ke.prototype.load=function(){for(var Oe=[],Re=0;Re<arguments.length;Re++)Oe[Re]=arguments[Re];for(var Je=this._getContainerModuleHelpersFactory(),O=0,at=Oe;O<at.length;O++){var Pe=at[O],ve=Je(Pe.id);Pe.registry(ve.bindFunction,ve.unbindFunction,ve.isboundFunction,ve.rebindFunction)}},ke.prototype.loadAsync=function(){for(var Oe=[],Re=0;Re<arguments.length;Re++)Oe[Re]=arguments[Re];return W(this,void 0,void 0,function(){var Je,O,at,Pe,ve;return A(this,function(Be){switch(Be.label){case 0:Je=this._getContainerModuleHelpersFactory(),O=0,at=Oe,Be.label=1;case 1:return O<at.length?(Pe=at[O],ve=Je(Pe.id),[4,Pe.registry(ve.bindFunction,ve.unbindFunction,ve.isboundFunction,ve.rebindFunction)]):[3,4];case 2:Be.sent(),Be.label=3;case 3:return O++,[3,1];case 4:return[2]}})})},ke.prototype.unload=function(){for(var Oe=this,Re=[],Je=0;Je<arguments.length;Je++)Re[Je]=arguments[Je];var O=function(at){return function(Pe){return Pe.moduleId===at}};Re.forEach(function(at){var Pe=O(at.id);Oe._bindingDictionary.removeByCondition(Pe)})},ke.prototype.bind=function(Oe){var Re=this.options.defaultScope||U.BindingScopeEnum.Transient,Je=new k.Binding(Oe,Re);return this._bindingDictionary.add(Oe,Je),new pe.BindingToSyntax(Je)},ke.prototype.rebind=function(Oe){return this.unbind(Oe),this.bind(Oe)},ke.prototype.unbind=function(Oe){try{this._bindingDictionary.remove(Oe)}catch(Re){throw new Error(L.CANNOT_UNBIND+" "+it.getServiceIdentifierAsString(Oe))}},ke.prototype.unbindAll=function(){this._bindingDictionary=new we.Lookup},ke.prototype.isBound=function(Oe){var Re=this._bindingDictionary.hasKey(Oe);return!Re&&this.parent&&(Re=this.parent.isBound(Oe)),Re},ke.prototype.isBoundNamed=function(Oe,Re){return this.isBoundTagged(Oe,re.NAMED_TAG,Re)},ke.prototype.isBoundTagged=function(Oe,Re,Je){var O=!1;if(this._bindingDictionary.hasKey(Oe)){var at=this._bindingDictionary.get(Oe),Pe=ne.createMockRequest(this,Oe,Re,Je);O=at.some(function(ve){return ve.constraint(Pe)})}return!O&&this.parent&&(O=this.parent.isBoundTagged(Oe,Re,Je)),O},ke.prototype.snapshot=function(){this._snapshots.push(nt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},ke.prototype.restore=function(){var Oe=this._snapshots.pop();if(Oe===void 0)throw new Error(L.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Oe.bindings,this._middleware=Oe.middleware},ke.prototype.createChild=function(Oe){var Re=new ke(Oe||this.options);return Re.parent=this,Re},ke.prototype.applyMiddleware=function(){for(var Oe=[],Re=0;Re<arguments.length;Re++)Oe[Re]=arguments[Re];this._appliedMiddleware=this._appliedMiddleware.concat(Oe);var Je=this._middleware?this._middleware:this._planAndResolve();this._middleware=Oe.reduce(function(O,at){return at(O)},Je)},ke.prototype.applyCustomMetadataReader=function(Oe){this._metadataReader=Oe},ke.prototype.get=function(Oe){return this._get(!1,!1,U.TargetTypeEnum.Variable,Oe)},ke.prototype.getTagged=function(Oe,Re,Je){return this._get(!1,!1,U.TargetTypeEnum.Variable,Oe,Re,Je)},ke.prototype.getNamed=function(Oe,Re){return this.getTagged(Oe,re.NAMED_TAG,Re)},ke.prototype.getAll=function(Oe){return this._get(!0,!0,U.TargetTypeEnum.Variable,Oe)},ke.prototype.getAllTagged=function(Oe,Re,Je){return this._get(!1,!0,U.TargetTypeEnum.Variable,Oe,Re,Je)},ke.prototype.getAllNamed=function(Oe,Re){return this.getAllTagged(Oe,re.NAMED_TAG,Re)},ke.prototype.resolve=function(Oe){var Re=this.createChild();return Re.bind(Oe).toSelf(),this._appliedMiddleware.forEach(function(Je){Re.applyMiddleware(Je)}),Re.get(Oe)},ke.prototype._getContainerModuleHelpersFactory=function(){var Oe=this,Re=function(ve,Be){ve._binding.moduleId=Be},Je=function(ve){return function(Be){var Ae=Oe.bind.bind(Oe),ct=Ae(Be);return Re(ct,ve),ct}},O=function(ve){return function(Be){var Ae=Oe.unbind.bind(Oe);Ae(Be)}},at=function(ve){return function(Be){var Ae=Oe.isBound.bind(Oe);return Ae(Be)}},Pe=function(ve){return function(Be){var Ae=Oe.rebind.bind(Oe),ct=Ae(Be);return Re(ct,ve),ct}};return function(ve){return{bindFunction:Je(ve),isboundFunction:at(ve),rebindFunction:Pe(ve),unbindFunction:O(ve)}}},ke.prototype._get=function(Oe,Re,Je,O,at,Pe){var ve=null,Be={avoidConstraints:Oe,contextInterceptor:function(Ae){return Ae},isMultiInject:Re,key:at,serviceIdentifier:O,targetType:Je,value:Pe};if(this._middleware){if(ve=this._middleware(Be),ve==null)throw new Error(L.INVALID_MIDDLEWARE_RETURN)}else ve=this._planAndResolve()(Be);return ve},ke.prototype._planAndResolve=function(){var Oe=this;return function(Re){var Je=ne.plan(Oe._metadataReader,Oe,Re.isMultiInject,Re.targetType,Re.serviceIdentifier,Re.key,Re.value,Re.avoidConstraints);Je=Re.contextInterceptor(Je);var O=le.resolve(Je);return O}},ke}();I.Container=Ke},33244:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.AsyncContainerModule=I.ContainerModule=void 0;var W=T(37791),A=function(){function k(L){this.id=W.id(),this.registry=L}return k}();I.ContainerModule=A;var $=function(){function k(L){this.id=W.id(),this.registry=L}return k}();I.AsyncContainerModule=$},85700:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ContainerSnapshot=void 0;var T=function(){function W(){}return W.of=function(A,$){var k=new W;return k.bindings=A,k.middleware=$,k},W}();I.ContainerSnapshot=T},80175:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Lookup=void 0;var W=T(16674),A=function(){function $(){this._map=new Map}return $.prototype.getMap=function(){return this._map},$.prototype.add=function(k,L){if(k==null)throw new Error(W.NULL_ARGUMENT);if(L==null)throw new Error(W.NULL_ARGUMENT);var U=this._map.get(k);U!==void 0?(U.push(L),this._map.set(k,U)):this._map.set(k,[L])},$.prototype.get=function(k){if(k==null)throw new Error(W.NULL_ARGUMENT);var L=this._map.get(k);if(L!==void 0)return L;throw new Error(W.KEY_NOT_FOUND)},$.prototype.remove=function(k){if(k==null)throw new Error(W.NULL_ARGUMENT);if(!this._map.delete(k))throw new Error(W.KEY_NOT_FOUND)},$.prototype.removeByCondition=function(k){var L=this;this._map.forEach(function(U,re){var K=U.filter(function(ne){return!k(ne)});K.length>0?L._map.set(re,K):L._map.delete(re)})},$.prototype.hasKey=function(k){if(k==null)throw new Error(W.NULL_ARGUMENT);return this._map.has(k)},$.prototype.clone=function(){var k=new $;return this._map.forEach(function(L,U){L.forEach(function(re){return k.add(U,re.clone())})}),k},$.prototype.traverse=function(k){this._map.forEach(function(L,U){k(U,L)})},$}();I.Lookup=A},86700:function(et,I,T){"use strict";var W;W={value:!0},W=W=W=W=W=W=I.GW=W=W=I.zY=W=W=W=W=W=I.f3=W=W=I.b2=W=W=W=W=W=I.W2=W=void 0;var A=T(6867);W=A;var $=T(51389);Object.defineProperty(I,"W2",{enumerable:!0,get:function(){return $.Container}});var k=T(28421);W={enumerable:!0,get:function(){return k.BindingScopeEnum}},W={enumerable:!0,get:function(){return k.BindingTypeEnum}},W={enumerable:!0,get:function(){return k.TargetTypeEnum}};var L=T(33244);W={enumerable:!0,get:function(){return L.AsyncContainerModule}},W={enumerable:!0,get:function(){return L.ContainerModule}};var U=T(64315);Object.defineProperty(I,"b2",{enumerable:!0,get:function(){return U.injectable}});var re=T(32052);W={enumerable:!0,get:function(){return re.tagged}};var K=T(38085);W={enumerable:!0,get:function(){return K.named}};var ne=T(5744);Object.defineProperty(I,"f3",{enumerable:!0,get:function(){return ne.inject}}),W={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var le=T(6515);W={enumerable:!0,get:function(){return le.optional}};var pe=T(86757);W={enumerable:!0,get:function(){return pe.unmanaged}};var xe=T(71693);W={enumerable:!0,get:function(){return xe.multiInject}};var it=T(55638);W={enumerable:!0,get:function(){return it.targetName}};var nt=T(7014);Object.defineProperty(I,"zY",{enumerable:!0,get:function(){return nt.postConstruct}});var we=T(51377);W={enumerable:!0,get:function(){return we.MetadataReader}};var Ke=T(37791);W={enumerable:!0,get:function(){return Ke.id}};var ke=T(99934);Object.defineProperty(I,"GW",{enumerable:!0,get:function(){return ke.decorate}});var Oe=T(80758);W={enumerable:!0,get:function(){return Oe.traverseAncerstors}},W={enumerable:!0,get:function(){return Oe.taggedConstraint}},W={enumerable:!0,get:function(){return Oe.namedConstraint}},W={enumerable:!0,get:function(){return Oe.typeConstraint}};var Re=T(55800);W={enumerable:!0,get:function(){return Re.getServiceIdentifierAsString}};var Je=T(70600);W={enumerable:!0,get:function(){return Je.multiBindToService}}},95228:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Context=void 0;var W=T(37791),A=function(){function $(k){this.id=W.id(),this.container=k}return $.prototype.addPlan=function(k){this.plan=k},$.prototype.setCurrentRequest=function(k){this.currentRequest=k},$}();I.Context=A},47738:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Metadata=void 0;var W=T(6867),A=function(){function $(k,L){this.key=k,this.value=L}return $.prototype.toString=function(){return this.key===W.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},$}();I.Metadata=A},51377:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.MetadataReader=void 0;var W=T(6867),A=function(){function $(){}return $.prototype.getConstructorMetadata=function(k){var L=Reflect.getMetadata(W.PARAM_TYPES,k),U=Reflect.getMetadata(W.TAGGED,k);return{compilerGeneratedMetadata:L,userGeneratedMetadata:U||{}}},$.prototype.getPropertiesMetadata=function(k){var L=Reflect.getMetadata(W.TAGGED_PROP,k)||[];return L},$}();I.MetadataReader=A},55314:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Plan=void 0;var T=function(){function W(A,$){this.parentContext=A,this.rootRequest=$}return W}();I.Plan=T},86311:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.getBindingDictionary=I.createMockRequest=I.plan=void 0;var W=T(23184),A=T(16674),$=T(28421),k=T(6867),L=T(85265),U=T(55800),re=T(95228),K=T(47738),ne=T(55314),le=T(6e3),pe=T(6748),xe=T(18924);function it(O){return O._bindingDictionary}I.getBindingDictionary=it;function nt(O,at,Pe,ve,Be,Ae){var ct=O?k.MULTI_INJECT_TAG:k.INJECT_TAG,ut=new K.Metadata(ct,Pe),St=new xe.Target(at,ve,Pe,ut);if(Be!==void 0){var Tt=new K.Metadata(Be,Ae);St.metadata.push(Tt)}return St}function we(O,at,Pe,ve,Be){var Ae=Oe(Pe.container,Be.serviceIdentifier),ct=[];return Ae.length===W.BindingCount.NoBindingsAvailable&&Pe.container.options.autoBindInjectable&&typeof Be.serviceIdentifier=="function"&&O.getConstructorMetadata(Be.serviceIdentifier).compilerGeneratedMetadata&&(Pe.container.bind(Be.serviceIdentifier).toSelf(),Ae=Oe(Pe.container,Be.serviceIdentifier)),at?ct=Ae:ct=Ae.filter(function(ut){var St=new pe.Request(ut.serviceIdentifier,Pe,ve,ut,Be);return ut.constraint(St)}),Ke(Be.serviceIdentifier,ct,Be,Pe.container),ct}function Ke(O,at,Pe,ve){switch(at.length){case W.BindingCount.NoBindingsAvailable:if(Pe.isOptional())return at;var Be=U.getServiceIdentifierAsString(O),Ae=A.NOT_REGISTERED;throw Ae+=U.listMetadataForTarget(Be,Pe),Ae+=U.listRegisteredBindingsForServiceIdentifier(ve,Be,Oe),new Error(Ae);case W.BindingCount.OnlyOneBindingAvailable:if(!Pe.isArray())return at;case W.BindingCount.MultipleBindingsAvailable:default:if(Pe.isArray())return at;var Be=U.getServiceIdentifierAsString(O),Ae=A.AMBIGUOUS_MATCH+" "+Be;throw Ae+=U.listRegisteredBindingsForServiceIdentifier(ve,Be,Oe),new Error(Ae)}}function ke(O,at,Pe,ve,Be,Ae){var ct,ut;if(Be===null){ct=we(O,at,ve,null,Ae),ut=new pe.Request(Pe,ve,null,ct,Ae);var St=new ne.Plan(ve,ut);ve.addPlan(St)}else ct=we(O,at,ve,Be,Ae),ut=Be.addChildRequest(Ae.serviceIdentifier,ct,Ae);ct.forEach(function(Tt){var Q=null;if(Ae.isArray())Q=ut.addChildRequest(Tt.serviceIdentifier,Tt,Ae);else{if(Tt.cache)return;Q=ut}if(Tt.type===$.BindingTypeEnum.Instance&&Tt.implementationType!==null){var p=le.getDependencies(O,Tt.implementationType);if(!ve.container.options.skipBaseClassChecks){var B=le.getBaseClassDependencyCount(O,Tt.implementationType);if(p.length<B){var be=A.ARGUMENTS_LENGTH_MISMATCH(le.getFunctionName(Tt.implementationType));throw new Error(be)}}p.forEach(function(Te){ke(O,!1,Te.serviceIdentifier,ve,Q,Te)})}})}function Oe(O,at){var Pe=[],ve=it(O);return ve.hasKey(at)?Pe=ve.get(at):O.parent!==null&&(Pe=Oe(O.parent,at)),Pe}function Re(O,at,Pe,ve,Be,Ae,ct,ut){ut===void 0&&(ut=!1);var St=new re.Context(at),Tt=nt(Pe,ve,Be,"",Ae,ct);try{return ke(O,ut,Be,St,null,Tt),St}catch(Q){throw L.isStackOverflowExeption(Q)&&St.plan&&U.circularDependencyToException(St.plan.rootRequest),Q}}I.plan=Re;function Je(O,at,Pe,ve){var Be=new xe.Target($.TargetTypeEnum.Variable,"",at,new K.Metadata(Pe,ve)),Ae=new re.Context(O),ct=new pe.Request(at,Ae,null,[],Be);return ct}I.createMockRequest=Je},88460:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.QueryableString=void 0;var T=function(){function W(A){this.str=A}return W.prototype.startsWith=function(A){return this.str.indexOf(A)===0},W.prototype.endsWith=function(A){var $="",k=A.split("").reverse().join("");return $=this.str.split("").reverse().join(""),this.startsWith.call({str:$},k)},W.prototype.contains=function(A){return this.str.indexOf(A)!==-1},W.prototype.equals=function(A){return this.str===A},W.prototype.value=function(){return this.str},W}();I.QueryableString=T},6e3:function(et,I,T){"use strict";var W=this&&this.__spreadArray||function(we,Ke){for(var ke=0,Oe=Ke.length,Re=we.length;ke<Oe;ke++,Re++)we[Re]=Ke[ke];return we};Object.defineProperty(I,"__esModule",{value:!0}),I.getFunctionName=I.getBaseClassDependencyCount=I.getDependencies=void 0;var A=T(5744),$=T(16674),k=T(28421),L=T(6867),U=T(55800);Object.defineProperty(I,"getFunctionName",{enumerable:!0,get:function(){return U.getFunctionName}});var re=T(18924);function K(we,Ke){var ke=U.getFunctionName(Ke),Oe=ne(we,ke,Ke,!1);return Oe}I.getDependencies=K;function ne(we,Ke,ke,Oe){var Re=we.getConstructorMetadata(ke),Je=Re.compilerGeneratedMetadata;if(Je===void 0){var O=$.MISSING_INJECTABLE_ANNOTATION+" "+Ke+".";throw new Error(O)}var at=Re.userGeneratedMetadata,Pe=Object.keys(at),ve=ke.length===0&&Pe.length>0,Be=Pe.length>ke.length,Ae=ve||Be?Pe.length:ke.length,ct=pe(Oe,Ke,Je,at,Ae),ut=xe(we,ke),St=W(W([],ct),ut);return St}function le(we,Ke,ke,Oe,Re){var Je=Re[we.toString()]||[],O=nt(Je),at=O.unmanaged!==!0,Pe=Oe[we],ve=O.inject||O.multiInject;if(Pe=ve||Pe,Pe instanceof A.LazyServiceIdentifer&&(Pe=Pe.unwrap()),at){var Be=Pe===Object,Ae=Pe===Function,ct=Pe===void 0,ut=Be||Ae||ct;if(!Ke&&ut){var St=$.MISSING_INJECT_ANNOTATION+" argument "+we+" in class "+ke+".";throw new Error(St)}var Tt=new re.Target(k.TargetTypeEnum.ConstructorArgument,O.targetName,Pe);return Tt.metadata=Je,Tt}return null}function pe(we,Ke,ke,Oe,Re){for(var Je=[],O=0;O<Re;O++){var at=O,Pe=le(at,we,Ke,ke,Oe);Pe!==null&&Je.push(Pe)}return Je}function xe(we,Ke){for(var ke=we.getPropertiesMetadata(Ke),Oe=[],Re=Object.keys(ke),Je=0,O=Re;Je<O.length;Je++){var at=O[Je],Pe=ke[at],ve=nt(ke[at]),Be=ve.targetName||at,Ae=ve.inject||ve.multiInject,ct=new re.Target(k.TargetTypeEnum.ClassProperty,Be,Ae);ct.metadata=Pe,Oe.push(ct)}var ut=Object.getPrototypeOf(Ke.prototype).constructor;if(ut!==Object){var St=xe(we,ut);Oe=W(W([],Oe),St)}return Oe}function it(we,Ke){var ke=Object.getPrototypeOf(Ke.prototype).constructor;if(ke!==Object){var Oe=U.getFunctionName(ke),Re=ne(we,Oe,ke,!0),Je=Re.map(function(Pe){return Pe.metadata.filter(function(ve){return ve.key===L.UNMANAGED_TAG})}),O=[].concat.apply([],Je).length,at=Re.length-O;return at>0?at:it(we,ke)}else return 0}I.getBaseClassDependencyCount=it;function nt(we){var Ke={};return we.forEach(function(ke){Ke[ke.key.toString()]=ke.value}),{inject:Ke[L.INJECT_TAG],multiInject:Ke[L.MULTI_INJECT_TAG],targetName:Ke[L.NAME_TAG],unmanaged:Ke[L.UNMANAGED_TAG]}}},6748:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Request=void 0;var W=T(37791),A=function(){function $(k,L,U,re,K){this.id=W.id(),this.serviceIdentifier=k,this.parentContext=L,this.parentRequest=U,this.target=K,this.childRequests=[],this.bindings=Array.isArray(re)?re:[re],this.requestScope=U===null?new Map:null}return $.prototype.addChildRequest=function(k,L,U){var re=new $(k,this.parentContext,this,L,U);return this.childRequests.push(re),re},$}();I.Request=A},18924:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Target=void 0;var W=T(6867),A=T(37791),$=T(47738),k=T(88460),L=function(){function U(re,K,ne,le){this.id=A.id(),this.type=re,this.serviceIdentifier=ne,this.name=new k.QueryableString(K||""),this.metadata=new Array;var pe=null;typeof le=="string"?pe=new $.Metadata(W.NAMED_TAG,le):le instanceof $.Metadata&&(pe=le),pe!==null&&this.metadata.push(pe)}return U.prototype.hasTag=function(re){for(var K=0,ne=this.metadata;K<ne.length;K++){var le=ne[K];if(le.key===re)return!0}return!1},U.prototype.isArray=function(){return this.hasTag(W.MULTI_INJECT_TAG)},U.prototype.matchesArray=function(re){return this.matchesTag(W.MULTI_INJECT_TAG)(re)},U.prototype.isNamed=function(){return this.hasTag(W.NAMED_TAG)},U.prototype.isTagged=function(){return this.metadata.some(function(re){return W.NON_CUSTOM_TAG_KEYS.every(function(K){return re.key!==K})})},U.prototype.isOptional=function(){return this.matchesTag(W.OPTIONAL_TAG)(!0)},U.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(re){return re.key===W.NAMED_TAG})[0]:null},U.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(re){return W.NON_CUSTOM_TAG_KEYS.every(function(K){return re.key!==K})}):null},U.prototype.matchesNamedTag=function(re){return this.matchesTag(W.NAMED_TAG)(re)},U.prototype.matchesTag=function(re){var K=this;return function(ne){for(var le=0,pe=K.metadata;le<pe.length;le++){var xe=pe[le];if(xe.key===re&&xe.value===ne)return!0}return!1}},U}();I.Target=L},52279:function(et,I,T){"use strict";var W=this&&this.__spreadArray||function(ne,le){for(var pe=0,xe=le.length,it=ne.length;pe<xe;pe++,it++)ne[it]=le[pe];return ne};Object.defineProperty(I,"__esModule",{value:!0}),I.resolveInstance=void 0;var A=T(16674),$=T(28421),k=T(6867);function L(ne,le,pe){var xe=le.filter(function(nt){return nt.target!==null&&nt.target.type===$.TargetTypeEnum.ClassProperty}),it=xe.map(pe);return xe.forEach(function(nt,we){var Ke="";Ke=nt.target.name.value();var ke=it[we];ne[Ke]=ke}),ne}function U(ne,le){return new(ne.bind.apply(ne,W([void 0],le)))}function re(ne,le){if(Reflect.hasMetadata(k.POST_CONSTRUCT,ne)){var pe=Reflect.getMetadata(k.POST_CONSTRUCT,ne);try{le[pe.value]()}catch(xe){throw new Error(A.POST_CONSTRUCT_ERROR(ne.name,xe.message))}}}function K(ne,le,pe){var xe=null;if(le.length>0){var it=le.filter(function(we){return we.target!==null&&we.target.type===$.TargetTypeEnum.ConstructorArgument}),nt=it.map(pe);xe=U(ne,nt),xe=L(xe,le,pe)}else xe=new ne;return re(ne,xe),xe}I.resolveInstance=K},31927:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.resolve=void 0;var W=T(16674),A=T(28421),$=T(85265),k=T(55800),L=T(52279),U=function(ne,le,pe){try{return pe()}catch(xe){throw $.isStackOverflowExeption(xe)?new Error(W.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,le.toString())):xe}},re=function(ne){return function(le){le.parentContext.setCurrentRequest(le);var pe=le.bindings,xe=le.childRequests,it=le.target&&le.target.isArray(),nt=!le.parentRequest||!le.parentRequest.target||!le.target||!le.parentRequest.target.matchesArray(le.target.serviceIdentifier);if(it&&nt)return xe.map(function(Je){var O=re(ne);return O(Je)});var we=null;if(le.target.isOptional()&&pe.length===0)return;var Ke=pe[0],ke=Ke.scope===A.BindingScopeEnum.Singleton,Oe=Ke.scope===A.BindingScopeEnum.Request;if(ke&&Ke.activated)return Ke.cache;if(Oe&&ne!==null&&ne.has(Ke.id))return ne.get(Ke.id);if(Ke.type===A.BindingTypeEnum.ConstantValue)we=Ke.cache,Ke.activated=!0;else if(Ke.type===A.BindingTypeEnum.Function)we=Ke.cache,Ke.activated=!0;else if(Ke.type===A.BindingTypeEnum.Constructor)we=Ke.implementationType;else if(Ke.type===A.BindingTypeEnum.DynamicValue&&Ke.dynamicValue!==null)we=U("toDynamicValue",Ke.serviceIdentifier,function(){return Ke.dynamicValue(le.parentContext)});else if(Ke.type===A.BindingTypeEnum.Factory&&Ke.factory!==null)we=U("toFactory",Ke.serviceIdentifier,function(){return Ke.factory(le.parentContext)});else if(Ke.type===A.BindingTypeEnum.Provider&&Ke.provider!==null)we=U("toProvider",Ke.serviceIdentifier,function(){return Ke.provider(le.parentContext)});else if(Ke.type===A.BindingTypeEnum.Instance&&Ke.implementationType!==null)we=L.resolveInstance(Ke.implementationType,xe,re(ne));else{var Re=k.getServiceIdentifierAsString(le.serviceIdentifier);throw new Error(W.INVALID_BINDING_TYPE+" "+Re)}return typeof Ke.onActivation=="function"&&(we=Ke.onActivation(le.parentContext,we)),ke&&(Ke.cache=we,Ke.activated=!0),Oe&&ne!==null&&!ne.has(Ke.id)&&ne.set(Ke.id,we),we}};function K(ne){var le=re(ne.plan.rootRequest.requestScope);return le(ne.plan.rootRequest)}I.resolve=K},83366:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingInSyntax=void 0;var W=T(28421),A=T(71325),$=function(){function k(L){this._binding=L}return k.prototype.inRequestScope=function(){return this._binding.scope=W.BindingScopeEnum.Request,new A.BindingWhenOnSyntax(this._binding)},k.prototype.inSingletonScope=function(){return this._binding.scope=W.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},k.prototype.inTransientScope=function(){return this._binding.scope=W.BindingScopeEnum.Transient,new A.BindingWhenOnSyntax(this._binding)},k}();I.BindingInSyntax=$},99812:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingInWhenOnSyntax=void 0;var W=T(83366),A=T(51811),$=T(98370),k=function(){function L(U){this._binding=U,this._bindingWhenSyntax=new $.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new A.BindingOnSyntax(this._binding),this._bindingInSyntax=new W.BindingInSyntax(U)}return L.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},L.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},L.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},L.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},L.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},L.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},L.prototype.whenTargetTagged=function(U,re){return this._bindingWhenSyntax.whenTargetTagged(U,re)},L.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},L.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},L.prototype.whenParentTagged=function(U,re){return this._bindingWhenSyntax.whenParentTagged(U,re)},L.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},L.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},L.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},L.prototype.whenAnyAncestorTagged=function(U,re){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,re)},L.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},L.prototype.whenNoAncestorTagged=function(U,re){return this._bindingWhenSyntax.whenNoAncestorTagged(U,re)},L.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},L.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},L.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},L}();I.BindingInWhenOnSyntax=k},51811:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingOnSyntax=void 0;var W=T(98370),A=function(){function $(k){this._binding=k}return $.prototype.onActivation=function(k){return this._binding.onActivation=k,new W.BindingWhenSyntax(this._binding)},$}();I.BindingOnSyntax=A},51860:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingToSyntax=void 0;var W=T(16674),A=T(28421),$=T(99812),k=T(71325),L=function(){function U(re){this._binding=re}return U.prototype.to=function(re){return this._binding.type=A.BindingTypeEnum.Instance,this._binding.implementationType=re,new $.BindingInWhenOnSyntax(this._binding)},U.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+W.INVALID_TO_SELF_VALUE);var re=this._binding.serviceIdentifier;return this.to(re)},U.prototype.toConstantValue=function(re){return this._binding.type=A.BindingTypeEnum.ConstantValue,this._binding.cache=re,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=A.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},U.prototype.toDynamicValue=function(re){return this._binding.type=A.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=re,this._binding.implementationType=null,new $.BindingInWhenOnSyntax(this._binding)},U.prototype.toConstructor=function(re){return this._binding.type=A.BindingTypeEnum.Constructor,this._binding.implementationType=re,this._binding.scope=A.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},U.prototype.toFactory=function(re){return this._binding.type=A.BindingTypeEnum.Factory,this._binding.factory=re,this._binding.scope=A.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},U.prototype.toFunction=function(re){if(typeof re!="function")throw new Error(W.INVALID_FUNCTION_BINDING);var K=this.toConstantValue(re);return this._binding.type=A.BindingTypeEnum.Function,this._binding.scope=A.BindingScopeEnum.Singleton,K},U.prototype.toAutoFactory=function(re){return this._binding.type=A.BindingTypeEnum.Factory,this._binding.factory=function(K){var ne=function(){return K.container.get(re)};return ne},this._binding.scope=A.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},U.prototype.toProvider=function(re){return this._binding.type=A.BindingTypeEnum.Provider,this._binding.provider=re,this._binding.scope=A.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},U.prototype.toService=function(re){this.toDynamicValue(function(K){return K.container.get(re)})},U}();I.BindingToSyntax=L},71325:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingWhenOnSyntax=void 0;var W=T(51811),A=T(98370),$=function(){function k(L){this._binding=L,this._bindingWhenSyntax=new A.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new W.BindingOnSyntax(this._binding)}return k.prototype.when=function(L){return this._bindingWhenSyntax.when(L)},k.prototype.whenTargetNamed=function(L){return this._bindingWhenSyntax.whenTargetNamed(L)},k.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},k.prototype.whenTargetTagged=function(L,U){return this._bindingWhenSyntax.whenTargetTagged(L,U)},k.prototype.whenInjectedInto=function(L){return this._bindingWhenSyntax.whenInjectedInto(L)},k.prototype.whenParentNamed=function(L){return this._bindingWhenSyntax.whenParentNamed(L)},k.prototype.whenParentTagged=function(L,U){return this._bindingWhenSyntax.whenParentTagged(L,U)},k.prototype.whenAnyAncestorIs=function(L){return this._bindingWhenSyntax.whenAnyAncestorIs(L)},k.prototype.whenNoAncestorIs=function(L){return this._bindingWhenSyntax.whenNoAncestorIs(L)},k.prototype.whenAnyAncestorNamed=function(L){return this._bindingWhenSyntax.whenAnyAncestorNamed(L)},k.prototype.whenAnyAncestorTagged=function(L,U){return this._bindingWhenSyntax.whenAnyAncestorTagged(L,U)},k.prototype.whenNoAncestorNamed=function(L){return this._bindingWhenSyntax.whenNoAncestorNamed(L)},k.prototype.whenNoAncestorTagged=function(L,U){return this._bindingWhenSyntax.whenNoAncestorTagged(L,U)},k.prototype.whenAnyAncestorMatches=function(L){return this._bindingWhenSyntax.whenAnyAncestorMatches(L)},k.prototype.whenNoAncestorMatches=function(L){return this._bindingWhenSyntax.whenNoAncestorMatches(L)},k.prototype.onActivation=function(L){return this._bindingOnSyntax.onActivation(L)},k}();I.BindingWhenOnSyntax=$},98370:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.BindingWhenSyntax=void 0;var W=T(51811),A=T(80758),$=function(){function k(L){this._binding=L}return k.prototype.when=function(L){return this._binding.constraint=L,new W.BindingOnSyntax(this._binding)},k.prototype.whenTargetNamed=function(L){return this._binding.constraint=A.namedConstraint(L),new W.BindingOnSyntax(this._binding)},k.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(L){var U=L.target!==null&&!L.target.isNamed()&&!L.target.isTagged();return U},new W.BindingOnSyntax(this._binding)},k.prototype.whenTargetTagged=function(L,U){return this._binding.constraint=A.taggedConstraint(L)(U),new W.BindingOnSyntax(this._binding)},k.prototype.whenInjectedInto=function(L){return this._binding.constraint=function(U){return A.typeConstraint(L)(U.parentRequest)},new W.BindingOnSyntax(this._binding)},k.prototype.whenParentNamed=function(L){return this._binding.constraint=function(U){return A.namedConstraint(L)(U.parentRequest)},new W.BindingOnSyntax(this._binding)},k.prototype.whenParentTagged=function(L,U){return this._binding.constraint=function(re){return A.taggedConstraint(L)(U)(re.parentRequest)},new W.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorIs=function(L){return this._binding.constraint=function(U){return A.traverseAncerstors(U,A.typeConstraint(L))},new W.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorIs=function(L){return this._binding.constraint=function(U){return!A.traverseAncerstors(U,A.typeConstraint(L))},new W.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorNamed=function(L){return this._binding.constraint=function(U){return A.traverseAncerstors(U,A.namedConstraint(L))},new W.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorNamed=function(L){return this._binding.constraint=function(U){return!A.traverseAncerstors(U,A.namedConstraint(L))},new W.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorTagged=function(L,U){return this._binding.constraint=function(re){return A.traverseAncerstors(re,A.taggedConstraint(L)(U))},new W.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorTagged=function(L,U){return this._binding.constraint=function(re){return!A.traverseAncerstors(re,A.taggedConstraint(L)(U))},new W.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorMatches=function(L){return this._binding.constraint=function(U){return A.traverseAncerstors(U,L)},new W.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorMatches=function(L){return this._binding.constraint=function(U){return!A.traverseAncerstors(U,L)},new W.BindingOnSyntax(this._binding)},k}();I.BindingWhenSyntax=$},80758:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.typeConstraint=I.namedConstraint=I.taggedConstraint=I.traverseAncerstors=void 0;var W=T(6867),A=T(47738),$=function(re,K){var ne=re.parentRequest;return ne!==null?K(ne)?!0:$(ne,K):!1};I.traverseAncerstors=$;var k=function(re){return function(K){var ne=function(le){return le!==null&&le.target!==null&&le.target.matchesTag(re)(K)};return ne.metaData=new A.Metadata(re,K),ne}};I.taggedConstraint=k;var L=k(W.NAMED_TAG);I.namedConstraint=L;var U=function(re){return function(K){var ne=null;if(K!==null)if(ne=K.bindings[0],typeof re=="string"){var le=ne.serviceIdentifier;return le===re}else{var pe=K.bindings[0].implementationType;return re===pe}return!1}};I.typeConstraint=U},70600:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.multiBindToService=void 0;var T=function(W){return function(A){return function(){for(var $=[],k=0;k<arguments.length;k++)$[k]=arguments[k];return $.forEach(function(L){return W.bind(L).toService(A)})}}};I.multiBindToService=T},85265:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.isStackOverflowExeption=void 0;var W=T(16674);function A($){return $ instanceof RangeError||$.message===W.STACK_OVERFLOW}I.isStackOverflowExeption=A},37791:function(et,I){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.id=void 0;var T=0;function W(){return T++}I.id=W},55800:function(et,I,T){"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.circularDependencyToException=I.listMetadataForTarget=I.listRegisteredBindingsForServiceIdentifier=I.getServiceIdentifierAsString=I.getFunctionName=void 0;var W=T(16674);function A(ne){if(typeof ne=="function"){var le=ne;return le.name}else{if(typeof ne=="symbol")return ne.toString();var le=ne;return le}}I.getServiceIdentifierAsString=A;function $(ne,le,pe){var xe="",it=pe(ne,le);return it.length!==0&&(xe=`
Registered bindings:`,it.forEach(function(nt){var we="Object";nt.implementationType!==null&&(we=K(nt.implementationType)),xe=xe+`
 `+we,nt.constraint.metaData&&(xe=xe+" - "+nt.constraint.metaData)})),xe}I.listRegisteredBindingsForServiceIdentifier=$;function k(ne,le){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===le?!0:k(ne.parentRequest,le)}function L(ne){function le(xe,it){it===void 0&&(it=[]);var nt=A(xe.serviceIdentifier);return it.push(nt),xe.parentRequest!==null?le(xe.parentRequest,it):it}var pe=le(ne);return pe.reverse().join(" --> ")}function U(ne){ne.childRequests.forEach(function(le){if(k(le,le.serviceIdentifier)){var pe=L(le);throw new Error(W.CIRCULAR_DEPENDENCY+" "+pe)}else U(le)})}I.circularDependencyToException=U;function re(ne,le){if(le.isTagged()||le.isNamed()){var pe="",xe=le.getNamedTag(),it=le.getCustomTags();return xe!==null&&(pe+=xe.toString()+`
`),it!==null&&it.forEach(function(nt){pe+=nt.toString()+`
`})," "+ne+`
 `+ne+" - "+pe}else return" "+ne}I.listMetadataForTarget=re;function K(ne){if(ne.name)return ne.name;var le=ne.toString(),pe=le.match(/^function\s*([^\s(]+)/);return pe?pe[1]:"Anonymous function: "+le}I.getFunctionName=K},31745:function(et){"use strict";et.exports=T,et.exports.default=T;var I=1e20;function T(L,U,re,K,ne,le){this.fontSize=L||24,this.buffer=U===void 0?3:U,this.cutoff=K||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=le||"normal",this.radius=re||8;var pe=this.size=this.fontSize+this.buffer*2,xe=pe+this.buffer*2,it=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;it?this.canvas=my.createOffscreenCanvas(pe,pe,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=pe),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(xe*xe),this.gridInner=new Float64Array(xe*xe),this.f=new Float64Array(xe),this.z=new Float64Array(xe+1),this.v=new Uint16Array(xe),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,it?this.middle=Math.round(pe/2*1):this.middle=Math.round(pe/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function W(L,U,re,K,ne,le,pe){le.fill(I,0,U*re),pe.fill(0,0,U*re);for(var xe=(U-K)/2,it=0;it<ne;it++)for(var nt=0;nt<K;nt++){var we=(it+xe)*U+nt+xe,Ke=L.data[4*(it*K+nt)+3]/255;if(Ke===1)le[we]=0,pe[we]=I;else if(Ke===0)le[we]=I,pe[we]=0;else{var ke=Math.max(0,.5-Ke),Oe=Math.max(0,Ke-.5);le[we]=ke*ke,pe[we]=Oe*Oe}}}function A(L,U,re,K,ne,le,pe){for(var xe=0;xe<U*re;xe++){var it=Math.sqrt(K[xe])-Math.sqrt(ne[xe]);L[xe]=Math.round(255-255*(it/le+pe))}}T.prototype._draw=function(L,U){var re=this.ctx.measureText(L),K=re.width,ne=2*this.buffer,le,pe,xe,it,nt,we,Ke,ke;U&&this.useMetrics?(nt=Math.floor(re.actualBoundingBoxAscent),ke=this.buffer+Math.ceil(re.actualBoundingBoxAscent),we=this.buffer,Ke=this.buffer,pe=Math.min(this.size,Math.ceil(re.actualBoundingBoxRight-re.actualBoundingBoxLeft)),it=Math.min(this.size-we,Math.ceil(re.actualBoundingBoxAscent+re.actualBoundingBoxDescent)),le=pe+ne,xe=it+ne,this.ctx.textBaseline="alphabetic"):(le=pe=this.size,xe=it=this.size,nt=19*this.fontSize/24,we=Ke=0,ke=this.middle,this.ctx.textBaseline="middle");var Oe;pe&&it&&(this.ctx.clearRect(Ke,we,pe,it),this.ctx.fillText(L,this.buffer,ke),Oe=this.ctx.getImageData(Ke,we,pe,it));var Re=new Uint8ClampedArray(le*xe);return W(Oe,le,xe,pe,it,this.gridOuter,this.gridInner),$(this.gridOuter,le,xe,this.f,this.v,this.z),$(this.gridInner,le,xe,this.f,this.v,this.z),A(Re,le,xe,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Re,metrics:{width:pe,height:it,sdfWidth:le,sdfHeight:xe,top:nt,left:0,advance:K}}},T.prototype.draw=function(L){return this._draw(L,!1).data},T.prototype.drawWithMetrics=function(L){return this._draw(L,!0)};function $(L,U,re,K,ne,le){for(var pe=0;pe<U;pe++)k(L,pe,U,re,K,ne,le);for(var xe=0;xe<re;xe++)k(L,xe*U,1,U,K,ne,le)}function k(L,U,re,K,ne,le,pe){var xe,it,nt,we;for(le[0]=0,pe[0]=-I,pe[1]=I,xe=0;xe<K;xe++)ne[xe]=L[U+xe*re];for(xe=1,it=0,nt=0;xe<K;xe++){do we=le[it],nt=(ne[xe]-ne[we]+xe*xe-we*we)/(xe-we)/2;while(nt<=pe[it]&&--it>-1);it++,le[it]=xe,pe[it]=nt,pe[it+1]=I}for(xe=0,it=0;xe<K;xe++){for(;pe[it+1]<xe;)it++;we=le[it],L[U+xe*re]=ne[we]+(xe-we)*(xe-we)}}},18857:function(et,I,T){"use strict";T.r(I),T.d(I,{Function:function(){return fo},Interpreter:function(){return vn},default:function(){return mu},evaluate:function(){return Cl},vm:function(){return W}});var W={};T.r(W),T.d(W,{Script:function(){return Ma},compileFunction:function(){return ea},createContext:function(){return dn},runInContext:function(){return $u},runInNewContext:function(){return Wf}});var A={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},$="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",k={5:$,"5module":$+" export import",6:$+" const class extends export import super"},L=/^in(stanceof)?$/,U="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",re="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",K=new RegExp("["+U+"]"),ne=new RegExp("["+U+re+"]");U=re=null;var le=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],pe=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function xe(f,m){for(var C=65536,_=0;_<m.length;_+=2){if(C+=m[_],C>f)return!1;if(C+=m[_+1],C>=f)return!0}}function it(f,m){return f<65?f===36:f<91?!0:f<97?f===95:f<123?!0:f<=65535?f>=170&&K.test(String.fromCharCode(f)):m===!1?!1:xe(f,le)}function nt(f,m){return f<48?f===36:f<58?!0:f<65?!1:f<91?!0:f<97?f===95:f<123?!0:f<=65535?f>=170&&ne.test(String.fromCharCode(f)):m===!1?!1:xe(f,le)||xe(f,pe)}var we=function(m,C){C===void 0&&(C={}),this.label=m,this.keyword=C.keyword,this.beforeExpr=!!C.beforeExpr,this.startsExpr=!!C.startsExpr,this.isLoop=!!C.isLoop,this.isAssign=!!C.isAssign,this.prefix=!!C.prefix,this.postfix=!!C.postfix,this.binop=C.binop||null,this.updateContext=null};function Ke(f,m){return new we(f,{beforeExpr:!0,binop:m})}var ke={beforeExpr:!0},Oe={startsExpr:!0},Re={};function Je(f,m){return m===void 0&&(m={}),m.keyword=f,Re[f]=new we(f,m)}var O={num:new we("num",Oe),regexp:new we("regexp",Oe),string:new we("string",Oe),name:new we("name",Oe),eof:new we("eof"),bracketL:new we("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new we("]"),braceL:new we("{",{beforeExpr:!0,startsExpr:!0}),braceR:new we("}"),parenL:new we("(",{beforeExpr:!0,startsExpr:!0}),parenR:new we(")"),comma:new we(",",ke),semi:new we(";",ke),colon:new we(":",ke),dot:new we("."),question:new we("?",ke),questionDot:new we("?."),arrow:new we("=>",ke),template:new we("template"),invalidTemplate:new we("invalidTemplate"),ellipsis:new we("...",ke),backQuote:new we("`",Oe),dollarBraceL:new we("${",{beforeExpr:!0,startsExpr:!0}),eq:new we("=",{beforeExpr:!0,isAssign:!0}),assign:new we("_=",{beforeExpr:!0,isAssign:!0}),incDec:new we("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new we("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Ke("||",1),logicalAND:Ke("&&",2),bitwiseOR:Ke("|",3),bitwiseXOR:Ke("^",4),bitwiseAND:Ke("&",5),equality:Ke("==/!=/===/!==",6),relational:Ke("</>/<=/>=",7),bitShift:Ke("<</>>/>>>",8),plusMin:new we("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Ke("%",10),star:Ke("*",10),slash:Ke("/",10),starstar:new we("**",{beforeExpr:!0}),coalesce:Ke("??",1),_break:Je("break"),_case:Je("case",ke),_catch:Je("catch"),_continue:Je("continue"),_debugger:Je("debugger"),_default:Je("default",ke),_do:Je("do",{isLoop:!0,beforeExpr:!0}),_else:Je("else",ke),_finally:Je("finally"),_for:Je("for",{isLoop:!0}),_function:Je("function",Oe),_if:Je("if"),_return:Je("return",ke),_switch:Je("switch"),_throw:Je("throw",ke),_try:Je("try"),_var:Je("var"),_const:Je("const"),_while:Je("while",{isLoop:!0}),_with:Je("with"),_new:Je("new",{beforeExpr:!0,startsExpr:!0}),_this:Je("this",Oe),_super:Je("super",Oe),_class:Je("class",Oe),_extends:Je("extends",ke),_export:Je("export"),_import:Je("import",Oe),_null:Je("null",Oe),_true:Je("true",Oe),_false:Je("false",Oe),_in:Je("in",{beforeExpr:!0,binop:7}),_instanceof:Je("instanceof",{beforeExpr:!0,binop:7}),_typeof:Je("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Je("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Je("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},at=/\r\n?|\n|\u2028|\u2029/,Pe=new RegExp(at.source,"g");function ve(f,m){return f===10||f===13||!m&&(f===8232||f===8233)}var Be=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ae=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,ct=Object.prototype,ut=ct.hasOwnProperty,St=ct.toString;function Tt(f,m){return ut.call(f,m)}var Q=Array.isArray||function(f){return St.call(f)==="[object Array]"};function p(f){return new RegExp("^(?:"+f.replace(/ /g,"|")+")$")}var B=function(m,C){this.line=m,this.column=C};B.prototype.offset=function(m){return new B(this.line,this.column+m)};var be=function(m,C,_){this.start=C,this.end=_,m.sourceFile!==null&&(this.source=m.sourceFile)};function Te(f,m){for(var C=1,_=0;;){Pe.lastIndex=_;var R=Pe.exec(f);if(R&&R.index<m)++C,_=R.index+R[0].length;else return new B(C,m-_)}}var Ge={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function $e(f){var m={};for(var C in Ge)m[C]=f&&Tt(f,C)?f[C]:Ge[C];if(m.ecmaVersion>=2015&&(m.ecmaVersion-=2009),m.allowReserved==null&&(m.allowReserved=m.ecmaVersion<5),Q(m.onToken)){var _=m.onToken;m.onToken=function(R){return _.push(R)}}return Q(m.onComment)&&(m.onComment=Mt(m,m.onComment)),m}function Mt(f,m){return function(C,_,R,X,oe,Me){var Ie={type:C?"Block":"Line",value:_,start:R,end:X};f.locations&&(Ie.loc=new be(this,oe,Me)),f.ranges&&(Ie.range=[R,X]),m.push(Ie)}}var Sr=1,gr=2,sn=Sr|gr,Cr=4,Br=8,Zr=16,kr=32,Jn=64,Tn=128;function rn(f,m){return gr|(f?Cr:0)|(m?Br:0)}var En=0,Gr=1,Fn=2,si=3,zn=4,Nn=5,_n=function(m,C,_){this.options=m=$e(m),this.sourceFile=m.sourceFile,this.keywords=p(k[m.ecmaVersion>=6?6:m.sourceType==="module"?"5module":5]);var R="";if(m.allowReserved!==!0){for(var X=m.ecmaVersion;!(R=A[X]);X--);m.sourceType==="module"&&(R+=" await")}this.reservedWords=p(R);var oe=(R?R+" ":"")+A.strict;this.reservedWordsStrict=p(oe),this.reservedWordsStrictBind=p(oe+" "+A.strictBind),this.input=String(C),this.containsEsc=!1,_?(this.pos=_,this.lineStart=this.input.lastIndexOf(`
`,_-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(at).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=O.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=m.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&m.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Sr),this.regexpState=null},On={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};_n.prototype.parse=function(){var m=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(m)},On.inFunction.get=function(){return(this.currentVarScope().flags&gr)>0},On.inGenerator.get=function(){return(this.currentVarScope().flags&Br)>0},On.inAsync.get=function(){return(this.currentVarScope().flags&Cr)>0},On.allowSuper.get=function(){return(this.currentThisScope().flags&Jn)>0},On.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Tn)>0},On.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},_n.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&gr)>0},_n.extend=function(){for(var m=[],C=arguments.length;C--;)m[C]=arguments[C];for(var _=this,R=0;R<m.length;R++)_=m[R](_);return _},_n.parse=function(m,C){return new this(C,m).parse()},_n.parseExpressionAt=function(m,C,_){var R=new this(_,m,C);return R.nextToken(),R.parseExpression()},_n.tokenizer=function(m,C){return new this(C,m)},Object.defineProperties(_n.prototype,On);var cn=_n.prototype,Aa=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;cn.strictDirective=function(f){for(;;){Ae.lastIndex=f,f+=Ae.exec(this.input)[0].length;var m=Aa.exec(this.input.slice(f));if(!m)return!1;if((m[1]||m[2])==="use strict"){Ae.lastIndex=f+m[0].length;var C=Ae.exec(this.input),_=C.index+C[0].length,R=this.input.charAt(_);return R===";"||R==="}"||at.test(C[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(R)||R==="!"&&this.input.charAt(_+1)==="=")}f+=m[0].length,Ae.lastIndex=f,f+=Ae.exec(this.input)[0].length,this.input[f]===";"&&f++}},cn.eat=function(f){return this.type===f?(this.next(),!0):!1},cn.isContextual=function(f){return this.type===O.name&&this.value===f&&!this.containsEsc},cn.eatContextual=function(f){return this.isContextual(f)?(this.next(),!0):!1},cn.expectContextual=function(f){this.eatContextual(f)||this.unexpected()},cn.canInsertSemicolon=function(){return this.type===O.eof||this.type===O.braceR||at.test(this.input.slice(this.lastTokEnd,this.start))},cn.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},cn.semicolon=function(){!this.eat(O.semi)&&!this.insertSemicolon()&&this.unexpected()},cn.afterTrailingComma=function(f,m){if(this.type===f)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),m||this.next(),!0},cn.expect=function(f){this.eat(f)||this.unexpected()},cn.unexpected=function(f){this.raise(f!=null?f:this.start,"Unexpected token")};function j(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}cn.checkPatternErrors=function(f,m){if(!!f){f.trailingComma>-1&&this.raiseRecoverable(f.trailingComma,"Comma is not permitted after the rest element");var C=m?f.parenthesizedAssign:f.parenthesizedBind;C>-1&&this.raiseRecoverable(C,"Parenthesized pattern")}},cn.checkExpressionErrors=function(f,m){if(!f)return!1;var C=f.shorthandAssign,_=f.doubleProto;if(!m)return C>=0||_>=0;C>=0&&this.raise(C,"Shorthand property assignments are valid only in destructuring patterns"),_>=0&&this.raiseRecoverable(_,"Redefinition of __proto__ property")},cn.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},cn.isSimpleAssignTarget=function(f){return f.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(f.expression):f.type==="Identifier"||f.type==="MemberExpression"};var Hr=_n.prototype;Hr.parseTopLevel=function(f){var m={};for(f.body||(f.body=[]);this.type!==O.eof;){var C=this.parseStatement(null,!0,m);f.body.push(C)}if(this.inModule)for(var _=0,R=Object.keys(this.undefinedExports);_<R.length;_+=1){var X=R[_];this.raiseRecoverable(this.undefinedExports[X].start,"Export '"+X+"' is not defined")}return this.adaptDirectivePrologue(f.body),this.next(),f.sourceType=this.options.sourceType,this.finishNode(f,"Program")};var ri={kind:"loop"},fu={kind:"switch"};Hr.isLet=function(f){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ae.lastIndex=this.pos;var m=Ae.exec(this.input),C=this.pos+m[0].length,_=this.input.charCodeAt(C);if(_===91)return!0;if(f)return!1;if(_===123)return!0;if(it(_,!0)){for(var R=C+1;nt(this.input.charCodeAt(R),!0);)++R;var X=this.input.slice(C,R);if(!L.test(X))return!0}return!1},Hr.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ae.lastIndex=this.pos;var f=Ae.exec(this.input),m=this.pos+f[0].length;return!at.test(this.input.slice(this.pos,m))&&this.input.slice(m,m+8)==="function"&&(m+8===this.input.length||!nt(this.input.charAt(m+8)))},Hr.parseStatement=function(f,m,C){var _=this.type,R=this.startNode(),X;switch(this.isLet(f)&&(_=O._var,X="let"),_){case O._break:case O._continue:return this.parseBreakContinueStatement(R,_.keyword);case O._debugger:return this.parseDebuggerStatement(R);case O._do:return this.parseDoStatement(R);case O._for:return this.parseForStatement(R);case O._function:return f&&(this.strict||f!=="if"&&f!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(R,!1,!f);case O._class:return f&&this.unexpected(),this.parseClass(R,!0);case O._if:return this.parseIfStatement(R);case O._return:return this.parseReturnStatement(R);case O._switch:return this.parseSwitchStatement(R);case O._throw:return this.parseThrowStatement(R);case O._try:return this.parseTryStatement(R);case O._const:case O._var:return X=X||this.value,f&&X!=="var"&&this.unexpected(),this.parseVarStatement(R,X);case O._while:return this.parseWhileStatement(R);case O._with:return this.parseWithStatement(R);case O.braceL:return this.parseBlock(!0,R);case O.semi:return this.parseEmptyStatement(R);case O._export:case O._import:if(this.options.ecmaVersion>10&&_===O._import){Ae.lastIndex=this.pos;var oe=Ae.exec(this.input),Me=this.pos+oe[0].length,Ie=this.input.charCodeAt(Me);if(Ie===40||Ie===46)return this.parseExpressionStatement(R,this.parseExpression())}return this.options.allowImportExportEverywhere||(m||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),_===O._import?this.parseImport(R):this.parseExport(R,C);default:if(this.isAsyncFunction())return f&&this.unexpected(),this.next(),this.parseFunctionStatement(R,!0,!f);var Ct=this.value,Pt=this.parseExpression();return _===O.name&&Pt.type==="Identifier"&&this.eat(O.colon)?this.parseLabeledStatement(R,Ct,Pt,f):this.parseExpressionStatement(R,Pt)}},Hr.parseBreakContinueStatement=function(f,m){var C=m==="break";this.next(),this.eat(O.semi)||this.insertSemicolon()?f.label=null:this.type!==O.name?this.unexpected():(f.label=this.parseIdent(),this.semicolon());for(var _=0;_<this.labels.length;++_){var R=this.labels[_];if((f.label==null||R.name===f.label.name)&&(R.kind!=null&&(C||R.kind==="loop")||f.label&&C))break}return _===this.labels.length&&this.raise(f.start,"Unsyntactic "+m),this.finishNode(f,C?"BreakStatement":"ContinueStatement")},Hr.parseDebuggerStatement=function(f){return this.next(),this.semicolon(),this.finishNode(f,"DebuggerStatement")},Hr.parseDoStatement=function(f){return this.next(),this.labels.push(ri),f.body=this.parseStatement("do"),this.labels.pop(),this.expect(O._while),f.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(O.semi):this.semicolon(),this.finishNode(f,"DoWhileStatement")},Hr.parseForStatement=function(f){this.next();var m=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(ri),this.enterScope(0),this.expect(O.parenL),this.type===O.semi)return m>-1&&this.unexpected(m),this.parseFor(f,null);var C=this.isLet();if(this.type===O._var||this.type===O._const||C){var _=this.startNode(),R=C?"let":this.value;return this.next(),this.parseVar(_,!0,R),this.finishNode(_,"VariableDeclaration"),(this.type===O._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&_.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===O._in?m>-1&&this.unexpected(m):f.await=m>-1),this.parseForIn(f,_)):(m>-1&&this.unexpected(m),this.parseFor(f,_))}var X=new j,oe=this.parseExpression(!0,X);return this.type===O._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===O._in?m>-1&&this.unexpected(m):f.await=m>-1),this.toAssignable(oe,!1,X),this.checkLVal(oe),this.parseForIn(f,oe)):(this.checkExpressionErrors(X,!0),m>-1&&this.unexpected(m),this.parseFor(f,oe))},Hr.parseFunctionStatement=function(f,m,C){return this.next(),this.parseFunction(f,dt|(C?0:Nt),!1,m)},Hr.parseIfStatement=function(f){return this.next(),f.test=this.parseParenExpression(),f.consequent=this.parseStatement("if"),f.alternate=this.eat(O._else)?this.parseStatement("if"):null,this.finishNode(f,"IfStatement")},Hr.parseReturnStatement=function(f){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(O.semi)||this.insertSemicolon()?f.argument=null:(f.argument=this.parseExpression(),this.semicolon()),this.finishNode(f,"ReturnStatement")},Hr.parseSwitchStatement=function(f){this.next(),f.discriminant=this.parseParenExpression(),f.cases=[],this.expect(O.braceL),this.labels.push(fu),this.enterScope(0);for(var m,C=!1;this.type!==O.braceR;)if(this.type===O._case||this.type===O._default){var _=this.type===O._case;m&&this.finishNode(m,"SwitchCase"),f.cases.push(m=this.startNode()),m.consequent=[],this.next(),_?m.test=this.parseExpression():(C&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),C=!0,m.test=null),this.expect(O.colon)}else m||this.unexpected(),m.consequent.push(this.parseStatement(null));return this.exitScope(),m&&this.finishNode(m,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(f,"SwitchStatement")},Hr.parseThrowStatement=function(f){return this.next(),at.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),f.argument=this.parseExpression(),this.semicolon(),this.finishNode(f,"ThrowStatement")};var qe=[];Hr.parseTryStatement=function(f){if(this.next(),f.block=this.parseBlock(),f.handler=null,this.type===O._catch){var m=this.startNode();if(this.next(),this.eat(O.parenL)){m.param=this.parseBindingAtom();var C=m.param.type==="Identifier";this.enterScope(C?kr:0),this.checkLVal(m.param,C?zn:Fn),this.expect(O.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),m.param=null,this.enterScope(0);m.body=this.parseBlock(!1),this.exitScope(),f.handler=this.finishNode(m,"CatchClause")}return f.finalizer=this.eat(O._finally)?this.parseBlock():null,!f.handler&&!f.finalizer&&this.raise(f.start,"Missing catch or finally clause"),this.finishNode(f,"TryStatement")},Hr.parseVarStatement=function(f,m){return this.next(),this.parseVar(f,!1,m),this.semicolon(),this.finishNode(f,"VariableDeclaration")},Hr.parseWhileStatement=function(f){return this.next(),f.test=this.parseParenExpression(),this.labels.push(ri),f.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(f,"WhileStatement")},Hr.parseWithStatement=function(f){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),f.object=this.parseParenExpression(),f.body=this.parseStatement("with"),this.finishNode(f,"WithStatement")},Hr.parseEmptyStatement=function(f){return this.next(),this.finishNode(f,"EmptyStatement")},Hr.parseLabeledStatement=function(f,m,C,_){for(var R=0,X=this.labels;R<X.length;R+=1){var oe=X[R];oe.name===m&&this.raise(C.start,"Label '"+m+"' is already declared")}for(var Me=this.type.isLoop?"loop":this.type===O._switch?"switch":null,Ie=this.labels.length-1;Ie>=0;Ie--){var Ct=this.labels[Ie];if(Ct.statementStart===f.start)Ct.statementStart=this.start,Ct.kind=Me;else break}return this.labels.push({name:m,kind:Me,statementStart:this.start}),f.body=this.parseStatement(_?_.indexOf("label")===-1?_+"label":_:"label"),this.labels.pop(),f.label=C,this.finishNode(f,"LabeledStatement")},Hr.parseExpressionStatement=function(f,m){return f.expression=m,this.semicolon(),this.finishNode(f,"ExpressionStatement")},Hr.parseBlock=function(f,m,C){for(f===void 0&&(f=!0),m===void 0&&(m=this.startNode()),m.body=[],this.expect(O.braceL),f&&this.enterScope(0);this.type!==O.braceR;){var _=this.parseStatement(null);m.body.push(_)}return C&&(this.strict=!1),this.next(),f&&this.exitScope(),this.finishNode(m,"BlockStatement")},Hr.parseFor=function(f,m){return f.init=m,this.expect(O.semi),f.test=this.type===O.semi?null:this.parseExpression(),this.expect(O.semi),f.update=this.type===O.parenR?null:this.parseExpression(),this.expect(O.parenR),f.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(f,"ForStatement")},Hr.parseForIn=function(f,m){var C=this.type===O._in;return this.next(),m.type==="VariableDeclaration"&&m.declarations[0].init!=null&&(!C||this.options.ecmaVersion<8||this.strict||m.kind!=="var"||m.declarations[0].id.type!=="Identifier")?this.raise(m.start,(C?"for-in":"for-of")+" loop variable declaration may not have an initializer"):m.type==="AssignmentPattern"&&this.raise(m.start,"Invalid left-hand side in for-loop"),f.left=m,f.right=C?this.parseExpression():this.parseMaybeAssign(),this.expect(O.parenR),f.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(f,C?"ForInStatement":"ForOfStatement")},Hr.parseVar=function(f,m,C){for(f.declarations=[],f.kind=C;;){var _=this.startNode();if(this.parseVarId(_,C),this.eat(O.eq)?_.init=this.parseMaybeAssign(m):C==="const"&&!(this.type===O._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():_.id.type!=="Identifier"&&!(m&&(this.type===O._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):_.init=null,f.declarations.push(this.finishNode(_,"VariableDeclarator")),!this.eat(O.comma))break}return f},Hr.parseVarId=function(f,m){f.id=this.parseBindingAtom(),this.checkLVal(f.id,m==="var"?Gr:Fn,!1)};var dt=1,Nt=2,ar=4;Hr.parseFunction=function(f,m,C,_){this.initFunction(f),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!_)&&(this.type===O.star&&m&Nt&&this.unexpected(),f.generator=this.eat(O.star)),this.options.ecmaVersion>=8&&(f.async=!!_),m&dt&&(f.id=m&ar&&this.type!==O.name?null:this.parseIdent(),f.id&&!(m&Nt)&&this.checkLVal(f.id,this.strict||f.generator||f.async?this.treatFunctionsAsVar?Gr:Fn:si));var R=this.yieldPos,X=this.awaitPos,oe=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(rn(f.async,f.generator)),m&dt||(f.id=this.type===O.name?this.parseIdent():null),this.parseFunctionParams(f),this.parseFunctionBody(f,C,!1),this.yieldPos=R,this.awaitPos=X,this.awaitIdentPos=oe,this.finishNode(f,m&dt?"FunctionDeclaration":"FunctionExpression")},Hr.parseFunctionParams=function(f){this.expect(O.parenL),f.params=this.parseBindingList(O.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Hr.parseClass=function(f,m){this.next();var C=this.strict;this.strict=!0,this.parseClassId(f,m),this.parseClassSuper(f);var _=this.startNode(),R=!1;for(_.body=[],this.expect(O.braceL);this.type!==O.braceR;){var X=this.parseClassElement(f.superClass!==null);X&&(_.body.push(X),X.type==="MethodDefinition"&&X.kind==="constructor"&&(R&&this.raise(X.start,"Duplicate constructor in the same class"),R=!0))}return this.strict=C,this.next(),f.body=this.finishNode(_,"ClassBody"),this.finishNode(f,m?"ClassDeclaration":"ClassExpression")},Hr.parseClassElement=function(f){var m=this;if(this.eat(O.semi))return null;var C=this.startNode(),_=function(Ie,Ct){Ct===void 0&&(Ct=!1);var Pt=m.start,dr=m.startLoc;return m.eatContextual(Ie)?m.type!==O.parenL&&(!Ct||!m.canInsertSemicolon())?!0:(C.key&&m.unexpected(),C.computed=!1,C.key=m.startNodeAt(Pt,dr),C.key.name=Ie,m.finishNode(C.key,"Identifier"),!1):!1};C.kind="method",C.static=_("static");var R=this.eat(O.star),X=!1;R||(this.options.ecmaVersion>=8&&_("async",!0)?(X=!0,R=this.options.ecmaVersion>=9&&this.eat(O.star)):_("get")?C.kind="get":_("set")&&(C.kind="set")),C.key||this.parsePropertyName(C);var oe=C.key,Me=!1;return!C.computed&&!C.static&&(oe.type==="Identifier"&&oe.name==="constructor"||oe.type==="Literal"&&oe.value==="constructor")?(C.kind!=="method"&&this.raise(oe.start,"Constructor can't have get/set modifier"),R&&this.raise(oe.start,"Constructor can't be a generator"),X&&this.raise(oe.start,"Constructor can't be an async method"),C.kind="constructor",Me=f):C.static&&oe.type==="Identifier"&&oe.name==="prototype"&&this.raise(oe.start,"Classes may not have a static property named prototype"),this.parseClassMethod(C,R,X,Me),C.kind==="get"&&C.value.params.length!==0&&this.raiseRecoverable(C.value.start,"getter should have no params"),C.kind==="set"&&C.value.params.length!==1&&this.raiseRecoverable(C.value.start,"setter should have exactly one param"),C.kind==="set"&&C.value.params[0].type==="RestElement"&&this.raiseRecoverable(C.value.params[0].start,"Setter cannot use rest params"),C},Hr.parseClassMethod=function(f,m,C,_){return f.value=this.parseMethod(m,C,_),this.finishNode(f,"MethodDefinition")},Hr.parseClassId=function(f,m){this.type===O.name?(f.id=this.parseIdent(),m&&this.checkLVal(f.id,Fn,!1)):(m===!0&&this.unexpected(),f.id=null)},Hr.parseClassSuper=function(f){f.superClass=this.eat(O._extends)?this.parseExprSubscripts():null},Hr.parseExport=function(f,m){if(this.next(),this.eat(O.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(f.exported=this.parseIdent(!0),this.checkExport(m,f.exported.name,this.lastTokStart)):f.exported=null),this.expectContextual("from"),this.type!==O.string&&this.unexpected(),f.source=this.parseExprAtom(),this.semicolon(),this.finishNode(f,"ExportAllDeclaration");if(this.eat(O._default)){this.checkExport(m,"default",this.lastTokStart);var C;if(this.type===O._function||(C=this.isAsyncFunction())){var _=this.startNode();this.next(),C&&this.next(),f.declaration=this.parseFunction(_,dt|ar,!1,C)}else if(this.type===O._class){var R=this.startNode();f.declaration=this.parseClass(R,"nullableID")}else f.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(f,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())f.declaration=this.parseStatement(null),f.declaration.type==="VariableDeclaration"?this.checkVariableExport(m,f.declaration.declarations):this.checkExport(m,f.declaration.id.name,f.declaration.id.start),f.specifiers=[],f.source=null;else{if(f.declaration=null,f.specifiers=this.parseExportSpecifiers(m),this.eatContextual("from"))this.type!==O.string&&this.unexpected(),f.source=this.parseExprAtom();else{for(var X=0,oe=f.specifiers;X<oe.length;X+=1){var Me=oe[X];this.checkUnreserved(Me.local),this.checkLocalExport(Me.local)}f.source=null}this.semicolon()}return this.finishNode(f,"ExportNamedDeclaration")},Hr.checkExport=function(f,m,C){!f||(Tt(f,m)&&this.raiseRecoverable(C,"Duplicate export '"+m+"'"),f[m]=!0)},Hr.checkPatternExport=function(f,m){var C=m.type;if(C==="Identifier")this.checkExport(f,m.name,m.start);else if(C==="ObjectPattern")for(var _=0,R=m.properties;_<R.length;_+=1){var X=R[_];this.checkPatternExport(f,X)}else if(C==="ArrayPattern")for(var oe=0,Me=m.elements;oe<Me.length;oe+=1){var Ie=Me[oe];Ie&&this.checkPatternExport(f,Ie)}else C==="Property"?this.checkPatternExport(f,m.value):C==="AssignmentPattern"?this.checkPatternExport(f,m.left):C==="RestElement"?this.checkPatternExport(f,m.argument):C==="ParenthesizedExpression"&&this.checkPatternExport(f,m.expression)},Hr.checkVariableExport=function(f,m){if(!!f)for(var C=0,_=m;C<_.length;C+=1){var R=_[C];this.checkPatternExport(f,R.id)}},Hr.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Hr.parseExportSpecifiers=function(f){var m=[],C=!0;for(this.expect(O.braceL);!this.eat(O.braceR);){if(C)C=!1;else if(this.expect(O.comma),this.afterTrailingComma(O.braceR))break;var _=this.startNode();_.local=this.parseIdent(!0),_.exported=this.eatContextual("as")?this.parseIdent(!0):_.local,this.checkExport(f,_.exported.name,_.exported.start),m.push(this.finishNode(_,"ExportSpecifier"))}return m},Hr.parseImport=function(f){return this.next(),this.type===O.string?(f.specifiers=qe,f.source=this.parseExprAtom()):(f.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),f.source=this.type===O.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(f,"ImportDeclaration")},Hr.parseImportSpecifiers=function(){var f=[],m=!0;if(this.type===O.name){var C=this.startNode();if(C.local=this.parseIdent(),this.checkLVal(C.local,Fn),f.push(this.finishNode(C,"ImportDefaultSpecifier")),!this.eat(O.comma))return f}if(this.type===O.star){var _=this.startNode();return this.next(),this.expectContextual("as"),_.local=this.parseIdent(),this.checkLVal(_.local,Fn),f.push(this.finishNode(_,"ImportNamespaceSpecifier")),f}for(this.expect(O.braceL);!this.eat(O.braceR);){if(m)m=!1;else if(this.expect(O.comma),this.afterTrailingComma(O.braceR))break;var R=this.startNode();R.imported=this.parseIdent(!0),this.eatContextual("as")?R.local=this.parseIdent():(this.checkUnreserved(R.imported),R.local=R.imported),this.checkLVal(R.local,Fn),f.push(this.finishNode(R,"ImportSpecifier"))}return f},Hr.adaptDirectivePrologue=function(f){for(var m=0;m<f.length&&this.isDirectiveCandidate(f[m]);++m)f[m].directive=f[m].expression.raw.slice(1,-1)},Hr.isDirectiveCandidate=function(f){return f.type==="ExpressionStatement"&&f.expression.type==="Literal"&&typeof f.expression.value=="string"&&(this.input[f.start]==='"'||this.input[f.start]==="'")};var yr=_n.prototype;yr.toAssignable=function(f,m,C){if(this.options.ecmaVersion>=6&&f)switch(f.type){case"Identifier":this.inAsync&&f.name==="await"&&this.raise(f.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":f.type="ObjectPattern",C&&this.checkPatternErrors(C,!0);for(var _=0,R=f.properties;_<R.length;_+=1){var X=R[_];this.toAssignable(X,m),X.type==="RestElement"&&(X.argument.type==="ArrayPattern"||X.argument.type==="ObjectPattern")&&this.raise(X.argument.start,"Unexpected token")}break;case"Property":f.kind!=="init"&&this.raise(f.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(f.value,m);break;case"ArrayExpression":f.type="ArrayPattern",C&&this.checkPatternErrors(C,!0),this.toAssignableList(f.elements,m);break;case"SpreadElement":f.type="RestElement",this.toAssignable(f.argument,m),f.argument.type==="AssignmentPattern"&&this.raise(f.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":f.operator!=="="&&this.raise(f.left.end,"Only '=' operator can be used for specifying default value."),f.type="AssignmentPattern",delete f.operator,this.toAssignable(f.left,m);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(f.expression,m,C);break;case"ChainExpression":this.raiseRecoverable(f.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!m)break;default:this.raise(f.start,"Assigning to rvalue")}else C&&this.checkPatternErrors(C,!0);return f},yr.toAssignableList=function(f,m){for(var C=f.length,_=0;_<C;_++){var R=f[_];R&&this.toAssignable(R,m)}if(C){var X=f[C-1];this.options.ecmaVersion===6&&m&&X&&X.type==="RestElement"&&X.argument.type!=="Identifier"&&this.unexpected(X.argument.start)}return f},yr.parseSpread=function(f){var m=this.startNode();return this.next(),m.argument=this.parseMaybeAssign(!1,f),this.finishNode(m,"SpreadElement")},yr.parseRestBinding=function(){var f=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==O.name&&this.unexpected(),f.argument=this.parseBindingAtom(),this.finishNode(f,"RestElement")},yr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case O.bracketL:var f=this.startNode();return this.next(),f.elements=this.parseBindingList(O.bracketR,!0,!0),this.finishNode(f,"ArrayPattern");case O.braceL:return this.parseObj(!0)}return this.parseIdent()},yr.parseBindingList=function(f,m,C){for(var _=[],R=!0;!this.eat(f);)if(R?R=!1:this.expect(O.comma),m&&this.type===O.comma)_.push(null);else{if(C&&this.afterTrailingComma(f))break;if(this.type===O.ellipsis){var X=this.parseRestBinding();this.parseBindingListItem(X),_.push(X),this.type===O.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(f);break}else{var oe=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(oe),_.push(oe)}}return _},yr.parseBindingListItem=function(f){return f},yr.parseMaybeDefault=function(f,m,C){if(C=C||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(O.eq))return C;var _=this.startNodeAt(f,m);return _.left=C,_.right=this.parseMaybeAssign(),this.finishNode(_,"AssignmentPattern")},yr.checkLVal=function(f,m,C){switch(m===void 0&&(m=En),f.type){case"Identifier":m===Fn&&f.name==="let"&&this.raiseRecoverable(f.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(f.name)&&this.raiseRecoverable(f.start,(m?"Binding ":"Assigning to ")+f.name+" in strict mode"),C&&(Tt(C,f.name)&&this.raiseRecoverable(f.start,"Argument name clash"),C[f.name]=!0),m!==En&&m!==Nn&&this.declareName(f.name,m,f.start);break;case"ChainExpression":this.raiseRecoverable(f.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":m&&this.raiseRecoverable(f.start,"Binding member expression");break;case"ObjectPattern":for(var _=0,R=f.properties;_<R.length;_+=1){var X=R[_];this.checkLVal(X,m,C)}break;case"Property":this.checkLVal(f.value,m,C);break;case"ArrayPattern":for(var oe=0,Me=f.elements;oe<Me.length;oe+=1){var Ie=Me[oe];Ie&&this.checkLVal(Ie,m,C)}break;case"AssignmentPattern":this.checkLVal(f.left,m,C);break;case"RestElement":this.checkLVal(f.argument,m,C);break;case"ParenthesizedExpression":this.checkLVal(f.expression,m,C);break;default:this.raise(f.start,(m?"Binding":"Assigning to")+" rvalue")}};var Tr=_n.prototype;Tr.checkPropClash=function(f,m,C){if(!(this.options.ecmaVersion>=9&&f.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(f.computed||f.method||f.shorthand))){var _=f.key,R;switch(_.type){case"Identifier":R=_.name;break;case"Literal":R=String(_.value);break;default:return}var X=f.kind;if(this.options.ecmaVersion>=6){R==="__proto__"&&X==="init"&&(m.proto&&(C?C.doubleProto<0&&(C.doubleProto=_.start):this.raiseRecoverable(_.start,"Redefinition of __proto__ property")),m.proto=!0);return}R="$"+R;var oe=m[R];if(oe){var Me;X==="init"?Me=this.strict&&oe.init||oe.get||oe.set:Me=oe.init||oe[X],Me&&this.raiseRecoverable(_.start,"Redefinition of property")}else oe=m[R]={init:!1,get:!1,set:!1};oe[X]=!0}},Tr.parseExpression=function(f,m){var C=this.start,_=this.startLoc,R=this.parseMaybeAssign(f,m);if(this.type===O.comma){var X=this.startNodeAt(C,_);for(X.expressions=[R];this.eat(O.comma);)X.expressions.push(this.parseMaybeAssign(f,m));return this.finishNode(X,"SequenceExpression")}return R},Tr.parseMaybeAssign=function(f,m,C){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(f);this.exprAllowed=!1}var _=!1,R=-1,X=-1;m?(R=m.parenthesizedAssign,X=m.trailingComma,m.parenthesizedAssign=m.trailingComma=-1):(m=new j,_=!0);var oe=this.start,Me=this.startLoc;(this.type===O.parenL||this.type===O.name)&&(this.potentialArrowAt=this.start);var Ie=this.parseMaybeConditional(f,m);if(C&&(Ie=C.call(this,Ie,oe,Me)),this.type.isAssign){var Ct=this.startNodeAt(oe,Me);return Ct.operator=this.value,Ct.left=this.type===O.eq?this.toAssignable(Ie,!1,m):Ie,_||(m.parenthesizedAssign=m.trailingComma=m.doubleProto=-1),m.shorthandAssign>=Ct.left.start&&(m.shorthandAssign=-1),this.checkLVal(Ie),this.next(),Ct.right=this.parseMaybeAssign(f),this.finishNode(Ct,"AssignmentExpression")}else _&&this.checkExpressionErrors(m,!0);return R>-1&&(m.parenthesizedAssign=R),X>-1&&(m.trailingComma=X),Ie},Tr.parseMaybeConditional=function(f,m){var C=this.start,_=this.startLoc,R=this.parseExprOps(f,m);if(this.checkExpressionErrors(m))return R;if(this.eat(O.question)){var X=this.startNodeAt(C,_);return X.test=R,X.consequent=this.parseMaybeAssign(),this.expect(O.colon),X.alternate=this.parseMaybeAssign(f),this.finishNode(X,"ConditionalExpression")}return R},Tr.parseExprOps=function(f,m){var C=this.start,_=this.startLoc,R=this.parseMaybeUnary(m,!1);return this.checkExpressionErrors(m)||R.start===C&&R.type==="ArrowFunctionExpression"?R:this.parseExprOp(R,C,_,-1,f)},Tr.parseExprOp=function(f,m,C,_,R){var X=this.type.binop;if(X!=null&&(!R||this.type!==O._in)&&X>_){var oe=this.type===O.logicalOR||this.type===O.logicalAND,Me=this.type===O.coalesce;Me&&(X=O.logicalAND.binop);var Ie=this.value;this.next();var Ct=this.start,Pt=this.startLoc,dr=this.parseExprOp(this.parseMaybeUnary(null,!1),Ct,Pt,X,R),zr=this.buildBinary(m,C,f,dr,Ie,oe||Me);return(oe&&this.type===O.coalesce||Me&&(this.type===O.logicalOR||this.type===O.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(zr,m,C,_,R)}return f},Tr.buildBinary=function(f,m,C,_,R,X){var oe=this.startNodeAt(f,m);return oe.left=C,oe.operator=R,oe.right=_,this.finishNode(oe,X?"LogicalExpression":"BinaryExpression")},Tr.parseMaybeUnary=function(f,m){var C=this.start,_=this.startLoc,R;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))R=this.parseAwait(),m=!0;else if(this.type.prefix){var X=this.startNode(),oe=this.type===O.incDec;X.operator=this.value,X.prefix=!0,this.next(),X.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(f,!0),oe?this.checkLVal(X.argument):this.strict&&X.operator==="delete"&&X.argument.type==="Identifier"?this.raiseRecoverable(X.start,"Deleting local variable in strict mode"):m=!0,R=this.finishNode(X,oe?"UpdateExpression":"UnaryExpression")}else{if(R=this.parseExprSubscripts(f),this.checkExpressionErrors(f))return R;for(;this.type.postfix&&!this.canInsertSemicolon();){var Me=this.startNodeAt(C,_);Me.operator=this.value,Me.prefix=!1,Me.argument=R,this.checkLVal(R),this.next(),R=this.finishNode(Me,"UpdateExpression")}}return!m&&this.eat(O.starstar)?this.buildBinary(C,_,R,this.parseMaybeUnary(null,!1),"**",!1):R},Tr.parseExprSubscripts=function(f){var m=this.start,C=this.startLoc,_=this.parseExprAtom(f);if(_.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return _;var R=this.parseSubscripts(_,m,C);return f&&R.type==="MemberExpression"&&(f.parenthesizedAssign>=R.start&&(f.parenthesizedAssign=-1),f.parenthesizedBind>=R.start&&(f.parenthesizedBind=-1)),R},Tr.parseSubscripts=function(f,m,C,_){for(var R=this.options.ecmaVersion>=8&&f.type==="Identifier"&&f.name==="async"&&this.lastTokEnd===f.end&&!this.canInsertSemicolon()&&f.end-f.start==5&&this.potentialArrowAt===f.start,X=!1;;){var oe=this.parseSubscript(f,m,C,_,R,X);if(oe.optional&&(X=!0),oe===f||oe.type==="ArrowFunctionExpression"){if(X){var Me=this.startNodeAt(m,C);Me.expression=oe,oe=this.finishNode(Me,"ChainExpression")}return oe}f=oe}},Tr.parseSubscript=function(f,m,C,_,R,X){var oe=this.options.ecmaVersion>=11,Me=oe&&this.eat(O.questionDot);_&&Me&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Ie=this.eat(O.bracketL);if(Ie||Me&&this.type!==O.parenL&&this.type!==O.backQuote||this.eat(O.dot)){var Ct=this.startNodeAt(m,C);Ct.object=f,Ct.property=Ie?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Ct.computed=!!Ie,Ie&&this.expect(O.bracketR),oe&&(Ct.optional=Me),f=this.finishNode(Ct,"MemberExpression")}else if(!_&&this.eat(O.parenL)){var Pt=new j,dr=this.yieldPos,zr=this.awaitPos,Ar=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Qr=this.parseExprList(O.parenR,this.options.ecmaVersion>=8,!1,Pt);if(R&&!Me&&!this.canInsertSemicolon()&&this.eat(O.arrow))return this.checkPatternErrors(Pt,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=dr,this.awaitPos=zr,this.awaitIdentPos=Ar,this.parseArrowExpression(this.startNodeAt(m,C),Qr,!0);this.checkExpressionErrors(Pt,!0),this.yieldPos=dr||this.yieldPos,this.awaitPos=zr||this.awaitPos,this.awaitIdentPos=Ar||this.awaitIdentPos;var un=this.startNodeAt(m,C);un.callee=f,un.arguments=Qr,oe&&(un.optional=Me),f=this.finishNode(un,"CallExpression")}else if(this.type===O.backQuote){(Me||X)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var kn=this.startNodeAt(m,C);kn.tag=f,kn.quasi=this.parseTemplate({isTagged:!0}),f=this.finishNode(kn,"TaggedTemplateExpression")}return f},Tr.parseExprAtom=function(f){this.type===O.slash&&this.readRegexp();var m,C=this.potentialArrowAt===this.start;switch(this.type){case O._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),m=this.startNode(),this.next(),this.type===O.parenL&&!this.allowDirectSuper&&this.raise(m.start,"super() call outside constructor of a subclass"),this.type!==O.dot&&this.type!==O.bracketL&&this.type!==O.parenL&&this.unexpected(),this.finishNode(m,"Super");case O._this:return m=this.startNode(),this.next(),this.finishNode(m,"ThisExpression");case O.name:var _=this.start,R=this.startLoc,X=this.containsEsc,oe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!X&&oe.name==="async"&&!this.canInsertSemicolon()&&this.eat(O._function))return this.parseFunction(this.startNodeAt(_,R),0,!1,!0);if(C&&!this.canInsertSemicolon()){if(this.eat(O.arrow))return this.parseArrowExpression(this.startNodeAt(_,R),[oe],!1);if(this.options.ecmaVersion>=8&&oe.name==="async"&&this.type===O.name&&!X)return oe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(O.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(_,R),[oe],!0)}return oe;case O.regexp:var Me=this.value;return m=this.parseLiteral(Me.value),m.regex={pattern:Me.pattern,flags:Me.flags},m;case O.num:case O.string:return this.parseLiteral(this.value);case O._null:case O._true:case O._false:return m=this.startNode(),m.value=this.type===O._null?null:this.type===O._true,m.raw=this.type.keyword,this.next(),this.finishNode(m,"Literal");case O.parenL:var Ie=this.start,Ct=this.parseParenAndDistinguishExpression(C);return f&&(f.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Ct)&&(f.parenthesizedAssign=Ie),f.parenthesizedBind<0&&(f.parenthesizedBind=Ie)),Ct;case O.bracketL:return m=this.startNode(),this.next(),m.elements=this.parseExprList(O.bracketR,!0,!0,f),this.finishNode(m,"ArrayExpression");case O.braceL:return this.parseObj(!1,f);case O._function:return m=this.startNode(),this.next(),this.parseFunction(m,0);case O._class:return this.parseClass(this.startNode(),!1);case O._new:return this.parseNew();case O.backQuote:return this.parseTemplate();case O._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Tr.parseExprImport=function(){var f=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var m=this.parseIdent(!0);switch(this.type){case O.parenL:return this.parseDynamicImport(f);case O.dot:return f.meta=m,this.parseImportMeta(f);default:this.unexpected()}},Tr.parseDynamicImport=function(f){if(this.next(),f.source=this.parseMaybeAssign(),!this.eat(O.parenR)){var m=this.start;this.eat(O.comma)&&this.eat(O.parenR)?this.raiseRecoverable(m,"Trailing comma is not allowed in import()"):this.unexpected(m)}return this.finishNode(f,"ImportExpression")},Tr.parseImportMeta=function(f){this.next();var m=this.containsEsc;return f.property=this.parseIdent(!0),f.property.name!=="meta"&&this.raiseRecoverable(f.property.start,"The only valid meta property for import is 'import.meta'"),m&&this.raiseRecoverable(f.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(f.start,"Cannot use 'import.meta' outside a module"),this.finishNode(f,"MetaProperty")},Tr.parseLiteral=function(f){var m=this.startNode();return m.value=f,m.raw=this.input.slice(this.start,this.end),m.raw.charCodeAt(m.raw.length-1)===110&&(m.bigint=m.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(m,"Literal")},Tr.parseParenExpression=function(){this.expect(O.parenL);var f=this.parseExpression();return this.expect(O.parenR),f},Tr.parseParenAndDistinguishExpression=function(f){var m=this.start,C=this.startLoc,_,R=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var X=this.start,oe=this.startLoc,Me=[],Ie=!0,Ct=!1,Pt=new j,dr=this.yieldPos,zr=this.awaitPos,Ar;for(this.yieldPos=0,this.awaitPos=0;this.type!==O.parenR;)if(Ie?Ie=!1:this.expect(O.comma),R&&this.afterTrailingComma(O.parenR,!0)){Ct=!0;break}else if(this.type===O.ellipsis){Ar=this.start,Me.push(this.parseParenItem(this.parseRestBinding())),this.type===O.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Me.push(this.parseMaybeAssign(!1,Pt,this.parseParenItem));var Qr=this.start,un=this.startLoc;if(this.expect(O.parenR),f&&!this.canInsertSemicolon()&&this.eat(O.arrow))return this.checkPatternErrors(Pt,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=dr,this.awaitPos=zr,this.parseParenArrowList(m,C,Me);(!Me.length||Ct)&&this.unexpected(this.lastTokStart),Ar&&this.unexpected(Ar),this.checkExpressionErrors(Pt,!0),this.yieldPos=dr||this.yieldPos,this.awaitPos=zr||this.awaitPos,Me.length>1?(_=this.startNodeAt(X,oe),_.expressions=Me,this.finishNodeAt(_,"SequenceExpression",Qr,un)):_=Me[0]}else _=this.parseParenExpression();if(this.options.preserveParens){var kn=this.startNodeAt(m,C);return kn.expression=_,this.finishNode(kn,"ParenthesizedExpression")}else return _},Tr.parseParenItem=function(f){return f},Tr.parseParenArrowList=function(f,m,C){return this.parseArrowExpression(this.startNodeAt(f,m),C)};var $r=[];Tr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var f=this.startNode(),m=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(O.dot)){f.meta=m;var C=this.containsEsc;return f.property=this.parseIdent(!0),f.property.name!=="target"&&this.raiseRecoverable(f.property.start,"The only valid meta property for new is 'new.target'"),C&&this.raiseRecoverable(f.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(f.start,"'new.target' can only be used in functions"),this.finishNode(f,"MetaProperty")}var _=this.start,R=this.startLoc,X=this.type===O._import;return f.callee=this.parseSubscripts(this.parseExprAtom(),_,R,!0),X&&f.callee.type==="ImportExpression"&&this.raise(_,"Cannot use new with import()"),this.eat(O.parenL)?f.arguments=this.parseExprList(O.parenR,this.options.ecmaVersion>=8,!1):f.arguments=$r,this.finishNode(f,"NewExpression")},Tr.parseTemplateElement=function(f){var m=f.isTagged,C=this.startNode();return this.type===O.invalidTemplate?(m||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),C.value={raw:this.value,cooked:null}):C.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),C.tail=this.type===O.backQuote,this.finishNode(C,"TemplateElement")},Tr.parseTemplate=function(f){f===void 0&&(f={});var m=f.isTagged;m===void 0&&(m=!1);var C=this.startNode();this.next(),C.expressions=[];var _=this.parseTemplateElement({isTagged:m});for(C.quasis=[_];!_.tail;)this.type===O.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(O.dollarBraceL),C.expressions.push(this.parseExpression()),this.expect(O.braceR),C.quasis.push(_=this.parseTemplateElement({isTagged:m}));return this.next(),this.finishNode(C,"TemplateLiteral")},Tr.isAsyncProp=function(f){return!f.computed&&f.key.type==="Identifier"&&f.key.name==="async"&&(this.type===O.name||this.type===O.num||this.type===O.string||this.type===O.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===O.star)&&!at.test(this.input.slice(this.lastTokEnd,this.start))},Tr.parseObj=function(f,m){var C=this.startNode(),_=!0,R={};for(C.properties=[],this.next();!this.eat(O.braceR);){if(_)_=!1;else if(this.expect(O.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(O.braceR))break;var X=this.parseProperty(f,m);f||this.checkPropClash(X,R,m),C.properties.push(X)}return this.finishNode(C,f?"ObjectPattern":"ObjectExpression")},Tr.parseProperty=function(f,m){var C=this.startNode(),_,R,X,oe;if(this.options.ecmaVersion>=9&&this.eat(O.ellipsis))return f?(C.argument=this.parseIdent(!1),this.type===O.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(C,"RestElement")):(this.type===O.parenL&&m&&(m.parenthesizedAssign<0&&(m.parenthesizedAssign=this.start),m.parenthesizedBind<0&&(m.parenthesizedBind=this.start)),C.argument=this.parseMaybeAssign(!1,m),this.type===O.comma&&m&&m.trailingComma<0&&(m.trailingComma=this.start),this.finishNode(C,"SpreadElement"));this.options.ecmaVersion>=6&&(C.method=!1,C.shorthand=!1,(f||m)&&(X=this.start,oe=this.startLoc),f||(_=this.eat(O.star)));var Me=this.containsEsc;return this.parsePropertyName(C),!f&&!Me&&this.options.ecmaVersion>=8&&!_&&this.isAsyncProp(C)?(R=!0,_=this.options.ecmaVersion>=9&&this.eat(O.star),this.parsePropertyName(C,m)):R=!1,this.parsePropertyValue(C,f,_,R,X,oe,m,Me),this.finishNode(C,"Property")},Tr.parsePropertyValue=function(f,m,C,_,R,X,oe,Me){if((C||_)&&this.type===O.colon&&this.unexpected(),this.eat(O.colon))f.value=m?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,oe),f.kind="init";else if(this.options.ecmaVersion>=6&&this.type===O.parenL)m&&this.unexpected(),f.kind="init",f.method=!0,f.value=this.parseMethod(C,_);else if(!m&&!Me&&this.options.ecmaVersion>=5&&!f.computed&&f.key.type==="Identifier"&&(f.key.name==="get"||f.key.name==="set")&&this.type!==O.comma&&this.type!==O.braceR&&this.type!==O.eq){(C||_)&&this.unexpected(),f.kind=f.key.name,this.parsePropertyName(f),f.value=this.parseMethod(!1);var Ie=f.kind==="get"?0:1;if(f.value.params.length!==Ie){var Ct=f.value.start;f.kind==="get"?this.raiseRecoverable(Ct,"getter should have no params"):this.raiseRecoverable(Ct,"setter should have exactly one param")}else f.kind==="set"&&f.value.params[0].type==="RestElement"&&this.raiseRecoverable(f.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!f.computed&&f.key.type==="Identifier"?((C||_)&&this.unexpected(),this.checkUnreserved(f.key),f.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=R),f.kind="init",m?f.value=this.parseMaybeDefault(R,X,f.key):this.type===O.eq&&oe?(oe.shorthandAssign<0&&(oe.shorthandAssign=this.start),f.value=this.parseMaybeDefault(R,X,f.key)):f.value=f.key,f.shorthand=!0):this.unexpected()},Tr.parsePropertyName=function(f){if(this.options.ecmaVersion>=6){if(this.eat(O.bracketL))return f.computed=!0,f.key=this.parseMaybeAssign(),this.expect(O.bracketR),f.key;f.computed=!1}return f.key=this.type===O.num||this.type===O.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Tr.initFunction=function(f){f.id=null,this.options.ecmaVersion>=6&&(f.generator=f.expression=!1),this.options.ecmaVersion>=8&&(f.async=!1)},Tr.parseMethod=function(f,m,C){var _=this.startNode(),R=this.yieldPos,X=this.awaitPos,oe=this.awaitIdentPos;return this.initFunction(_),this.options.ecmaVersion>=6&&(_.generator=f),this.options.ecmaVersion>=8&&(_.async=!!m),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(rn(m,_.generator)|Jn|(C?Tn:0)),this.expect(O.parenL),_.params=this.parseBindingList(O.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(_,!1,!0),this.yieldPos=R,this.awaitPos=X,this.awaitIdentPos=oe,this.finishNode(_,"FunctionExpression")},Tr.parseArrowExpression=function(f,m,C){var _=this.yieldPos,R=this.awaitPos,X=this.awaitIdentPos;return this.enterScope(rn(C,!1)|Zr),this.initFunction(f),this.options.ecmaVersion>=8&&(f.async=!!C),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,f.params=this.toAssignableList(m,!0),this.parseFunctionBody(f,!0,!1),this.yieldPos=_,this.awaitPos=R,this.awaitIdentPos=X,this.finishNode(f,"ArrowFunctionExpression")},Tr.parseFunctionBody=function(f,m,C){var _=m&&this.type!==O.braceL,R=this.strict,X=!1;if(_)f.body=this.parseMaybeAssign(),f.expression=!0,this.checkParams(f,!1);else{var oe=this.options.ecmaVersion>=7&&!this.isSimpleParamList(f.params);(!R||oe)&&(X=this.strictDirective(this.end),X&&oe&&this.raiseRecoverable(f.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Me=this.labels;this.labels=[],X&&(this.strict=!0),this.checkParams(f,!R&&!X&&!m&&!C&&this.isSimpleParamList(f.params)),this.strict&&f.id&&this.checkLVal(f.id,Nn),f.body=this.parseBlock(!1,void 0,X&&!R),f.expression=!1,this.adaptDirectivePrologue(f.body.body),this.labels=Me}this.exitScope()},Tr.isSimpleParamList=function(f){for(var m=0,C=f;m<C.length;m+=1){var _=C[m];if(_.type!=="Identifier")return!1}return!0},Tr.checkParams=function(f,m){for(var C={},_=0,R=f.params;_<R.length;_+=1){var X=R[_];this.checkLVal(X,Gr,m?null:C)}},Tr.parseExprList=function(f,m,C,_){for(var R=[],X=!0;!this.eat(f);){if(X)X=!1;else if(this.expect(O.comma),m&&this.afterTrailingComma(f))break;var oe=void 0;C&&this.type===O.comma?oe=null:this.type===O.ellipsis?(oe=this.parseSpread(_),_&&this.type===O.comma&&_.trailingComma<0&&(_.trailingComma=this.start)):oe=this.parseMaybeAssign(!1,_),R.push(oe)}return R},Tr.checkUnreserved=function(f){var m=f.start,C=f.end,_=f.name;if(this.inGenerator&&_==="yield"&&this.raiseRecoverable(m,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&_==="await"&&this.raiseRecoverable(m,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(_)&&this.raise(m,"Unexpected keyword '"+_+"'"),!(this.options.ecmaVersion<6&&this.input.slice(m,C).indexOf("\\")!==-1)){var R=this.strict?this.reservedWordsStrict:this.reservedWords;R.test(_)&&(!this.inAsync&&_==="await"&&this.raiseRecoverable(m,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(m,"The keyword '"+_+"' is reserved"))}},Tr.parseIdent=function(f,m){var C=this.startNode();return this.type===O.name?C.name=this.value:this.type.keyword?(C.name=this.type.keyword,(C.name==="class"||C.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!f),this.finishNode(C,"Identifier"),f||(this.checkUnreserved(C),C.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=C.start)),C},Tr.parseYield=function(f){this.yieldPos||(this.yieldPos=this.start);var m=this.startNode();return this.next(),this.type===O.semi||this.canInsertSemicolon()||this.type!==O.star&&!this.type.startsExpr?(m.delegate=!1,m.argument=null):(m.delegate=this.eat(O.star),m.argument=this.parseMaybeAssign(f)),this.finishNode(m,"YieldExpression")},Tr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var f=this.startNode();return this.next(),f.argument=this.parseMaybeUnary(null,!1),this.finishNode(f,"AwaitExpression")};var Vr=_n.prototype;Vr.raise=function(f,m){var C=Te(this.input,f);m+=" ("+C.line+":"+C.column+")";var _=new SyntaxError(m);throw _.pos=f,_.loc=C,_.raisedAt=this.pos,_},Vr.raiseRecoverable=Vr.raise,Vr.curPosition=function(){if(this.options.locations)return new B(this.curLine,this.pos-this.lineStart)};var vr=_n.prototype,ln=function(m){this.flags=m,this.var=[],this.lexical=[],this.functions=[]};vr.enterScope=function(f){this.scopeStack.push(new ln(f))},vr.exitScope=function(){this.scopeStack.pop()},vr.treatFunctionsAsVarInScope=function(f){return f.flags&gr||!this.inModule&&f.flags&Sr},vr.declareName=function(f,m,C){var _=!1;if(m===Fn){var R=this.currentScope();_=R.lexical.indexOf(f)>-1||R.functions.indexOf(f)>-1||R.var.indexOf(f)>-1,R.lexical.push(f),this.inModule&&R.flags&Sr&&delete this.undefinedExports[f]}else if(m===zn){var X=this.currentScope();X.lexical.push(f)}else if(m===si){var oe=this.currentScope();this.treatFunctionsAsVar?_=oe.lexical.indexOf(f)>-1:_=oe.lexical.indexOf(f)>-1||oe.var.indexOf(f)>-1,oe.functions.push(f)}else for(var Me=this.scopeStack.length-1;Me>=0;--Me){var Ie=this.scopeStack[Me];if(Ie.lexical.indexOf(f)>-1&&!(Ie.flags&kr&&Ie.lexical[0]===f)||!this.treatFunctionsAsVarInScope(Ie)&&Ie.functions.indexOf(f)>-1){_=!0;break}if(Ie.var.push(f),this.inModule&&Ie.flags&Sr&&delete this.undefinedExports[f],Ie.flags&sn)break}_&&this.raiseRecoverable(C,"Identifier '"+f+"' has already been declared")},vr.checkLocalExport=function(f){this.scopeStack[0].lexical.indexOf(f.name)===-1&&this.scopeStack[0].var.indexOf(f.name)===-1&&(this.undefinedExports[f.name]=f)},vr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},vr.currentVarScope=function(){for(var f=this.scopeStack.length-1;;f--){var m=this.scopeStack[f];if(m.flags&sn)return m}},vr.currentThisScope=function(){for(var f=this.scopeStack.length-1;;f--){var m=this.scopeStack[f];if(m.flags&sn&&!(m.flags&Zr))return m}};var fn=function(m,C,_){this.type="",this.start=C,this.end=0,m.options.locations&&(this.loc=new be(m,_)),m.options.directSourceFile&&(this.sourceFile=m.options.directSourceFile),m.options.ranges&&(this.range=[C,0])},Ni=_n.prototype;Ni.startNode=function(){return new fn(this,this.start,this.startLoc)},Ni.startNodeAt=function(f,m){return new fn(this,f,m)};function hu(f,m,C,_){return f.type=m,f.end=C,this.options.locations&&(f.loc.end=_),this.options.ranges&&(f.range[1]=C),f}Ni.finishNode=function(f,m){return hu.call(this,f,m,this.lastTokEnd,this.lastTokEndLoc)},Ni.finishNodeAt=function(f,m,C,_){return hu.call(this,f,m,C,_)};var da=function(m,C,_,R,X){this.token=m,this.isExpr=!!C,this.preserveSpace=!!_,this.override=R,this.generator=!!X},ni={b_stat:new da("{",!1),b_expr:new da("{",!0),b_tmpl:new da("${",!1),p_stat:new da("(",!1),p_expr:new da("(",!0),q_tmpl:new da("`",!0,!0,function(f){return f.tryReadTemplateToken()}),f_stat:new da("function",!1),f_expr:new da("function",!0),f_expr_gen:new da("function",!0,!1,null,!0),f_gen:new da("function",!1,!1,null,!0)},lo=_n.prototype;lo.initialContext=function(){return[ni.b_stat]},lo.braceIsBlock=function(f){var m=this.curContext();return m===ni.f_expr||m===ni.f_stat?!0:f===O.colon&&(m===ni.b_stat||m===ni.b_expr)?!m.isExpr:f===O._return||f===O.name&&this.exprAllowed?at.test(this.input.slice(this.lastTokEnd,this.start)):f===O._else||f===O.semi||f===O.eof||f===O.parenR||f===O.arrow?!0:f===O.braceL?m===ni.b_stat:f===O._var||f===O._const||f===O.name?!1:!this.exprAllowed},lo.inGeneratorContext=function(){for(var f=this.context.length-1;f>=1;f--){var m=this.context[f];if(m.token==="function")return m.generator}return!1},lo.updateContext=function(f){var m,C=this.type;C.keyword&&f===O.dot?this.exprAllowed=!1:(m=C.updateContext)?m.call(this,f):this.exprAllowed=C.beforeExpr},O.parenR.updateContext=O.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var f=this.context.pop();f===ni.b_stat&&this.curContext().token==="function"&&(f=this.context.pop()),this.exprAllowed=!f.isExpr},O.braceL.updateContext=function(f){this.context.push(this.braceIsBlock(f)?ni.b_stat:ni.b_expr),this.exprAllowed=!0},O.dollarBraceL.updateContext=function(){this.context.push(ni.b_tmpl),this.exprAllowed=!0},O.parenL.updateContext=function(f){var m=f===O._if||f===O._for||f===O._with||f===O._while;this.context.push(m?ni.p_stat:ni.p_expr),this.exprAllowed=!0},O.incDec.updateContext=function(){},O._function.updateContext=O._class.updateContext=function(f){f.beforeExpr&&f!==O.semi&&f!==O._else&&!(f===O._return&&at.test(this.input.slice(this.lastTokEnd,this.start)))&&!((f===O.colon||f===O.braceL)&&this.curContext()===ni.b_stat)?this.context.push(ni.f_expr):this.context.push(ni.f_stat),this.exprAllowed=!1},O.backQuote.updateContext=function(){this.curContext()===ni.q_tmpl?this.context.pop():this.context.push(ni.q_tmpl),this.exprAllowed=!1},O.star.updateContext=function(f){if(f===O._function){var m=this.context.length-1;this.context[m]===ni.f_expr?this.context[m]=ni.f_expr_gen:this.context[m]=ni.f_gen}this.exprAllowed=!0},O.name.updateContext=function(f){var m=!1;this.options.ecmaVersion>=6&&f!==O.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(m=!0),this.exprAllowed=m};var gl="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",To=gl+" Extended_Pictographic",Ms=To,Os={9:gl,10:To,11:Ms},du="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ki="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",_l=ki+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",oc=_l+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Vo={9:ki,10:_l,11:oc},yl={};function ja(f){var m=yl[f]={binary:p(Os[f]+" "+du),nonBinary:{General_Category:p(du),Script:p(Vo[f])}};m.nonBinary.Script_Extensions=m.nonBinary.Script,m.nonBinary.gc=m.nonBinary.General_Category,m.nonBinary.sc=m.nonBinary.Script,m.nonBinary.scx=m.nonBinary.Script_Extensions}ja(9),ja(10),ja(11);var Fr=_n.prototype,Qi=function(m){this.parser=m,this.validFlags="gim"+(m.options.ecmaVersion>=6?"uy":"")+(m.options.ecmaVersion>=9?"s":""),this.unicodeProperties=yl[m.options.ecmaVersion>=11?11:m.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Qi.prototype.reset=function(m,C,_){var R=_.indexOf("u")!==-1;this.start=m|0,this.source=C+"",this.flags=_,this.switchU=R&&this.parser.options.ecmaVersion>=6,this.switchN=R&&this.parser.options.ecmaVersion>=9},Qi.prototype.raise=function(m){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+m)},Qi.prototype.at=function(m,C){C===void 0&&(C=!1);var _=this.source,R=_.length;if(m>=R)return-1;var X=_.charCodeAt(m);if(!(C||this.switchU)||X<=55295||X>=57344||m+1>=R)return X;var oe=_.charCodeAt(m+1);return oe>=56320&&oe<=57343?(X<<10)+oe-56613888:X},Qi.prototype.nextIndex=function(m,C){C===void 0&&(C=!1);var _=this.source,R=_.length;if(m>=R)return R;var X=_.charCodeAt(m),oe;return!(C||this.switchU)||X<=55295||X>=57344||m+1>=R||(oe=_.charCodeAt(m+1))<56320||oe>57343?m+1:m+2},Qi.prototype.current=function(m){return m===void 0&&(m=!1),this.at(this.pos,m)},Qi.prototype.lookahead=function(m){return m===void 0&&(m=!1),this.at(this.nextIndex(this.pos,m),m)},Qi.prototype.advance=function(m){m===void 0&&(m=!1),this.pos=this.nextIndex(this.pos,m)},Qi.prototype.eat=function(m,C){return C===void 0&&(C=!1),this.current(C)===m?(this.advance(C),!0):!1};function zu(f){return f<=65535?String.fromCharCode(f):(f-=65536,String.fromCharCode((f>>10)+55296,(f&1023)+56320))}Fr.validateRegExpFlags=function(f){for(var m=f.validFlags,C=f.flags,_=0;_<C.length;_++){var R=C.charAt(_);m.indexOf(R)===-1&&this.raise(f.start,"Invalid regular expression flag"),C.indexOf(R,_+1)>-1&&this.raise(f.start,"Duplicate regular expression flag")}},Fr.validateRegExpPattern=function(f){this.regexp_pattern(f),!f.switchN&&this.options.ecmaVersion>=9&&f.groupNames.length>0&&(f.switchN=!0,this.regexp_pattern(f))},Fr.regexp_pattern=function(f){f.pos=0,f.lastIntValue=0,f.lastStringValue="",f.lastAssertionIsQuantifiable=!1,f.numCapturingParens=0,f.maxBackReference=0,f.groupNames.length=0,f.backReferenceNames.length=0,this.regexp_disjunction(f),f.pos!==f.source.length&&(f.eat(41)&&f.raise("Unmatched ')'"),(f.eat(93)||f.eat(125))&&f.raise("Lone quantifier brackets")),f.maxBackReference>f.numCapturingParens&&f.raise("Invalid escape");for(var m=0,C=f.backReferenceNames;m<C.length;m+=1){var _=C[m];f.groupNames.indexOf(_)===-1&&f.raise("Invalid named capture referenced")}},Fr.regexp_disjunction=function(f){for(this.regexp_alternative(f);f.eat(124);)this.regexp_alternative(f);this.regexp_eatQuantifier(f,!0)&&f.raise("Nothing to repeat"),f.eat(123)&&f.raise("Lone quantifier brackets")},Fr.regexp_alternative=function(f){for(;f.pos<f.source.length&&this.regexp_eatTerm(f););},Fr.regexp_eatTerm=function(f){return this.regexp_eatAssertion(f)?(f.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(f)&&f.switchU&&f.raise("Invalid quantifier"),!0):(f.switchU?this.regexp_eatAtom(f):this.regexp_eatExtendedAtom(f))?(this.regexp_eatQuantifier(f),!0):!1},Fr.regexp_eatAssertion=function(f){var m=f.pos;if(f.lastAssertionIsQuantifiable=!1,f.eat(94)||f.eat(36))return!0;if(f.eat(92)){if(f.eat(66)||f.eat(98))return!0;f.pos=m}if(f.eat(40)&&f.eat(63)){var C=!1;if(this.options.ecmaVersion>=9&&(C=f.eat(60)),f.eat(61)||f.eat(33))return this.regexp_disjunction(f),f.eat(41)||f.raise("Unterminated group"),f.lastAssertionIsQuantifiable=!C,!0}return f.pos=m,!1},Fr.regexp_eatQuantifier=function(f,m){return m===void 0&&(m=!1),this.regexp_eatQuantifierPrefix(f,m)?(f.eat(63),!0):!1},Fr.regexp_eatQuantifierPrefix=function(f,m){return f.eat(42)||f.eat(43)||f.eat(63)||this.regexp_eatBracedQuantifier(f,m)},Fr.regexp_eatBracedQuantifier=function(f,m){var C=f.pos;if(f.eat(123)){var _=0,R=-1;if(this.regexp_eatDecimalDigits(f)&&(_=f.lastIntValue,f.eat(44)&&this.regexp_eatDecimalDigits(f)&&(R=f.lastIntValue),f.eat(125)))return R!==-1&&R<_&&!m&&f.raise("numbers out of order in {} quantifier"),!0;f.switchU&&!m&&f.raise("Incomplete quantifier"),f.pos=C}return!1},Fr.regexp_eatAtom=function(f){return this.regexp_eatPatternCharacters(f)||f.eat(46)||this.regexp_eatReverseSolidusAtomEscape(f)||this.regexp_eatCharacterClass(f)||this.regexp_eatUncapturingGroup(f)||this.regexp_eatCapturingGroup(f)},Fr.regexp_eatReverseSolidusAtomEscape=function(f){var m=f.pos;if(f.eat(92)){if(this.regexp_eatAtomEscape(f))return!0;f.pos=m}return!1},Fr.regexp_eatUncapturingGroup=function(f){var m=f.pos;if(f.eat(40)){if(f.eat(63)&&f.eat(58)){if(this.regexp_disjunction(f),f.eat(41))return!0;f.raise("Unterminated group")}f.pos=m}return!1},Fr.regexp_eatCapturingGroup=function(f){if(f.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(f):f.current()===63&&f.raise("Invalid group"),this.regexp_disjunction(f),f.eat(41))return f.numCapturingParens+=1,!0;f.raise("Unterminated group")}return!1},Fr.regexp_eatExtendedAtom=function(f){return f.eat(46)||this.regexp_eatReverseSolidusAtomEscape(f)||this.regexp_eatCharacterClass(f)||this.regexp_eatUncapturingGroup(f)||this.regexp_eatCapturingGroup(f)||this.regexp_eatInvalidBracedQuantifier(f)||this.regexp_eatExtendedPatternCharacter(f)},Fr.regexp_eatInvalidBracedQuantifier=function(f){return this.regexp_eatBracedQuantifier(f,!0)&&f.raise("Nothing to repeat"),!1},Fr.regexp_eatSyntaxCharacter=function(f){var m=f.current();return Hu(m)?(f.lastIntValue=m,f.advance(),!0):!1};function Hu(f){return f===36||f>=40&&f<=43||f===46||f===63||f>=91&&f<=94||f>=123&&f<=125}Fr.regexp_eatPatternCharacters=function(f){for(var m=f.pos,C=0;(C=f.current())!==-1&&!Hu(C);)f.advance();return f.pos!==m},Fr.regexp_eatExtendedPatternCharacter=function(f){var m=f.current();return m!==-1&&m!==36&&!(m>=40&&m<=43)&&m!==46&&m!==63&&m!==91&&m!==94&&m!==124?(f.advance(),!0):!1},Fr.regexp_groupSpecifier=function(f){if(f.eat(63)){if(this.regexp_eatGroupName(f)){f.groupNames.indexOf(f.lastStringValue)!==-1&&f.raise("Duplicate capture group name"),f.groupNames.push(f.lastStringValue);return}f.raise("Invalid group")}},Fr.regexp_eatGroupName=function(f){if(f.lastStringValue="",f.eat(60)){if(this.regexp_eatRegExpIdentifierName(f)&&f.eat(62))return!0;f.raise("Invalid capture group name")}return!1},Fr.regexp_eatRegExpIdentifierName=function(f){if(f.lastStringValue="",this.regexp_eatRegExpIdentifierStart(f)){for(f.lastStringValue+=zu(f.lastIntValue);this.regexp_eatRegExpIdentifierPart(f);)f.lastStringValue+=zu(f.lastIntValue);return!0}return!1},Fr.regexp_eatRegExpIdentifierStart=function(f){var m=f.pos,C=this.options.ecmaVersion>=11,_=f.current(C);return f.advance(C),_===92&&this.regexp_eatRegExpUnicodeEscapeSequence(f,C)&&(_=f.lastIntValue),Rs(_)?(f.lastIntValue=_,!0):(f.pos=m,!1)};function Rs(f){return it(f,!0)||f===36||f===95}Fr.regexp_eatRegExpIdentifierPart=function(f){var m=f.pos,C=this.options.ecmaVersion>=11,_=f.current(C);return f.advance(C),_===92&&this.regexp_eatRegExpUnicodeEscapeSequence(f,C)&&(_=f.lastIntValue),$n(_)?(f.lastIntValue=_,!0):(f.pos=m,!1)};function $n(f){return nt(f,!0)||f===36||f===95||f===8204||f===8205}Fr.regexp_eatAtomEscape=function(f){return this.regexp_eatBackReference(f)||this.regexp_eatCharacterClassEscape(f)||this.regexp_eatCharacterEscape(f)||f.switchN&&this.regexp_eatKGroupName(f)?!0:(f.switchU&&(f.current()===99&&f.raise("Invalid unicode escape"),f.raise("Invalid escape")),!1)},Fr.regexp_eatBackReference=function(f){var m=f.pos;if(this.regexp_eatDecimalEscape(f)){var C=f.lastIntValue;if(f.switchU)return C>f.maxBackReference&&(f.maxBackReference=C),!0;if(C<=f.numCapturingParens)return!0;f.pos=m}return!1},Fr.regexp_eatKGroupName=function(f){if(f.eat(107)){if(this.regexp_eatGroupName(f))return f.backReferenceNames.push(f.lastStringValue),!0;f.raise("Invalid named reference")}return!1},Fr.regexp_eatCharacterEscape=function(f){return this.regexp_eatControlEscape(f)||this.regexp_eatCControlLetter(f)||this.regexp_eatZero(f)||this.regexp_eatHexEscapeSequence(f)||this.regexp_eatRegExpUnicodeEscapeSequence(f,!1)||!f.switchU&&this.regexp_eatLegacyOctalEscapeSequence(f)||this.regexp_eatIdentityEscape(f)},Fr.regexp_eatCControlLetter=function(f){var m=f.pos;if(f.eat(99)){if(this.regexp_eatControlLetter(f))return!0;f.pos=m}return!1},Fr.regexp_eatZero=function(f){return f.current()===48&&!pu(f.lookahead())?(f.lastIntValue=0,f.advance(),!0):!1},Fr.regexp_eatControlEscape=function(f){var m=f.current();return m===116?(f.lastIntValue=9,f.advance(),!0):m===110?(f.lastIntValue=10,f.advance(),!0):m===118?(f.lastIntValue=11,f.advance(),!0):m===102?(f.lastIntValue=12,f.advance(),!0):m===114?(f.lastIntValue=13,f.advance(),!0):!1},Fr.regexp_eatControlLetter=function(f){var m=f.current();return El(m)?(f.lastIntValue=m%32,f.advance(),!0):!1};function El(f){return f>=65&&f<=90||f>=97&&f<=122}Fr.regexp_eatRegExpUnicodeEscapeSequence=function(f,m){m===void 0&&(m=!1);var C=f.pos,_=m||f.switchU;if(f.eat(117)){if(this.regexp_eatFixedHexDigits(f,4)){var R=f.lastIntValue;if(_&&R>=55296&&R<=56319){var X=f.pos;if(f.eat(92)&&f.eat(117)&&this.regexp_eatFixedHexDigits(f,4)){var oe=f.lastIntValue;if(oe>=56320&&oe<=57343)return f.lastIntValue=(R-55296)*1024+(oe-56320)+65536,!0}f.pos=X,f.lastIntValue=R}return!0}if(_&&f.eat(123)&&this.regexp_eatHexDigits(f)&&f.eat(125)&&ju(f.lastIntValue))return!0;_&&f.raise("Invalid unicode escape"),f.pos=C}return!1};function ju(f){return f>=0&&f<=1114111}Fr.regexp_eatIdentityEscape=function(f){if(f.switchU)return this.regexp_eatSyntaxCharacter(f)?!0:f.eat(47)?(f.lastIntValue=47,!0):!1;var m=f.current();return m!==99&&(!f.switchN||m!==107)?(f.lastIntValue=m,f.advance(),!0):!1},Fr.regexp_eatDecimalEscape=function(f){f.lastIntValue=0;var m=f.current();if(m>=49&&m<=57){do f.lastIntValue=10*f.lastIntValue+(m-48),f.advance();while((m=f.current())>=48&&m<=57);return!0}return!1},Fr.regexp_eatCharacterClassEscape=function(f){var m=f.current();if(Vu(m))return f.lastIntValue=-1,f.advance(),!0;if(f.switchU&&this.options.ecmaVersion>=9&&(m===80||m===112)){if(f.lastIntValue=-1,f.advance(),f.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(f)&&f.eat(125))return!0;f.raise("Invalid property name")}return!1};function Vu(f){return f===100||f===68||f===115||f===83||f===119||f===87}Fr.regexp_eatUnicodePropertyValueExpression=function(f){var m=f.pos;if(this.regexp_eatUnicodePropertyName(f)&&f.eat(61)){var C=f.lastStringValue;if(this.regexp_eatUnicodePropertyValue(f)){var _=f.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(f,C,_),!0}}if(f.pos=m,this.regexp_eatLoneUnicodePropertyNameOrValue(f)){var R=f.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(f,R),!0}return!1},Fr.regexp_validateUnicodePropertyNameAndValue=function(f,m,C){Tt(f.unicodeProperties.nonBinary,m)||f.raise("Invalid property name"),f.unicodeProperties.nonBinary[m].test(C)||f.raise("Invalid property value")},Fr.regexp_validateUnicodePropertyNameOrValue=function(f,m){f.unicodeProperties.binary.test(m)||f.raise("Invalid property name")},Fr.regexp_eatUnicodePropertyName=function(f){var m=0;for(f.lastStringValue="";Wu(m=f.current());)f.lastStringValue+=zu(m),f.advance();return f.lastStringValue!==""};function Wu(f){return El(f)||f===95}Fr.regexp_eatUnicodePropertyValue=function(f){var m=0;for(f.lastStringValue="";xl(m=f.current());)f.lastStringValue+=zu(m),f.advance();return f.lastStringValue!==""};function xl(f){return Wu(f)||pu(f)}Fr.regexp_eatLoneUnicodePropertyNameOrValue=function(f){return this.regexp_eatUnicodePropertyValue(f)},Fr.regexp_eatCharacterClass=function(f){if(f.eat(91)){if(f.eat(94),this.regexp_classRanges(f),f.eat(93))return!0;f.raise("Unterminated character class")}return!1},Fr.regexp_classRanges=function(f){for(;this.regexp_eatClassAtom(f);){var m=f.lastIntValue;if(f.eat(45)&&this.regexp_eatClassAtom(f)){var C=f.lastIntValue;f.switchU&&(m===-1||C===-1)&&f.raise("Invalid character class"),m!==-1&&C!==-1&&m>C&&f.raise("Range out of order in character class")}}},Fr.regexp_eatClassAtom=function(f){var m=f.pos;if(f.eat(92)){if(this.regexp_eatClassEscape(f))return!0;if(f.switchU){var C=f.current();(C===99||pa(C))&&f.raise("Invalid class escape"),f.raise("Invalid escape")}f.pos=m}var _=f.current();return _!==93?(f.lastIntValue=_,f.advance(),!0):!1},Fr.regexp_eatClassEscape=function(f){var m=f.pos;if(f.eat(98))return f.lastIntValue=8,!0;if(f.switchU&&f.eat(45))return f.lastIntValue=45,!0;if(!f.switchU&&f.eat(99)){if(this.regexp_eatClassControlLetter(f))return!0;f.pos=m}return this.regexp_eatCharacterClassEscape(f)||this.regexp_eatCharacterEscape(f)},Fr.regexp_eatClassControlLetter=function(f){var m=f.current();return pu(m)||m===95?(f.lastIntValue=m%32,f.advance(),!0):!1},Fr.regexp_eatHexEscapeSequence=function(f){var m=f.pos;if(f.eat(120)){if(this.regexp_eatFixedHexDigits(f,2))return!0;f.switchU&&f.raise("Invalid escape"),f.pos=m}return!1},Fr.regexp_eatDecimalDigits=function(f){var m=f.pos,C=0;for(f.lastIntValue=0;pu(C=f.current());)f.lastIntValue=10*f.lastIntValue+(C-48),f.advance();return f.pos!==m};function pu(f){return f>=48&&f<=57}Fr.regexp_eatHexDigits=function(f){var m=f.pos,C=0;for(f.lastIntValue=0;Rn(C=f.current());)f.lastIntValue=16*f.lastIntValue+Va(C),f.advance();return f.pos!==m};function Rn(f){return f>=48&&f<=57||f>=65&&f<=70||f>=97&&f<=102}function Va(f){return f>=65&&f<=70?10+(f-65):f>=97&&f<=102?10+(f-97):f-48}Fr.regexp_eatLegacyOctalEscapeSequence=function(f){if(this.regexp_eatOctalDigit(f)){var m=f.lastIntValue;if(this.regexp_eatOctalDigit(f)){var C=f.lastIntValue;m<=3&&this.regexp_eatOctalDigit(f)?f.lastIntValue=m*64+C*8+f.lastIntValue:f.lastIntValue=m*8+C}else f.lastIntValue=m;return!0}return!1},Fr.regexp_eatOctalDigit=function(f){var m=f.current();return pa(m)?(f.lastIntValue=m-48,f.advance(),!0):(f.lastIntValue=0,!1)};function pa(f){return f>=48&&f<=55}Fr.regexp_eatFixedHexDigits=function(f,m){var C=f.pos;f.lastIntValue=0;for(var _=0;_<m;++_){var R=f.current();if(!Rn(R))return f.pos=C,!1;f.lastIntValue=16*f.lastIntValue+Va(R),f.advance()}return!0};var va=function(m){this.type=m.type,this.value=m.value,this.start=m.start,this.end=m.end,m.options.locations&&(this.loc=new be(m,m.startLoc,m.endLoc)),m.options.ranges&&(this.range=[m.start,m.end])},nn=_n.prototype;nn.next=function(f){!f&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new va(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},nn.getToken=function(){return this.next(),new va(this)},typeof Symbol!="undefined"&&(nn[Symbol.iterator]=function(){var f=this;return{next:function(){var m=f.getToken();return{done:m.type===O.eof,value:m}}}}),nn.curContext=function(){return this.context[this.context.length-1]},nn.nextToken=function(){var f=this.curContext();if((!f||!f.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(O.eof);if(f.override)return f.override(this);this.readToken(this.fullCharCodeAtPos())},nn.readToken=function(f){return it(f,this.options.ecmaVersion>=6)||f===92?this.readWord():this.getTokenFromCode(f)},nn.fullCharCodeAtPos=function(){var f=this.input.charCodeAt(this.pos);if(f<=55295||f>=57344)return f;var m=this.input.charCodeAt(this.pos+1);return(f<<10)+m-56613888},nn.skipBlockComment=function(){var f=this.options.onComment&&this.curPosition(),m=this.pos,C=this.input.indexOf("*/",this.pos+=2);if(C===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=C+2,this.options.locations){Pe.lastIndex=m;for(var _;(_=Pe.exec(this.input))&&_.index<this.pos;)++this.curLine,this.lineStart=_.index+_[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(m+2,C),m,this.pos,f,this.curPosition())},nn.skipLineComment=function(f){for(var m=this.pos,C=this.options.onComment&&this.curPosition(),_=this.input.charCodeAt(this.pos+=f);this.pos<this.input.length&&!ve(_);)_=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(m+f,this.pos),m,this.pos,C,this.curPosition())},nn.skipSpace=function(){e:for(;this.pos<this.input.length;){var f=this.input.charCodeAt(this.pos);switch(f){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(f>8&&f<14||f>=5760&&Be.test(String.fromCharCode(f)))++this.pos;else break e}}},nn.finishToken=function(f,m){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var C=this.type;this.type=f,this.value=m,this.updateContext(C)},nn.readToken_dot=function(){var f=this.input.charCodeAt(this.pos+1);if(f>=48&&f<=57)return this.readNumber(!0);var m=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&f===46&&m===46?(this.pos+=3,this.finishToken(O.ellipsis)):(++this.pos,this.finishToken(O.dot))},nn.readToken_slash=function(){var f=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):f===61?this.finishOp(O.assign,2):this.finishOp(O.slash,1)},nn.readToken_mult_modulo_exp=function(f){var m=this.input.charCodeAt(this.pos+1),C=1,_=f===42?O.star:O.modulo;return this.options.ecmaVersion>=7&&f===42&&m===42&&(++C,_=O.starstar,m=this.input.charCodeAt(this.pos+2)),m===61?this.finishOp(O.assign,C+1):this.finishOp(_,C)},nn.readToken_pipe_amp=function(f){var m=this.input.charCodeAt(this.pos+1);if(m===f){if(this.options.ecmaVersion>=12){var C=this.input.charCodeAt(this.pos+2);if(C===61)return this.finishOp(O.assign,3)}return this.finishOp(f===124?O.logicalOR:O.logicalAND,2)}return m===61?this.finishOp(O.assign,2):this.finishOp(f===124?O.bitwiseOR:O.bitwiseAND,1)},nn.readToken_caret=function(){var f=this.input.charCodeAt(this.pos+1);return f===61?this.finishOp(O.assign,2):this.finishOp(O.bitwiseXOR,1)},nn.readToken_plus_min=function(f){var m=this.input.charCodeAt(this.pos+1);return m===f?m===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||at.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(O.incDec,2):m===61?this.finishOp(O.assign,2):this.finishOp(O.plusMin,1)},nn.readToken_lt_gt=function(f){var m=this.input.charCodeAt(this.pos+1),C=1;return m===f?(C=f===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+C)===61?this.finishOp(O.assign,C+1):this.finishOp(O.bitShift,C)):m===33&&f===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(m===61&&(C=2),this.finishOp(O.relational,C))},nn.readToken_eq_excl=function(f){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(O.equality,this.input.charCodeAt(this.pos+2)===61?3:2):f===61&&m===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(O.arrow)):this.finishOp(f===61?O.eq:O.prefix,1)},nn.readToken_question=function(){var f=this.options.ecmaVersion;if(f>=11){var m=this.input.charCodeAt(this.pos+1);if(m===46){var C=this.input.charCodeAt(this.pos+2);if(C<48||C>57)return this.finishOp(O.questionDot,2)}if(m===63){if(f>=12){var _=this.input.charCodeAt(this.pos+2);if(_===61)return this.finishOp(O.assign,3)}return this.finishOp(O.coalesce,2)}}return this.finishOp(O.question,1)},nn.getTokenFromCode=function(f){switch(f){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(O.parenL);case 41:return++this.pos,this.finishToken(O.parenR);case 59:return++this.pos,this.finishToken(O.semi);case 44:return++this.pos,this.finishToken(O.comma);case 91:return++this.pos,this.finishToken(O.bracketL);case 93:return++this.pos,this.finishToken(O.bracketR);case 123:return++this.pos,this.finishToken(O.braceL);case 125:return++this.pos,this.finishToken(O.braceR);case 58:return++this.pos,this.finishToken(O.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(O.backQuote);case 48:var m=this.input.charCodeAt(this.pos+1);if(m===120||m===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(m===111||m===79)return this.readRadixNumber(8);if(m===98||m===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(f);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(f);case 124:case 38:return this.readToken_pipe_amp(f);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(f);case 60:case 62:return this.readToken_lt_gt(f);case 61:case 33:return this.readToken_eq_excl(f);case 63:return this.readToken_question();case 126:return this.finishOp(O.prefix,1)}this.raise(this.pos,"Unexpected character '"+Xu(f)+"'")},nn.finishOp=function(f,m){var C=this.input.slice(this.pos,this.pos+m);return this.pos+=m,this.finishToken(f,C)},nn.readRegexp=function(){for(var f,m,C=this.pos;;){this.pos>=this.input.length&&this.raise(C,"Unterminated regular expression");var _=this.input.charAt(this.pos);if(at.test(_)&&this.raise(C,"Unterminated regular expression"),f)f=!1;else{if(_==="[")m=!0;else if(_==="]"&&m)m=!1;else if(_==="/"&&!m)break;f=_==="\\"}++this.pos}var R=this.input.slice(C,this.pos);++this.pos;var X=this.pos,oe=this.readWord1();this.containsEsc&&this.unexpected(X);var Me=this.regexpState||(this.regexpState=new Qi(this));Me.reset(C,R,oe),this.validateRegExpFlags(Me),this.validateRegExpPattern(Me);var Ie=null;try{Ie=new RegExp(R,oe)}catch(Ct){}return this.finishToken(O.regexp,{pattern:R,flags:oe,value:Ie})},nn.readInt=function(f,m,C){for(var _=this.options.ecmaVersion>=12&&m===void 0,R=C&&this.input.charCodeAt(this.pos)===48,X=this.pos,oe=0,Me=0,Ie=0,Ct=m==null?Infinity:m;Ie<Ct;++Ie,++this.pos){var Pt=this.input.charCodeAt(this.pos),dr=void 0;if(_&&Pt===95){R&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Me===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ie===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Me=Pt;continue}if(Pt>=97?dr=Pt-97+10:Pt>=65?dr=Pt-65+10:Pt>=48&&Pt<=57?dr=Pt-48:dr=Infinity,dr>=f)break;Me=Pt,oe=oe*f+dr}return _&&Me===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===X||m!=null&&this.pos-X!==m?null:oe};function ft(f,m){return m?parseInt(f,8):parseFloat(f.replace(/_/g,""))}function mt(f){return typeof BigInt!="function"?null:BigInt(f.replace(/_/g,""))}nn.readRadixNumber=function(f){var m=this.pos;this.pos+=2;var C=this.readInt(f);return C==null&&this.raise(this.start+2,"Expected number in radix "+f),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(C=mt(this.input.slice(m,this.pos)),++this.pos):it(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(O.num,C)},nn.readNumber=function(f){var m=this.pos;!f&&this.readInt(10,void 0,!0)===null&&this.raise(m,"Invalid number");var C=this.pos-m>=2&&this.input.charCodeAt(m)===48;C&&this.strict&&this.raise(m,"Invalid number");var _=this.input.charCodeAt(this.pos);if(!C&&!f&&this.options.ecmaVersion>=11&&_===110){var R=mt(this.input.slice(m,this.pos));return++this.pos,it(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(O.num,R)}C&&/[89]/.test(this.input.slice(m,this.pos))&&(C=!1),_===46&&!C&&(++this.pos,this.readInt(10),_=this.input.charCodeAt(this.pos)),(_===69||_===101)&&!C&&(_=this.input.charCodeAt(++this.pos),(_===43||_===45)&&++this.pos,this.readInt(10)===null&&this.raise(m,"Invalid number")),it(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var X=ft(this.input.slice(m,this.pos),C);return this.finishToken(O.num,X)},nn.readCodePoint=function(){var f=this.input.charCodeAt(this.pos),m;if(f===123){this.options.ecmaVersion<6&&this.unexpected();var C=++this.pos;m=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,m>1114111&&this.invalidStringToken(C,"Code point out of bounds")}else m=this.readHexChar(4);return m};function Xu(f){return f<=65535?String.fromCharCode(f):(f-=65536,String.fromCharCode((f>>10)+55296,(f&1023)+56320))}nn.readString=function(f){for(var m="",C=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var _=this.input.charCodeAt(this.pos);if(_===f)break;_===92?(m+=this.input.slice(C,this.pos),m+=this.readEscapedChar(!1),C=this.pos):(ve(_,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return m+=this.input.slice(C,this.pos++),this.finishToken(O.string,m)};var Ui={};nn.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(f){if(f===Ui)this.readInvalidTemplateToken();else throw f}this.inTemplateElement=!1},nn.invalidStringToken=function(f,m){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ui;this.raise(f,m)},nn.readTmplToken=function(){for(var f="",m=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var C=this.input.charCodeAt(this.pos);if(C===96||C===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===O.template||this.type===O.invalidTemplate)?C===36?(this.pos+=2,this.finishToken(O.dollarBraceL)):(++this.pos,this.finishToken(O.backQuote)):(f+=this.input.slice(m,this.pos),this.finishToken(O.template,f));if(C===92)f+=this.input.slice(m,this.pos),f+=this.readEscapedChar(!0),m=this.pos;else if(ve(C)){switch(f+=this.input.slice(m,this.pos),++this.pos,C){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:f+=`
`;break;default:f+=String.fromCharCode(C);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),m=this.pos}else++this.pos}},nn.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(O.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},nn.readEscapedChar=function(f){var m=this.input.charCodeAt(++this.pos);switch(++this.pos,m){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Xu(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(f){var C=this.pos-1;return this.invalidStringToken(C,"Invalid escape sequence in template string"),null}default:if(m>=48&&m<=55){var _=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],R=parseInt(_,8);return R>255&&(_=_.slice(0,-1),R=parseInt(_,8)),this.pos+=_.length-1,m=this.input.charCodeAt(this.pos),(_!=="0"||m===56||m===57)&&(this.strict||f)&&this.invalidStringToken(this.pos-1-_.length,f?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(R)}return ve(m)?"":String.fromCharCode(m)}},nn.readHexChar=function(f){var m=this.pos,C=this.readInt(16,f);return C===null&&this.invalidStringToken(m,"Bad character escape sequence"),C},nn.readWord1=function(){this.containsEsc=!1;for(var f="",m=!0,C=this.pos,_=this.options.ecmaVersion>=6;this.pos<this.input.length;){var R=this.fullCharCodeAtPos();if(nt(R,_))this.pos+=R<=65535?1:2;else if(R===92){this.containsEsc=!0,f+=this.input.slice(C,this.pos);var X=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var oe=this.readCodePoint();(m?it:nt)(oe,_)||this.invalidStringToken(X,"Invalid Unicode escape"),f+=Xu(oe),C=this.pos}else break;m=!1}return f+this.input.slice(C,this.pos)},nn.readWord=function(){var f=this.readWord1(),m=O.name;return this.keywords.test(f)&&(m=Re[f]),this.finishToken(m,f)};var Wo="7.4.1";_n.acorn={Parser:_n,version:Wo,defaultOptions:Ge,Position:B,SourceLocation:be,getLineInfo:Te,Node:fn,TokenType:we,tokTypes:O,keywordTypes:Re,TokContext:da,tokContexts:ni,isIdentifierChar:nt,isIdentifierStart:it,Token:va,isNewLine:ve,lineBreak:at,lineBreakG:Pe,nonASCIIwhitespace:Be};function Gi(f,m){return _n.parse(f,m)}function lr(f,m,C){return _n.parseExpressionAt(f,m,C)}function cr(f,m){return _n.tokenizer(f,m)}function Xe(f,m){f.prototype=Object.create(m.prototype),f.prototype.constructor=f,f.__proto__=m}function Bi(f){var m=typeof Map=="function"?new Map:void 0;return Bi=function(_){if(_===null||!Yu(_))return _;if(typeof _!="function")throw new TypeError("Super expression must either be null or a function");if(typeof m!="undefined"){if(m.has(_))return m.get(_);m.set(_,R)}function R(){return zi(_,arguments,Ji(this).constructor)}return R.prototype=Object.create(_.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),co(R,_)},Bi(f)}function z(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(f){return!1}}function zi(f,m,C){return z()?zi=Reflect.construct:zi=function(R,X,oe){var Me=[null];Me.push.apply(Me,X);var Ie=Function.bind.apply(R,Me),Ct=new Ie;return oe&&co(Ct,oe.prototype),Ct},zi.apply(null,arguments)}function Yu(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function co(f,m){return co=Object.setPrototypeOf||function(_,R){return _.__proto__=R,_},co(f,m)}function Ji(f){return Ji=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},Ji(f)}var Hi=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(Bi(Error)),Wa=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(Bi(SyntaxError)),ba=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(Bi(ReferenceError)),Xo=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(Bi(TypeError)),Yo=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(Hi),Xa=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(Wa),yi=function(f){Xe(m,f);function m(){return f.apply(this,arguments)||this}return m}(ba),Hn={UnknownError:[3001,"%0",Yo],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Yo],NodeTypeSyntaxError:[1001,"Unknown node type: %0",yi],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",yi],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",yi],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",yi],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",yi],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",yi],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",yi],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",yi],ParamTypeSyntaxError:[1009,"Unknown param type: %0",yi],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",yi],FunctionUndefinedReferenceError:[2001,"%0 is not a function",ba],VariableUndefinedReferenceError:[2002,"%0 is not defined",ba],IsNotConstructor:[2003,"%0 is not a constructor",Xo]};function $o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(f){return!1}}function Ya(f,m,C){return $o()?Ya=Reflect.construct:Ya=function(R,X,oe){var Me=[null];Me.push.apply(Me,X);var Ie=Function.bind.apply(R,Me),Ct=new Ie;return oe&&Ta(Ct,oe.prototype),Ct},Ya.apply(null,arguments)}function Ta(f,m){return Ta=Object.setPrototypeOf||function(_,R){return _.__proto__=R,_},Ta(f,m)}var Mo="0.0.3";function ma(f,m){Object.defineProperty(f,"name",{value:m,writable:!1,enumerable:!1,configurable:!0})}var ji=Object.prototype.hasOwnProperty,D=Symbol("Break"),V=Symbol("Continue"),he=Symbol("DefaultCase"),Ue=Symbol("EmptyStatementReturn"),Zt=Symbol("WithScopeName"),mr=Symbol("SuperScopeName"),hn=Symbol("RootScopeName"),li=Symbol("GlobalScopeName");function ii(f){return typeof f=="function"}var Kn=function(){function f(C){this.interpreter=C}var m=f.prototype;return m.generator=function(){var _=this.interpreter;function R(){return this.getCurrentScope()}function X(){return this.getGlobalScope()}function oe(){return this.getCurrentContext()}return{getOptions:_.getOptions.bind(_),getCurrentScope:R.bind(_),getGlobalScope:X.bind(_),getCurrentContext:oe.bind(_),getExecStartTime:_.getExecStartTime.bind(_)}},f}();function Vi(f,m,C){if(C===void 0&&(C=!0),!(f instanceof Kn))throw new Error("Illegal call");if(typeof m!="string")return m;if(!!m){var _=f.generator(),R=_.getOptions(),X={timeout:R.timeout,_initEnv:function(){C||this.setCurrentContext(_.getCurrentContext()),this.execStartTime=_.getExecStartTime(),this.execEndTime=this.execStartTime}},oe=C?_.getGlobalScope():_.getCurrentScope(),Me=new vn(oe,X);return Me.evaluate(m)}}Object.defineProperty(Vi,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Sl(f){if(!(f instanceof Kn))throw new Error("Illegal call");for(var m=f.generator(),C=arguments.length,_=new Array(C>1?C-1:0),R=1;R<C;R++)_[R-1]=arguments[R];var X=_.pop(),oe=new vn(m.getGlobalScope(),m.getOptions()),Me=`
		    (function anonymous(`+_.join(",")+`){
		        `+X+`
		    });
		    `;return oe.evaluate(Me)}Object.defineProperty(Sl,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var $a=function(m){this.value=m},ga=function(m){this.value=m},Wi=function(m){this.value=m},vu=function(m,C,_){C===void 0&&(C=null),this.name=_,this.parent=C,this.data=m,this.labelStack=[]};function Ps(){}function Oo(f,m){return f===void 0&&(f=null),new vu(Object.create(null),f,m)}function ef(f){return Object.create(f)}var Ka={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Vi,Function:Sl};typeof JSON!="undefined"&&(Ka.JSON=JSON),typeof Promise!="undefined"&&(Ka.Promise=Promise),typeof Set!="undefined"&&(Ka.Set=Set),typeof Map!="undefined"&&(Ka.Map=Map),typeof Symbol!="undefined"&&(Ka.Symbol=Symbol),typeof Proxy!="undefined"&&(Ka.Proxy=Proxy),typeof WeakMap!="undefined"&&(Ka.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Ka.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Ka.Reflect=Reflect);var vn=function(){function f(C,_){C===void 0&&(C=f.global),_===void 0&&(_={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:_.ecmaVersion||f.ecmaVersion,timeout:_.timeout||0,rootContext:_.rootContext,globalContextInFunction:_.globalContextInFunction===void 0?f.globalContextInFunction:_.globalContextInFunction,_initEnv:_._initEnv},this.context=C||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var m=f.prototype;return m.initEnvironment=function(_){var R;if(_ instanceof vu)R=_;else{var X=null,oe=this.createSuperScope(_);this.options.rootContext&&(X=new vu(ef(this.options.rootContext),oe,hn)),R=new vu(_,X||oe,li)}this.globalScope=R,this.currentScope=this.globalScope,this.globalContext=R.data,this.currentContext=R.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Me=this.options._initEnv;Me&&Me.call(this)},m.getExecStartTime=function(){return this.execStartTime},m.getExecutionTime=function(){return this.execEndTime-this.execStartTime},m.setExecTimeout=function(_){_===void 0&&(_=0),this.options.timeout=_},m.getOptions=function(){return this.options},m.getGlobalScope=function(){return this.globalScope},m.getCurrentScope=function(){return this.currentScope},m.getCurrentContext=function(){return this.currentContext},m.isInterruptThrow=function(_){return _ instanceof Yo||_ instanceof yi||_ instanceof Xa},m.createSuperScope=function(_){var R=Object.assign({},Ka),X=Object.keys(R);return X.forEach(function(oe){oe in _&&delete R[oe]}),new vu(R,null,mr)},m.setCurrentContext=function(_){this.currentContext=_},m.setCurrentScope=function(_){this.currentScope=_},m.evaluate=function(_){_===void 0&&(_="");var R;if(!!_)return R=Gi(_,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||f.ecmaVersion}),this.evaluateNode(R,_)},m.appendCode=function(_){return this.evaluate(_)},m.evaluateNode=function(_,R){var X=this;R===void 0&&(R=""),this.value=void 0,this.source=R,this.sourceList.push(R),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var oe=this.getCurrentScope(),Me=this.getCurrentContext(),Ie=oe.labelStack.concat([]),Ct=this.callStack.concat([]),Pt=function(){X.setCurrentScope(oe),X.setCurrentContext(Me),oe.labelStack=Ie,X.callStack=Ct};try{var dr=this.createClosure(_);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),dr()}catch(zr){throw zr}finally{Pt(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},m.createErrorMessage=function(_,R,X){var oe=_[1].replace("%0",String(R));return X!==null&&(oe+=this.getNodePosition(X||this.lastExecNode)),oe},m.createError=function(_,R){return new R(_)},m.createThrowError=function(_,R){return this.createError(_,R)},m.createInternalThrowError=function(_,R,X){return this.createError(this.createErrorMessage(_,R,X),_[2])},m.checkTimeout=function(){if(!this.isRunning)return!1;var _=this.options.timeout||0,R=Date.now();return R-this.execStartTime>_},m.getNodePosition=function(_){if(_){var R="";return _.loc?" ["+_.loc.start.line+":"+_.loc.start.column+"]"+R:""}return""},m.createClosure=function(_){var R=this,X;switch(_.type){case"BinaryExpression":X=this.binaryExpressionHandler(_);break;case"LogicalExpression":X=this.logicalExpressionHandler(_);break;case"UnaryExpression":X=this.unaryExpressionHandler(_);break;case"UpdateExpression":X=this.updateExpressionHandler(_);break;case"ObjectExpression":X=this.objectExpressionHandler(_);break;case"ArrayExpression":X=this.arrayExpressionHandler(_);break;case"CallExpression":X=this.callExpressionHandler(_);break;case"NewExpression":X=this.newExpressionHandler(_);break;case"MemberExpression":X=this.memberExpressionHandler(_);break;case"ThisExpression":X=this.thisExpressionHandler(_);break;case"SequenceExpression":X=this.sequenceExpressionHandler(_);break;case"Literal":X=this.literalHandler(_);break;case"Identifier":X=this.identifierHandler(_);break;case"AssignmentExpression":X=this.assignmentExpressionHandler(_);break;case"FunctionDeclaration":X=this.functionDeclarationHandler(_);break;case"VariableDeclaration":X=this.variableDeclarationHandler(_);break;case"BlockStatement":case"Program":X=this.programHandler(_);break;case"ExpressionStatement":X=this.expressionStatementHandler(_);break;case"EmptyStatement":X=this.emptyStatementHandler(_);break;case"ReturnStatement":X=this.returnStatementHandler(_);break;case"FunctionExpression":X=this.functionExpressionHandler(_);break;case"IfStatement":X=this.ifStatementHandler(_);break;case"ConditionalExpression":X=this.conditionalExpressionHandler(_);break;case"ForStatement":X=this.forStatementHandler(_);break;case"WhileStatement":X=this.whileStatementHandler(_);break;case"DoWhileStatement":X=this.doWhileStatementHandler(_);break;case"ForInStatement":X=this.forInStatementHandler(_);break;case"WithStatement":X=this.withStatementHandler(_);break;case"ThrowStatement":X=this.throwStatementHandler(_);break;case"TryStatement":X=this.tryStatementHandler(_);break;case"ContinueStatement":X=this.continueStatementHandler(_);break;case"BreakStatement":X=this.breakStatementHandler(_);break;case"SwitchStatement":X=this.switchStatementHandler(_);break;case"LabeledStatement":X=this.labeledStatementHandler(_);break;case"DebuggerStatement":X=this.debuggerStatementHandler(_);break;default:throw this.createInternalThrowError(Hn.NodeTypeSyntaxError,_.type,_)}return function(){var oe=R.options.timeout;if(oe&&oe>0&&R.checkTimeout())throw R.createInternalThrowError(Hn.ExecutionTimeOutError,oe,null);return R.lastExecNode=_,X.apply(void 0,arguments)}},m.binaryExpressionHandler=function(_){var R=this,X=this.createClosure(_.left),oe=this.createClosure(_.right);return function(){var Me=X(),Ie=oe();switch(_.operator){case"==":return Me==Ie;case"!=":return Me!=Ie;case"===":return Me===Ie;case"!==":return Me!==Ie;case"<":return Me<Ie;case"<=":return Me<=Ie;case">":return Me>Ie;case">=":return Me>=Ie;case"<<":return Me<<Ie;case">>":return Me>>Ie;case">>>":return Me>>>Ie;case"+":return Me+Ie;case"-":return Me-Ie;case"*":return Me*Ie;case"**":return Math.pow(Me,Ie);case"/":return Me/Ie;case"%":return Me%Ie;case"|":return Me|Ie;case"^":return Me^Ie;case"&":return Me&Ie;case"in":return Me in Ie;case"instanceof":return Me instanceof Ie;default:throw R.createInternalThrowError(Hn.BinaryOperatorSyntaxError,_.operator,_)}}},m.logicalExpressionHandler=function(_){var R=this,X=this.createClosure(_.left),oe=this.createClosure(_.right);return function(){switch(_.operator){case"||":return X()||oe();case"&&":return X()&&oe();default:throw R.createInternalThrowError(Hn.LogicalOperatorSyntaxError,_.operator,_)}}},m.unaryExpressionHandler=function(_){var R=this;switch(_.operator){case"delete":var X=this.createObjectGetter(_.argument),oe=this.createNameGetter(_.argument);return function(){var Pt=X(),dr=oe();return delete Pt[dr]};default:var Me;if(_.operator==="typeof"&&_.argument.type==="Identifier"){var Ie=this.createObjectGetter(_.argument),Ct=this.createNameGetter(_.argument);Me=function(){return Ie()[Ct()]}}else Me=this.createClosure(_.argument);return function(){var Pt=Me();switch(_.operator){case"-":return-Pt;case"+":return+Pt;case"!":return!Pt;case"~":return~Pt;case"void":return;case"typeof":return typeof Pt;default:throw R.createInternalThrowError(Hn.UnaryOperatorSyntaxError,_.operator,_)}}}},m.updateExpressionHandler=function(_){var R=this,X=this.createObjectGetter(_.argument),oe=this.createNameGetter(_.argument);return function(){var Me=X(),Ie=oe();switch(R.assertVariable(Me,Ie,_),_.operator){case"++":return _.prefix?++Me[Ie]:Me[Ie]++;case"--":return _.prefix?--Me[Ie]:Me[Ie]--;default:throw R.createInternalThrowError(Hn.UpdateOperatorSyntaxError,_.operator,_)}}},m.objectExpressionHandler=function(_){var R=this,X=[];function oe(Ie){return Ie.type==="Identifier"?Ie.name:Ie.type==="Literal"?Ie.value:this.throwError(Hn.ObjectStructureSyntaxError,Ie.type,Ie)}var Me=Object.create(null);return _.properties.forEach(function(Ie){var Ct=Ie.kind,Pt=oe(Ie.key);(!Me[Pt]||Ct==="init")&&(Me[Pt]={}),Me[Pt][Ct]=R.createClosure(Ie.value),X.push({key:Pt,property:Ie})}),function(){for(var Ie={},Ct=X.length,Pt=0;Pt<Ct;Pt++){var dr=X[Pt],zr=dr.key,Ar=Me[zr],Qr=Ar.init?Ar.init():void 0,un=Ar.get?Ar.get():function(){},kn=Ar.set?Ar.set():function(Ro){};if("set"in Ar||"get"in Ar){var Oa={configurable:!0,enumerable:!0,get:un,set:kn};Object.defineProperty(Ie,zr,Oa)}else{var ci=dr.property,ho=ci.kind;ci.key.type==="Identifier"&&ci.value.type==="FunctionExpression"&&ho==="init"&&!ci.value.id&&ma(Qr,ci.key.name),Ie[zr]=Qr}}return Ie}},m.arrayExpressionHandler=function(_){var R=this,X=_.elements.map(function(oe){return oe&&R.createClosure(oe)});return function(){for(var oe=X.length,Me=Array(oe),Ie=0;Ie<oe;Ie++){var Ct=X[Ie];Ct&&(Me[Ie]=Ct())}return Me}},m.safeObjectGet=function(_,R,X){return _[R]},m.createCallFunctionGetter=function(_){var R=this;switch(_.type){case"MemberExpression":var X=this.createClosure(_.object),oe=this.createMemberKeyGetter(_),Me=this.source;return function(){var Ct=X(),Pt=oe(),dr=R.safeObjectGet(Ct,Pt,_);if(!dr||!ii(dr)){var zr=Me.slice(_.start,_.end);throw R.createInternalThrowError(Hn.FunctionUndefinedReferenceError,zr,_)}return dr.__IS_EVAL_FUNC?function(Ar){return dr(new Kn(R),Ar,!0)}:dr.__IS_FUNCTION_FUNC?function(){for(var Ar=arguments.length,Qr=new Array(Ar),un=0;un<Ar;un++)Qr[un]=arguments[un];return dr.apply(void 0,[new Kn(R)].concat(Qr))}:dr.bind(Ct)};default:var Ie=this.createClosure(_);return function(){var Ct="";_.type==="Identifier"&&(Ct=_.name);var Pt=Ie();if(!Pt||!ii(Pt))throw R.createInternalThrowError(Hn.FunctionUndefinedReferenceError,Ct,_);if(_.type==="Identifier"&&Pt.__IS_EVAL_FUNC&&Ct==="eval")return function(Ar){var Qr=R.getScopeFromName(Ct,R.getCurrentScope()),un=Qr.name===mr||Qr.name===li||Qr.name===hn;return Pt(new Kn(R),Ar,!un)};if(Pt.__IS_EVAL_FUNC)return function(Ar){return Pt(new Kn(R),Ar,!0)};if(Pt.__IS_FUNCTION_FUNC)return function(){for(var Ar=arguments.length,Qr=new Array(Ar),un=0;un<Ar;un++)Qr[un]=arguments[un];return Pt.apply(void 0,[new Kn(R)].concat(Qr))};var dr=R.options.globalContextInFunction;if(_.type==="Identifier"){var zr=R.getIdentifierScope(_);zr.name===Zt&&(dr=zr.data)}return Pt.bind(dr)}}},m.callExpressionHandler=function(_){var R=this,X=this.createCallFunctionGetter(_.callee),oe=_.arguments.map(function(Me){return R.createClosure(Me)});return function(){return X().apply(void 0,oe.map(function(Me){return Me()}))}},m.functionExpressionHandler=function(_){var R=this,X=this,oe=this.source,Me=this.collectDeclVars,Ie=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ct=_.id?_.id.name:"",Pt=_.params.length,dr=_.params.map(function(un){return R.createParamNameGetter(un)}),zr=this.createClosure(_.body),Ar=this.collectDeclVars,Qr=this.collectDeclFuncs;return this.collectDeclVars=Me,this.collectDeclFuncs=Ie,function(){var un=X.getCurrentScope(),kn=function Oa(){for(var ci=arguments.length,ho=new Array(ci),Ro=0;Ro<ci;Ro++)ho[Ro]=arguments[Ro];X.callStack.push(""+Ct);var qn=X.getCurrentScope(),_a=Oo(un,"FunctionScope("+Ct+")");X.setCurrentScope(_a),X.addDeclarationsToScope(Ar,Qr,_a),Ct&&(_a.data[Ct]=Oa),_a.data.arguments=arguments,dr.forEach(function(Al,sc){_a.data[Al()]=ho[sc]});var ws=X.getCurrentContext();X.setCurrentContext(this);var uc=zr();if(X.setCurrentContext(ws),X.setCurrentScope(qn),X.callStack.pop(),uc instanceof $a)return uc.value};return ma(kn,Ct),Object.defineProperty(kn,"length",{value:Pt,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(kn,"toString",{value:function(){return oe.slice(_.start,_.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(kn,"valueOf",{value:function(){return oe.slice(_.start,_.end)},writable:!0,configurable:!0,enumerable:!1}),kn}},m.newExpressionHandler=function(_){var R=this,X=this.source,oe=this.createClosure(_.callee),Me=_.arguments.map(function(Ie){return R.createClosure(Ie)});return function(){var Ie=oe();if(!ii(Ie)||Ie.__IS_EVAL_FUNC){var Ct=_.callee,Pt=X.slice(Ct.start,Ct.end);throw R.createInternalThrowError(Hn.IsNotConstructor,Pt,_)}return Ie.__IS_FUNCTION_FUNC?Ie.apply(void 0,[new Kn(R)].concat(Me.map(function(dr){return dr()}))):Ya(Ie,Me.map(function(dr){return dr()}))}},m.memberExpressionHandler=function(_){var R=this.createClosure(_.object),X=this.createMemberKeyGetter(_);return function(){var oe=R(),Me=X();return oe[Me]}},m.thisExpressionHandler=function(_){var R=this;return function(){return R.getCurrentContext()}},m.sequenceExpressionHandler=function(_){var R=this,X=_.expressions.map(function(oe){return R.createClosure(oe)});return function(){for(var oe,Me=X.length,Ie=0;Ie<Me;Ie++){var Ct=X[Ie];oe=Ct()}return oe}},m.literalHandler=function(_){return function(){return _.regex?new RegExp(_.regex.pattern,_.regex.flags):_.value}},m.identifierHandler=function(_){var R=this;return function(){var X=R.getCurrentScope(),oe=R.getScopeDataFromName(_.name,X);return R.assertVariable(oe,_.name,_),oe[_.name]}},m.getIdentifierScope=function(_){var R=this.getCurrentScope(),X=this.getScopeFromName(_.name,R);return X},m.assignmentExpressionHandler=function(_){var R=this;_.left.type==="Identifier"&&_.right.type==="FunctionExpression"&&!_.right.id&&(_.right.id={type:"Identifier",name:_.left.name});var X=this.createObjectGetter(_.left),oe=this.createNameGetter(_.left),Me=this.createClosure(_.right);return function(){var Ie=X(),Ct=oe(),Pt=Me();switch(_.operator!=="="&&R.assertVariable(Ie,Ct,_),_.operator){case"=":return Ie[Ct]=Pt;case"+=":return Ie[Ct]+=Pt;case"-=":return Ie[Ct]-=Pt;case"*=":return Ie[Ct]*=Pt;case"**=":return Ie[Ct]=Math.pow(Ie[Ct],Pt);case"/=":return Ie[Ct]/=Pt;case"%=":return Ie[Ct]%=Pt;case"<<=":return Ie[Ct]<<=Pt;case">>=":return Ie[Ct]>>=Pt;case">>>=":return Ie[Ct]>>>=Pt;case"&=":return Ie[Ct]&=Pt;case"^=":return Ie[Ct]^=Pt;case"|=":return Ie[Ct]|=Pt;default:throw R.createInternalThrowError(Hn.AssignmentExpressionSyntaxError,_.type,_)}}},m.functionDeclarationHandler=function(_){if(_.id){var R=this.functionExpressionHandler(_);Object.defineProperty(R,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(_.id.name,R)}return function(){return Ue}},m.getVariableName=function(_){if(_.type==="Identifier")return _.name;throw this.createInternalThrowError(Hn.VariableTypeSyntaxError,_.type,_)},m.variableDeclarationHandler=function(_){for(var R=this,X,oe=[],Me=0;Me<_.declarations.length;Me++){var Ie=_.declarations[Me];this.varDeclaration(this.getVariableName(Ie.id)),Ie.init&&oe.push({type:"AssignmentExpression",operator:"=",left:Ie.id,right:Ie.init})}return oe.length&&(X=this.createClosure({type:"BlockStatement",body:oe})),function(){if(X){var Ct=R.isVarDeclMode;R.isVarDeclMode=!0,X(),R.isVarDeclMode=Ct}return Ue}},m.assertVariable=function(_,R,X){if(_===this.globalScope.data&&!(R in _))throw this.createInternalThrowError(Hn.VariableUndefinedReferenceError,R,X)},m.programHandler=function(_){var R=this,X=_.body.map(function(oe){return R.createClosure(oe)});return function(){for(var oe=Ue,Me=0;Me<X.length;Me++){var Ie=X[Me],Ct=R.setValue(Ie());if(Ct!==Ue&&(oe=Ct,oe instanceof $a||oe instanceof ga||oe instanceof Wi||oe===D||oe===V))break}return oe}},m.expressionStatementHandler=function(_){return this.createClosure(_.expression)},m.emptyStatementHandler=function(_){return function(){return Ue}},m.returnStatementHandler=function(_){var R=_.argument?this.createClosure(_.argument):Ps;return function(){return new $a(R())}},m.ifStatementHandler=function(_){var R=this.createClosure(_.test),X=this.createClosure(_.consequent),oe=_.alternate?this.createClosure(_.alternate):function(){return Ue};return function(){return R()?X():oe()}},m.conditionalExpressionHandler=function(_){return this.ifStatementHandler(_)},m.forStatementHandler=function(_){var R=this,X=Ps,oe=_.test?this.createClosure(_.test):function(){return!0},Me=Ps,Ie=this.createClosure(_.body);return _.type==="ForStatement"&&(X=_.init?this.createClosure(_.init):X,Me=_.update?this.createClosure(_.update):Ps),function(Ct){var Pt,dr=Ue,zr=_.type==="DoWhileStatement";for(Ct&&Ct.type==="LabeledStatement"&&(Pt=Ct.label.name),X();zr||oe();Me()){zr=!1;var Ar=R.setValue(Ie());if(!(Ar===Ue||Ar===V)){if(Ar===D)break;if(dr=Ar,dr instanceof Wi&&dr.value===Pt){dr=Ue;continue}if(dr instanceof $a||dr instanceof ga||dr instanceof Wi)break}}return dr}},m.whileStatementHandler=function(_){return this.forStatementHandler(_)},m.doWhileStatementHandler=function(_){return this.forStatementHandler(_)},m.forInStatementHandler=function(_){var R=this,X=_.left,oe=this.createClosure(_.right),Me=this.createClosure(_.body);return _.left.type==="VariableDeclaration"&&(this.createClosure(_.left)(),X=_.left.declarations[0].id),function(Ie){var Ct,Pt=Ue,dr;Ie&&Ie.type==="LabeledStatement"&&(Ct=Ie.label.name);var zr=oe();for(dr in zr){R.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:X,right:{type:"Literal",value:dr}})();var Ar=R.setValue(Me());if(!(Ar===Ue||Ar===V)){if(Ar===D)break;if(Pt=Ar,Pt instanceof Wi&&Pt.value===Ct){Pt=Ue;continue}if(Pt instanceof $a||Pt instanceof ga||Pt instanceof Wi)break}}return Pt}},m.withStatementHandler=function(_){var R=this,X=this.createClosure(_.object),oe=this.createClosure(_.body);return function(){var Me=X(),Ie=R.getCurrentScope(),Ct=new vu(Me,Ie,Zt);R.setCurrentScope(Ct);var Pt=R.setValue(oe());return R.setCurrentScope(Ie),Pt}},m.throwStatementHandler=function(_){var R=this,X=this.createClosure(_.argument);return function(){throw R.setValue(void 0),X()}},m.tryStatementHandler=function(_){var R=this,X=this.createClosure(_.block),oe=_.handler?this.catchClauseHandler(_.handler):null,Me=_.finalizer?this.createClosure(_.finalizer):null;return function(){var Ie=R.getCurrentScope(),Ct=R.getCurrentContext(),Pt=Ie.labelStack.concat([]),dr=R.callStack.concat([]),zr=Ue,Ar,Qr,un=function(){R.setCurrentScope(Ie),R.setCurrentContext(Ct),Ie.labelStack=Pt,R.callStack=dr};try{zr=R.setValue(X()),zr instanceof $a&&(Ar=zr)}catch(kn){if(un(),R.isInterruptThrow(kn))throw kn;if(oe)try{zr=R.setValue(oe(kn)),zr instanceof $a&&(Ar=zr)}catch(Oa){if(un(),R.isInterruptThrow(Oa))throw Oa;Qr=Oa}}if(Me)try{zr=Me(),zr instanceof $a&&(Ar=zr)}catch(kn){if(un(),R.isInterruptThrow(kn))throw kn;Qr=kn}if(Qr)throw Qr;return Ar||zr}},m.catchClauseHandler=function(_){var R=this,X=this.createParamNameGetter(_.param),oe=this.createClosure(_.body);return function(Me){var Ie,Ct=R.getCurrentScope(),Pt=Ct.data,dr=X(),zr=ji.call(Pt,dr),Ar=Pt[dr];return Pt[dr]=Me,Ie=oe(),zr?Pt[dr]=Ar:delete Pt[dr],Ie}},m.continueStatementHandler=function(_){return function(){return _.label?new Wi(_.label.name):V}},m.breakStatementHandler=function(_){return function(){return _.label?new ga(_.label.name):D}},m.switchStatementHandler=function(_){var R=this,X=this.createClosure(_.discriminant),oe=_.cases.map(function(Me){return R.switchCaseHandler(Me)});return function(){for(var Me=X(),Ie=!1,Ct,Pt,dr,zr=0;zr<oe.length;zr++){var Ar=oe[zr](),Qr=Ar.testClosure();if(Qr===he){dr=Ar;continue}if(Ie||Qr===Me){if(Ie=!0,Pt=R.setValue(Ar.bodyClosure()),Pt===Ue)continue;if(Pt===D||(Ct=Pt,Ct instanceof $a||Ct instanceof ga||Ct instanceof Wi||Ct===V))break}}if(!Ie&&dr){Pt=R.setValue(dr.bodyClosure());var un=Pt===Ue||Pt===D||Pt===V;un||(Ct=Pt)}return Ct}},m.switchCaseHandler=function(_){var R=_.test?this.createClosure(_.test):function(){return he},X=this.createClosure({type:"BlockStatement",body:_.consequent});return function(){return{testClosure:R,bodyClosure:X}}},m.labeledStatementHandler=function(_){var R=this,X=_.label.name,oe=this.createClosure(_.body);return function(){var Me,Ie=R.getCurrentScope();return Ie.labelStack.push(X),Me=oe(_),Me instanceof ga&&Me.value===X&&(Me=Ue),Ie.labelStack.pop(),Me}},m.debuggerStatementHandler=function(_){return function(){debugger;return Ue}},m.createParamNameGetter=function(_){if(_.type==="Identifier")return function(){return _.name};throw this.createInternalThrowError(Hn.ParamTypeSyntaxError,_.type,_)},m.createObjectKeyGetter=function(_){var R;return _.type==="Identifier"?R=function(){return _.name}:R=this.createClosure(_),function(){return R()}},m.createMemberKeyGetter=function(_){return _.computed?this.createClosure(_.property):this.createObjectKeyGetter(_.property)},m.createObjectGetter=function(_){var R=this;switch(_.type){case"Identifier":return function(){return R.getScopeDataFromName(_.name,R.getCurrentScope())};case"MemberExpression":return this.createClosure(_.object);default:throw this.createInternalThrowError(Hn.AssignmentTypeSyntaxError,_.type,_)}},m.createNameGetter=function(_){switch(_.type){case"Identifier":return function(){return _.name};case"MemberExpression":return this.createMemberKeyGetter(_);default:throw this.createInternalThrowError(Hn.AssignmentTypeSyntaxError,_.type,_)}},m.varDeclaration=function(_){var R=this.collectDeclVars;R[_]=void 0},m.funcDeclaration=function(_,R){var X=this.collectDeclFuncs;X[_]=R},m.addDeclarationsToScope=function(_,R,X){var oe=X.data;for(var Me in R){var Ie=R[Me];oe[Me]=Ie&&Ie()}for(var Ct in _)Ct in oe||(oe[Ct]=void 0)},m.getScopeValue=function(_,R){var X=this.getScopeFromName(_,R);return X.data[_]},m.getScopeDataFromName=function(_,R){return this.getScopeFromName(_,R).data},m.getScopeFromName=function(_,R){var X=R;do if(_ in X.data)return X;while(X=X.parent);return this.globalScope},m.setValue=function(_){var R=this.callStack.length;return this.isVarDeclMode||R||_===Ue||_===D||_===V||_ instanceof ga||_ instanceof Wi||(this.value=_ instanceof $a?_.value:_),_},m.getValue=function(){return this.value},f}();vn.version=Mo,vn.eval=Vi,vn.Function=Sl,vn.ecmaVersion=5,vn.globalContextInFunction=void 0,vn.global=Object.create(null);function dn(f){return f===void 0&&(f=Object.create(null)),f}function ea(f,m,C){m===void 0&&(m=[]),C===void 0&&(C={});var _=C.parsingContext,R=C.timeout===void 0?0:C.timeout,X=`
    (function anonymous(`+m.join(",")+`){
         `+f+`
    });
    `,oe=new vn(_,{ecmaVersion:C.ecmaVersion,timeout:R,rootContext:C.rootContext,globalContextInFunction:C.globalContextInFunction});return oe.evaluate(X)}function $u(f,m,C){var _=new vn(m,C);return _.evaluate(f)}var Wf=$u,Ma=function(){function f(C){this._code=C}var m=f.prototype;return m.runInContext=function(_){return $u(this._code,_)},m.runInNewContext=function(_){return $u(this._code,_)},f}(),Cl=function(f,m,C){return $u(f,m,C)};function fo(){for(var f=arguments.length,m=new Array(f),C=0;C<f;C++)m[C]=arguments[C];var _=m.pop();return ea(_||"",m)}var mu=Cl},20396:function(et,I,T){var W;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(A,$,k,L){"use strict";var U=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,re=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),K=U||re,ne=["","webkit","Moz","MS","ms","o"],le=K?"":$.createElement("div"),pe="function",xe=Math.round,it=Math.abs,nt=Date.now;function we(D,V,he){return setTimeout(Pe(D,he),V)}function Ke(D,V,he){return Array.isArray(D)?(ke(D,he[V],he),!0):!1}function ke(D,V,he){var Ue;if(!!D)if(D.forEach)D.forEach(V,he);else if(D.length!==L)for(Ue=0;Ue<D.length;)V.call(he,D[Ue],Ue,D),Ue++;else for(Ue in D)D.hasOwnProperty(Ue)&&V.call(he,D[Ue],Ue,D)}function Oe(D,V,he){var Ue="DEPRECATED METHOD: "+V+`
`+he+` AT 
`;return function(){var Zt=new Error("get-stack-trace"),mr=Zt&&Zt.stack?Zt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",hn=A.console&&(A.console.warn||A.console.log);return hn&&hn.call(A.console,Ue,mr),D.apply(this,arguments)}}var Re;typeof Object.assign!="function"?Re=function(V){if(V===L||V===null)throw new TypeError("Cannot convert undefined or null to object");for(var he=Object(V),Ue=1;Ue<arguments.length;Ue++){var Zt=arguments[Ue];if(Zt!==L&&Zt!==null)for(var mr in Zt)Zt.hasOwnProperty(mr)&&(he[mr]=Zt[mr])}return he}:Re=Object.assign;var Je=Oe(function(V,he,Ue){for(var Zt=Object.keys(he),mr=0;mr<Zt.length;)(!Ue||Ue&&V[Zt[mr]]===L)&&(V[Zt[mr]]=he[Zt[mr]]),mr++;return V},"extend","Use `assign`."),O=Oe(function(V,he){return Je(V,he,!0)},"merge","Use `assign`.");function at(D,V,he){var Ue=V.prototype,Zt;Zt=D.prototype=Object.create(Ue),Zt.constructor=D,Zt._super=Ue,he&&Re(Zt,he)}function Pe(D,V){return function(){return D.apply(V,arguments)}}function ve(D,V){return typeof D==pe?D.apply(V&&V[0]||L,V):D}function Be(D,V){return D===L?V:D}function Ae(D,V,he){ke(Tt(V),function(Ue){D.addEventListener(Ue,he,!1)})}function ct(D,V,he){ke(Tt(V),function(Ue){D.removeEventListener(Ue,he,!1)})}function ut(D,V){for(;D;){if(D==V)return!0;D=D.parentNode}return!1}function St(D,V){return D.indexOf(V)>-1}function Tt(D){return D.trim().split(/\s+/g)}function Q(D,V,he){if(D.indexOf&&!he)return D.indexOf(V);for(var Ue=0;Ue<D.length;){if(he&&D[Ue][he]==V||!he&&D[Ue]===V)return Ue;Ue++}return-1}function p(D){return Array.prototype.slice.call(D,0)}function B(D,V,he){for(var Ue=[],Zt=[],mr=0;mr<D.length;){var hn=V?D[mr][V]:D[mr];Q(Zt,hn)<0&&Ue.push(D[mr]),Zt[mr]=hn,mr++}return he&&(V?Ue=Ue.sort(function(ii,Kn){return ii[V]>Kn[V]}):Ue=Ue.sort()),Ue}function be(D,V){for(var he,Ue,Zt=V[0].toUpperCase()+V.slice(1),mr=0;mr<ne.length;){if(he=ne[mr],Ue=he?he+Zt:V,Ue in D)return Ue;mr++}return L}var Te=1;function Ge(){return Te++}function $e(D){var V=D.ownerDocument||D;return V.defaultView||V.parentWindow||A}var Mt=/mobile|tablet|ip(ad|hone|od)|android/i,Sr="ontouchstart"in A,gr=be(A,"PointerEvent")!==L,sn=Sr&&Mt.test(navigator.userAgent),Cr="touch",Br="pen",Zr="mouse",kr="kinect",Jn=25,Tn=1,rn=2,En=4,Gr=8,Fn=1,si=2,zn=4,Nn=8,_n=16,On=si|zn,cn=Nn|_n,Aa=On|cn,j=["x","y"],Hr=["clientX","clientY"];function ri(D,V){var he=this;this.manager=D,this.callback=V,this.element=D.element,this.target=D.options.inputTarget,this.domHandler=function(Ue){ve(D.options.enable,[D])&&he.handler(Ue)},this.init()}ri.prototype={handler:function(){},init:function(){this.evEl&&Ae(this.element,this.evEl,this.domHandler),this.evTarget&&Ae(this.target,this.evTarget,this.domHandler),this.evWin&&Ae($e(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ct(this.element,this.evEl,this.domHandler),this.evTarget&&ct(this.target,this.evTarget,this.domHandler),this.evWin&&ct($e(this.element),this.evWin,this.domHandler)}};function fu(D){var V,he=D.options.inputClass;return he?V=he:gr?V=du:sn?V=Qi:Sr?V=$n:V=lo,new V(D,qe)}function qe(D,V,he){var Ue=he.pointers.length,Zt=he.changedPointers.length,mr=V&Tn&&Ue-Zt==0,hn=V&(En|Gr)&&Ue-Zt==0;he.isFirst=!!mr,he.isFinal=!!hn,mr&&(D.session={}),he.eventType=V,dt(D,he),D.emit("hammer.input",he),D.recognize(he),D.session.prevInput=he}function dt(D,V){var he=D.session,Ue=V.pointers,Zt=Ue.length;he.firstInput||(he.firstInput=yr(V)),Zt>1&&!he.firstMultiple?he.firstMultiple=yr(V):Zt===1&&(he.firstMultiple=!1);var mr=he.firstInput,hn=he.firstMultiple,li=hn?hn.center:mr.center,ii=V.center=Tr(Ue);V.timeStamp=nt(),V.deltaTime=V.timeStamp-mr.timeStamp,V.angle=ln(li,ii),V.distance=vr(li,ii),Nt(he,V),V.offsetDirection=Vr(V.deltaX,V.deltaY);var Kn=$r(V.deltaTime,V.deltaX,V.deltaY);V.overallVelocityX=Kn.x,V.overallVelocityY=Kn.y,V.overallVelocity=it(Kn.x)>it(Kn.y)?Kn.x:Kn.y,V.scale=hn?Ni(hn.pointers,Ue):1,V.rotation=hn?fn(hn.pointers,Ue):0,V.maxPointers=he.prevInput?V.pointers.length>he.prevInput.maxPointers?V.pointers.length:he.prevInput.maxPointers:V.pointers.length,ar(he,V);var Vi=D.element;ut(V.srcEvent.target,Vi)&&(Vi=V.srcEvent.target),V.target=Vi}function Nt(D,V){var he=V.center,Ue=D.offsetDelta||{},Zt=D.prevDelta||{},mr=D.prevInput||{};(V.eventType===Tn||mr.eventType===En)&&(Zt=D.prevDelta={x:mr.deltaX||0,y:mr.deltaY||0},Ue=D.offsetDelta={x:he.x,y:he.y}),V.deltaX=Zt.x+(he.x-Ue.x),V.deltaY=Zt.y+(he.y-Ue.y)}function ar(D,V){var he=D.lastInterval||V,Ue=V.timeStamp-he.timeStamp,Zt,mr,hn,li;if(V.eventType!=Gr&&(Ue>Jn||he.velocity===L)){var ii=V.deltaX-he.deltaX,Kn=V.deltaY-he.deltaY,Vi=$r(Ue,ii,Kn);mr=Vi.x,hn=Vi.y,Zt=it(Vi.x)>it(Vi.y)?Vi.x:Vi.y,li=Vr(ii,Kn),D.lastInterval=V}else Zt=he.velocity,mr=he.velocityX,hn=he.velocityY,li=he.direction;V.velocity=Zt,V.velocityX=mr,V.velocityY=hn,V.direction=li}function yr(D){for(var V=[],he=0;he<D.pointers.length;)V[he]={clientX:xe(D.pointers[he].clientX),clientY:xe(D.pointers[he].clientY)},he++;return{timeStamp:nt(),pointers:V,center:Tr(V),deltaX:D.deltaX,deltaY:D.deltaY}}function Tr(D){var V=D.length;if(V===1)return{x:xe(D[0].clientX),y:xe(D[0].clientY)};for(var he=0,Ue=0,Zt=0;Zt<V;)he+=D[Zt].clientX,Ue+=D[Zt].clientY,Zt++;return{x:xe(he/V),y:xe(Ue/V)}}function $r(D,V,he){return{x:V/D||0,y:he/D||0}}function Vr(D,V){return D===V?Fn:it(D)>=it(V)?D<0?si:zn:V<0?Nn:_n}function vr(D,V,he){he||(he=j);var Ue=V[he[0]]-D[he[0]],Zt=V[he[1]]-D[he[1]];return Math.sqrt(Ue*Ue+Zt*Zt)}function ln(D,V,he){he||(he=j);var Ue=V[he[0]]-D[he[0]],Zt=V[he[1]]-D[he[1]];return Math.atan2(Zt,Ue)*180/Math.PI}function fn(D,V){return ln(V[1],V[0],Hr)+ln(D[1],D[0],Hr)}function Ni(D,V){return vr(V[0],V[1],Hr)/vr(D[0],D[1],Hr)}var hu={mousedown:Tn,mousemove:rn,mouseup:En},da="mousedown",ni="mousemove mouseup";function lo(){this.evEl=da,this.evWin=ni,this.pressed=!1,ri.apply(this,arguments)}at(lo,ri,{handler:function(V){var he=hu[V.type];he&Tn&&V.button===0&&(this.pressed=!0),he&rn&&V.which!==1&&(he=En),!!this.pressed&&(he&En&&(this.pressed=!1),this.callback(this.manager,he,{pointers:[V],changedPointers:[V],pointerType:Zr,srcEvent:V}))}});var gl={pointerdown:Tn,pointermove:rn,pointerup:En,pointercancel:Gr,pointerout:Gr},To={2:Cr,3:Br,4:Zr,5:kr},Ms="pointerdown",Os="pointermove pointerup pointercancel";!K&&A.MSPointerEvent&&!A.PointerEvent&&(Ms="MSPointerDown",Os="MSPointerMove MSPointerUp MSPointerCancel");function du(){this.evEl=Ms,this.evWin=Os,ri.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}at(du,ri,{handler:function(V){var he=this.store,Ue=!1,Zt=V.type.toLowerCase().replace("ms",""),mr=gl[Zt],hn=To[V.pointerType]||V.pointerType,li=hn==Cr,ii=Q(he,V.pointerId,"pointerId");mr&Tn&&(V.button===0||li)?ii<0&&(he.push(V),ii=he.length-1):mr&(En|Gr)&&(Ue=!0),!(ii<0)&&(he[ii]=V,this.callback(this.manager,mr,{pointers:he,changedPointers:[V],pointerType:hn,srcEvent:V}),Ue&&he.splice(ii,1))}});var ki={touchstart:Tn,touchmove:rn,touchend:En,touchcancel:Gr},_l="touchstart",oc="touchstart touchmove touchend touchcancel";function Vo(){this.evTarget=_l,this.evWin=oc,this.started=!1,ri.apply(this,arguments)}at(Vo,ri,{handler:function(V){var he=ki[V.type];if(he===Tn&&(this.started=!0),!!this.started){var Ue=yl.call(this,V,he);he&(En|Gr)&&Ue[0].length-Ue[1].length==0&&(this.started=!1),this.callback(this.manager,he,{pointers:Ue[0],changedPointers:Ue[1],pointerType:Cr,srcEvent:V})}}});function yl(D,V){var he=p(D.touches),Ue=p(D.changedTouches);return V&(En|Gr)&&(he=B(he.concat(Ue),"identifier",!0)),[he,Ue]}var ja={touchstart:Tn,touchmove:rn,touchend:En,touchcancel:Gr},Fr="touchstart touchmove touchend touchcancel";function Qi(){this.evTarget=Fr,this.targetIds={},ri.apply(this,arguments)}at(Qi,ri,{handler:function(V){var he=ja[V.type],Ue=zu.call(this,V,he);!Ue||this.callback(this.manager,he,{pointers:Ue[0],changedPointers:Ue[1],pointerType:Cr,srcEvent:V})}});function zu(D,V){var he=p(D.touches),Ue=this.targetIds;if(V&(Tn|rn)&&he.length===1)return Ue[he[0].identifier]=!0,[he,he];var Zt,mr,hn=p(D.changedTouches),li=[],ii=this.target;if(mr=he.filter(function(Kn){return ut(Kn.target,ii)}),V===Tn)for(Zt=0;Zt<mr.length;)Ue[mr[Zt].identifier]=!0,Zt++;for(Zt=0;Zt<hn.length;)Ue[hn[Zt].identifier]&&li.push(hn[Zt]),V&(En|Gr)&&delete Ue[hn[Zt].identifier],Zt++;if(!!li.length)return[B(mr.concat(li),"identifier",!0),li]}var Hu=2500,Rs=25;function $n(){ri.apply(this,arguments);var D=Pe(this.handler,this);this.touch=new Qi(this.manager,D),this.mouse=new lo(this.manager,D),this.primaryTouch=null,this.lastTouches=[]}at($n,ri,{handler:function(V,he,Ue){var Zt=Ue.pointerType==Cr,mr=Ue.pointerType==Zr;if(!(mr&&Ue.sourceCapabilities&&Ue.sourceCapabilities.firesTouchEvents)){if(Zt)El.call(this,he,Ue);else if(mr&&Vu.call(this,Ue))return;this.callback(V,he,Ue)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function El(D,V){D&Tn?(this.primaryTouch=V.changedPointers[0].identifier,ju.call(this,V)):D&(En|Gr)&&ju.call(this,V)}function ju(D){var V=D.changedPointers[0];if(V.identifier===this.primaryTouch){var he={x:V.clientX,y:V.clientY};this.lastTouches.push(he);var Ue=this.lastTouches,Zt=function(){var mr=Ue.indexOf(he);mr>-1&&Ue.splice(mr,1)};setTimeout(Zt,Hu)}}function Vu(D){for(var V=D.srcEvent.clientX,he=D.srcEvent.clientY,Ue=0;Ue<this.lastTouches.length;Ue++){var Zt=this.lastTouches[Ue],mr=Math.abs(V-Zt.x),hn=Math.abs(he-Zt.y);if(mr<=Rs&&hn<=Rs)return!0}return!1}var Wu=K?L:be(le.style,"touchAction"),xl=Wu!==L,pu="compute",Rn="auto",Va="manipulation",pa="none",va="pan-x",nn="pan-y",ft=Ui();function mt(D,V){this.manager=D,this.set(V)}mt.prototype={set:function(D){D==pu&&(D=this.compute()),xl&&this.manager.element.style&&ft[D]&&(this.manager.element.style[Wu]=D),this.actions=D.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var D=[];return ke(this.manager.recognizers,function(V){ve(V.options.enable,[V])&&(D=D.concat(V.getTouchAction()))}),Xu(D.join(" "))},preventDefaults:function(D){var V=D.srcEvent,he=D.offsetDirection;if(this.manager.session.prevented){V.preventDefault();return}var Ue=this.actions,Zt=St(Ue,pa)&&!ft[pa],mr=St(Ue,nn)&&!ft[nn],hn=St(Ue,va)&&!ft[va];if(Zt){var li=D.pointers.length===1,ii=D.distance<2,Kn=D.deltaTime<250;if(li&&ii&&Kn)return}if(!(hn&&mr)&&(Zt||mr&&he&On||hn&&he&cn))return this.preventSrc(V)},preventSrc:function(D){this.manager.session.prevented=!0,D.preventDefault()}};function Xu(D){if(St(D,pa))return pa;var V=St(D,va),he=St(D,nn);return V&&he?pa:V||he?V?va:nn:St(D,Va)?Va:Rn}function Ui(){if(!xl)return!1;var D={};if(K)return D;var V=A.CSS&&A.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(he){D[he]=V?A.CSS.supports("touch-action",he):!0}),D}var Wo=1,Gi=2,lr=4,cr=8,Xe=cr,Bi=16,z=32;function zi(D){this.options=Re({},this.defaults,D||{}),this.id=Ge(),this.manager=null,this.options.enable=Be(this.options.enable,!0),this.state=Wo,this.simultaneous={},this.requireFail=[]}zi.prototype={defaults:{},set:function(D){return Re(this.options,D),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(D){if(Ke(D,"recognizeWith",this))return this;var V=this.simultaneous;return D=Ji(D,this),V[D.id]||(V[D.id]=D,D.recognizeWith(this)),this},dropRecognizeWith:function(D){return Ke(D,"dropRecognizeWith",this)?this:(D=Ji(D,this),delete this.simultaneous[D.id],this)},requireFailure:function(D){if(Ke(D,"requireFailure",this))return this;var V=this.requireFail;return D=Ji(D,this),Q(V,D)===-1&&(V.push(D),D.requireFailure(this)),this},dropRequireFailure:function(D){if(Ke(D,"dropRequireFailure",this))return this;D=Ji(D,this);var V=Q(this.requireFail,D);return V>-1&&this.requireFail.splice(V,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(D){return!!this.simultaneous[D.id]},emit:function(D){var V=this,he=this.state;function Ue(Zt){V.manager.emit(Zt,D)}he<cr&&Ue(V.options.event+Yu(he)),Ue(V.options.event),D.additionalEvent&&Ue(D.additionalEvent),he>=cr&&Ue(V.options.event+Yu(he))},tryEmit:function(D){if(this.canEmit())return this.emit(D);this.state=z},canEmit:function(){for(var D=0;D<this.requireFail.length;){if(!(this.requireFail[D].state&(z|Wo)))return!1;D++}return!0},recognize:function(D){var V=Re({},D);if(!ve(this.options.enable,[this,V])){this.reset(),this.state=z;return}this.state&(Xe|Bi|z)&&(this.state=Wo),this.state=this.process(V),this.state&(Gi|lr|cr|Bi)&&this.tryEmit(V)},process:function(D){},getTouchAction:function(){},reset:function(){}};function Yu(D){return D&Bi?"cancel":D&cr?"end":D&lr?"move":D&Gi?"start":""}function co(D){return D==_n?"down":D==Nn?"up":D==si?"left":D==zn?"right":""}function Ji(D,V){var he=V.manager;return he?he.get(D):D}function Hi(){zi.apply(this,arguments)}at(Hi,zi,{defaults:{pointers:1},attrTest:function(D){var V=this.options.pointers;return V===0||D.pointers.length===V},process:function(D){var V=this.state,he=D.eventType,Ue=V&(Gi|lr),Zt=this.attrTest(D);return Ue&&(he&Gr||!Zt)?V|Bi:Ue||Zt?he&En?V|cr:V&Gi?V|lr:Gi:z}});function Wa(){Hi.apply(this,arguments),this.pX=null,this.pY=null}at(Wa,Hi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Aa},getTouchAction:function(){var D=this.options.direction,V=[];return D&On&&V.push(nn),D&cn&&V.push(va),V},directionTest:function(D){var V=this.options,he=!0,Ue=D.distance,Zt=D.direction,mr=D.deltaX,hn=D.deltaY;return Zt&V.direction||(V.direction&On?(Zt=mr===0?Fn:mr<0?si:zn,he=mr!=this.pX,Ue=Math.abs(D.deltaX)):(Zt=hn===0?Fn:hn<0?Nn:_n,he=hn!=this.pY,Ue=Math.abs(D.deltaY))),D.direction=Zt,he&&Ue>V.threshold&&Zt&V.direction},attrTest:function(D){return Hi.prototype.attrTest.call(this,D)&&(this.state&Gi||!(this.state&Gi)&&this.directionTest(D))},emit:function(D){this.pX=D.deltaX,this.pY=D.deltaY;var V=co(D.direction);V&&(D.additionalEvent=this.options.event+V),this._super.emit.call(this,D)}});function ba(){Hi.apply(this,arguments)}at(ba,Hi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[pa]},attrTest:function(D){return this._super.attrTest.call(this,D)&&(Math.abs(D.scale-1)>this.options.threshold||this.state&Gi)},emit:function(D){if(D.scale!==1){var V=D.scale<1?"in":"out";D.additionalEvent=this.options.event+V}this._super.emit.call(this,D)}});function Xo(){zi.apply(this,arguments),this._timer=null,this._input=null}at(Xo,zi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Rn]},process:function(D){var V=this.options,he=D.pointers.length===V.pointers,Ue=D.distance<V.threshold,Zt=D.deltaTime>V.time;if(this._input=D,!Ue||!he||D.eventType&(En|Gr)&&!Zt)this.reset();else if(D.eventType&Tn)this.reset(),this._timer=we(function(){this.state=Xe,this.tryEmit()},V.time,this);else if(D.eventType&En)return Xe;return z},reset:function(){clearTimeout(this._timer)},emit:function(D){this.state===Xe&&(D&&D.eventType&En?this.manager.emit(this.options.event+"up",D):(this._input.timeStamp=nt(),this.manager.emit(this.options.event,this._input)))}});function Yo(){Hi.apply(this,arguments)}at(Yo,Hi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[pa]},attrTest:function(D){return this._super.attrTest.call(this,D)&&(Math.abs(D.rotation)>this.options.threshold||this.state&Gi)}});function Xa(){Hi.apply(this,arguments)}at(Xa,Hi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:On|cn,pointers:1},getTouchAction:function(){return Wa.prototype.getTouchAction.call(this)},attrTest:function(D){var V=this.options.direction,he;return V&(On|cn)?he=D.overallVelocity:V&On?he=D.overallVelocityX:V&cn&&(he=D.overallVelocityY),this._super.attrTest.call(this,D)&&V&D.offsetDirection&&D.distance>this.options.threshold&&D.maxPointers==this.options.pointers&&it(he)>this.options.velocity&&D.eventType&En},emit:function(D){var V=co(D.offsetDirection);V&&this.manager.emit(this.options.event+V,D),this.manager.emit(this.options.event,D)}});function yi(){zi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}at(yi,zi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Va]},process:function(D){var V=this.options,he=D.pointers.length===V.pointers,Ue=D.distance<V.threshold,Zt=D.deltaTime<V.time;if(this.reset(),D.eventType&Tn&&this.count===0)return this.failTimeout();if(Ue&&Zt&&he){if(D.eventType!=En)return this.failTimeout();var mr=this.pTime?D.timeStamp-this.pTime<V.interval:!0,hn=!this.pCenter||vr(this.pCenter,D.center)<V.posThreshold;this.pTime=D.timeStamp,this.pCenter=D.center,!hn||!mr?this.count=1:this.count+=1,this._input=D;var li=this.count%V.taps;if(li===0)return this.hasRequireFailures()?(this._timer=we(function(){this.state=Xe,this.tryEmit()},V.interval,this),Gi):Xe}return z},failTimeout:function(){return this._timer=we(function(){this.state=z},this.options.interval,this),z},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Xe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Hn(D,V){return V=V||{},V.recognizers=Be(V.recognizers,Hn.defaults.preset),new Ta(D,V)}Hn.VERSION="2.0.7",Hn.defaults={domEvents:!1,touchAction:pu,enable:!0,inputTarget:null,inputClass:null,preset:[[Yo,{enable:!1}],[ba,{enable:!1},["rotate"]],[Xa,{direction:On}],[Wa,{direction:On},["swipe"]],[yi],[yi,{event:"doubletap",taps:2},["tap"]],[Xo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $o=1,Ya=2;function Ta(D,V){this.options=Re({},Hn.defaults,V||{}),this.options.inputTarget=this.options.inputTarget||D,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=D,this.input=fu(this),this.touchAction=new mt(this,this.options.touchAction),Mo(this,!0),ke(this.options.recognizers,function(he){var Ue=this.add(new he[0](he[1]));he[2]&&Ue.recognizeWith(he[2]),he[3]&&Ue.requireFailure(he[3])},this)}Ta.prototype={set:function(D){return Re(this.options,D),D.touchAction&&this.touchAction.update(),D.inputTarget&&(this.input.destroy(),this.input.target=D.inputTarget,this.input.init()),this},stop:function(D){this.session.stopped=D?Ya:$o},recognize:function(D){var V=this.session;if(!V.stopped){this.touchAction.preventDefaults(D);var he,Ue=this.recognizers,Zt=V.curRecognizer;(!Zt||Zt&&Zt.state&Xe)&&(Zt=V.curRecognizer=null);for(var mr=0;mr<Ue.length;)he=Ue[mr],V.stopped!==Ya&&(!Zt||he==Zt||he.canRecognizeWith(Zt))?he.recognize(D):he.reset(),!Zt&&he.state&(Gi|lr|cr)&&(Zt=V.curRecognizer=he),mr++}},get:function(D){if(D instanceof zi)return D;for(var V=this.recognizers,he=0;he<V.length;he++)if(V[he].options.event==D)return V[he];return null},add:function(D){if(Ke(D,"add",this))return this;var V=this.get(D.options.event);return V&&this.remove(V),this.recognizers.push(D),D.manager=this,this.touchAction.update(),D},remove:function(D){if(Ke(D,"remove",this))return this;if(D=this.get(D),D){var V=this.recognizers,he=Q(V,D);he!==-1&&(V.splice(he,1),this.touchAction.update())}return this},on:function(D,V){if(D!==L&&V!==L){var he=this.handlers;return ke(Tt(D),function(Ue){he[Ue]=he[Ue]||[],he[Ue].push(V)}),this}},off:function(D,V){if(D!==L){var he=this.handlers;return ke(Tt(D),function(Ue){V?he[Ue]&&he[Ue].splice(Q(he[Ue],V),1):delete he[Ue]}),this}},emit:function(D,V){this.options.domEvents&&ma(D,V);var he=this.handlers[D]&&this.handlers[D].slice();if(!(!he||!he.length)){V.type=D,V.preventDefault=function(){V.srcEvent.preventDefault()};for(var Ue=0;Ue<he.length;)he[Ue](V),Ue++}},destroy:function(){this.element&&Mo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Mo(D,V){var he=D.element;if(!!he.style){var Ue;ke(D.options.cssProps,function(Zt,mr){Ue=be(he.style,mr),V?(D.oldCssProps[Ue]=he.style[Ue],he.style[Ue]=Zt):he.style[Ue]=D.oldCssProps[Ue]||""}),V||(D.oldCssProps={})}}function ma(D,V){if(!K){var he=$.createEvent("Event");he.initEvent(D,!0,!0),he.gesture=V,V.target.dispatchEvent(he)}}if(!K){Re(Hn,{INPUT_START:Tn,INPUT_MOVE:rn,INPUT_END:En,INPUT_CANCEL:Gr,STATE_POSSIBLE:Wo,STATE_BEGAN:Gi,STATE_CHANGED:lr,STATE_ENDED:cr,STATE_RECOGNIZED:Xe,STATE_CANCELLED:Bi,STATE_FAILED:z,DIRECTION_NONE:Fn,DIRECTION_LEFT:si,DIRECTION_RIGHT:zn,DIRECTION_UP:Nn,DIRECTION_DOWN:_n,DIRECTION_HORIZONTAL:On,DIRECTION_VERTICAL:cn,DIRECTION_ALL:Aa,Manager:Ta,Input:ri,TouchAction:mt,TouchInput:Qi,MouseInput:lo,PointerEventInput:du,TouchMouseInput:$n,SingleTouchInput:Vo,Recognizer:zi,AttrRecognizer:Hi,Tap:yi,Pan:Wa,Swipe:Xa,Pinch:ba,Rotate:Yo,Press:Xo,on:Ae,off:ct,each:ke,merge:O,extend:Je,assign:Re,inherit:at,bindFn:Pe,prefixed:be});var ji=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ji.Hammer=Hn,W=function(){return Hn}.call(I,T,I,et),W!==L&&(et.exports=W)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(et,I,T){(function(W,A){et.exports=A(T(18857))})(this,function(W){"use strict";var A=function(S){return S instanceof Uint8Array||S instanceof Uint16Array||S instanceof Uint32Array||S instanceof Int8Array||S instanceof Int16Array||S instanceof Int32Array||S instanceof Float32Array||S instanceof Float64Array||S instanceof Uint8ClampedArray},$=function(S,G){for(var ie=Object.keys(G),De=0;De<ie.length;++De)S[ie[De]]=G[ie[De]];return S},k=`
`;function L(S){return typeof atob!="undefined"?atob(S):"base64:"+S}function U(S){var G=new Error("(regl) "+S);throw console.error(G),G}function re(S,G){S||U(G)}function K(S){return S?": "+S:""}function ne(S,G,ie){S in G||U("unknown parameter ("+S+")"+K(ie)+". possible values: "+Object.keys(G).join())}function le(S,G){A(S)||U("invalid parameter type"+K(G)+". must be a typed array")}function pe(S,G){switch(G){case"number":return typeof S=="number";case"object":return typeof S=="object";case"string":return typeof S=="string";case"boolean":return typeof S=="boolean";case"function":return typeof S=="function";case"undefined":return typeof S=="undefined";case"symbol":return typeof S=="symbol"}}function xe(S,G,ie){pe(S,G)||U("invalid parameter type"+K(ie)+". expected "+G+", got "+typeof S)}function it(S,G){S>=0&&(S|0)===S||U("invalid parameter type, ("+S+")"+K(G)+". must be a nonnegative integer")}function nt(S,G,ie){G.indexOf(S)<0&&U("invalid value"+K(ie)+". must be one of: "+G)}var we=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ke(S){Object.keys(S).forEach(function(G){we.indexOf(G)<0&&U('invalid regl constructor argument "'+G+'". must be one of '+we)})}function ke(S,G){for(S=S+"";S.length<G;)S=" "+S;return S}function Oe(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Re(S,G){this.number=S,this.line=G,this.errors=[]}function Je(S,G,ie){this.file=S,this.line=G,this.message=ie}function O(){var S=new Error,G=(S.stack||S).toString(),ie=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(G);if(ie)return ie[1];var De=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(G);return De?De[1]:"unknown"}function at(){var S=new Error,G=(S.stack||S).toString(),ie=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(G);if(ie)return ie[1];var De=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(G);return De?De[1]:"unknown"}function Pe(S,G){var ie=S.split(`
`),De=1,pt=0,ze={unknown:new Oe,0:new Oe};ze.unknown.name=ze[0].name=G||O(),ze.unknown.lines.push(new Re(0,""));for(var tt=0;tt<ie.length;++tt){var gt=ie[tt],bt=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(gt);if(bt)switch(bt[1]){case"line":var vt=/(\d+)(\s+\d+)?/.exec(bt[2]);vt&&(De=vt[1]|0,vt[2]&&(pt=vt[2]|0,pt in ze||(ze[pt]=new Oe)));break;case"define":var At=/SHADER_NAME(_B64)?\s+(.*)$/.exec(bt[2]);At&&(ze[pt].name=At[1]?L(At[2]):At[2]);break}ze[pt].lines.push(new Re(De++,gt))}return Object.keys(ze).forEach(function(Ft){var kt=ze[Ft];kt.lines.forEach(function(_t){kt.index[_t.number]=_t})}),ze}function ve(S){var G=[];return S.split(`
`).forEach(function(ie){if(!(ie.length<5)){var De=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ie);De?G.push(new Je(De[1]|0,De[2]|0,De[3].trim())):ie.length>0&&G.push(new Je("unknown",0,ie))}}),G}function Be(S,G){G.forEach(function(ie){var De=S[ie.file];if(De){var pt=De.index[ie.line];if(pt){pt.errors.push(ie),De.hasErrors=!0;return}}S.unknown.hasErrors=!0,S.unknown.lines[0].errors.push(ie)})}function Ae(S,G,ie,De,pt){if(!S.getShaderParameter(G,S.COMPILE_STATUS)){var ze=S.getShaderInfoLog(G),tt=De===S.FRAGMENT_SHADER?"fragment":"vertex";B(ie,"string",tt+" shader source must be a string",pt);var gt=Pe(ie,pt),bt=ve(ze);Be(gt,bt),Object.keys(gt).forEach(function(vt){var At=gt[vt];if(!At.hasErrors)return;var Ft=[""],kt=[""];function _t(Dt,Ce){Ft.push(Dt),kt.push(Ce||"")}_t("file number "+vt+": "+At.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),At.lines.forEach(function(Dt){if(Dt.errors.length>0){_t(ke(Dt.number,4)+"|  ","background-color:yellow; font-weight:bold"),_t(Dt.line+k,"color:red; background-color:yellow; font-weight:bold");var Ce=0;Dt.errors.forEach(function(He){var wt=He.message,tr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(wt);if(tr){var yt=tr[1];switch(wt=tr[2],yt){case"assign":yt="=";break}Ce=Math.max(Dt.line.indexOf(yt,Ce),0)}else Ce=0;_t(ke("| ",6)),_t(ke("^^^",Ce+3)+k,"font-weight:bold"),_t(ke("| ",6)),_t(wt+k,"font-weight:bold")}),_t(ke("| ",6)+k)}else _t(ke(Dt.number,4)+"|  "),_t(Dt.line+k,"color:red")}),typeof document!="undefined"&&!window.chrome?(kt[0]=Ft.join("%c"),console.log.apply(console,kt)):console.log(Ft.join(""))}),re.raise("Error compiling "+tt+" shader, "+gt[0].name)}}function ct(S,G,ie,De,pt){if(!S.getProgramParameter(G,S.LINK_STATUS)){var ze=S.getProgramInfoLog(G),tt=Pe(ie,pt),gt=Pe(De,pt),bt='Error linking program with vertex shader, "'+gt[0].name+'", and fragment shader "'+tt[0].name+'"';typeof document!="undefined"?console.log("%c"+bt+k+"%c"+ze,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(bt+k+ze),re.raise(bt)}}function ut(S){S._commandRef=O()}function St(S,G,ie,De){ut(S);function pt(bt){return bt?De.id(bt):0}S._fragId=pt(S.static.frag),S._vertId=pt(S.static.vert);function ze(bt,vt){Object.keys(vt).forEach(function(At){bt[De.id(At)]=!0})}var tt=S._uniformSet={};ze(tt,G.static),ze(tt,G.dynamic);var gt=S._attributeSet={};ze(gt,ie.static),ze(gt,ie.dynamic),S._hasCount="count"in S.static||"count"in S.dynamic||"elements"in S.static||"elements"in S.dynamic}function Tt(S,G){var ie=at();U(S+" in command "+(G||O())+(ie==="unknown"?"":" called from "+ie))}function Q(S,G,ie){S||Tt(G,ie||O())}function p(S,G,ie,De){S in G||Tt("unknown parameter ("+S+")"+K(ie)+". possible values: "+Object.keys(G).join(),De||O())}function B(S,G,ie,De){pe(S,G)||Tt("invalid parameter type"+K(ie)+". expected "+G+", got "+typeof S,De||O())}function be(S){S()}function Te(S,G,ie){S.texture?nt(S.texture._texture.internalformat,G,"unsupported texture format for attachment"):nt(S.renderbuffer._renderbuffer.format,ie,"unsupported renderbuffer format for attachment")}var Ge=33071,$e=9728,Mt=9984,Sr=9985,gr=9986,sn=9987,Cr=5120,Br=5121,Zr=5122,kr=5123,Jn=5124,Tn=5125,rn=5126,En=32819,Gr=32820,Fn=33635,si=34042,zn=36193,Nn={};Nn[Cr]=Nn[Br]=1,Nn[Zr]=Nn[kr]=Nn[zn]=Nn[Fn]=Nn[En]=Nn[Gr]=2,Nn[Jn]=Nn[Tn]=Nn[rn]=Nn[si]=4;function _n(S,G){return S===Gr||S===En||S===Fn?2:S===si?4:Nn[S]*G}function On(S){return!(S&S-1)&&!!S}function cn(S,G,ie){var De,pt=G.width,ze=G.height,tt=G.channels;re(pt>0&&pt<=ie.maxTextureSize&&ze>0&&ze<=ie.maxTextureSize,"invalid texture shape"),(S.wrapS!==Ge||S.wrapT!==Ge)&&re(On(pt)&&On(ze),"incompatible wrap mode for texture, both width and height must be power of 2"),G.mipmask===1?pt!==1&&ze!==1&&re(S.minFilter!==Mt&&S.minFilter!==gr&&S.minFilter!==Sr&&S.minFilter!==sn,"min filter requires mipmap"):(re(On(pt)&&On(ze),"texture must be a square power of 2 to support mipmapping"),re(G.mipmask===(pt<<1)-1,"missing or incomplete mipmap data")),G.type===rn&&(ie.extensions.indexOf("oes_texture_float_linear")<0&&re(S.minFilter===$e&&S.magFilter===$e,"filter not supported, must enable oes_texture_float_linear"),re(!S.genMipmaps,"mipmap generation not supported with float textures"));var gt=G.images;for(De=0;De<16;++De)if(gt[De]){var bt=pt>>De,vt=ze>>De;re(G.mipmask&1<<De,"missing mipmap data");var At=gt[De];if(re(At.width===bt&&At.height===vt,"invalid shape for mip images"),re(At.format===G.format&&At.internalformat===G.internalformat&&At.type===G.type,"incompatible type for mip image"),!At.compressed)if(At.data){var Ft=Math.ceil(_n(At.type,tt)*bt/At.unpackAlignment)*At.unpackAlignment;re(At.data.byteLength===Ft*vt,"invalid data for image, buffer size is inconsistent with image format")}else At.element||At.copy}else S.genMipmaps||re((G.mipmask&1<<De)==0,"extra mipmap data");G.compressed&&re(!S.genMipmaps,"mipmap generation for compressed images not supported")}function Aa(S,G,ie,De){var pt=S.width,ze=S.height,tt=S.channels;re(pt>0&&pt<=De.maxTextureSize&&ze>0&&ze<=De.maxTextureSize,"invalid texture shape"),re(pt===ze,"cube map must be square"),re(G.wrapS===Ge&&G.wrapT===Ge,"wrap mode not supported by cube map");for(var gt=0;gt<ie.length;++gt){var bt=ie[gt];re(bt.width===pt&&bt.height===ze,"inconsistent cube map face shape"),G.genMipmaps&&(re(!bt.compressed,"can not generate mipmap for compressed textures"),re(bt.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var vt=bt.images,At=0;At<16;++At){var Ft=vt[At];if(Ft){var kt=pt>>At,_t=ze>>At;re(bt.mipmask&1<<At,"missing mipmap data"),re(Ft.width===kt&&Ft.height===_t,"invalid shape for mip images"),re(Ft.format===S.format&&Ft.internalformat===S.internalformat&&Ft.type===S.type,"incompatible type for mip image"),Ft.compressed||(Ft.data?re(Ft.data.byteLength===kt*_t*Math.max(_n(Ft.type,tt),Ft.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ft.element||Ft.copy)}}}}var j=$(re,{optional:be,raise:U,commandRaise:Tt,command:Q,parameter:ne,commandParameter:p,constructor:Ke,type:xe,commandType:B,isTypedArray:le,nni:it,oneOf:nt,shaderError:Ae,linkError:ct,callSite:at,saveCommandRef:ut,saveDrawInfo:St,framebufferFormat:Te,guessCommand:O,texture2D:cn,textureCube:Aa}),Hr=0,ri=0,fu=5,qe=6;function dt(S,G){this.id=Hr++,this.type=S,this.data=G}function Nt(S){return S.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ar(S){if(S.length===0)return[];var G=S.charAt(0),ie=S.charAt(S.length-1);if(S.length>1&&G===ie&&(G==='"'||G==="'"))return['"'+Nt(S.substr(1,S.length-2))+'"'];var De=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(S);if(De)return ar(S.substr(0,De.index)).concat(ar(De[1])).concat(ar(S.substr(De.index+De[0].length)));var pt=S.split(".");if(pt.length===1)return['"'+Nt(S)+'"'];for(var ze=[],tt=0;tt<pt.length;++tt)ze=ze.concat(ar(pt[tt]));return ze}function yr(S){return"["+ar(S).join("][")+"]"}function Tr(S,G){return new dt(S,yr(G+""))}function $r(S){return typeof S=="function"&&!S._reglType||S instanceof dt}function Vr(S,G){if(typeof S=="function")return new dt(ri,S);if(typeof S=="number"||typeof S=="boolean")return new dt(fu,S);if(Array.isArray(S))return new dt(qe,S.map(function(ie,De){return Vr(ie,G+"["+De+"]")}));if(S instanceof dt)return S;j(!1,"invalid option type in uniform "+G)}var vr={DynamicVariable:dt,define:Tr,isDynamic:$r,unbox:Vr,accessor:yr},ln={next:typeof requestAnimationFrame=="function"?function(S){return requestAnimationFrame(S)}:function(S){return setTimeout(S,16)},cancel:typeof cancelAnimationFrame=="function"?function(S){return cancelAnimationFrame(S)}:clearTimeout},fn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ni=fn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hu(){var S={"":0},G=[""];return{id:function(ie){var De=S[ie];return De||(De=S[ie]=G.length,G.push(ie),De)},str:function(ie){return G[ie]}}}function da(S,G,ie){var De=document.createElement("canvas");$(De.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),S.appendChild(De),S===document.body&&(De.style.position="absolute",$(S.style,{margin:0,padding:0}));function pt(){var gt=window.innerWidth,bt=window.innerHeight;if(S!==document.body){var vt=De.getBoundingClientRect();gt=vt.right-vt.left,bt=vt.bottom-vt.top}De.width=ie*gt,De.height=ie*bt}var ze;S!==document.body&&typeof ResizeObserver=="function"?(ze=new ResizeObserver(function(){setTimeout(pt)}),ze.observe(S)):window.addEventListener("resize",pt,!1);function tt(){ze?ze.disconnect():window.removeEventListener("resize",pt),S.removeChild(De)}return pt(),{canvas:De,onDestroy:tt}}function ni(S,G){function ie(De){try{return S.getContext(De,G)}catch(pt){return null}}return ie("webgl")||ie("experimental-webgl")||ie("webgl-experimental")}function lo(S){return typeof S.nodeName=="string"&&typeof S.appendChild=="function"&&typeof S.getBoundingClientRect=="function"}function gl(S){return typeof S.drawArrays=="function"||typeof S.drawElements=="function"}function To(S){return typeof S=="string"?S.split():(j(Array.isArray(S),"invalid extension array"),S)}function Ms(S){return typeof S=="string"?(j(typeof document!="undefined","not supported outside of DOM"),document.querySelector(S)):S}function Os(S){var G=S||{},ie,De,pt,ze,tt={},gt=[],bt=[],vt=typeof window=="undefined"?1:window.devicePixelRatio,At=!1,Ft=function(Dt){Dt&&j.raise(Dt)},kt=function(){};if(typeof G=="string"?(j(typeof document!="undefined","selector queries only supported in DOM environments"),ie=document.querySelector(G),j(ie,"invalid query string for element")):typeof G=="object"?lo(G)?ie=G:gl(G)?(ze=G,pt=ze.canvas):(j.constructor(G),"gl"in G?ze=G.gl:"canvas"in G?pt=Ms(G.canvas):"container"in G&&(De=Ms(G.container)),"attributes"in G&&(tt=G.attributes,j.type(tt,"object","invalid context attributes")),"extensions"in G&&(gt=To(G.extensions)),"optionalExtensions"in G&&(bt=To(G.optionalExtensions)),"onDone"in G&&(j.type(G.onDone,"function","invalid or missing onDone callback"),Ft=G.onDone),"profile"in G&&(At=!!G.profile),"pixelRatio"in G&&(vt=+G.pixelRatio,j(vt>0,"invalid pixel ratio"))):j.raise("invalid arguments to regl"),ie&&(ie.nodeName.toLowerCase()==="canvas"?pt=ie:De=ie),!ze){if(!pt){j(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var _t=da(De||document.body,Ft,vt);if(!_t)return null;pt=_t.canvas,kt=_t.onDestroy}tt.premultipliedAlpha===void 0&&(tt.premultipliedAlpha=!0),ze=ni(pt,tt)}return ze?{gl:ze,canvas:pt,container:De,extensions:gt,optionalExtensions:bt,pixelRatio:vt,profile:At,onDone:Ft,onDestroy:kt}:(kt(),Ft("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function du(S,G){var ie={};function De(gt){j.type(gt,"string","extension name must be string");var bt=gt.toLowerCase(),vt;try{vt=ie[bt]=pt(gt)}catch(At){}return!!vt}function pt(gt){return S.getExtension(gt)?S.getExtension(gt):S.getExtension(gt.toLowerCase())?S.getExtension(gt.toLowerCase()):null}for(var ze=0;ze<G.extensions.length;++ze){var tt=G.extensions[ze];if(!De(tt))return G.onDestroy(),G.onDone('"'+tt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return G.optionalExtensions.forEach(De),{extensions:ie,restore:function(){Object.keys(ie).forEach(function(gt){if(ie[gt]&&!De(gt))throw new Error("(regl): error restoring extension "+gt)})}}}function ki(S,G){for(var ie=Array(S),De=0;De<S;++De)ie[De]=G(De);return ie}var _l=5120,oc=5121,Vo=5122,yl=5123,ja=5124,Fr=5125,Qi=5126;function zu(S){for(var G=16;G<=1<<28;G*=16)if(S<=G)return G;return 0}function Hu(S){var G,ie;return G=(S>65535)<<4,S>>>=G,ie=(S>255)<<3,S>>>=ie,G|=ie,ie=(S>15)<<2,S>>>=ie,G|=ie,ie=(S>3)<<1,S>>>=ie,G|=ie,G|S>>1}function Rs(){var S=ki(8,function(){return[]});function G(ze){var tt=zu(ze),gt=S[Hu(tt)>>2];return gt.length>0?gt.pop():new ArrayBuffer(tt)}function ie(ze){S[Hu(ze.byteLength)>>2].push(ze)}function De(ze,tt){var gt=null;switch(ze){case _l:gt=new Int8Array(G(tt),0,tt);break;case oc:gt=new Uint8Array(G(tt),0,tt);break;case Vo:gt=new Int16Array(G(2*tt),0,tt);break;case yl:gt=new Uint16Array(G(2*tt),0,tt);break;case ja:gt=new Int32Array(G(4*tt),0,tt);break;case Fr:gt=new Uint32Array(G(4*tt),0,tt);break;case Qi:gt=new Float32Array(G(4*tt),0,tt);break;default:return null}return gt.length!==tt?gt.subarray(0,tt):gt}function pt(ze){ie(ze.buffer)}return{alloc:G,free:ie,allocType:De,freeType:pt}}var $n=Rs();$n.zero=Rs();var El=3408,ju=3410,Vu=3411,Wu=3412,xl=3413,pu=3414,Rn=3415,Va=33901,pa=33902,va=3379,nn=3386,ft=34921,mt=36347,Xu=36348,Ui=35661,Wo=35660,Gi=34930,lr=36349,cr=34076,Xe=34024,Bi=7936,z=7937,zi=7938,Yu=35724,co=34047,Ji=36063,Hi=34852,Wa=3553,ba=34067,Xo=34069,Yo=33984,Xa=6408,yi=5126,Hn=5121,$o=36160,Ya=36053,Ta=36064,Mo=16384,ma=function(S,G){var ie=1;G.ext_texture_filter_anisotropic&&(ie=S.getParameter(co));var De=1,pt=1;G.webgl_draw_buffers&&(De=S.getParameter(Hi),pt=S.getParameter(Ji));var ze=!!G.oes_texture_float;if(ze){var tt=S.createTexture();S.bindTexture(Wa,tt),S.texImage2D(Wa,0,Xa,1,1,0,Xa,yi,null);var gt=S.createFramebuffer();if(S.bindFramebuffer($o,gt),S.framebufferTexture2D($o,Ta,Wa,tt,0),S.bindTexture(Wa,null),S.checkFramebufferStatus($o)!==Ya)ze=!1;else{S.viewport(0,0,1,1),S.clearColor(1,0,0,1),S.clear(Mo);var bt=$n.allocType(yi,4);S.readPixels(0,0,1,1,Xa,yi,bt),S.getError()?ze=!1:(S.deleteFramebuffer(gt),S.deleteTexture(tt),ze=bt[0]===1),$n.freeType(bt)}}var vt=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),At=!0;if(!vt){var Ft=S.createTexture(),kt=$n.allocType(Hn,36);S.activeTexture(Yo),S.bindTexture(ba,Ft),S.texImage2D(Xo,0,Xa,3,3,0,Xa,Hn,kt),$n.freeType(kt),S.bindTexture(ba,null),S.deleteTexture(Ft),At=!S.getError()}return{colorBits:[S.getParameter(ju),S.getParameter(Vu),S.getParameter(Wu),S.getParameter(xl)],depthBits:S.getParameter(pu),stencilBits:S.getParameter(Rn),subpixelBits:S.getParameter(El),extensions:Object.keys(G).filter(function(_t){return!!G[_t]}),maxAnisotropic:ie,maxDrawbuffers:De,maxColorAttachments:pt,pointSizeDims:S.getParameter(Va),lineWidthDims:S.getParameter(pa),maxViewportDims:S.getParameter(nn),maxCombinedTextureUnits:S.getParameter(Ui),maxCubeMapSize:S.getParameter(cr),maxRenderbufferSize:S.getParameter(Xe),maxTextureUnits:S.getParameter(Gi),maxTextureSize:S.getParameter(va),maxAttributes:S.getParameter(ft),maxVertexUniforms:S.getParameter(mt),maxVertexTextureUnits:S.getParameter(Wo),maxVaryingVectors:S.getParameter(Xu),maxFragmentUniforms:S.getParameter(lr),glsl:S.getParameter(Yu),renderer:S.getParameter(z),vendor:S.getParameter(Bi),version:S.getParameter(zi),readFloat:ze,npotTextureCube:At}};function ji(S){return!!S&&typeof S=="object"&&Array.isArray(S.shape)&&Array.isArray(S.stride)&&typeof S.offset=="number"&&S.shape.length===S.stride.length&&(Array.isArray(S.data)||A(S.data))}var D=function(S){return Object.keys(S).map(function(G){return S[G]})},V={shape:li,flatten:hn};function he(S,G,ie){for(var De=0;De<G;++De)ie[De]=S[De]}function Ue(S,G,ie,De){for(var pt=0,ze=0;ze<G;++ze)for(var tt=S[ze],gt=0;gt<ie;++gt)De[pt++]=tt[gt]}function Zt(S,G,ie,De,pt,ze){for(var tt=ze,gt=0;gt<G;++gt)for(var bt=S[gt],vt=0;vt<ie;++vt)for(var At=bt[vt],Ft=0;Ft<De;++Ft)pt[tt++]=At[Ft]}function mr(S,G,ie,De,pt){for(var ze=1,tt=ie+1;tt<G.length;++tt)ze*=G[tt];var gt=G[ie];if(G.length-ie==4){var bt=G[ie+1],vt=G[ie+2],At=G[ie+3];for(tt=0;tt<gt;++tt)Zt(S[tt],bt,vt,At,De,pt),pt+=ze}else for(tt=0;tt<gt;++tt)mr(S[tt],G,ie+1,De,pt),pt+=ze}function hn(S,G,ie,De){var pt=1;if(G.length)for(var ze=0;ze<G.length;++ze)pt*=G[ze];else pt=0;var tt=De||$n.allocType(ie,pt);switch(G.length){case 0:break;case 1:he(S,G[0],tt);break;case 2:Ue(S,G[0],G[1],tt);break;case 3:Zt(S,G[0],G[1],G[2],tt,0);break;default:mr(S,G,0,tt,0)}return tt}function li(S){for(var G=[],ie=S;ie.length;ie=ie[0])G.push(ie.length);return G}var ii={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Kn=5120,Vi=5122,Sl=5124,$a=5121,ga=5123,Wi=5125,vu=5126,Ps=5126,Oo={int8:Kn,int16:Vi,int32:Sl,uint8:$a,uint16:ga,uint32:Wi,float:vu,float32:Ps},ef=35048,Ka=35040,vn={dynamic:ef,stream:Ka,static:35044},dn=V.flatten,ea=V.shape,$u=35044,Wf=35040,Ma=5121,Cl=5126,fo=[];fo[5120]=1,fo[5122]=2,fo[5124]=4,fo[5121]=1,fo[5123]=2,fo[5125]=4,fo[5126]=4;function mu(S){return ii[Object.prototype.toString.call(S)]|0}function f(S,G){for(var ie=0;ie<G.length;++ie)S[ie]=G[ie]}function m(S,G,ie,De,pt,ze,tt){for(var gt=0,bt=0;bt<ie;++bt)for(var vt=0;vt<De;++vt)S[gt++]=G[pt*bt+ze*vt+tt]}function C(S,G,ie,De){var pt=0,ze={};function tt(Ce){this.id=pt++,this.buffer=S.createBuffer(),this.type=Ce,this.usage=$u,this.byteLength=0,this.dimension=1,this.dtype=Ma,this.persistentData=null,ie.profile&&(this.stats={size:0})}tt.prototype.bind=function(){S.bindBuffer(this.type,this.buffer)},tt.prototype.destroy=function(){kt(this)};var gt=[];function bt(Ce,He){var wt=gt.pop();return wt||(wt=new tt(Ce)),wt.bind(),Ft(wt,He,Wf,0,1,!1),wt}function vt(Ce){gt.push(Ce)}function At(Ce,He,wt){Ce.byteLength=He.byteLength,S.bufferData(Ce.type,He,wt)}function Ft(Ce,He,wt,tr,yt,Qt){var Kt;if(Ce.usage=wt,Array.isArray(He)){if(Ce.dtype=tr||Cl,He.length>0){var br;if(Array.isArray(He[0])){Kt=ea(He);for(var ht=1,st=1;st<Kt.length;++st)ht*=Kt[st];Ce.dimension=ht,br=dn(He,Kt,Ce.dtype),At(Ce,br,wt),Qt?Ce.persistentData=br:$n.freeType(br)}else if(typeof He[0]=="number"){Ce.dimension=yt;var or=$n.allocType(Ce.dtype,He.length);f(or,He),At(Ce,or,wt),Qt?Ce.persistentData=or:$n.freeType(or)}else A(He[0])?(Ce.dimension=He[0].length,Ce.dtype=tr||mu(He[0])||Cl,br=dn(He,[He.length,He[0].length],Ce.dtype),At(Ce,br,wt),Qt?Ce.persistentData=br:$n.freeType(br)):j.raise("invalid buffer data")}}else if(A(He))Ce.dtype=tr||mu(He),Ce.dimension=yt,At(Ce,He,wt),Qt&&(Ce.persistentData=new Uint8Array(new Uint8Array(He.buffer)));else if(ji(He)){Kt=He.shape;var Bt=He.stride,Ot=He.offset,Xt=0,Yt=0,Nr=0,Mr=0;Kt.length===1?(Xt=Kt[0],Yt=1,Nr=Bt[0],Mr=0):Kt.length===2?(Xt=Kt[0],Yt=Kt[1],Nr=Bt[0],Mr=Bt[1]):j.raise("invalid shape"),Ce.dtype=tr||mu(He.data)||Cl,Ce.dimension=Yt;var $t=$n.allocType(Ce.dtype,Xt*Yt);m($t,He.data,Xt,Yt,Nr,Mr,Ot),At(Ce,$t,wt),Qt?Ce.persistentData=$t:$n.freeType($t)}else He instanceof ArrayBuffer?(Ce.dtype=Ma,Ce.dimension=yt,At(Ce,He,wt),Qt&&(Ce.persistentData=new Uint8Array(new Uint8Array(He)))):j.raise("invalid buffer data")}function kt(Ce){G.bufferCount--,De(Ce);var He=Ce.buffer;j(He,"buffer must not be deleted already"),S.deleteBuffer(He),Ce.buffer=null,delete ze[Ce.id]}function _t(Ce,He,wt,tr){G.bufferCount++;var yt=new tt(He);ze[yt.id]=yt;function Qt(ht){var st=$u,or=null,Bt=0,Ot=0,Xt=1;return Array.isArray(ht)||A(ht)||ji(ht)||ht instanceof ArrayBuffer?or=ht:typeof ht=="number"?Bt=ht|0:ht&&(j.type(ht,"object","buffer arguments must be an object, a number or an array"),"data"in ht&&(j(or===null||Array.isArray(or)||A(or)||ji(or),"invalid data for buffer"),or=ht.data),"usage"in ht&&(j.parameter(ht.usage,vn,"invalid buffer usage"),st=vn[ht.usage]),"type"in ht&&(j.parameter(ht.type,Oo,"invalid buffer type"),Ot=Oo[ht.type]),"dimension"in ht&&(j.type(ht.dimension,"number","invalid dimension"),Xt=ht.dimension|0),"length"in ht&&(j.nni(Bt,"buffer length must be a nonnegative integer"),Bt=ht.length|0)),yt.bind(),or?Ft(yt,or,st,Ot,Xt,tr):(Bt&&S.bufferData(yt.type,Bt,st),yt.dtype=Ot||Ma,yt.usage=st,yt.dimension=Xt,yt.byteLength=Bt),ie.profile&&(yt.stats.size=yt.byteLength*fo[yt.dtype]),Qt}function Kt(ht,st){j(st+ht.byteLength<=yt.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ht.byteLength+" starting from offset "+st+" to a buffer of size "+yt.byteLength),S.bufferSubData(yt.type,st,ht)}function br(ht,st){var or=(st||0)|0,Bt;if(yt.bind(),A(ht)||ht instanceof ArrayBuffer)Kt(ht,or);else if(Array.isArray(ht)){if(ht.length>0)if(typeof ht[0]=="number"){var Ot=$n.allocType(yt.dtype,ht.length);f(Ot,ht),Kt(Ot,or),$n.freeType(Ot)}else if(Array.isArray(ht[0])||A(ht[0])){Bt=ea(ht);var Xt=dn(ht,Bt,yt.dtype);Kt(Xt,or),$n.freeType(Xt)}else j.raise("invalid buffer data")}else if(ji(ht)){Bt=ht.shape;var Yt=ht.stride,Nr=0,Mr=0,$t=0,Jt=0;Bt.length===1?(Nr=Bt[0],Mr=1,$t=Yt[0],Jt=0):Bt.length===2?(Nr=Bt[0],Mr=Bt[1],$t=Yt[0],Jt=Yt[1]):j.raise("invalid shape");var Or=Array.isArray(ht.data)?yt.dtype:mu(ht.data),Ir=$n.allocType(Or,Nr*Mr);m(Ir,ht.data,Nr,Mr,$t,Jt,ht.offset),Kt(Ir,or),$n.freeType(Ir)}else j.raise("invalid data for buffer subdata");return Qt}return wt||Qt(Ce),Qt._reglType="buffer",Qt._buffer=yt,Qt.subdata=br,ie.profile&&(Qt.stats=yt.stats),Qt.destroy=function(){kt(yt)},Qt}function Dt(){D(ze).forEach(function(Ce){Ce.buffer=S.createBuffer(),S.bindBuffer(Ce.type,Ce.buffer),S.bufferData(Ce.type,Ce.persistentData||Ce.byteLength,Ce.usage)})}return ie.profile&&(G.getTotalBufferSize=function(){var Ce=0;return Object.keys(ze).forEach(function(He){Ce+=ze[He].stats.size}),Ce}),{create:_t,createStream:bt,destroyStream:vt,clear:function(){D(ze).forEach(kt),gt.forEach(kt)},getBuffer:function(Ce){return Ce&&Ce._buffer instanceof tt?Ce._buffer:null},restore:Dt,_initBuffer:Ft}}var _=0,R=0,X=1,oe=1,Me=4,Ie=4,Ct={points:_,point:R,lines:X,line:oe,triangles:Me,triangle:Ie,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Pt=0,dr=1,zr=4,Ar=5120,Qr=5121,un=5122,kn=5123,Oa=5124,ci=5125,ho=34963,Ro=35040,qn=35044;function _a(S,G,ie,De){var pt={},ze=0,tt={uint8:Qr,uint16:kn};G.oes_element_index_uint&&(tt.uint32=ci);function gt(Dt){this.id=ze++,pt[this.id]=this,this.buffer=Dt,this.primType=zr,this.vertCount=0,this.type=0}gt.prototype.bind=function(){this.buffer.bind()};var bt=[];function vt(Dt){var Ce=bt.pop();return Ce||(Ce=new gt(ie.create(null,ho,!0,!1)._buffer)),Ft(Ce,Dt,Ro,-1,-1,0,0),Ce}function At(Dt){bt.push(Dt)}function Ft(Dt,Ce,He,wt,tr,yt,Qt){Dt.buffer.bind();var Kt;if(Ce){var br=Qt;!Qt&&(!A(Ce)||ji(Ce)&&!A(Ce.data))&&(br=G.oes_element_index_uint?ci:kn),ie._initBuffer(Dt.buffer,Ce,He,br,3)}else S.bufferData(ho,yt,He),Dt.buffer.dtype=Kt||Qr,Dt.buffer.usage=He,Dt.buffer.dimension=3,Dt.buffer.byteLength=yt;if(Kt=Qt,!Qt){switch(Dt.buffer.dtype){case Qr:case Ar:Kt=Qr;break;case kn:case un:Kt=kn;break;case ci:case Oa:Kt=ci;break;default:j.raise("unsupported type for element array")}Dt.buffer.dtype=Kt}Dt.type=Kt,j(Kt!==ci||!!G.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ht=tr;ht<0&&(ht=Dt.buffer.byteLength,Kt===kn?ht>>=1:Kt===ci&&(ht>>=2)),Dt.vertCount=ht;var st=wt;if(wt<0){st=zr;var or=Dt.buffer.dimension;or===1&&(st=Pt),or===2&&(st=dr),or===3&&(st=zr)}Dt.primType=st}function kt(Dt){De.elementsCount--,j(Dt.buffer!==null,"must not double destroy elements"),delete pt[Dt.id],Dt.buffer.destroy(),Dt.buffer=null}function _t(Dt,Ce){var He=ie.create(null,ho,!0),wt=new gt(He._buffer);De.elementsCount++;function tr(yt){if(!yt)He(),wt.primType=zr,wt.vertCount=0,wt.type=Qr;else if(typeof yt=="number")He(yt),wt.primType=zr,wt.vertCount=yt|0,wt.type=Qr;else{var Qt=null,Kt=qn,br=-1,ht=-1,st=0,or=0;Array.isArray(yt)||A(yt)||ji(yt)?Qt=yt:(j.type(yt,"object","invalid arguments for elements"),"data"in yt&&(Qt=yt.data,j(Array.isArray(Qt)||A(Qt)||ji(Qt),"invalid data for element buffer")),"usage"in yt&&(j.parameter(yt.usage,vn,"invalid element buffer usage"),Kt=vn[yt.usage]),"primitive"in yt&&(j.parameter(yt.primitive,Ct,"invalid element buffer primitive"),br=Ct[yt.primitive]),"count"in yt&&(j(typeof yt.count=="number"&&yt.count>=0,"invalid vertex count for elements"),ht=yt.count|0),"type"in yt&&(j.parameter(yt.type,tt,"invalid buffer type"),or=tt[yt.type]),"length"in yt?st=yt.length|0:(st=ht,or===kn||or===un?st*=2:(or===ci||or===Oa)&&(st*=4))),Ft(wt,Qt,Kt,br,ht,st,or)}return tr}return tr(Dt),tr._reglType="elements",tr._elements=wt,tr.subdata=function(yt,Qt){return He.subdata(yt,Qt),tr},tr.destroy=function(){kt(wt)},tr}return{create:_t,createStream:vt,destroyStream:At,getElements:function(Dt){return typeof Dt=="function"&&Dt._elements instanceof gt?Dt._elements:null},clear:function(){D(pt).forEach(kt)}}}var ws=new Float32Array(1),uc=new Uint32Array(ws.buffer),Al=5123;function sc(S){for(var G=$n.allocType(Al,S.length),ie=0;ie<S.length;++ie)if(isNaN(S[ie]))G[ie]=65535;else if(S[ie]===Infinity)G[ie]=31744;else if(S[ie]===-Infinity)G[ie]=64512;else{ws[0]=S[ie];var De=uc[0],pt=De>>>31<<15,ze=(De<<1>>>24)-127,tt=De>>13&(1<<10)-1;if(ze<-24)G[ie]=pt;else if(ze<-14){var gt=-14-ze;G[ie]=pt+(tt+(1<<10)>>gt)}else ze>15?G[ie]=pt+31744:G[ie]=pt+(ze+15<<10)+tt}return G}function fi(S){return Array.isArray(S)||A(S)}var Xf=function(S){return!(S&S-1)&&!!S},Yf=34467,Ra=3553,Po=34067,bl=34069,gu=6408,tf=6406,Is=6407,Ls=6409,ta=6410,$f=32854,Tl=32855,lc=36194,rf=32819,cc=32820,Pa=33635,Kf=34042,Ds=6402,fc=34041,nf=35904,af=35906,Fs=36193,of=33776,hc=33777,uf=33778,_u=33779,qf=35986,Qf=35987,yu=34798,sf=35840,Ko=35841,Ml=35842,dc=35843,Kh=36196,Ol=5121,Ku=5123,wa=5125,Ns=5126,ld=10242,lf=10243,cd=10497,Jf=33071,fd=33648,pc=10240,Fe=10241,lt=9728,ot=9729,Wt=9984,an=9985,Bn=9986,ei=9987,wn=33170,ks=4352,qh=4353,Cn=4354,qo=34046,qu=3317,wo=37440,vc=37441,Rl=37443,In=37444,Bs=33984,eh=[Wt,Bn,an,ei],Eu=[0,Ls,ta,Is,gu],qa={};qa[Ls]=qa[tf]=qa[Ds]=1,qa[fc]=qa[ta]=2,qa[Is]=qa[nf]=3,qa[gu]=qa[af]=4;function Pl(S){return"[object "+S+"]"}var th=Pl("HTMLCanvasElement"),Qn=Pl("OffscreenCanvas"),Io=Pl("CanvasRenderingContext2D"),wl=Pl("ImageBitmap"),cf=Pl("HTMLImageElement"),Lo=Pl("HTMLVideoElement"),mc=Object.keys(ii).concat([th,Qn,Io,wl,cf,Lo]),Qu=[];Qu[Ol]=1,Qu[Ns]=4,Qu[Fs]=2,Qu[Ku]=2,Qu[wa]=4;var Ci=[];Ci[$f]=2,Ci[Tl]=2,Ci[lc]=2,Ci[fc]=4,Ci[of]=.5,Ci[hc]=.5,Ci[uf]=1,Ci[_u]=1,Ci[qf]=.5,Ci[Qf]=1,Ci[yu]=1,Ci[sf]=.5,Ci[Ko]=.25,Ci[Ml]=.5,Ci[dc]=.25,Ci[Kh]=.5;function Il(S){return Array.isArray(S)&&(S.length===0||typeof S[0]=="number")}function Ju(S){if(!Array.isArray(S))return!1;var G=S.length;return!(G===0||!fi(S[0]))}function Qa(S){return Object.prototype.toString.call(S)}function Ll(S){return Qa(S)===th}function Qh(S){return Qa(S)===Qn}function Jh(S){return Qa(S)===Io}function rh(S){return Qa(S)===wl}function es(S){return Qa(S)===cf}function gc(S){return Qa(S)===Lo}function Zs(S){var G=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(G&&S&&S.getContext)}function e0(S){var G=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(G&&S&&"src"in S&&"crossOrigin"in S)}function Dl(S){if(!S)return!1;if(Zs(S)||e0(S))return!0;var G=Qa(S);return mc.indexOf(G)>=0?!0:Il(S)||Ju(S)||ji(S)}function _c(S){return ii[Object.prototype.toString.call(S)]|0}function hd(S,G){var ie=G.length;switch(S.type){case Ol:case Ku:case wa:case Ns:var De=$n.allocType(S.type,ie);De.set(G),S.data=De;break;case Fs:S.data=sc(G);break;default:j.raise("unsupported texture type, must specify a typed array")}}function bi(S,G){return $n.allocType(S.type===Fs?Ns:S.type,G)}function Xi(S,G){S.type===Fs?(S.data=sc(G),$n.freeType(G)):S.data=G}function t0(S,G,ie,De,pt,ze){for(var tt=S.width,gt=S.height,bt=S.channels,vt=tt*gt*bt,At=bi(S,vt),Ft=0,kt=0;kt<gt;++kt)for(var _t=0;_t<tt;++_t)for(var Dt=0;Dt<bt;++Dt)At[Ft++]=G[ie*_t+De*kt+pt*Dt+ze];Xi(S,At)}function Ia(S,G,ie,De,pt,ze){var tt;if(typeof Ci[S]!="undefined"?tt=Ci[S]:tt=qa[S]*Qu[G],ze&&(tt*=6),pt){for(var gt=0,bt=ie;bt>=1;)gt+=tt*bt*bt,bt/=2;return gt}else return tt*ie*De}function r0(S,G,ie,De,pt,ze,tt){var gt={"don't care":ks,"dont care":ks,nice:Cn,fast:qh},bt={repeat:cd,clamp:Jf,mirror:fd},vt={nearest:lt,linear:ot},At=$({mipmap:ei,"nearest mipmap nearest":Wt,"linear mipmap nearest":an,"nearest mipmap linear":Bn,"linear mipmap linear":ei},vt),Ft={none:0,browser:In},kt={uint8:Ol,rgba4:rf,rgb565:Pa,"rgb5 a1":cc},_t={alpha:tf,luminance:Ls,"luminance alpha":ta,rgb:Is,rgba:gu,rgba4:$f,"rgb5 a1":Tl,rgb565:lc},Dt={};G.ext_srgb&&(_t.srgb=nf,_t.srgba=af),G.oes_texture_float&&(kt.float32=kt.float=Ns),G.oes_texture_half_float&&(kt.float16=kt["half float"]=Fs),G.webgl_depth_texture&&($(_t,{depth:Ds,"depth stencil":fc}),$(kt,{uint16:Ku,uint32:wa,"depth stencil":Kf})),G.webgl_compressed_texture_s3tc&&$(Dt,{"rgb s3tc dxt1":of,"rgba s3tc dxt1":hc,"rgba s3tc dxt3":uf,"rgba s3tc dxt5":_u}),G.webgl_compressed_texture_atc&&$(Dt,{"rgb atc":qf,"rgba atc explicit alpha":Qf,"rgba atc interpolated alpha":yu}),G.webgl_compressed_texture_pvrtc&&$(Dt,{"rgb pvrtc 4bppv1":sf,"rgb pvrtc 2bppv1":Ko,"rgba pvrtc 4bppv1":Ml,"rgba pvrtc 2bppv1":dc}),G.webgl_compressed_texture_etc1&&(Dt["rgb etc1"]=Kh);var Ce=Array.prototype.slice.call(S.getParameter(Yf)||new Uint32Array(0));Object.keys(Dt).forEach(function(te){var Ye=Dt[te];Ce.indexOf(Ye)>=0&&(_t[te]=Ye)});var He=Object.keys(_t);ie.textureFormats=He;var wt=[];Object.keys(_t).forEach(function(te){var Ye=_t[te];wt[Ye]=te});var tr=[];Object.keys(kt).forEach(function(te){var Ye=kt[te];tr[Ye]=te});var yt=[];Object.keys(vt).forEach(function(te){var Ye=vt[te];yt[Ye]=te});var Qt=[];Object.keys(At).forEach(function(te){var Ye=At[te];Qt[Ye]=te});var Kt=[];Object.keys(bt).forEach(function(te){var Ye=bt[te];Kt[Ye]=te});var br=He.reduce(function(te,Ye){var Ne=_t[Ye];return Ne===Ls||Ne===tf||Ne===Ls||Ne===ta||Ne===Ds||Ne===fc||G.ext_srgb&&(Ne===nf||Ne===af)?te[Ne]=Ne:Ne===Tl||Ye.indexOf("rgba")>=0?te[Ne]=gu:te[Ne]=Is,te},{});function ht(){this.internalformat=gu,this.format=gu,this.type=Ol,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=In,this.width=0,this.height=0,this.channels=0}function st(te,Ye){te.internalformat=Ye.internalformat,te.format=Ye.format,te.type=Ye.type,te.compressed=Ye.compressed,te.premultiplyAlpha=Ye.premultiplyAlpha,te.flipY=Ye.flipY,te.unpackAlignment=Ye.unpackAlignment,te.colorSpace=Ye.colorSpace,te.width=Ye.width,te.height=Ye.height,te.channels=Ye.channels}function or(te,Ye){if(!(typeof Ye!="object"||!Ye)){if("premultiplyAlpha"in Ye&&(j.type(Ye.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),te.premultiplyAlpha=Ye.premultiplyAlpha),"flipY"in Ye&&(j.type(Ye.flipY,"boolean","invalid texture flip"),te.flipY=Ye.flipY),"alignment"in Ye&&(j.oneOf(Ye.alignment,[1,2,4,8],"invalid texture unpack alignment"),te.unpackAlignment=Ye.alignment),"colorSpace"in Ye&&(j.parameter(Ye.colorSpace,Ft,"invalid colorSpace"),te.colorSpace=Ft[Ye.colorSpace]),"type"in Ye){var Ne=Ye.type;j(G.oes_texture_float||!(Ne==="float"||Ne==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),j(G.oes_texture_half_float||!(Ne==="half float"||Ne==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),j(G.webgl_depth_texture||!(Ne==="uint16"||Ne==="uint32"||Ne==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(Ne,kt,"invalid texture type"),te.type=kt[Ne]}var nr=te.width,on=te.height,q=te.channels,N=!1;"shape"in Ye?(j(Array.isArray(Ye.shape)&&Ye.shape.length>=2,"shape must be an array"),nr=Ye.shape[0],on=Ye.shape[1],Ye.shape.length===3&&(q=Ye.shape[2],j(q>0&&q<=4,"invalid number of channels"),N=!0),j(nr>=0&&nr<=ie.maxTextureSize,"invalid width"),j(on>=0&&on<=ie.maxTextureSize,"invalid height")):("radius"in Ye&&(nr=on=Ye.radius,j(nr>=0&&nr<=ie.maxTextureSize,"invalid radius")),"width"in Ye&&(nr=Ye.width,j(nr>=0&&nr<=ie.maxTextureSize,"invalid width")),"height"in Ye&&(on=Ye.height,j(on>=0&&on<=ie.maxTextureSize,"invalid height")),"channels"in Ye&&(q=Ye.channels,j(q>0&&q<=4,"invalid number of channels"),N=!0)),te.width=nr|0,te.height=on|0,te.channels=q|0;var ue=!1;if("format"in Ye){var _e=Ye.format;j(G.webgl_depth_texture||!(_e==="depth"||_e==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(_e,_t,"invalid texture format");var We=te.internalformat=_t[_e];te.format=br[We],_e in kt&&("type"in Ye||(te.type=kt[_e])),_e in Dt&&(te.compressed=!0),ue=!0}!N&&ue?te.channels=qa[te.format]:N&&!ue?te.channels!==Eu[te.format]&&(te.format=te.internalformat=Eu[te.channels]):ue&&N&&j(te.channels===qa[te.format],"number of channels inconsistent with specified format")}}function Bt(te){S.pixelStorei(wo,te.flipY),S.pixelStorei(vc,te.premultiplyAlpha),S.pixelStorei(Rl,te.colorSpace),S.pixelStorei(qu,te.unpackAlignment)}function Ot(){ht.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Xt(te,Ye){var Ne=null;if(Dl(Ye)?Ne=Ye:Ye&&(j.type(Ye,"object","invalid pixel data type"),or(te,Ye),"x"in Ye&&(te.xOffset=Ye.x|0),"y"in Ye&&(te.yOffset=Ye.y|0),Dl(Ye.data)&&(Ne=Ye.data)),j(!te.compressed||Ne instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ye.copy){j(!Ne,"can not specify copy and data field for the same texture");var nr=pt.viewportWidth,on=pt.viewportHeight;te.width=te.width||nr-te.xOffset,te.height=te.height||on-te.yOffset,te.needsCopy=!0,j(te.xOffset>=0&&te.xOffset<nr&&te.yOffset>=0&&te.yOffset<on&&te.width>0&&te.width<=nr&&te.height>0&&te.height<=on,"copy texture read out of bounds")}else if(!Ne)te.width=te.width||1,te.height=te.height||1,te.channels=te.channels||4;else if(A(Ne))te.channels=te.channels||4,te.data=Ne,!("type"in Ye)&&te.type===Ol&&(te.type=_c(Ne));else if(Il(Ne))te.channels=te.channels||4,hd(te,Ne),te.alignment=1,te.needsFree=!0;else if(ji(Ne)){var q=Ne.data;!Array.isArray(q)&&te.type===Ol&&(te.type=_c(q));var N=Ne.shape,ue=Ne.stride,_e,We,de,fe,me,H;N.length===3?(de=N[2],H=ue[2]):(j(N.length===2,"invalid ndarray pixel data, must be 2 or 3D"),de=1,H=1),_e=N[0],We=N[1],fe=ue[0],me=ue[1],te.alignment=1,te.width=_e,te.height=We,te.channels=de,te.format=te.internalformat=Eu[de],te.needsFree=!0,t0(te,q,fe,me,H,Ne.offset)}else if(Zs(Ne)||Ll(Ne)||Qh(Ne)||Jh(Ne))Zs(Ne)||Ll(Ne)||Qh(Ne)?te.element=Ne:te.element=Ne.canvas,te.width=te.element.width,te.height=te.element.height,te.channels=4;else if(rh(Ne))te.element=Ne,te.width=Ne.width,te.height=Ne.height,te.channels=4;else if(es(Ne))te.element=Ne,te.width=Ne.naturalWidth,te.height=Ne.naturalHeight,te.channels=4;else if(e0(Ne))te.element=Ne,te.width=Ne.width,te.height=Ne.height,te.channels=4;else if(gc(Ne))te.element=Ne,te.width=Ne.videoWidth,te.height=Ne.videoHeight,te.channels=4;else if(Ju(Ne)){var ae=te.width||Ne[0].length,J=te.height||Ne.length,Se=te.channels;fi(Ne[0][0])?Se=Se||Ne[0][0].length:Se=Se||1;for(var Le=V.shape(Ne),xt=1,Ht=0;Ht<Le.length;++Ht)xt*=Le[Ht];var jt=bi(te,xt);V.flatten(Ne,Le,"",jt),Xi(te,jt),te.alignment=1,te.width=ae,te.height=J,te.channels=Se,te.format=te.internalformat=Eu[Se],te.needsFree=!0}te.type===Ns?j(ie.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):te.type===Fs&&j(ie.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Yt(te,Ye,Ne){var nr=te.element,on=te.data,q=te.internalformat,N=te.format,ue=te.type,_e=te.width,We=te.height;Bt(te),nr?S.texImage2D(Ye,Ne,N,N,ue,nr):te.compressed?S.compressedTexImage2D(Ye,Ne,q,_e,We,0,on):te.needsCopy?(De(),S.copyTexImage2D(Ye,Ne,N,te.xOffset,te.yOffset,_e,We,0)):S.texImage2D(Ye,Ne,N,_e,We,0,N,ue,on||null)}function Nr(te,Ye,Ne,nr,on){var q=te.element,N=te.data,ue=te.internalformat,_e=te.format,We=te.type,de=te.width,fe=te.height;Bt(te),q?S.texSubImage2D(Ye,on,Ne,nr,_e,We,q):te.compressed?S.compressedTexSubImage2D(Ye,on,Ne,nr,ue,de,fe,N):te.needsCopy?(De(),S.copyTexSubImage2D(Ye,on,Ne,nr,te.xOffset,te.yOffset,de,fe)):S.texSubImage2D(Ye,on,Ne,nr,de,fe,_e,We,N)}var Mr=[];function $t(){return Mr.pop()||new Ot}function Jt(te){te.needsFree&&$n.freeType(te.data),Ot.call(te),Mr.push(te)}function Or(){ht.call(this),this.genMipmaps=!1,this.mipmapHint=ks,this.mipmask=0,this.images=Array(16)}function Ir(te,Ye,Ne){var nr=te.images[0]=$t();te.mipmask=1,nr.width=te.width=Ye,nr.height=te.height=Ne,nr.channels=te.channels=4}function en(te,Ye){var Ne=null;if(Dl(Ye))Ne=te.images[0]=$t(),st(Ne,te),Xt(Ne,Ye),te.mipmask=1;else if(or(te,Ye),Array.isArray(Ye.mipmap))for(var nr=Ye.mipmap,on=0;on<nr.length;++on)Ne=te.images[on]=$t(),st(Ne,te),Ne.width>>=on,Ne.height>>=on,Xt(Ne,nr[on]),te.mipmask|=1<<on;else Ne=te.images[0]=$t(),st(Ne,te),Xt(Ne,Ye),te.mipmask=1;st(te,te.images[0]),te.compressed&&(te.internalformat===of||te.internalformat===hc||te.internalformat===uf||te.internalformat===_u)&&j(te.width%4==0&&te.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function An(te,Ye){for(var Ne=te.images,nr=0;nr<Ne.length;++nr){if(!Ne[nr])return;Yt(Ne[nr],Ye,nr)}}var Un=[];function tn(){var te=Un.pop()||new Or;ht.call(te),te.mipmask=0;for(var Ye=0;Ye<16;++Ye)te.images[Ye]=null;return te}function Ti(te){for(var Ye=te.images,Ne=0;Ne<Ye.length;++Ne)Ye[Ne]&&Jt(Ye[Ne]),Ye[Ne]=null;Un.push(te)}function jn(){this.minFilter=lt,this.magFilter=lt,this.wrapS=Jf,this.wrapT=Jf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ks}function Ei(te,Ye){if("min"in Ye){var Ne=Ye.min;j.parameter(Ne,At),te.minFilter=At[Ne],eh.indexOf(te.minFilter)>=0&&!("faces"in Ye)&&(te.genMipmaps=!0)}if("mag"in Ye){var nr=Ye.mag;j.parameter(nr,vt),te.magFilter=vt[nr]}var on=te.wrapS,q=te.wrapT;if("wrap"in Ye){var N=Ye.wrap;typeof N=="string"?(j.parameter(N,bt),on=q=bt[N]):Array.isArray(N)&&(j.parameter(N[0],bt),j.parameter(N[1],bt),on=bt[N[0]],q=bt[N[1]])}else{if("wrapS"in Ye){var ue=Ye.wrapS;j.parameter(ue,bt),on=bt[ue]}if("wrapT"in Ye){var _e=Ye.wrapT;j.parameter(_e,bt),q=bt[_e]}}if(te.wrapS=on,te.wrapT=q,"anisotropic"in Ye){var We=Ye.anisotropic;j(typeof We=="number"&&We>=1&&We<=ie.maxAnisotropic,"aniso samples must be between 1 and "),te.anisotropic=Ye.anisotropic}if("mipmap"in Ye){var de=!1;switch(typeof Ye.mipmap){case"string":j.parameter(Ye.mipmap,gt,"invalid mipmap hint"),te.mipmapHint=gt[Ye.mipmap],te.genMipmaps=!0,de=!0;break;case"boolean":de=te.genMipmaps=Ye.mipmap;break;case"object":j(Array.isArray(Ye.mipmap),"invalid mipmap type"),te.genMipmaps=!1,de=!0;break;default:j.raise("invalid mipmap type")}de&&!("min"in Ye)&&(te.minFilter=Wt)}}function pi(te,Ye){S.texParameteri(Ye,Fe,te.minFilter),S.texParameteri(Ye,pc,te.magFilter),S.texParameteri(Ye,ld,te.wrapS),S.texParameteri(Ye,lf,te.wrapT),G.ext_texture_filter_anisotropic&&S.texParameteri(Ye,qo,te.anisotropic),te.genMipmaps&&(S.hint(wn,te.mipmapHint),S.generateMipmap(Ye))}var Mi=0,Di={},Zi=ie.maxTextureUnits,vi=Array(Zi).map(function(){return null});function jr(te){ht.call(this),this.mipmask=0,this.internalformat=gu,this.id=Mi++,this.refCount=1,this.target=te,this.texture=S.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new jn,tt.profile&&(this.stats={size:0})}function Oi(te){S.activeTexture(Bs),S.bindTexture(te.target,te.texture)}function bn(){var te=vi[0];te?S.bindTexture(te.target,te.texture):S.bindTexture(Ra,null)}function Ri(te){var Ye=te.texture;j(Ye,"must not double destroy texture");var Ne=te.unit,nr=te.target;Ne>=0&&(S.activeTexture(Bs+Ne),S.bindTexture(nr,null),vi[Ne]=null),S.deleteTexture(Ye),te.texture=null,te.params=null,te.pixels=null,te.refCount=0,delete Di[te.id],ze.textureCount--}$(jr.prototype,{bind:function(){var te=this;te.bindCount+=1;var Ye=te.unit;if(Ye<0){for(var Ne=0;Ne<Zi;++Ne){var nr=vi[Ne];if(nr){if(nr.bindCount>0)continue;nr.unit=-1}vi[Ne]=te,Ye=Ne;break}Ye>=Zi&&j.raise("insufficient number of texture units"),tt.profile&&ze.maxTextureUnits<Ye+1&&(ze.maxTextureUnits=Ye+1),te.unit=Ye,S.activeTexture(Bs+Ye),S.bindTexture(te.target,te.texture)}return Ye},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ri(this)}});function Rr(te,Ye){var Ne=new jr(Ra);Di[Ne.id]=Ne,ze.textureCount++;function nr(N,ue){var _e=Ne.texInfo;jn.call(_e);var We=tn();return typeof N=="number"?typeof ue=="number"?Ir(We,N|0,ue|0):Ir(We,N|0,N|0):N?(j.type(N,"object","invalid arguments to regl.texture"),Ei(_e,N),en(We,N)):Ir(We,1,1),_e.genMipmaps&&(We.mipmask=(We.width<<1)-1),Ne.mipmask=We.mipmask,st(Ne,We),j.texture2D(_e,We,ie),Ne.internalformat=We.internalformat,nr.width=We.width,nr.height=We.height,Oi(Ne),An(We,Ra),pi(_e,Ra),bn(),Ti(We),tt.profile&&(Ne.stats.size=Ia(Ne.internalformat,Ne.type,We.width,We.height,_e.genMipmaps,!1)),nr.format=wt[Ne.internalformat],nr.type=tr[Ne.type],nr.mag=yt[_e.magFilter],nr.min=Qt[_e.minFilter],nr.wrapS=Kt[_e.wrapS],nr.wrapT=Kt[_e.wrapT],nr}function on(N,ue,_e,We){j(!!N,"must specify image data");var de=ue|0,fe=_e|0,me=We|0,H=$t();return st(H,Ne),H.width=0,H.height=0,Xt(H,N),H.width=H.width||(Ne.width>>me)-de,H.height=H.height||(Ne.height>>me)-fe,j(Ne.type===H.type&&Ne.format===H.format&&Ne.internalformat===H.internalformat,"incompatible format for texture.subimage"),j(de>=0&&fe>=0&&de+H.width<=Ne.width&&fe+H.height<=Ne.height,"texture.subimage write out of bounds"),j(Ne.mipmask&1<<me,"missing mipmap data"),j(H.data||H.element||H.needsCopy,"missing image data"),Oi(Ne),Nr(H,Ra,de,fe,me),bn(),Jt(H),nr}function q(N,ue){var _e=N|0,We=ue|0||_e;if(_e===Ne.width&&We===Ne.height)return nr;nr.width=Ne.width=_e,nr.height=Ne.height=We,Oi(Ne);for(var de=0;Ne.mipmask>>de;++de){var fe=_e>>de,me=We>>de;if(!fe||!me)break;S.texImage2D(Ra,de,Ne.format,fe,me,0,Ne.format,Ne.type,null)}return bn(),tt.profile&&(Ne.stats.size=Ia(Ne.internalformat,Ne.type,_e,We,!1,!1)),nr}return nr(te,Ye),nr.subimage=on,nr.resize=q,nr._reglType="texture2d",nr._texture=Ne,tt.profile&&(nr.stats=Ne.stats),nr.destroy=function(){Ne.decRef()},nr}function qr(te,Ye,Ne,nr,on,q){var N=new jr(Po);Di[N.id]=N,ze.cubeCount++;var ue=new Array(6);function _e(fe,me,H,ae,J,Se){var Le,xt=N.texInfo;for(jn.call(xt),Le=0;Le<6;++Le)ue[Le]=tn();if(typeof fe=="number"||!fe){var Ht=fe|0||1;for(Le=0;Le<6;++Le)Ir(ue[Le],Ht,Ht)}else if(typeof fe=="object")if(me)en(ue[0],fe),en(ue[1],me),en(ue[2],H),en(ue[3],ae),en(ue[4],J),en(ue[5],Se);else if(Ei(xt,fe),or(N,fe),"faces"in fe){var jt=fe.faces;for(j(Array.isArray(jt)&&jt.length===6,"cube faces must be a length 6 array"),Le=0;Le<6;++Le)j(typeof jt[Le]=="object"&&!!jt[Le],"invalid input for cube map face"),st(ue[Le],N),en(ue[Le],jt[Le])}else for(Le=0;Le<6;++Le)en(ue[Le],fe);else j.raise("invalid arguments to cube map");for(st(N,ue[0]),j.optional(function(){ie.npotTextureCube||j(Xf(N.width)&&Xf(N.height),"your browser does not support non power or two texture dimensions")}),xt.genMipmaps?N.mipmask=(ue[0].width<<1)-1:N.mipmask=ue[0].mipmask,j.textureCube(N,xt,ue,ie),N.internalformat=ue[0].internalformat,_e.width=ue[0].width,_e.height=ue[0].height,Oi(N),Le=0;Le<6;++Le)An(ue[Le],bl+Le);for(pi(xt,Po),bn(),tt.profile&&(N.stats.size=Ia(N.internalformat,N.type,_e.width,_e.height,xt.genMipmaps,!0)),_e.format=wt[N.internalformat],_e.type=tr[N.type],_e.mag=yt[xt.magFilter],_e.min=Qt[xt.minFilter],_e.wrapS=Kt[xt.wrapS],_e.wrapT=Kt[xt.wrapT],Le=0;Le<6;++Le)Ti(ue[Le]);return _e}function We(fe,me,H,ae,J){j(!!me,"must specify image data"),j(typeof fe=="number"&&fe===(fe|0)&&fe>=0&&fe<6,"invalid face");var Se=H|0,Le=ae|0,xt=J|0,Ht=$t();return st(Ht,N),Ht.width=0,Ht.height=0,Xt(Ht,me),Ht.width=Ht.width||(N.width>>xt)-Se,Ht.height=Ht.height||(N.height>>xt)-Le,j(N.type===Ht.type&&N.format===Ht.format&&N.internalformat===Ht.internalformat,"incompatible format for texture.subimage"),j(Se>=0&&Le>=0&&Se+Ht.width<=N.width&&Le+Ht.height<=N.height,"texture.subimage write out of bounds"),j(N.mipmask&1<<xt,"missing mipmap data"),j(Ht.data||Ht.element||Ht.needsCopy,"missing image data"),Oi(N),Nr(Ht,bl+fe,Se,Le,xt),bn(),Jt(Ht),_e}function de(fe){var me=fe|0;if(me!==N.width){_e.width=N.width=me,_e.height=N.height=me,Oi(N);for(var H=0;H<6;++H)for(var ae=0;N.mipmask>>ae;++ae)S.texImage2D(bl+H,ae,N.format,me>>ae,me>>ae,0,N.format,N.type,null);return bn(),tt.profile&&(N.stats.size=Ia(N.internalformat,N.type,_e.width,_e.height,!1,!0)),_e}}return _e(te,Ye,Ne,nr,on,q),_e.subimage=We,_e.resize=de,_e._reglType="textureCube",_e._texture=N,tt.profile&&(_e.stats=N.stats),_e.destroy=function(){N.decRef()},_e}function Pn(){for(var te=0;te<Zi;++te)S.activeTexture(Bs+te),S.bindTexture(Ra,null),vi[te]=null;D(Di).forEach(Ri),ze.cubeCount=0,ze.textureCount=0}tt.profile&&(ze.getTotalTextureSize=function(){var te=0;return Object.keys(Di).forEach(function(Ye){te+=Di[Ye].stats.size}),te});function mi(){for(var te=0;te<Zi;++te){var Ye=vi[te];Ye&&(Ye.bindCount=0,Ye.unit=-1,vi[te]=null)}D(Di).forEach(function(Ne){Ne.texture=S.createTexture(),S.bindTexture(Ne.target,Ne.texture);for(var nr=0;nr<32;++nr)if((Ne.mipmask&1<<nr)!=0)if(Ne.target===Ra)S.texImage2D(Ra,nr,Ne.internalformat,Ne.width>>nr,Ne.height>>nr,0,Ne.internalformat,Ne.type,null);else for(var on=0;on<6;++on)S.texImage2D(bl+on,nr,Ne.internalformat,Ne.width>>nr,Ne.height>>nr,0,Ne.internalformat,Ne.type,null);pi(Ne.texInfo,Ne.target)})}function au(){for(var te=0;te<Zi;++te){var Ye=vi[te];Ye&&(Ye.bindCount=0,Ye.unit=-1,vi[te]=null),S.activeTexture(Bs+te),S.bindTexture(Ra,null),S.bindTexture(Po,null)}}return{create2D:Rr,createCube:qr,clear:Pn,getTexture:function(te){return null},restore:mi,refresh:au}}var xu=36161,Fl=32854,Su=32855,Nl=36194,ts=33189,Us=36168,Gs=34041,zs=35907,Hs=34836,nh=34842,n0=34843,po=[];po[Fl]=2,po[Su]=2,po[Nl]=2,po[ts]=2,po[Us]=1,po[Gs]=4,po[zs]=4,po[Hs]=16,po[nh]=8,po[n0]=6;function rs(S,G,ie){return po[S]*G*ie}var dd=function(S,G,ie,De,pt){var ze={rgba4:Fl,rgb565:Nl,"rgb5 a1":Su,depth:ts,stencil:Us,"depth stencil":Gs};G.ext_srgb&&(ze.srgba=zs),G.ext_color_buffer_half_float&&(ze.rgba16f=nh,ze.rgb16f=n0),G.webgl_color_buffer_float&&(ze.rgba32f=Hs);var tt=[];Object.keys(ze).forEach(function(_t){var Dt=ze[_t];tt[Dt]=_t});var gt=0,bt={};function vt(_t){this.id=gt++,this.refCount=1,this.renderbuffer=_t,this.format=Fl,this.width=0,this.height=0,pt.profile&&(this.stats={size:0})}vt.prototype.decRef=function(){--this.refCount<=0&&At(this)};function At(_t){var Dt=_t.renderbuffer;j(Dt,"must not double destroy renderbuffer"),S.bindRenderbuffer(xu,null),S.deleteRenderbuffer(Dt),_t.renderbuffer=null,_t.refCount=0,delete bt[_t.id],De.renderbufferCount--}function Ft(_t,Dt){var Ce=new vt(S.createRenderbuffer());bt[Ce.id]=Ce,De.renderbufferCount++;function He(tr,yt){var Qt=0,Kt=0,br=Fl;if(typeof tr=="object"&&tr){var ht=tr;if("shape"in ht){var st=ht.shape;j(Array.isArray(st)&&st.length>=2,"invalid renderbuffer shape"),Qt=st[0]|0,Kt=st[1]|0}else"radius"in ht&&(Qt=Kt=ht.radius|0),"width"in ht&&(Qt=ht.width|0),"height"in ht&&(Kt=ht.height|0);"format"in ht&&(j.parameter(ht.format,ze,"invalid renderbuffer format"),br=ze[ht.format])}else typeof tr=="number"?(Qt=tr|0,typeof yt=="number"?Kt=yt|0:Kt=Qt):tr?j.raise("invalid arguments to renderbuffer constructor"):Qt=Kt=1;if(j(Qt>0&&Kt>0&&Qt<=ie.maxRenderbufferSize&&Kt<=ie.maxRenderbufferSize,"invalid renderbuffer size"),!(Qt===Ce.width&&Kt===Ce.height&&br===Ce.format))return He.width=Ce.width=Qt,He.height=Ce.height=Kt,Ce.format=br,S.bindRenderbuffer(xu,Ce.renderbuffer),S.renderbufferStorage(xu,br,Qt,Kt),j(S.getError()===0,"invalid render buffer format"),pt.profile&&(Ce.stats.size=rs(Ce.format,Ce.width,Ce.height)),He.format=tt[Ce.format],He}function wt(tr,yt){var Qt=tr|0,Kt=yt|0||Qt;return Qt===Ce.width&&Kt===Ce.height||(j(Qt>0&&Kt>0&&Qt<=ie.maxRenderbufferSize&&Kt<=ie.maxRenderbufferSize,"invalid renderbuffer size"),He.width=Ce.width=Qt,He.height=Ce.height=Kt,S.bindRenderbuffer(xu,Ce.renderbuffer),S.renderbufferStorage(xu,Ce.format,Qt,Kt),j(S.getError()===0,"invalid render buffer format"),pt.profile&&(Ce.stats.size=rs(Ce.format,Ce.width,Ce.height))),He}return He(_t,Dt),He.resize=wt,He._reglType="renderbuffer",He._renderbuffer=Ce,pt.profile&&(He.stats=Ce.stats),He.destroy=function(){Ce.decRef()},He}pt.profile&&(De.getTotalRenderbufferSize=function(){var _t=0;return Object.keys(bt).forEach(function(Dt){_t+=bt[Dt].stats.size}),_t});function kt(){D(bt).forEach(function(_t){_t.renderbuffer=S.createRenderbuffer(),S.bindRenderbuffer(xu,_t.renderbuffer),S.renderbufferStorage(xu,_t.format,_t.width,_t.height)}),S.bindRenderbuffer(xu,null)}return{create:Ft,clear:function(){D(bt).forEach(At)},restore:kt}},ya=36160,Cu=36161,Ja=3553,Z=34069,Do=36064,Fo=36096,Yi=36128,Jr=33306,ih=36053,i0=36054,a0=36055,ns=36057,o0=36061,u0=36193,s0=5121,ah=5126,ff=6407,No=6408,oh=6402,Au=[ff,No],yc=[];yc[No]=4,yc[ff]=3;var is=[];is[s0]=1,is[ah]=4,is[u0]=2;var l0=32854,eo=32855,La=36194,uh=33189,sh=36168,Ec=34041,lh=35907,bu=34836,c0=34842,ko=34843,Da=[l0,eo,La,lh,c0,ko,bu],js={};js[ih]="complete",js[i0]="incomplete attachment",js[ns]="incomplete dimensions",js[a0]="incomplete, missing attachment",js[o0]="unsupported";function Zn(S,G,ie,De,pt,ze){var tt={cur:null,next:null,dirty:!1,setFBO:null},gt=["rgba"],bt=["rgba4","rgb565","rgb5 a1"];G.ext_srgb&&bt.push("srgba"),G.ext_color_buffer_half_float&&bt.push("rgba16f","rgb16f"),G.webgl_color_buffer_float&&bt.push("rgba32f");var vt=["uint8"];G.oes_texture_half_float&&vt.push("half float","float16"),G.oes_texture_float&&vt.push("float","float32");function At(Ot,Xt,Yt){this.target=Ot,this.texture=Xt,this.renderbuffer=Yt;var Nr=0,Mr=0;Xt?(Nr=Xt.width,Mr=Xt.height):Yt&&(Nr=Yt.width,Mr=Yt.height),this.width=Nr,this.height=Mr}function Ft(Ot){Ot&&(Ot.texture&&Ot.texture._texture.decRef(),Ot.renderbuffer&&Ot.renderbuffer._renderbuffer.decRef())}function kt(Ot,Xt,Yt){if(!!Ot)if(Ot.texture){var Nr=Ot.texture._texture,Mr=Math.max(1,Nr.width),$t=Math.max(1,Nr.height);j(Mr===Xt&&$t===Yt,"inconsistent width/height for supplied texture"),Nr.refCount+=1}else{var Jt=Ot.renderbuffer._renderbuffer;j(Jt.width===Xt&&Jt.height===Yt,"inconsistent width/height for renderbuffer"),Jt.refCount+=1}}function _t(Ot,Xt){Xt&&(Xt.texture?S.framebufferTexture2D(ya,Ot,Xt.target,Xt.texture._texture.texture,0):S.framebufferRenderbuffer(ya,Ot,Cu,Xt.renderbuffer._renderbuffer.renderbuffer))}function Dt(Ot){var Xt=Ja,Yt=null,Nr=null,Mr=Ot;typeof Ot=="object"&&(Mr=Ot.data,"target"in Ot&&(Xt=Ot.target|0)),j.type(Mr,"function","invalid attachment data");var $t=Mr._reglType;return $t==="texture2d"?(Yt=Mr,j(Xt===Ja)):$t==="textureCube"?(Yt=Mr,j(Xt>=Z&&Xt<Z+6,"invalid cube map target")):$t==="renderbuffer"?(Nr=Mr,Xt=Cu):j.raise("invalid regl object for attachment"),new At(Xt,Yt,Nr)}function Ce(Ot,Xt,Yt,Nr,Mr){if(Yt){var $t=De.create2D({width:Ot,height:Xt,format:Nr,type:Mr});return $t._texture.refCount=0,new At(Ja,$t,null)}else{var Jt=pt.create({width:Ot,height:Xt,format:Nr});return Jt._renderbuffer.refCount=0,new At(Cu,null,Jt)}}function He(Ot){return Ot&&(Ot.texture||Ot.renderbuffer)}function wt(Ot,Xt,Yt){Ot&&(Ot.texture?Ot.texture.resize(Xt,Yt):Ot.renderbuffer&&Ot.renderbuffer.resize(Xt,Yt),Ot.width=Xt,Ot.height=Yt)}var tr=0,yt={};function Qt(){this.id=tr++,yt[this.id]=this,this.framebuffer=S.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Kt(Ot){Ot.colorAttachments.forEach(Ft),Ft(Ot.depthAttachment),Ft(Ot.stencilAttachment),Ft(Ot.depthStencilAttachment)}function br(Ot){var Xt=Ot.framebuffer;j(Xt,"must not double destroy framebuffer"),S.deleteFramebuffer(Xt),Ot.framebuffer=null,ze.framebufferCount--,delete yt[Ot.id]}function ht(Ot){var Xt;S.bindFramebuffer(ya,Ot.framebuffer);var Yt=Ot.colorAttachments;for(Xt=0;Xt<Yt.length;++Xt)_t(Do+Xt,Yt[Xt]);for(Xt=Yt.length;Xt<ie.maxColorAttachments;++Xt)S.framebufferTexture2D(ya,Do+Xt,Ja,null,0);S.framebufferTexture2D(ya,Jr,Ja,null,0),S.framebufferTexture2D(ya,Fo,Ja,null,0),S.framebufferTexture2D(ya,Yi,Ja,null,0),_t(Fo,Ot.depthAttachment),_t(Yi,Ot.stencilAttachment),_t(Jr,Ot.depthStencilAttachment);var Nr=S.checkFramebufferStatus(ya);!S.isContextLost()&&Nr!==ih&&j.raise("framebuffer configuration not supported, status = "+js[Nr]),S.bindFramebuffer(ya,tt.next?tt.next.framebuffer:null),tt.cur=tt.next,S.getError()}function st(Ot,Xt){var Yt=new Qt;ze.framebufferCount++;function Nr($t,Jt){var Or;j(tt.next!==Yt,"can not update framebuffer which is currently in use");var Ir=0,en=0,An=!0,Un=!0,tn=null,Ti=!0,jn="rgba",Ei="uint8",pi=1,Mi=null,Di=null,Zi=null,vi=!1;if(typeof $t=="number")Ir=$t|0,en=Jt|0||Ir;else if(!$t)Ir=en=1;else{j.type($t,"object","invalid arguments for framebuffer");var jr=$t;if("shape"in jr){var Oi=jr.shape;j(Array.isArray(Oi)&&Oi.length>=2,"invalid shape for framebuffer"),Ir=Oi[0],en=Oi[1]}else"radius"in jr&&(Ir=en=jr.radius),"width"in jr&&(Ir=jr.width),"height"in jr&&(en=jr.height);("color"in jr||"colors"in jr)&&(tn=jr.color||jr.colors,Array.isArray(tn)&&j(tn.length===1||G.webgl_draw_buffers,"multiple render targets not supported")),tn||("colorCount"in jr&&(pi=jr.colorCount|0,j(pi>0,"invalid color buffer count")),"colorTexture"in jr&&(Ti=!!jr.colorTexture,jn="rgba4"),"colorType"in jr&&(Ei=jr.colorType,Ti?(j(G.oes_texture_float||!(Ei==="float"||Ei==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),j(G.oes_texture_half_float||!(Ei==="half float"||Ei==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ei==="half float"||Ei==="float16"?(j(G.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),jn="rgba16f"):(Ei==="float"||Ei==="float32")&&(j(G.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),jn="rgba32f"),j.oneOf(Ei,vt,"invalid color type")),"colorFormat"in jr&&(jn=jr.colorFormat,gt.indexOf(jn)>=0?Ti=!0:bt.indexOf(jn)>=0?Ti=!1:j.optional(function(){Ti?j.oneOf(jr.colorFormat,gt,"invalid color format for texture"):j.oneOf(jr.colorFormat,bt,"invalid color format for renderbuffer")}))),("depthTexture"in jr||"depthStencilTexture"in jr)&&(vi=!!(jr.depthTexture||jr.depthStencilTexture),j(!vi||G.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in jr&&(typeof jr.depth=="boolean"?An=jr.depth:(Mi=jr.depth,Un=!1)),"stencil"in jr&&(typeof jr.stencil=="boolean"?Un=jr.stencil:(Di=jr.stencil,An=!1)),"depthStencil"in jr&&(typeof jr.depthStencil=="boolean"?An=Un=jr.depthStencil:(Zi=jr.depthStencil,An=!1,Un=!1))}var bn=null,Ri=null,Rr=null,qr=null;if(Array.isArray(tn))bn=tn.map(Dt);else if(tn)bn=[Dt(tn)];else for(bn=new Array(pi),Or=0;Or<pi;++Or)bn[Or]=Ce(Ir,en,Ti,jn,Ei);j(G.webgl_draw_buffers||bn.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),j(bn.length<=ie.maxColorAttachments,"too many color attachments, not supported"),Ir=Ir||bn[0].width,en=en||bn[0].height,Mi?Ri=Dt(Mi):An&&!Un&&(Ri=Ce(Ir,en,vi,"depth","uint32")),Di?Rr=Dt(Di):Un&&!An&&(Rr=Ce(Ir,en,!1,"stencil","uint8")),Zi?qr=Dt(Zi):!Mi&&!Di&&Un&&An&&(qr=Ce(Ir,en,vi,"depth stencil","depth stencil")),j(!!Mi+!!Di+!!Zi<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Pn=null;for(Or=0;Or<bn.length;++Or)if(kt(bn[Or],Ir,en),j(!bn[Or]||bn[Or].texture&&Au.indexOf(bn[Or].texture._texture.format)>=0||bn[Or].renderbuffer&&Da.indexOf(bn[Or].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Or+" is invalid"),bn[Or]&&bn[Or].texture){var mi=yc[bn[Or].texture._texture.format]*is[bn[Or].texture._texture.type];Pn===null?Pn=mi:j(Pn===mi,"all color attachments much have the same number of bits per pixel.")}return kt(Ri,Ir,en),j(!Ri||Ri.texture&&Ri.texture._texture.format===oh||Ri.renderbuffer&&Ri.renderbuffer._renderbuffer.format===uh,"invalid depth attachment for framebuffer object"),kt(Rr,Ir,en),j(!Rr||Rr.renderbuffer&&Rr.renderbuffer._renderbuffer.format===sh,"invalid stencil attachment for framebuffer object"),kt(qr,Ir,en),j(!qr||qr.texture&&qr.texture._texture.format===Ec||qr.renderbuffer&&qr.renderbuffer._renderbuffer.format===Ec,"invalid depth-stencil attachment for framebuffer object"),Kt(Yt),Yt.width=Ir,Yt.height=en,Yt.colorAttachments=bn,Yt.depthAttachment=Ri,Yt.stencilAttachment=Rr,Yt.depthStencilAttachment=qr,Nr.color=bn.map(He),Nr.depth=He(Ri),Nr.stencil=He(Rr),Nr.depthStencil=He(qr),Nr.width=Yt.width,Nr.height=Yt.height,ht(Yt),Nr}function Mr($t,Jt){j(tt.next!==Yt,"can not resize a framebuffer which is currently in use");var Or=Math.max($t|0,1),Ir=Math.max(Jt|0||Or,1);if(Or===Yt.width&&Ir===Yt.height)return Nr;for(var en=Yt.colorAttachments,An=0;An<en.length;++An)wt(en[An],Or,Ir);return wt(Yt.depthAttachment,Or,Ir),wt(Yt.stencilAttachment,Or,Ir),wt(Yt.depthStencilAttachment,Or,Ir),Yt.width=Nr.width=Or,Yt.height=Nr.height=Ir,ht(Yt),Nr}return Nr(Ot,Xt),$(Nr,{resize:Mr,_reglType:"framebuffer",_framebuffer:Yt,destroy:function(){br(Yt),Kt(Yt)},use:function($t){tt.setFBO({framebuffer:Nr},$t)}})}function or(Ot){var Xt=Array(6);function Yt(Mr){var $t;j(Xt.indexOf(tt.next)<0,"can not update framebuffer which is currently in use");var Jt={color:null},Or=0,Ir=null,en="rgba",An="uint8",Un=1;if(typeof Mr=="number")Or=Mr|0;else if(!Mr)Or=1;else{j.type(Mr,"object","invalid arguments for framebuffer");var tn=Mr;if("shape"in tn){var Ti=tn.shape;j(Array.isArray(Ti)&&Ti.length>=2,"invalid shape for framebuffer"),j(Ti[0]===Ti[1],"cube framebuffer must be square"),Or=Ti[0]}else"radius"in tn&&(Or=tn.radius|0),"width"in tn?(Or=tn.width|0,"height"in tn&&j(tn.height===Or,"must be square")):"height"in tn&&(Or=tn.height|0);("color"in tn||"colors"in tn)&&(Ir=tn.color||tn.colors,Array.isArray(Ir)&&j(Ir.length===1||G.webgl_draw_buffers,"multiple render targets not supported")),Ir||("colorCount"in tn&&(Un=tn.colorCount|0,j(Un>0,"invalid color buffer count")),"colorType"in tn&&(j.oneOf(tn.colorType,vt,"invalid color type"),An=tn.colorType),"colorFormat"in tn&&(en=tn.colorFormat,j.oneOf(tn.colorFormat,gt,"invalid color format for texture"))),"depth"in tn&&(Jt.depth=tn.depth),"stencil"in tn&&(Jt.stencil=tn.stencil),"depthStencil"in tn&&(Jt.depthStencil=tn.depthStencil)}var jn;if(Ir)if(Array.isArray(Ir))for(jn=[],$t=0;$t<Ir.length;++$t)jn[$t]=Ir[$t];else jn=[Ir];else{jn=Array(Un);var Ei={radius:Or,format:en,type:An};for($t=0;$t<Un;++$t)jn[$t]=De.createCube(Ei)}for(Jt.color=Array(jn.length),$t=0;$t<jn.length;++$t){var pi=jn[$t];j(typeof pi=="function"&&pi._reglType==="textureCube","invalid cube map"),Or=Or||pi.width,j(pi.width===Or&&pi.height===Or,"invalid cube map shape"),Jt.color[$t]={target:Z,data:jn[$t]}}for($t=0;$t<6;++$t){for(var Mi=0;Mi<jn.length;++Mi)Jt.color[Mi].target=Z+$t;$t>0&&(Jt.depth=Xt[0].depth,Jt.stencil=Xt[0].stencil,Jt.depthStencil=Xt[0].depthStencil),Xt[$t]?Xt[$t](Jt):Xt[$t]=st(Jt)}return $(Yt,{width:Or,height:Or,color:jn})}function Nr(Mr){var $t,Jt=Mr|0;if(j(Jt>0&&Jt<=ie.maxCubeMapSize,"invalid radius for cube fbo"),Jt===Yt.width)return Yt;var Or=Yt.color;for($t=0;$t<Or.length;++$t)Or[$t].resize(Jt);for($t=0;$t<6;++$t)Xt[$t].resize(Jt);return Yt.width=Yt.height=Jt,Yt}return Yt(Ot),$(Yt,{faces:Xt,resize:Nr,_reglType:"framebufferCube",destroy:function(){Xt.forEach(function(Mr){Mr.destroy()})}})}function Bt(){tt.cur=null,tt.next=null,tt.dirty=!0,D(yt).forEach(function(Ot){Ot.framebuffer=S.createFramebuffer(),ht(Ot)})}return $(tt,{getFramebuffer:function(Ot){if(typeof Ot=="function"&&Ot._reglType==="framebuffer"){var Xt=Ot._framebuffer;if(Xt instanceof Qt)return Xt}return null},create:st,createCube:or,clear:function(){D(yt).forEach(br)},restore:Bt})}var Vs=5126,Ws=34962,Xs=34963,Ys=["attributes","elements","offset","count","primitive","instances"];function as(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Vs,this.offset=0,this.stride=0,this.divisor=0}function ch(S,G,ie,De,pt,ze,tt){for(var gt=ie.maxAttributes,bt=new Array(gt),vt=0;vt<gt;++vt)bt[vt]=new as;var At=0,Ft={},kt={Record:as,scope:{},state:bt,currentVAO:null,targetVAO:null,restore:Dt()?Kt:function(){},createVAO:br,getVAO:He,destroyBuffer:_t,setVAO:Dt()?wt:tr,clear:Dt()?yt:function(){}};function _t(ht){for(var st=0;st<bt.length;++st){var or=bt[st];or.buffer===ht&&(S.disableVertexAttribArray(st),or.buffer=null)}}function Dt(){return G.oes_vertex_array_object}function Ce(){return G.angle_instanced_arrays}function He(ht){return typeof ht=="function"&&ht._vao?ht._vao:null}function wt(ht){if(ht!==kt.currentVAO){var st=Dt();ht?st.bindVertexArrayOES(ht.vao):st.bindVertexArrayOES(null),kt.currentVAO=ht}}function tr(ht){if(ht!==kt.currentVAO){if(ht)ht.bindAttrs();else{for(var st=Ce(),or=0;or<bt.length;++or){var Bt=bt[or];Bt.buffer?(S.enableVertexAttribArray(or),Bt.buffer.bind(),S.vertexAttribPointer(or,Bt.size,Bt.type,Bt.normalized,Bt.stride,Bt.offfset),st&&Bt.divisor&&st.vertexAttribDivisorANGLE(or,Bt.divisor)):(S.disableVertexAttribArray(or),S.vertexAttrib4f(or,Bt.x,Bt.y,Bt.z,Bt.w))}tt.elements?S.bindBuffer(Xs,tt.elements.buffer.buffer):S.bindBuffer(Xs,null)}kt.currentVAO=ht}}function yt(){D(Ft).forEach(function(ht){ht.destroy()})}function Qt(){this.id=++At,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var ht=Dt();ht?this.vao=ht.createVertexArrayOES():this.vao=null,Ft[this.id]=this,this.buffers=[]}Qt.prototype.bindAttrs=function(){for(var ht=Ce(),st=this.attributes,or=0;or<st.length;++or){var Bt=st[or];Bt.buffer?(S.enableVertexAttribArray(or),S.bindBuffer(Ws,Bt.buffer.buffer),S.vertexAttribPointer(or,Bt.size,Bt.type,Bt.normalized,Bt.stride,Bt.offset),ht&&Bt.divisor&&ht.vertexAttribDivisorANGLE(or,Bt.divisor)):(S.disableVertexAttribArray(or),S.vertexAttrib4f(or,Bt.x,Bt.y,Bt.z,Bt.w))}for(var Ot=st.length;Ot<gt;++Ot)S.disableVertexAttribArray(Ot);var Xt=ze.getElements(this.elements);Xt?S.bindBuffer(Xs,Xt.buffer.buffer):S.bindBuffer(Xs,null)},Qt.prototype.refresh=function(){var ht=Dt();ht&&(ht.bindVertexArrayOES(this.vao),this.bindAttrs(),kt.currentVAO=null,ht.bindVertexArrayOES(null))},Qt.prototype.destroy=function(){if(this.vao){var ht=Dt();this===kt.currentVAO&&(kt.currentVAO=null,ht.bindVertexArrayOES(null)),ht.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ft[this.id]&&(delete Ft[this.id],De.vaoCount-=1)};function Kt(){var ht=Dt();ht&&D(Ft).forEach(function(st){st.refresh()})}function br(ht){var st=new Qt;De.vaoCount+=1;function or(Bt){var Ot;if(Array.isArray(Bt))Ot=Bt,st.elements&&st.ownsElements&&st.elements.destroy(),st.elements=null,st.ownsElements=!1,st.offset=0,st.count=0,st.instances=-1,st.primitive=4;else{if(j(typeof Bt=="object","invalid arguments for create vao"),j("attributes"in Bt,"must specify attributes for vao"),Bt.elements){var Xt=Bt.elements;st.ownsElements?typeof Xt=="function"&&Xt._reglType==="elements"?(st.elements.destroy(),st.ownsElements=!1):(st.elements(Xt),st.ownsElements=!1):ze.getElements(Bt.elements)?(st.elements=Bt.elements,st.ownsElements=!1):(st.elements=ze.create(Bt.elements),st.ownsElements=!0)}else st.elements=null,st.ownsElements=!1;Ot=Bt.attributes,st.offset=0,st.count=-1,st.instances=-1,st.primitive=4,st.elements&&(st.count=st.elements._elements.vertCount,st.primitive=st.elements._elements.primType),"offset"in Bt&&(st.offset=Bt.offset|0),"count"in Bt&&(st.count=Bt.count|0),"instances"in Bt&&(st.instances=Bt.instances|0),"primitive"in Bt&&(j(Bt.primitive in Ct,"bad primitive type: "+Bt.primitive),st.primitive=Ct[Bt.primitive]),j.optional(function(){for(var An=Object.keys(Bt),Un=0;Un<An.length;++Un)j(Ys.indexOf(An[Un])>=0,'invalid option for vao: "'+An[Un]+'" valid options are '+Ys)}),j(Array.isArray(Ot),"attributes must be an array")}j(Ot.length<gt,"too many attributes"),j(Ot.length>0,"must specify at least one attribute");var Yt={},Nr=st.attributes;Nr.length=Ot.length;for(var Mr=0;Mr<Ot.length;++Mr){var $t=Ot[Mr],Jt=Nr[Mr]=new as,Or=$t.data||$t;if(Array.isArray(Or)||A(Or)||ji(Or)){var Ir;st.buffers[Mr]&&(Ir=st.buffers[Mr],A(Or)&&Ir._buffer.byteLength>=Or.byteLength?Ir.subdata(Or):(Ir.destroy(),st.buffers[Mr]=null)),st.buffers[Mr]||(Ir=st.buffers[Mr]=pt.create($t,Ws,!1,!0)),Jt.buffer=pt.getBuffer(Ir),Jt.size=Jt.buffer.dimension|0,Jt.normalized=!1,Jt.type=Jt.buffer.dtype,Jt.offset=0,Jt.stride=0,Jt.divisor=0,Jt.state=1,Yt[Mr]=1}else pt.getBuffer($t)?(Jt.buffer=pt.getBuffer($t),Jt.size=Jt.buffer.dimension|0,Jt.normalized=!1,Jt.type=Jt.buffer.dtype,Jt.offset=0,Jt.stride=0,Jt.divisor=0,Jt.state=1):pt.getBuffer($t.buffer)?(Jt.buffer=pt.getBuffer($t.buffer),Jt.size=(+$t.size||Jt.buffer.dimension)|0,Jt.normalized=!!$t.normalized||!1,"type"in $t?(j.parameter($t.type,Oo,"invalid buffer type"),Jt.type=Oo[$t.type]):Jt.type=Jt.buffer.dtype,Jt.offset=($t.offset||0)|0,Jt.stride=($t.stride||0)|0,Jt.divisor=($t.divisor||0)|0,Jt.state=1,j(Jt.size>=1&&Jt.size<=4,"size must be between 1 and 4"),j(Jt.offset>=0,"invalid offset"),j(Jt.stride>=0&&Jt.stride<=255,"stride must be between 0 and 255"),j(Jt.divisor>=0,"divisor must be positive"),j(!Jt.divisor||!!G.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in $t?(j(Mr>0,"first attribute must not be a constant"),Jt.x=+$t.x||0,Jt.y=+$t.y||0,Jt.z=+$t.z||0,Jt.w=+$t.w||0,Jt.state=2):j(!1,"invalid attribute spec for location "+Mr)}for(var en=0;en<st.buffers.length;++en)!Yt[en]&&st.buffers[en]&&(st.buffers[en].destroy(),st.buffers[en]=null);return st.refresh(),or}return or.destroy=function(){for(var Bt=0;Bt<st.buffers.length;++Bt)st.buffers[Bt]&&st.buffers[Bt].destroy();st.buffers.length=0,st.ownsElements&&(st.elements.destroy(),st.elements=null,st.ownsElements=!1),st.destroy()},or._vao=st,or._reglType="vao",or(ht)}return kt}var ai=35632,Qo=35633,Jo=35718,xc=35721;function f0(S,G,ie,De){var pt={},ze={};function tt(Ce,He,wt,tr){this.name=Ce,this.id=He,this.location=wt,this.info=tr}function gt(Ce,He){for(var wt=0;wt<Ce.length;++wt)if(Ce[wt].id===He.id){Ce[wt].location=He.location;return}Ce.push(He)}function bt(Ce,He,wt){var tr=Ce===ai?pt:ze,yt=tr[He];if(!yt){var Qt=G.str(He);yt=S.createShader(Ce),S.shaderSource(yt,Qt),S.compileShader(yt),j.shaderError(S,yt,Qt,Ce,wt),tr[He]=yt}return yt}var vt={},At=[],Ft=0;function kt(Ce,He){this.id=Ft++,this.fragId=Ce,this.vertId=He,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,De.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function _t(Ce,He,wt){var tr,yt,Qt=bt(ai,Ce.fragId),Kt=bt(Qo,Ce.vertId),br=Ce.program=S.createProgram();if(S.attachShader(br,Qt),S.attachShader(br,Kt),wt)for(tr=0;tr<wt.length;++tr){var ht=wt[tr];S.bindAttribLocation(br,ht[0],ht[1])}S.linkProgram(br),j.linkError(S,br,G.str(Ce.fragId),G.str(Ce.vertId),He);var st=S.getProgramParameter(br,Jo);De.profile&&(Ce.stats.uniformsCount=st);var or=Ce.uniforms;for(tr=0;tr<st;++tr)if(yt=S.getActiveUniform(br,tr),yt)if(yt.size>1)for(var Bt=0;Bt<yt.size;++Bt){var Ot=yt.name.replace("[0]","["+Bt+"]");gt(or,new tt(Ot,G.id(Ot),S.getUniformLocation(br,Ot),yt))}else gt(or,new tt(yt.name,G.id(yt.name),S.getUniformLocation(br,yt.name),yt));var Xt=S.getProgramParameter(br,xc);De.profile&&(Ce.stats.attributesCount=Xt);var Yt=Ce.attributes;for(tr=0;tr<Xt;++tr)yt=S.getActiveAttrib(br,tr),yt&&gt(Yt,new tt(yt.name,G.id(yt.name),S.getAttribLocation(br,yt.name),yt))}De.profile&&(ie.getMaxUniformsCount=function(){var Ce=0;return At.forEach(function(He){He.stats.uniformsCount>Ce&&(Ce=He.stats.uniformsCount)}),Ce},ie.getMaxAttributesCount=function(){var Ce=0;return At.forEach(function(He){He.stats.attributesCount>Ce&&(Ce=He.stats.attributesCount)}),Ce});function Dt(){pt={},ze={};for(var Ce=0;Ce<At.length;++Ce)_t(At[Ce],null,At[Ce].attributes.map(function(He){return[He.location,He.name]}))}return{clear:function(){var Ce=S.deleteShader.bind(S);D(pt).forEach(Ce),pt={},D(ze).forEach(Ce),ze={},At.forEach(function(He){S.deleteProgram(He.program)}),At.length=0,vt={},ie.shaderCount=0},program:function(Ce,He,wt,tr){j.command(Ce>=0,"missing vertex shader",wt),j.command(He>=0,"missing fragment shader",wt);var yt=vt[He];yt||(yt=vt[He]={});var Qt=yt[Ce];if(Qt&&(Qt.refCount++,!tr))return Qt;var Kt=new kt(He,Ce);return ie.shaderCount++,_t(Kt,wt,tr),Qt||(yt[Ce]=Kt),At.push(Kt),$(Kt,{destroy:function(){if(Kt.refCount--,Kt.refCount<=0){S.deleteProgram(Kt.program);var br=At.indexOf(Kt);At.splice(br,1),ie.shaderCount--}yt[Kt.vertId].refCount<=0&&(S.deleteShader(ze[Kt.vertId]),delete ze[Kt.vertId],delete vt[Kt.fragId][Kt.vertId]),Object.keys(vt[Kt.fragId]).length||(S.deleteShader(pt[Kt.fragId]),delete pt[Kt.fragId],delete vt[Kt.fragId])}})},restore:Dt,shader:bt,frag:-1,vert:-1}}var hf=6408,kl=5121,eu=3333,Tu=5126;function tu(S,G,ie,De,pt,ze,tt){function gt(At){var Ft;G.next===null?(j(pt.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ft=kl):(j(G.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ft=G.next.colorAttachments[0].texture._texture.type,j.optional(function(){ze.oes_texture_float?(j(Ft===kl||Ft===Tu,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ft===Tu&&j(tt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):j(Ft===kl,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var kt=0,_t=0,Dt=De.framebufferWidth,Ce=De.framebufferHeight,He=null;A(At)?He=At:At&&(j.type(At,"object","invalid arguments to regl.read()"),kt=At.x|0,_t=At.y|0,j(kt>=0&&kt<De.framebufferWidth,"invalid x offset for regl.read"),j(_t>=0&&_t<De.framebufferHeight,"invalid y offset for regl.read"),Dt=(At.width||De.framebufferWidth-kt)|0,Ce=(At.height||De.framebufferHeight-_t)|0,He=At.data||null),He&&(Ft===kl?j(He instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ft===Tu&&j(He instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),j(Dt>0&&Dt+kt<=De.framebufferWidth,"invalid width for read pixels"),j(Ce>0&&Ce+_t<=De.framebufferHeight,"invalid height for read pixels"),ie();var wt=Dt*Ce*4;return He||(Ft===kl?He=new Uint8Array(wt):Ft===Tu&&(He=He||new Float32Array(wt))),j.isTypedArray(He,"data buffer for regl.read() must be a typedarray"),j(He.byteLength>=wt,"data buffer for regl.read() too small"),S.pixelStorei(eu,4),S.readPixels(kt,_t,Dt,Ce,hf,Ft,He),He}function bt(At){var Ft;return G.setFBO({framebuffer:At.framebuffer},function(){Ft=gt(At)}),Ft}function vt(At){return!At||!("framebuffer"in At)?gt(At):bt(At)}return vt}function $i(S){return Array.prototype.slice.call(S)}function os(S){return $i(S).join("")}function fh(){var S=0,G=[],ie=[];function De(Ft){for(var kt=0;kt<ie.length;++kt)if(ie[kt]===Ft)return G[kt];var _t="g"+S++;return G.push(_t),ie.push(Ft),_t}function pt(){var Ft=[];function kt(){Ft.push.apply(Ft,$i(arguments))}var _t=[];function Dt(){var Ce="v"+S++;return _t.push(Ce),arguments.length>0&&(Ft.push(Ce,"="),Ft.push.apply(Ft,$i(arguments)),Ft.push(";")),Ce}return $(kt,{def:Dt,toString:function(){return os([_t.length>0?"var "+_t.join(",")+";":"",os(Ft)])}})}function ze(){var Ft=pt(),kt=pt(),_t=Ft.toString,Dt=kt.toString;function Ce(He,wt){kt(He,wt,"=",Ft.def(He,wt),";")}return $(function(){Ft.apply(Ft,$i(arguments))},{def:Ft.def,entry:Ft,exit:kt,save:Ce,set:function(He,wt,tr){Ce(He,wt),Ft(He,wt,"=",tr,";")},toString:function(){return _t()+Dt()}})}function tt(){var Ft=os(arguments),kt=ze(),_t=ze(),Dt=kt.toString,Ce=_t.toString;return $(kt,{then:function(){return kt.apply(kt,$i(arguments)),this},else:function(){return _t.apply(_t,$i(arguments)),this},toString:function(){var He=Ce();return He&&(He="else{"+He+"}"),os(["if(",Ft,"){",Dt(),"}",He])}})}var gt=pt(),bt={};function vt(Ft,kt){var _t=[];function Dt(){var yt="a"+_t.length;return _t.push(yt),yt}kt=kt||0;for(var Ce=0;Ce<kt;++Ce)Dt();var He=ze(),wt=He.toString,tr=bt[Ft]=$(He,{arg:Dt,toString:function(){return os(["function(",_t.join(),"){",wt(),"}"])}});return tr}function At(){var Ft=['"use strict";',gt,"return {"];Object.keys(bt).forEach(function(Ce){Ft.push('"',Ce,'":',bt[Ce].toString(),",")}),Ft.push("}");var kt=os(Ft).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),_t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Dt=_t?W.Function.apply(null,G.concat(kt)):Function.apply(null,G.concat(kt));return Dt.apply(null,ie)}return{global:gt,link:De,block:pt,proc:vt,scope:ze,cond:tt,compile:At}}var us="xyzw".split(""),$s=5121,Fa=1,Sc=2,Na=0,Ks=1,ru=2,Cc=3,hi=4,qs=5,df=6,vo="dither",Ac="blend.enable",Bl="blend.color",Wn="blend.equation",di="blend.func",Ii="depth.enable",Zl="depth.func",ss="depth.range",h0="depth.mask",hh="colorMask",pf="cull.enable",d0="cull.face",Mu="frontFace",Ea="lineWidth",p0="polygonOffset.enable",dh="polygonOffset.offset",Ul="sample.alpha",ls="sample.enable",Gl="sample.coverage",cs="stencil.enable",bc="stencil.mask",Tc="stencil.func",Qs="stencil.opFront",Ou="stencil.opBack",Mc="scissor.enable",fs="scissor.box",mo="viewport",Ru="profile",Pu="framebuffer",hs="vert",ua="frag",go="elements",ds="primitive",wu="count",zl="offset",Oc="instances",Js="vao",vf="Width",ps="Height",Ki=Pu+vf,Iu=Pu+ps,v0=mo+vf,Rc=mo+ps,mn="drawingBuffer",mf=mn+vf,gf=mn+ps,Hl=[di,Wn,Tc,Qs,Ou,Gl,mo,fs,dh],vs=34962,_f=34963,ph=35632,to=35633,vh=3553,Pc=34067,wc=2884,jl=3042,mh=3024,ka=2960,Lu=2929,yf=3089,gh=32823,Vl=32926,_h=32928,el=5126,ms=35664,tl=35665,rl=35666,Bo=5124,Ic=35667,_o=35668,Wl=35669,nu=35670,nl=35671,Lc=35672,Dc=35673,Xl=35674,gs=35675,_s=35676,Yl=35678,il=35680,$l=4,Li=1028,ra=1029,yh=2304,Ef=2305,Fc=32775,al=32776,m0=519,Ut=7680,Eh=0,Qe=1,ys=32774,Kl=513,xf=36160,Sf=36064,ro={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ql=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Du={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},sa={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Nc={frag:ph,vert:to},ol={cw:yh,ccw:Ef};function Ql(S){return Array.isArray(S)||A(S)||ji(S)}function kc(S){return S.sort(function(G,ie){return G===mo?-1:ie===mo?1:G<ie?-1:1})}function ui(S,G,ie,De){this.thisDep=S,this.contextDep=G,this.propDep=ie,this.append=De}function Zo(S){return S&&!(S.thisDep||S.contextDep||S.propDep)}function oi(S){return new ui(!1,!1,!1,S)}function xa(S,G){var ie=S.type;if(ie===Na){var De=S.data.length;return new ui(!0,De>=1,De>=2,G)}else if(ie===hi){var pt=S.data;return new ui(pt.thisDep,pt.contextDep,pt.propDep,G)}else{if(ie===qs)return new ui(!1,!1,!1,G);if(ie===df){for(var ze=!1,tt=!1,gt=!1,bt=0;bt<S.data.length;++bt){var vt=S.data[bt];if(vt.type===Ks)gt=!0;else if(vt.type===ru)tt=!0;else if(vt.type===Cc)ze=!0;else if(vt.type===Na){ze=!0;var At=vt.data;At>=1&&(tt=!0),At>=2&&(gt=!0)}else vt.type===hi&&(ze=ze||vt.data.thisDep,tt=tt||vt.data.contextDep,gt=gt||vt.data.propDep)}return new ui(ze,tt,gt,G)}else return new ui(ie===Cc,ie===ru,ie===Ks,G)}}var Bc=new ui(!1,!1,!1,function(){});function Uo(S,G,ie,De,pt,ze,tt,gt,bt,vt,At,Ft,kt,_t,Dt){var Ce=vt.Record,He={add:32774,subtract:32778,"reverse subtract":32779};ie.ext_blend_minmax&&(He.min=Fc,He.max=al);var wt=ie.angle_instanced_arrays,tr=ie.webgl_draw_buffers,yt=ie.oes_vertex_array_object,Qt={dirty:!0,profile:Dt.profile},Kt={},br=[],ht={},st={};function or(q){return q.replace(".","_")}function Bt(q,N,ue){var _e=or(q);br.push(q),Kt[_e]=Qt[_e]=!!ue,ht[_e]=N}function Ot(q,N,ue){var _e=or(q);br.push(q),Array.isArray(ue)?(Qt[_e]=ue.slice(),Kt[_e]=ue.slice()):Qt[_e]=Kt[_e]=ue,st[_e]=N}Bt(vo,mh),Bt(Ac,jl),Ot(Bl,"blendColor",[0,0,0,0]),Ot(Wn,"blendEquationSeparate",[ys,ys]),Ot(di,"blendFuncSeparate",[Qe,Eh,Qe,Eh]),Bt(Ii,Lu,!0),Ot(Zl,"depthFunc",Kl),Ot(ss,"depthRange",[0,1]),Ot(h0,"depthMask",!0),Ot(hh,hh,[!0,!0,!0,!0]),Bt(pf,wc),Ot(d0,"cullFace",ra),Ot(Mu,Mu,Ef),Ot(Ea,Ea,1),Bt(p0,gh),Ot(dh,"polygonOffset",[0,0]),Bt(Ul,Vl),Bt(ls,_h),Ot(Gl,"sampleCoverage",[1,!1]),Bt(cs,ka),Ot(bc,"stencilMask",-1),Ot(Tc,"stencilFunc",[m0,0,-1]),Ot(Qs,"stencilOpSeparate",[Li,Ut,Ut,Ut]),Ot(Ou,"stencilOpSeparate",[ra,Ut,Ut,Ut]),Bt(Mc,yf),Ot(fs,"scissor",[0,0,S.drawingBufferWidth,S.drawingBufferHeight]),Ot(mo,mo,[0,0,S.drawingBufferWidth,S.drawingBufferHeight]);var Xt={gl:S,context:kt,strings:G,next:Kt,current:Qt,draw:Ft,elements:ze,buffer:pt,shader:At,attributes:vt.state,vao:vt,uniforms:bt,framebuffer:gt,extensions:ie,timer:_t,isBufferArgs:Ql},Yt={primTypes:Ct,compareFuncs:Du,blendFuncs:ro,blendEquations:He,stencilOps:sa,glTypes:Oo,orientationType:ol};j.optional(function(){Xt.isArrayLike=fi}),tr&&(Yt.backBuffer=[ra],Yt.drawBuffer=ki(De.maxDrawbuffers,function(q){return q===0?[0]:ki(q,function(N){return Sf+N})}));var Nr=0;function Mr(){var q=fh(),N=q.link,ue=q.global;q.id=Nr++,q.batchId="0";var _e=N(Xt),We=q.shared={props:"a0"};Object.keys(Xt).forEach(function(ae){We[ae]=ue.def(_e,".",ae)}),j.optional(function(){q.CHECK=N(j),q.commandStr=j.guessCommand(),q.command=N(q.commandStr),q.assert=function(ae,J,Se){ae("if(!(",J,"))",this.CHECK,".commandRaise(",N(Se),",",this.command,");")},Yt.invalidBlendCombinations=ql});var de=q.next={},fe=q.current={};Object.keys(st).forEach(function(ae){Array.isArray(Qt[ae])&&(de[ae]=ue.def(We.next,".",ae),fe[ae]=ue.def(We.current,".",ae))});var me=q.constants={};Object.keys(Yt).forEach(function(ae){me[ae]=ue.def(JSON.stringify(Yt[ae]))}),q.invoke=function(ae,J){switch(J.type){case Na:var Se=["this",We.context,We.props,q.batchId];return ae.def(N(J.data),".call(",Se.slice(0,Math.max(J.data.length+1,4)),")");case Ks:return ae.def(We.props,J.data);case ru:return ae.def(We.context,J.data);case Cc:return ae.def("this",J.data);case hi:return J.data.append(q,ae),J.data.ref;case qs:return J.data.toString();case df:return J.data.map(function(Le){return q.invoke(ae,Le)})}},q.attribCache={};var H={};return q.scopeAttrib=function(ae){var J=G.id(ae);if(J in H)return H[J];var Se=vt.scope[J];Se||(Se=vt.scope[J]=new Ce);var Le=H[J]=N(Se);return Le},q}function $t(q){var N=q.static,ue=q.dynamic,_e;if(Ru in N){var We=!!N[Ru];_e=oi(function(fe,me){return We}),_e.enable=We}else if(Ru in ue){var de=ue[Ru];_e=xa(de,function(fe,me){return fe.invoke(me,de)})}return _e}function Jt(q,N){var ue=q.static,_e=q.dynamic;if(Pu in ue){var We=ue[Pu];return We?(We=gt.getFramebuffer(We),j.command(We,"invalid framebuffer object"),oi(function(fe,me){var H=fe.link(We),ae=fe.shared;me.set(ae.framebuffer,".next",H);var J=ae.context;return me.set(J,"."+Ki,H+".width"),me.set(J,"."+Iu,H+".height"),H})):oi(function(fe,me){var H=fe.shared;me.set(H.framebuffer,".next","null");var ae=H.context;return me.set(ae,"."+Ki,ae+"."+mf),me.set(ae,"."+Iu,ae+"."+gf),"null"})}else if(Pu in _e){var de=_e[Pu];return xa(de,function(fe,me){var H=fe.invoke(me,de),ae=fe.shared,J=ae.framebuffer,Se=me.def(J,".getFramebuffer(",H,")");j.optional(function(){fe.assert(me,"!"+H+"||"+Se,"invalid framebuffer object")}),me.set(J,".next",Se);var Le=ae.context;return me.set(Le,"."+Ki,Se+"?"+Se+".width:"+Le+"."+mf),me.set(Le,"."+Iu,Se+"?"+Se+".height:"+Le+"."+gf),Se})}else return null}function Or(q,N,ue){var _e=q.static,We=q.dynamic;function de(H){if(H in _e){var ae=_e[H];j.commandType(ae,"object","invalid "+H,ue.commandStr);var J=!0,Se=ae.x|0,Le=ae.y|0,xt,Ht;return"width"in ae?(xt=ae.width|0,j.command(xt>=0,"invalid "+H,ue.commandStr)):J=!1,"height"in ae?(Ht=ae.height|0,j.command(Ht>=0,"invalid "+H,ue.commandStr)):J=!1,new ui(!J&&N&&N.thisDep,!J&&N&&N.contextDep,!J&&N&&N.propDep,function(Gt,fr){var rr=Gt.shared.context,ur=xt;"width"in ae||(ur=fr.def(rr,".",Ki,"-",Se));var sr=Ht;return"height"in ae||(sr=fr.def(rr,".",Iu,"-",Le)),[Se,Le,ur,sr]})}else if(H in We){var jt=We[H],qt=xa(jt,function(Gt,fr){var rr=Gt.invoke(fr,jt);j.optional(function(){Gt.assert(fr,rr+"&&typeof "+rr+'==="object"',"invalid "+H)});var ur=Gt.shared.context,sr=fr.def(rr,".x|0"),hr=fr.def(rr,".y|0"),Pr=fr.def('"width" in ',rr,"?",rr,".width|0:","(",ur,".",Ki,"-",sr,")"),Gn=fr.def('"height" in ',rr,"?",rr,".height|0:","(",ur,".",Iu,"-",hr,")");return j.optional(function(){Gt.assert(fr,Pr+">=0&&"+Gn+">=0","invalid "+H)}),[sr,hr,Pr,Gn]});return N&&(qt.thisDep=qt.thisDep||N.thisDep,qt.contextDep=qt.contextDep||N.contextDep,qt.propDep=qt.propDep||N.propDep),qt}else return N?new ui(N.thisDep,N.contextDep,N.propDep,function(Gt,fr){var rr=Gt.shared.context;return[0,0,fr.def(rr,".",Ki),fr.def(rr,".",Iu)]}):null}var fe=de(mo);if(fe){var me=fe;fe=new ui(fe.thisDep,fe.contextDep,fe.propDep,function(H,ae){var J=me.append(H,ae),Se=H.shared.context;return ae.set(Se,"."+v0,J[2]),ae.set(Se,"."+Rc,J[3]),J})}return{viewport:fe,scissor_box:de(fs)}}function Ir(q,N){var ue=q.static,_e=typeof ue[ua]=="string"&&typeof ue[hs]=="string";if(_e){if(Object.keys(N.dynamic).length>0)return null;var We=N.static,de=Object.keys(We);if(de.length>0&&typeof We[de[0]]=="number"){for(var fe=[],me=0;me<de.length;++me)j(typeof We[de[me]]=="number","must specify all vertex attribute locations when using vaos"),fe.push([We[de[me]]|0,de[me]]);return fe}}return null}function en(q,N,ue){var _e=q.static,We=q.dynamic;function de(J){if(J in _e){var Se=G.id(_e[J]);j.optional(function(){At.shader(Nc[J],Se,j.guessCommand())});var Le=oi(function(){return Se});return Le.id=Se,Le}else if(J in We){var xt=We[J];return xa(xt,function(Ht,jt){var qt=Ht.invoke(jt,xt),Gt=jt.def(Ht.shared.strings,".id(",qt,")");return j.optional(function(){jt(Ht.shared.shader,".shader(",Nc[J],",",Gt,",",Ht.command,");")}),Gt})}return null}var fe=de(ua),me=de(hs),H=null,ae;return Zo(fe)&&Zo(me)?(H=At.program(me.id,fe.id,null,ue),ae=oi(function(J,Se){return J.link(H)})):ae=new ui(fe&&fe.thisDep||me&&me.thisDep,fe&&fe.contextDep||me&&me.contextDep,fe&&fe.propDep||me&&me.propDep,function(J,Se){var Le=J.shared.shader,xt;fe?xt=fe.append(J,Se):xt=Se.def(Le,".",ua);var Ht;me?Ht=me.append(J,Se):Ht=Se.def(Le,".",hs);var jt=Le+".program("+Ht+","+xt;return j.optional(function(){jt+=","+J.command}),Se.def(jt+")")}),{frag:fe,vert:me,progVar:ae,program:H}}function An(q,N){var ue=q.static,_e=q.dynamic,We={},de=!1;function fe(){if(Js in ue){var fr=ue[Js];return fr!==null&&vt.getVAO(fr)===null&&(fr=vt.createVAO(fr)),de=!0,We.vao=fr,oi(function(ur){var sr=vt.getVAO(fr);return sr?ur.link(sr):"null"})}else if(Js in _e){de=!0;var rr=_e[Js];return xa(rr,function(ur,sr){var hr=ur.invoke(sr,rr);return sr.def(ur.shared.vao+".getVAO("+hr+")")})}return null}var me=fe(),H=!1;function ae(){if(go in ue){var fr=ue[go];if(We.elements=fr,Ql(fr)){var rr=We.elements=ze.create(fr,!0);fr=ze.getElements(rr),H=!0}else fr&&(fr=ze.getElements(fr),H=!0,j.command(fr,"invalid elements",N.commandStr));var ur=oi(function(hr,Pr){if(fr){var Gn=hr.link(fr);return hr.ELEMENTS=Gn,Gn}return hr.ELEMENTS=null,null});return ur.value=fr,ur}else if(go in _e){H=!0;var sr=_e[go];return xa(sr,function(hr,Pr){var Gn=hr.shared,Pi=Gn.isBufferArgs,Go=Gn.elements,yo=hr.invoke(Pr,sr),ou=Pr.def("null"),na=Pr.def(Pi,"(",yo,")"),zo=hr.cond(na).then(ou,"=",Go,".createStream(",yo,");").else(ou,"=",Go,".getElements(",yo,");");return j.optional(function(){hr.assert(zo.else,"!"+yo+"||"+ou,"invalid elements")}),Pr.entry(zo),Pr.exit(hr.cond(na).then(Go,".destroyStream(",ou,");")),hr.ELEMENTS=ou,ou})}else if(de)return new ui(me.thisDep,me.contextDep,me.propDep,function(hr,Pr){return Pr.def(hr.shared.vao+".currentVAO?"+hr.shared.elements+".getElements("+hr.shared.vao+".currentVAO.elements):null")});return null}var J=ae();function Se(){if(ds in ue){var fr=ue[ds];return We.primitive=fr,j.commandParameter(fr,Ct,"invalid primitve",N.commandStr),oi(function(ur,sr){return Ct[fr]})}else if(ds in _e){var rr=_e[ds];return xa(rr,function(ur,sr){var hr=ur.constants.primTypes,Pr=ur.invoke(sr,rr);return j.optional(function(){ur.assert(sr,Pr+" in "+hr,"invalid primitive, must be one of "+Object.keys(Ct))}),sr.def(hr,"[",Pr,"]")})}else{if(H)return Zo(J)?J.value?oi(function(ur,sr){return sr.def(ur.ELEMENTS,".primType")}):oi(function(){return $l}):new ui(J.thisDep,J.contextDep,J.propDep,function(ur,sr){var hr=ur.ELEMENTS;return sr.def(hr,"?",hr,".primType:",$l)});if(de)return new ui(me.thisDep,me.contextDep,me.propDep,function(ur,sr){return sr.def(ur.shared.vao+".currentVAO?"+ur.shared.vao+".currentVAO.primitive:"+$l)})}return null}function Le(fr,rr){if(fr in ue){var ur=ue[fr]|0;return rr?We.offset=ur:We.instances=ur,j.command(!rr||ur>=0,"invalid "+fr,N.commandStr),oi(function(hr,Pr){return rr&&(hr.OFFSET=ur),ur})}else if(fr in _e){var sr=_e[fr];return xa(sr,function(hr,Pr){var Gn=hr.invoke(Pr,sr);return rr&&(hr.OFFSET=Gn,j.optional(function(){hr.assert(Pr,Gn+">=0","invalid "+fr)})),Gn})}else if(rr){if(H)return oi(function(hr,Pr){return hr.OFFSET=0,0});if(de)return new ui(me.thisDep,me.contextDep,me.propDep,function(hr,Pr){return Pr.def(hr.shared.vao+".currentVAO?"+hr.shared.vao+".currentVAO.offset:0")})}else if(de)return new ui(me.thisDep,me.contextDep,me.propDep,function(hr,Pr){return Pr.def(hr.shared.vao+".currentVAO?"+hr.shared.vao+".currentVAO.instances:-1")});return null}var xt=Le(zl,!0);function Ht(){if(wu in ue){var fr=ue[wu]|0;return We.count=fr,j.command(typeof fr=="number"&&fr>=0,"invalid vertex count",N.commandStr),oi(function(){return fr})}else if(wu in _e){var rr=_e[wu];return xa(rr,function(Pr,Gn){var Pi=Pr.invoke(Gn,rr);return j.optional(function(){Pr.assert(Gn,"typeof "+Pi+'==="number"&&'+Pi+">=0&&"+Pi+"===("+Pi+"|0)","invalid vertex count")}),Pi})}else if(H)if(Zo(J)){if(J)return xt?new ui(xt.thisDep,xt.contextDep,xt.propDep,function(Pr,Gn){var Pi=Gn.def(Pr.ELEMENTS,".vertCount-",Pr.OFFSET);return j.optional(function(){Pr.assert(Gn,Pi+">=0","invalid vertex offset/element buffer too small")}),Pi}):oi(function(Pr,Gn){return Gn.def(Pr.ELEMENTS,".vertCount")});var ur=oi(function(){return-1});return j.optional(function(){ur.MISSING=!0}),ur}else{var sr=new ui(J.thisDep||xt.thisDep,J.contextDep||xt.contextDep,J.propDep||xt.propDep,function(Pr,Gn){var Pi=Pr.ELEMENTS;return Pr.OFFSET?Gn.def(Pi,"?",Pi,".vertCount-",Pr.OFFSET,":-1"):Gn.def(Pi,"?",Pi,".vertCount:-1")});return j.optional(function(){sr.DYNAMIC=!0}),sr}else if(de){var hr=new ui(me.thisDep,me.contextDep,me.propDep,function(Pr,Gn){return Gn.def(Pr.shared.vao,".currentVAO?",Pr.shared.vao,".currentVAO.count:-1")});return hr}return null}var jt=Se(),qt=Ht(),Gt=Le(Oc,!1);return{elements:J,primitive:jt,count:qt,instances:Gt,offset:xt,vao:me,vaoActive:de,elementsActive:H,static:We}}function Un(q,N){var ue=q.static,_e=q.dynamic,We={};return br.forEach(function(de){var fe=or(de);function me(H,ae){if(de in ue){var J=H(ue[de]);We[fe]=oi(function(){return J})}else if(de in _e){var Se=_e[de];We[fe]=xa(Se,function(Le,xt){return ae(Le,xt,Le.invoke(xt,Se))})}}switch(de){case pf:case Ac:case vo:case cs:case Ii:case Mc:case p0:case Ul:case ls:case h0:return me(function(H){return j.commandType(H,"boolean",de,N.commandStr),H},function(H,ae,J){return j.optional(function(){H.assert(ae,"typeof "+J+'==="boolean"',"invalid flag "+de,H.commandStr)}),J});case Zl:return me(function(H){return j.commandParameter(H,Du,"invalid "+de,N.commandStr),Du[H]},function(H,ae,J){var Se=H.constants.compareFuncs;return j.optional(function(){H.assert(ae,J+" in "+Se,"invalid "+de+", must be one of "+Object.keys(Du))}),ae.def(Se,"[",J,"]")});case ss:return me(function(H){return j.command(fi(H)&&H.length===2&&typeof H[0]=="number"&&typeof H[1]=="number"&&H[0]<=H[1],"depth range is 2d array",N.commandStr),H},function(H,ae,J){j.optional(function(){H.assert(ae,H.shared.isArrayLike+"("+J+")&&"+J+".length===2&&typeof "+J+'[0]==="number"&&typeof '+J+'[1]==="number"&&'+J+"[0]<="+J+"[1]","depth range must be a 2d array")});var Se=ae.def("+",J,"[0]"),Le=ae.def("+",J,"[1]");return[Se,Le]});case di:return me(function(H){j.commandType(H,"object","blend.func",N.commandStr);var ae="srcRGB"in H?H.srcRGB:H.src,J="srcAlpha"in H?H.srcAlpha:H.src,Se="dstRGB"in H?H.dstRGB:H.dst,Le="dstAlpha"in H?H.dstAlpha:H.dst;return j.commandParameter(ae,ro,fe+".srcRGB",N.commandStr),j.commandParameter(J,ro,fe+".srcAlpha",N.commandStr),j.commandParameter(Se,ro,fe+".dstRGB",N.commandStr),j.commandParameter(Le,ro,fe+".dstAlpha",N.commandStr),j.command(ql.indexOf(ae+", "+Se)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ae+", "+Se+")",N.commandStr),[ro[ae],ro[Se],ro[J],ro[Le]]},function(H,ae,J){var Se=H.constants.blendFuncs;j.optional(function(){H.assert(ae,J+"&&typeof "+J+'==="object"',"invalid blend func, must be an object")});function Le(rr,ur){var sr=ae.def('"',rr,ur,'" in ',J,"?",J,".",rr,ur,":",J,".",rr);return j.optional(function(){H.assert(ae,sr+" in "+Se,"invalid "+de+"."+rr+ur+", must be one of "+Object.keys(ro))}),sr}var xt=Le("src","RGB"),Ht=Le("dst","RGB");j.optional(function(){var rr=H.constants.invalidBlendCombinations;H.assert(ae,rr+".indexOf("+xt+'+", "+'+Ht+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var jt=ae.def(Se,"[",xt,"]"),qt=ae.def(Se,"[",Le("src","Alpha"),"]"),Gt=ae.def(Se,"[",Ht,"]"),fr=ae.def(Se,"[",Le("dst","Alpha"),"]");return[jt,Gt,qt,fr]});case Wn:return me(function(H){if(typeof H=="string")return j.commandParameter(H,He,"invalid "+de,N.commandStr),[He[H],He[H]];if(typeof H=="object")return j.commandParameter(H.rgb,He,de+".rgb",N.commandStr),j.commandParameter(H.alpha,He,de+".alpha",N.commandStr),[He[H.rgb],He[H.alpha]];j.commandRaise("invalid blend.equation",N.commandStr)},function(H,ae,J){var Se=H.constants.blendEquations,Le=ae.def(),xt=ae.def(),Ht=H.cond("typeof ",J,'==="string"');return j.optional(function(){function jt(qt,Gt,fr){H.assert(qt,fr+" in "+Se,"invalid "+Gt+", must be one of "+Object.keys(He))}jt(Ht.then,de,J),H.assert(Ht.else,J+"&&typeof "+J+'==="object"',"invalid "+de),jt(Ht.else,de+".rgb",J+".rgb"),jt(Ht.else,de+".alpha",J+".alpha")}),Ht.then(Le,"=",xt,"=",Se,"[",J,"];"),Ht.else(Le,"=",Se,"[",J,".rgb];",xt,"=",Se,"[",J,".alpha];"),ae(Ht),[Le,xt]});case Bl:return me(function(H){return j.command(fi(H)&&H.length===4,"blend.color must be a 4d array",N.commandStr),ki(4,function(ae){return+H[ae]})},function(H,ae,J){return j.optional(function(){H.assert(ae,H.shared.isArrayLike+"("+J+")&&"+J+".length===4","blend.color must be a 4d array")}),ki(4,function(Se){return ae.def("+",J,"[",Se,"]")})});case bc:return me(function(H){return j.commandType(H,"number",fe,N.commandStr),H|0},function(H,ae,J){return j.optional(function(){H.assert(ae,"typeof "+J+'==="number"',"invalid stencil.mask")}),ae.def(J,"|0")});case Tc:return me(function(H){j.commandType(H,"object",fe,N.commandStr);var ae=H.cmp||"keep",J=H.ref||0,Se="mask"in H?H.mask:-1;return j.commandParameter(ae,Du,de+".cmp",N.commandStr),j.commandType(J,"number",de+".ref",N.commandStr),j.commandType(Se,"number",de+".mask",N.commandStr),[Du[ae],J,Se]},function(H,ae,J){var Se=H.constants.compareFuncs;j.optional(function(){function jt(){H.assert(ae,Array.prototype.join.call(arguments,""),"invalid stencil.func")}jt(J+"&&typeof ",J,'==="object"'),jt('!("cmp" in ',J,")||(",J,".cmp in ",Se,")")});var Le=ae.def('"cmp" in ',J,"?",Se,"[",J,".cmp]",":",Ut),xt=ae.def(J,".ref|0"),Ht=ae.def('"mask" in ',J,"?",J,".mask|0:-1");return[Le,xt,Ht]});case Qs:case Ou:return me(function(H){j.commandType(H,"object",fe,N.commandStr);var ae=H.fail||"keep",J=H.zfail||"keep",Se=H.zpass||"keep";return j.commandParameter(ae,sa,de+".fail",N.commandStr),j.commandParameter(J,sa,de+".zfail",N.commandStr),j.commandParameter(Se,sa,de+".zpass",N.commandStr),[de===Ou?ra:Li,sa[ae],sa[J],sa[Se]]},function(H,ae,J){var Se=H.constants.stencilOps;j.optional(function(){H.assert(ae,J+"&&typeof "+J+'==="object"',"invalid "+de)});function Le(xt){return j.optional(function(){H.assert(ae,'!("'+xt+'" in '+J+")||("+J+"."+xt+" in "+Se+")","invalid "+de+"."+xt+", must be one of "+Object.keys(sa))}),ae.def('"',xt,'" in ',J,"?",Se,"[",J,".",xt,"]:",Ut)}return[de===Ou?ra:Li,Le("fail"),Le("zfail"),Le("zpass")]});case dh:return me(function(H){j.commandType(H,"object",fe,N.commandStr);var ae=H.factor|0,J=H.units|0;return j.commandType(ae,"number",fe+".factor",N.commandStr),j.commandType(J,"number",fe+".units",N.commandStr),[ae,J]},function(H,ae,J){j.optional(function(){H.assert(ae,J+"&&typeof "+J+'==="object"',"invalid "+de)});var Se=ae.def(J,".factor|0"),Le=ae.def(J,".units|0");return[Se,Le]});case d0:return me(function(H){var ae=0;return H==="front"?ae=Li:H==="back"&&(ae=ra),j.command(!!ae,fe,N.commandStr),ae},function(H,ae,J){return j.optional(function(){H.assert(ae,J+'==="front"||'+J+'==="back"',"invalid cull.face")}),ae.def(J,'==="front"?',Li,":",ra)});case Ea:return me(function(H){return j.command(typeof H=="number"&&H>=De.lineWidthDims[0]&&H<=De.lineWidthDims[1],"invalid line width, must be a positive number between "+De.lineWidthDims[0]+" and "+De.lineWidthDims[1],N.commandStr),H},function(H,ae,J){return j.optional(function(){H.assert(ae,"typeof "+J+'==="number"&&'+J+">="+De.lineWidthDims[0]+"&&"+J+"<="+De.lineWidthDims[1],"invalid line width")}),J});case Mu:return me(function(H){return j.commandParameter(H,ol,fe,N.commandStr),ol[H]},function(H,ae,J){return j.optional(function(){H.assert(ae,J+'==="cw"||'+J+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ae.def(J+'==="cw"?'+yh+":"+Ef)});case hh:return me(function(H){return j.command(fi(H)&&H.length===4,"color.mask must be length 4 array",N.commandStr),H.map(function(ae){return!!ae})},function(H,ae,J){return j.optional(function(){H.assert(ae,H.shared.isArrayLike+"("+J+")&&"+J+".length===4","invalid color.mask")}),ki(4,function(Se){return"!!"+J+"["+Se+"]"})});case Gl:return me(function(H){j.command(typeof H=="object"&&H,fe,N.commandStr);var ae="value"in H?H.value:1,J=!!H.invert;return j.command(typeof ae=="number"&&ae>=0&&ae<=1,"sample.coverage.value must be a number between 0 and 1",N.commandStr),[ae,J]},function(H,ae,J){j.optional(function(){H.assert(ae,J+"&&typeof "+J+'==="object"',"invalid sample.coverage")});var Se=ae.def('"value" in ',J,"?+",J,".value:1"),Le=ae.def("!!",J,".invert");return[Se,Le]})}}),We}function tn(q,N){var ue=q.static,_e=q.dynamic,We={};return Object.keys(ue).forEach(function(de){var fe=ue[de],me;if(typeof fe=="number"||typeof fe=="boolean")me=oi(function(){return fe});else if(typeof fe=="function"){var H=fe._reglType;H==="texture2d"||H==="textureCube"?me=oi(function(ae){return ae.link(fe)}):H==="framebuffer"||H==="framebufferCube"?(j.command(fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+de+'"',N.commandStr),me=oi(function(ae){return ae.link(fe.color[0])})):j.commandRaise('invalid data for uniform "'+de+'"',N.commandStr)}else fi(fe)?me=oi(function(ae){var J=ae.global.def("[",ki(fe.length,function(Se){return j.command(typeof fe[Se]=="number"||typeof fe[Se]=="boolean","invalid uniform "+de,ae.commandStr),fe[Se]}),"]");return J}):j.commandRaise('invalid or missing data for uniform "'+de+'"',N.commandStr);me.value=fe,We[de]=me}),Object.keys(_e).forEach(function(de){var fe=_e[de];We[de]=xa(fe,function(me,H){return me.invoke(H,fe)})}),We}function Ti(q,N){var ue=q.static,_e=q.dynamic,We={};return Object.keys(ue).forEach(function(de){var fe=ue[de],me=G.id(de),H=new Ce;if(Ql(fe))H.state=Fa,H.buffer=pt.getBuffer(pt.create(fe,vs,!1,!0)),H.type=0;else{var ae=pt.getBuffer(fe);if(ae)H.state=Fa,H.buffer=ae,H.type=0;else if(j.command(typeof fe=="object"&&fe,"invalid data for attribute "+de,N.commandStr),"constant"in fe){var J=fe.constant;H.buffer="null",H.state=Sc,typeof J=="number"?H.x=J:(j.command(fi(J)&&J.length>0&&J.length<=4,"invalid constant for attribute "+de,N.commandStr),us.forEach(function(Gt,fr){fr<J.length&&(H[Gt]=J[fr])}))}else{Ql(fe.buffer)?ae=pt.getBuffer(pt.create(fe.buffer,vs,!1,!0)):ae=pt.getBuffer(fe.buffer),j.command(!!ae,'missing buffer for attribute "'+de+'"',N.commandStr);var Se=fe.offset|0;j.command(Se>=0,'invalid offset for attribute "'+de+'"',N.commandStr);var Le=fe.stride|0;j.command(Le>=0&&Le<256,'invalid stride for attribute "'+de+'", must be integer betweeen [0, 255]',N.commandStr);var xt=fe.size|0;j.command(!("size"in fe)||xt>0&&xt<=4,'invalid size for attribute "'+de+'", must be 1,2,3,4',N.commandStr);var Ht=!!fe.normalized,jt=0;"type"in fe&&(j.commandParameter(fe.type,Oo,"invalid type for attribute "+de,N.commandStr),jt=Oo[fe.type]);var qt=fe.divisor|0;j.optional(function(){"divisor"in fe&&(j.command(qt===0||wt,'cannot specify divisor for attribute "'+de+'", instancing not supported',N.commandStr),j.command(qt>=0,'invalid divisor for attribute "'+de+'"',N.commandStr));var Gt=N.commandStr,fr=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(fe).forEach(function(rr){j.command(fr.indexOf(rr)>=0,'unknown parameter "'+rr+'" for attribute pointer "'+de+'" (valid parameters are '+fr+")",Gt)})}),H.buffer=ae,H.state=Fa,H.size=xt,H.normalized=Ht,H.type=jt||ae.dtype,H.offset=Se,H.stride=Le,H.divisor=qt}}We[de]=oi(function(Gt,fr){var rr=Gt.attribCache;if(me in rr)return rr[me];var ur={isStream:!1};return Object.keys(H).forEach(function(sr){ur[sr]=H[sr]}),H.buffer&&(ur.buffer=Gt.link(H.buffer),ur.type=ur.type||ur.buffer+".dtype"),rr[me]=ur,ur})}),Object.keys(_e).forEach(function(de){var fe=_e[de];function me(H,ae){var J=H.invoke(ae,fe),Se=H.shared,Le=H.constants,xt=Se.isBufferArgs,Ht=Se.buffer;j.optional(function(){H.assert(ae,J+"&&(typeof "+J+'==="object"||typeof '+J+'==="function")&&('+xt+"("+J+")||"+Ht+".getBuffer("+J+")||"+Ht+".getBuffer("+J+".buffer)||"+xt+"("+J+'.buffer)||("constant" in '+J+"&&(typeof "+J+'.constant==="number"||'+Se.isArrayLike+"("+J+".constant))))",'invalid dynamic attribute "'+de+'"')});var jt={isStream:ae.def(!1)},qt=new Ce;qt.state=Fa,Object.keys(qt).forEach(function(ur){jt[ur]=ae.def(""+qt[ur])});var Gt=jt.buffer,fr=jt.type;ae("if(",xt,"(",J,")){",jt.isStream,"=true;",Gt,"=",Ht,".createStream(",vs,",",J,");",fr,"=",Gt,".dtype;","}else{",Gt,"=",Ht,".getBuffer(",J,");","if(",Gt,"){",fr,"=",Gt,".dtype;",'}else if("constant" in ',J,"){",jt.state,"=",Sc,";","if(typeof "+J+'.constant === "number"){',jt[us[0]],"=",J,".constant;",us.slice(1).map(function(ur){return jt[ur]}).join("="),"=0;","}else{",us.map(function(ur,sr){return jt[ur]+"="+J+".constant.length>"+sr+"?"+J+".constant["+sr+"]:0;"}).join(""),"}}else{","if(",xt,"(",J,".buffer)){",Gt,"=",Ht,".createStream(",vs,",",J,".buffer);","}else{",Gt,"=",Ht,".getBuffer(",J,".buffer);","}",fr,'="type" in ',J,"?",Le.glTypes,"[",J,".type]:",Gt,".dtype;",jt.normalized,"=!!",J,".normalized;");function rr(ur){ae(jt[ur],"=",J,".",ur,"|0;")}return rr("size"),rr("offset"),rr("stride"),rr("divisor"),ae("}}"),ae.exit("if(",jt.isStream,"){",Ht,".destroyStream(",Gt,");","}"),jt}We[de]=xa(fe,me)}),We}function jn(q){var N=q.static,ue=q.dynamic,_e={};return Object.keys(N).forEach(function(We){var de=N[We];_e[We]=oi(function(fe,me){return typeof de=="number"||typeof de=="boolean"?""+de:fe.link(de)})}),Object.keys(ue).forEach(function(We){var de=ue[We];_e[We]=xa(de,function(fe,me){return fe.invoke(me,de)})}),_e}function Ei(q,N,ue,_e,We){var de=q.static,fe=q.dynamic;j.optional(function(){var rr=[Pu,hs,ua,go,ds,zl,wu,Oc,Ru,Js].concat(br);function ur(sr){Object.keys(sr).forEach(function(hr){j.command(rr.indexOf(hr)>=0,'unknown parameter "'+hr+'"',We.commandStr)})}ur(de),ur(fe)});var me=Ir(q,N),H=Jt(q,We),ae=Or(q,H,We),J=An(q,We),Se=Un(q,We),Le=en(q,We,me);function xt(rr){var ur=ae[rr];ur&&(Se[rr]=ur)}xt(mo),xt(or(fs));var Ht=Object.keys(Se).length>0,jt={framebuffer:H,draw:J,shader:Le,state:Se,dirty:Ht,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(jt.profile=$t(q,We),jt.uniforms=tn(ue,We),jt.drawVAO=jt.scopeVAO=J.vao,!jt.drawVAO&&Le.program&&!me&&ie.angle_instanced_arrays&&J.static.elements){var qt=!0,Gt=Le.program.attributes.map(function(rr){var ur=N.static[rr];return qt=qt&&!!ur,ur});if(qt&&Gt.length>0){var fr=vt.getVAO(vt.createVAO({attributes:Gt,elements:J.static.elements}));jt.drawVAO=new ui(null,null,null,function(rr,ur){return rr.link(fr)}),jt.useVAO=!0}}return me?jt.useVAO=!0:jt.attributes=Ti(N,We),jt.context=jn(_e,We),jt}function pi(q,N,ue){var _e=q.shared,We=_e.context,de=q.scope();Object.keys(ue).forEach(function(fe){N.save(We,"."+fe);var me=ue[fe],H=me.append(q,N);Array.isArray(H)?de(We,".",fe,"=[",H.join(),"];"):de(We,".",fe,"=",H,";")}),N(de)}function Mi(q,N,ue,_e){var We=q.shared,de=We.gl,fe=We.framebuffer,me;tr&&(me=N.def(We.extensions,".webgl_draw_buffers"));var H=q.constants,ae=H.drawBuffer,J=H.backBuffer,Se;ue?Se=ue.append(q,N):Se=N.def(fe,".next"),_e||N("if(",Se,"!==",fe,".cur){"),N("if(",Se,"){",de,".bindFramebuffer(",xf,",",Se,".framebuffer);"),tr&&N(me,".drawBuffersWEBGL(",ae,"[",Se,".colorAttachments.length]);"),N("}else{",de,".bindFramebuffer(",xf,",null);"),tr&&N(me,".drawBuffersWEBGL(",J,");"),N("}",fe,".cur=",Se,";"),_e||N("}")}function Di(q,N,ue){var _e=q.shared,We=_e.gl,de=q.current,fe=q.next,me=_e.current,H=_e.next,ae=q.cond(me,".dirty");br.forEach(function(J){var Se=or(J);if(!(Se in ue.state)){var Le,xt;if(Se in fe){Le=fe[Se],xt=de[Se];var Ht=ki(Qt[Se].length,function(qt){return ae.def(Le,"[",qt,"]")});ae(q.cond(Ht.map(function(qt,Gt){return qt+"!=="+xt+"["+Gt+"]"}).join("||")).then(We,".",st[Se],"(",Ht,");",Ht.map(function(qt,Gt){return xt+"["+Gt+"]="+qt}).join(";"),";"))}else{Le=ae.def(H,".",Se);var jt=q.cond(Le,"!==",me,".",Se);ae(jt),Se in ht?jt(q.cond(Le).then(We,".enable(",ht[Se],");").else(We,".disable(",ht[Se],");"),me,".",Se,"=",Le,";"):jt(We,".",st[Se],"(",Le,");",me,".",Se,"=",Le,";")}}}),Object.keys(ue.state).length===0&&ae(me,".dirty=false;"),N(ae)}function Zi(q,N,ue,_e){var We=q.shared,de=q.current,fe=We.current,me=We.gl;kc(Object.keys(ue)).forEach(function(H){var ae=ue[H];if(!(_e&&!_e(ae))){var J=ae.append(q,N);if(ht[H]){var Se=ht[H];Zo(ae)?J?N(me,".enable(",Se,");"):N(me,".disable(",Se,");"):N(q.cond(J).then(me,".enable(",Se,");").else(me,".disable(",Se,");")),N(fe,".",H,"=",J,";")}else if(fi(J)){var Le=de[H];N(me,".",st[H],"(",J,");",J.map(function(xt,Ht){return Le+"["+Ht+"]="+xt}).join(";"),";")}else N(me,".",st[H],"(",J,");",fe,".",H,"=",J,";")}})}function vi(q,N){wt&&(q.instancing=N.def(q.shared.extensions,".angle_instanced_arrays"))}function jr(q,N,ue,_e,We){var de=q.shared,fe=q.stats,me=de.current,H=de.timer,ae=ue.profile;function J(){var rr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return rr||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Se,Le;function xt(rr){Se=N.def(),rr(Se,"=",J(),";"),typeof We=="string"?rr(fe,".count+=",We,";"):rr(fe,".count++;"),_t&&(_e?(Le=N.def(),rr(Le,"=",H,".getNumPendingQueries();")):rr(H,".beginQuery(",fe,");"))}function Ht(rr){rr(fe,".cpuTime+=",J(),"-",Se,";"),_t&&(_e?rr(H,".pushScopeStats(",Le,",",H,".getNumPendingQueries(),",fe,");"):rr(H,".endQuery();"))}function jt(rr){var ur=N.def(me,".profile");N(me,".profile=",rr,";"),N.exit(me,".profile=",ur,";")}var qt;if(ae){if(Zo(ae)){ae.enable?(xt(N),Ht(N.exit),jt("true")):jt("false");return}qt=ae.append(q,N),jt(qt)}else qt=N.def(me,".profile");var Gt=q.block();xt(Gt),N("if(",qt,"){",Gt,"}");var fr=q.block();Ht(fr),N.exit("if(",qt,"){",fr,"}")}function Oi(q,N,ue,_e,We){var de=q.shared;function fe(H){switch(H){case ms:case Ic:case nl:return 2;case tl:case _o:case Lc:return 3;case rl:case Wl:case Dc:return 4;default:return 1}}function me(H,ae,J){var Se=de.gl,Le=N.def(H,".location"),xt=N.def(de.attributes,"[",Le,"]"),Ht=J.state,jt=J.buffer,qt=[J.x,J.y,J.z,J.w],Gt=["buffer","normalized","offset","stride"];function fr(){N("if(!",xt,".buffer){",Se,".enableVertexAttribArray(",Le,");}");var ur=J.type,sr;if(J.size?sr=N.def(J.size,"||",ae):sr=ae,N("if(",xt,".type!==",ur,"||",xt,".size!==",sr,"||",Gt.map(function(Pr){return xt+"."+Pr+"!=="+J[Pr]}).join("||"),"){",Se,".bindBuffer(",vs,",",jt,".buffer);",Se,".vertexAttribPointer(",[Le,sr,ur,J.normalized,J.stride,J.offset],");",xt,".type=",ur,";",xt,".size=",sr,";",Gt.map(function(Pr){return xt+"."+Pr+"="+J[Pr]+";"}).join(""),"}"),wt){var hr=J.divisor;N("if(",xt,".divisor!==",hr,"){",q.instancing,".vertexAttribDivisorANGLE(",[Le,hr],");",xt,".divisor=",hr,";}")}}function rr(){N("if(",xt,".buffer){",Se,".disableVertexAttribArray(",Le,");",xt,".buffer=null;","}if(",us.map(function(ur,sr){return xt+"."+ur+"!=="+qt[sr]}).join("||"),"){",Se,".vertexAttrib4f(",Le,",",qt,");",us.map(function(ur,sr){return xt+"."+ur+"="+qt[sr]+";"}).join(""),"}")}Ht===Fa?fr():Ht===Sc?rr():(N("if(",Ht,"===",Fa,"){"),fr(),N("}else{"),rr(),N("}"))}_e.forEach(function(H){var ae=H.name,J=ue.attributes[ae],Se;if(J){if(!We(J))return;Se=J.append(q,N)}else{if(!We(Bc))return;var Le=q.scopeAttrib(ae);j.optional(function(){q.assert(N,Le+".state","missing attribute "+ae)}),Se={},Object.keys(new Ce).forEach(function(xt){Se[xt]=N.def(Le,".",xt)})}me(q.link(H),fe(H.info.type),Se)})}function bn(q,N,ue,_e,We,de){for(var fe=q.shared,me=fe.gl,H,ae=0;ae<_e.length;++ae){var J=_e[ae],Se=J.name,Le=J.info.type,xt=ue.uniforms[Se],Ht=q.link(J),jt=Ht+".location",qt;if(xt){if(!We(xt))continue;if(Zo(xt)){var Gt=xt.value;if(j.command(Gt!==null&&typeof Gt!="undefined",'missing uniform "'+Se+'"',q.commandStr),Le===Yl||Le===il){j.command(typeof Gt=="function"&&(Le===Yl&&(Gt._reglType==="texture2d"||Gt._reglType==="framebuffer")||Le===il&&(Gt._reglType==="textureCube"||Gt._reglType==="framebufferCube")),"invalid texture for uniform "+Se,q.commandStr);var fr=q.link(Gt._texture||Gt.color[0]._texture);N(me,".uniform1i(",jt,",",fr+".bind());"),N.exit(fr,".unbind();")}else if(Le===Xl||Le===gs||Le===_s){j.optional(function(){j.command(fi(Gt),"invalid matrix for uniform "+Se,q.commandStr),j.command(Le===Xl&&Gt.length===4||Le===gs&&Gt.length===9||Le===_s&&Gt.length===16,"invalid length for matrix uniform "+Se,q.commandStr)});var rr=q.global.def("new Float32Array(["+Array.prototype.slice.call(Gt)+"])"),ur=2;Le===gs?ur=3:Le===_s&&(ur=4),N(me,".uniformMatrix",ur,"fv(",jt,",false,",rr,");")}else{switch(Le){case el:j.commandType(Gt,"number","uniform "+Se,q.commandStr),H="1f";break;case ms:j.command(fi(Gt)&&Gt.length===2,"uniform "+Se,q.commandStr),H="2f";break;case tl:j.command(fi(Gt)&&Gt.length===3,"uniform "+Se,q.commandStr),H="3f";break;case rl:j.command(fi(Gt)&&Gt.length===4,"uniform "+Se,q.commandStr),H="4f";break;case nu:j.commandType(Gt,"boolean","uniform "+Se,q.commandStr),H="1i";break;case Bo:j.commandType(Gt,"number","uniform "+Se,q.commandStr),H="1i";break;case nl:j.command(fi(Gt)&&Gt.length===2,"uniform "+Se,q.commandStr),H="2i";break;case Ic:j.command(fi(Gt)&&Gt.length===2,"uniform "+Se,q.commandStr),H="2i";break;case Lc:j.command(fi(Gt)&&Gt.length===3,"uniform "+Se,q.commandStr),H="3i";break;case _o:j.command(fi(Gt)&&Gt.length===3,"uniform "+Se,q.commandStr),H="3i";break;case Dc:j.command(fi(Gt)&&Gt.length===4,"uniform "+Se,q.commandStr),H="4i";break;case Wl:j.command(fi(Gt)&&Gt.length===4,"uniform "+Se,q.commandStr),H="4i";break}N(me,".uniform",H,"(",jt,",",fi(Gt)?Array.prototype.slice.call(Gt):Gt,");")}continue}else qt=xt.append(q,N)}else{if(!We(Bc))continue;qt=N.def(fe.uniforms,"[",G.id(Se),"]")}Le===Yl?(j(!Array.isArray(qt),"must specify a scalar prop for textures"),N("if(",qt,"&&",qt,'._reglType==="framebuffer"){',qt,"=",qt,".color[0];","}")):Le===il&&(j(!Array.isArray(qt),"must specify a scalar prop for cube maps"),N("if(",qt,"&&",qt,'._reglType==="framebufferCube"){',qt,"=",qt,".color[0];","}")),j.optional(function(){function na(Sa,Sh){q.assert(N,Sa,'bad data or missing for uniform "'+Se+'".  '+Sh)}function zo(Sa){j(!Array.isArray(qt),"must not specify an array type for uniform"),na("typeof "+qt+'==="'+Sa+'"',"invalid type, expected "+Sa)}function wr(Sa,Sh){Array.isArray(qt)?j(qt.length===Sa,"must have length "+Sa):na(fe.isArrayLike+"("+qt+")&&"+qt+".length==="+Sa,"invalid vector, should have length "+Sa,q.commandStr)}function Xr(Sa){j(!Array.isArray(qt),"must not specify a value type"),na("typeof "+qt+'==="function"&&'+qt+'._reglType==="texture'+(Sa===vh?"2d":"Cube")+'"',"invalid texture type",q.commandStr)}switch(Le){case Bo:zo("number");break;case Ic:wr(2,"number");break;case _o:wr(3,"number");break;case Wl:wr(4,"number");break;case el:zo("number");break;case ms:wr(2,"number");break;case tl:wr(3,"number");break;case rl:wr(4,"number");break;case nu:zo("boolean");break;case nl:wr(2,"boolean");break;case Lc:wr(3,"boolean");break;case Dc:wr(4,"boolean");break;case Xl:wr(4,"number");break;case gs:wr(9,"number");break;case _s:wr(16,"number");break;case Yl:Xr(vh);break;case il:Xr(Pc);break}});var sr=1;switch(Le){case Yl:case il:var hr=N.def(qt,"._texture");N(me,".uniform1i(",jt,",",hr,".bind());"),N.exit(hr,".unbind();");continue;case Bo:case nu:H="1i";break;case Ic:case nl:H="2i",sr=2;break;case _o:case Lc:H="3i",sr=3;break;case Wl:case Dc:H="4i",sr=4;break;case el:H="1f";break;case ms:H="2f",sr=2;break;case tl:H="3f",sr=3;break;case rl:H="4f",sr=4;break;case Xl:H="Matrix2fv";break;case gs:H="Matrix3fv";break;case _s:H="Matrix4fv";break}if(H.charAt(0)==="M"){N(me,".uniform",H,"(",jt,",");var Pr=Math.pow(Le-Xl+2,2),Gn=q.global.def("new Float32Array(",Pr,")");Array.isArray(qt)?N("false,(",ki(Pr,function(na){return Gn+"["+na+"]="+qt[na]}),",",Gn,")"):N("false,(Array.isArray(",qt,")||",qt," instanceof Float32Array)?",qt,":(",ki(Pr,function(na){return Gn+"["+na+"]="+qt+"["+na+"]"}),",",Gn,")"),N(");")}else if(sr>1){for(var Pi=[],Go=[],yo=0;yo<sr;++yo)Array.isArray(qt)?Go.push(qt[yo]):Go.push(N.def(qt+"["+yo+"]")),de&&Pi.push(N.def());de&&N("if(!",q.batchId,"||",Pi.map(function(na,zo){return na+"!=="+Go[zo]}).join("||"),"){",Pi.map(function(na,zo){return na+"="+Go[zo]+";"}).join("")),N(me,".uniform",H,"(",jt,",",Go.join(","),");"),de&&N("}")}else{if(j(!Array.isArray(qt),"uniform value must not be an array"),de){var ou=N.def();N("if(!",q.batchId,"||",ou,"!==",qt,"){",ou,"=",qt,";")}N(me,".uniform",H,"(",jt,",",qt,");"),de&&N("}")}}}function Ri(q,N,ue,_e){var We=q.shared,de=We.gl,fe=We.draw,me=_e.draw;function H(){var sr=me.elements,hr,Pr=N;return sr?((sr.contextDep&&_e.contextDynamic||sr.propDep)&&(Pr=ue),hr=sr.append(q,Pr),me.elementsActive&&Pr("if("+hr+")"+de+".bindBuffer("+_f+","+hr+".buffer.buffer);")):(hr=Pr.def(),Pr(hr,"=",fe,".",go,";","if(",hr,"){",de,".bindBuffer(",_f,",",hr,".buffer.buffer);}","else if(",We.vao,".currentVAO){",hr,"=",q.shared.elements+".getElements("+We.vao,".currentVAO.elements);",yt?"":"if("+hr+")"+de+".bindBuffer("+_f+","+hr+".buffer.buffer);","}")),hr}function ae(){var sr=me.count,hr,Pr=N;return sr?((sr.contextDep&&_e.contextDynamic||sr.propDep)&&(Pr=ue),hr=sr.append(q,Pr),j.optional(function(){sr.MISSING&&q.assert(N,"false","missing vertex count"),sr.DYNAMIC&&q.assert(Pr,hr+">=0","missing vertex count")})):(hr=Pr.def(fe,".",wu),j.optional(function(){q.assert(Pr,hr+">=0","missing vertex count")})),hr}var J=H();function Se(sr){var hr=me[sr];return hr?hr.contextDep&&_e.contextDynamic||hr.propDep?hr.append(q,ue):hr.append(q,N):N.def(fe,".",sr)}var Le=Se(ds),xt=Se(zl),Ht=ae();if(typeof Ht=="number"){if(Ht===0)return}else ue("if(",Ht,"){"),ue.exit("}");var jt,qt;wt&&(jt=Se(Oc),qt=q.instancing);var Gt=J+".type",fr=me.elements&&Zo(me.elements)&&!me.vaoActive;function rr(){function sr(){ue(qt,".drawElementsInstancedANGLE(",[Le,Ht,Gt,xt+"<<(("+Gt+"-"+$s+")>>1)",jt],");")}function hr(){ue(qt,".drawArraysInstancedANGLE(",[Le,xt,Ht,jt],");")}J&&J!=="null"?fr?sr():(ue("if(",J,"){"),sr(),ue("}else{"),hr(),ue("}")):hr()}function ur(){function sr(){ue(de+".drawElements("+[Le,Ht,Gt,xt+"<<(("+Gt+"-"+$s+")>>1)"]+");")}function hr(){ue(de+".drawArrays("+[Le,xt,Ht]+");")}J&&J!=="null"?fr?sr():(ue("if(",J,"){"),sr(),ue("}else{"),hr(),ue("}")):hr()}wt&&(typeof jt!="number"||jt>=0)?typeof jt=="string"?(ue("if(",jt,">0){"),rr(),ue("}else if(",jt,"<0){"),ur(),ue("}")):rr():ur()}function Rr(q,N,ue,_e,We){var de=Mr(),fe=de.proc("body",We);return j.optional(function(){de.commandStr=N.commandStr,de.command=de.link(N.commandStr)}),wt&&(de.instancing=fe.def(de.shared.extensions,".angle_instanced_arrays")),q(de,fe,ue,_e),de.compile().body}function qr(q,N,ue,_e){vi(q,N),ue.useVAO?ue.drawVAO?N(q.shared.vao,".setVAO(",ue.drawVAO.append(q,N),");"):N(q.shared.vao,".setVAO(",q.shared.vao,".targetVAO);"):(N(q.shared.vao,".setVAO(null);"),Oi(q,N,ue,_e.attributes,function(){return!0})),bn(q,N,ue,_e.uniforms,function(){return!0},!1),Ri(q,N,N,ue)}function Pn(q,N){var ue=q.proc("draw",1);vi(q,ue),pi(q,ue,N.context),Mi(q,ue,N.framebuffer),Di(q,ue,N),Zi(q,ue,N.state),jr(q,ue,N,!1,!0);var _e=N.shader.progVar.append(q,ue);if(ue(q.shared.gl,".useProgram(",_e,".program);"),N.shader.program)qr(q,ue,N,N.shader.program);else{ue(q.shared.vao,".setVAO(null);");var We=q.global.def("{}"),de=ue.def(_e,".id"),fe=ue.def(We,"[",de,"]");ue(q.cond(fe).then(fe,".call(this,a0);").else(fe,"=",We,"[",de,"]=",q.link(function(me){return Rr(qr,q,N,me,1)}),"(",_e,");",fe,".call(this,a0);"))}Object.keys(N.state).length>0&&ue(q.shared.current,".dirty=true;"),q.shared.vao&&ue(q.shared.vao,".setVAO(null);")}function mi(q,N,ue,_e){q.batchId="a1",vi(q,N);function We(){return!0}Oi(q,N,ue,_e.attributes,We),bn(q,N,ue,_e.uniforms,We,!1),Ri(q,N,N,ue)}function au(q,N,ue,_e){vi(q,N);var We=ue.contextDep,de=N.def(),fe="a0",me="a1",H=N.def();q.shared.props=H,q.batchId=de;var ae=q.scope(),J=q.scope();N(ae.entry,"for(",de,"=0;",de,"<",me,";++",de,"){",H,"=",fe,"[",de,"];",J,"}",ae.exit);function Se(Gt){return Gt.contextDep&&We||Gt.propDep}function Le(Gt){return!Se(Gt)}if(ue.needsContext&&pi(q,J,ue.context),ue.needsFramebuffer&&Mi(q,J,ue.framebuffer),Zi(q,J,ue.state,Se),ue.profile&&Se(ue.profile)&&jr(q,J,ue,!1,!0),_e)ue.useVAO?ue.drawVAO?Se(ue.drawVAO)?J(q.shared.vao,".setVAO(",ue.drawVAO.append(q,J),");"):ae(q.shared.vao,".setVAO(",ue.drawVAO.append(q,ae),");"):ae(q.shared.vao,".setVAO(",q.shared.vao,".targetVAO);"):(ae(q.shared.vao,".setVAO(null);"),Oi(q,ae,ue,_e.attributes,Le),Oi(q,J,ue,_e.attributes,Se)),bn(q,ae,ue,_e.uniforms,Le,!1),bn(q,J,ue,_e.uniforms,Se,!0),Ri(q,ae,J,ue);else{var xt=q.global.def("{}"),Ht=ue.shader.progVar.append(q,J),jt=J.def(Ht,".id"),qt=J.def(xt,"[",jt,"]");J(q.shared.gl,".useProgram(",Ht,".program);","if(!",qt,"){",qt,"=",xt,"[",jt,"]=",q.link(function(Gt){return Rr(mi,q,ue,Gt,2)}),"(",Ht,");}",qt,".call(this,a0[",de,"],",de,");")}}function te(q,N){var ue=q.proc("batch",2);q.batchId="0",vi(q,ue);var _e=!1,We=!0;Object.keys(N.context).forEach(function(xt){_e=_e||N.context[xt].propDep}),_e||(pi(q,ue,N.context),We=!1);var de=N.framebuffer,fe=!1;de?(de.propDep?_e=fe=!0:de.contextDep&&_e&&(fe=!0),fe||Mi(q,ue,de)):Mi(q,ue,null),N.state.viewport&&N.state.viewport.propDep&&(_e=!0);function me(xt){return xt.contextDep&&_e||xt.propDep}Di(q,ue,N),Zi(q,ue,N.state,function(xt){return!me(xt)}),(!N.profile||!me(N.profile))&&jr(q,ue,N,!1,"a1"),N.contextDep=_e,N.needsContext=We,N.needsFramebuffer=fe;var H=N.shader.progVar;if(H.contextDep&&_e||H.propDep)au(q,ue,N,null);else{var ae=H.append(q,ue);if(ue(q.shared.gl,".useProgram(",ae,".program);"),N.shader.program)au(q,ue,N,N.shader.program);else{ue(q.shared.vao,".setVAO(null);");var J=q.global.def("{}"),Se=ue.def(ae,".id"),Le=ue.def(J,"[",Se,"]");ue(q.cond(Le).then(Le,".call(this,a0,a1);").else(Le,"=",J,"[",Se,"]=",q.link(function(xt){return Rr(au,q,N,xt,2)}),"(",ae,");",Le,".call(this,a0,a1);"))}}Object.keys(N.state).length>0&&ue(q.shared.current,".dirty=true;"),q.shared.vao&&ue(q.shared.vao,".setVAO(null);")}function Ye(q,N){var ue=q.proc("scope",3);q.batchId="a2";var _e=q.shared,We=_e.current;pi(q,ue,N.context),N.framebuffer&&N.framebuffer.append(q,ue),kc(Object.keys(N.state)).forEach(function(fe){var me=N.state[fe],H=me.append(q,ue);fi(H)?H.forEach(function(ae,J){ue.set(q.next[fe],"["+J+"]",ae)}):ue.set(_e.next,"."+fe,H)}),jr(q,ue,N,!0,!0),[go,zl,wu,Oc,ds].forEach(function(fe){var me=N.draw[fe];!me||ue.set(_e.draw,"."+fe,""+me.append(q,ue))}),Object.keys(N.uniforms).forEach(function(fe){var me=N.uniforms[fe].append(q,ue);Array.isArray(me)&&(me="["+me.join()+"]"),ue.set(_e.uniforms,"["+G.id(fe)+"]",me)}),Object.keys(N.attributes).forEach(function(fe){var me=N.attributes[fe].append(q,ue),H=q.scopeAttrib(fe);Object.keys(new Ce).forEach(function(ae){ue.set(H,"."+ae,me[ae])})}),N.scopeVAO&&ue.set(_e.vao,".targetVAO",N.scopeVAO.append(q,ue));function de(fe){var me=N.shader[fe];me&&ue.set(_e.shader,"."+fe,me.append(q,ue))}de(hs),de(ua),Object.keys(N.state).length>0&&(ue(We,".dirty=true;"),ue.exit(We,".dirty=true;")),ue("a1(",q.shared.context,",a0,",q.batchId,");")}function Ne(q){if(!(typeof q!="object"||fi(q))){for(var N=Object.keys(q),ue=0;ue<N.length;++ue)if(vr.isDynamic(q[N[ue]]))return!0;return!1}}function nr(q,N,ue){var _e=N.static[ue];if(!_e||!Ne(_e))return;var We=q.global,de=Object.keys(_e),fe=!1,me=!1,H=!1,ae=q.global.def("{}");de.forEach(function(Se){var Le=_e[Se];if(vr.isDynamic(Le)){typeof Le=="function"&&(Le=_e[Se]=vr.unbox(Le));var xt=xa(Le,null);fe=fe||xt.thisDep,H=H||xt.propDep,me=me||xt.contextDep}else{switch(We(ae,".",Se,"="),typeof Le){case"number":We(Le);break;case"string":We('"',Le,'"');break;case"object":Array.isArray(Le)&&We("[",Le.join(),"]");break;default:We(q.link(Le));break}We(";")}});function J(Se,Le){de.forEach(function(xt){var Ht=_e[xt];if(!!vr.isDynamic(Ht)){var jt=Se.invoke(Le,Ht);Le(ae,".",xt,"=",jt,";")}})}N.dynamic[ue]=new vr.DynamicVariable(hi,{thisDep:fe,contextDep:me,propDep:H,ref:ae,append:J}),delete N.static[ue]}function on(q,N,ue,_e,We){var de=Mr();de.stats=de.link(We),Object.keys(N.static).forEach(function(me){nr(de,N,me)}),Hl.forEach(function(me){nr(de,q,me)});var fe=Ei(q,N,ue,_e,de);return Pn(de,fe),Ye(de,fe),te(de,fe),$(de.compile(),{destroy:function(){fe.shader.program.destroy()}})}return{next:Kt,current:Qt,procs:function(){var q=Mr(),N=q.proc("poll"),ue=q.proc("refresh"),_e=q.block();N(_e),ue(_e);var We=q.shared,de=We.gl,fe=We.next,me=We.current;_e(me,".dirty=false;"),Mi(q,N),Mi(q,ue,null,!0);var H;wt&&(H=q.link(wt)),ie.oes_vertex_array_object&&ue(q.link(ie.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ae=0;ae<De.maxAttributes;++ae){var J=ue.def(We.attributes,"[",ae,"]"),Se=q.cond(J,".buffer");Se.then(de,".enableVertexAttribArray(",ae,");",de,".bindBuffer(",vs,",",J,".buffer.buffer);",de,".vertexAttribPointer(",ae,",",J,".size,",J,".type,",J,".normalized,",J,".stride,",J,".offset);").else(de,".disableVertexAttribArray(",ae,");",de,".vertexAttrib4f(",ae,",",J,".x,",J,".y,",J,".z,",J,".w);",J,".buffer=null;"),ue(Se),wt&&ue(H,".vertexAttribDivisorANGLE(",ae,",",J,".divisor);")}return ue(q.shared.vao,".currentVAO=null;",q.shared.vao,".setVAO(",q.shared.vao,".targetVAO);"),Object.keys(ht).forEach(function(Le){var xt=ht[Le],Ht=_e.def(fe,".",Le),jt=q.block();jt("if(",Ht,"){",de,".enable(",xt,")}else{",de,".disable(",xt,")}",me,".",Le,"=",Ht,";"),ue(jt),N("if(",Ht,"!==",me,".",Le,"){",jt,"}")}),Object.keys(st).forEach(function(Le){var xt=st[Le],Ht=Qt[Le],jt,qt,Gt=q.block();if(Gt(de,".",xt,"("),fi(Ht)){var fr=Ht.length;jt=q.global.def(fe,".",Le),qt=q.global.def(me,".",Le),Gt(ki(fr,function(rr){return jt+"["+rr+"]"}),");",ki(fr,function(rr){return qt+"["+rr+"]="+jt+"["+rr+"];"}).join("")),N("if(",ki(fr,function(rr){return jt+"["+rr+"]!=="+qt+"["+rr+"]"}).join("||"),"){",Gt,"}")}else jt=_e.def(fe,".",Le),qt=_e.def(me,".",Le),Gt(jt,");",me,".",Le,"=",jt,";"),N("if(",jt,"!==",qt,"){",Gt,"}");ue(Gt)}),q.compile()}(),compile:on}}function Zc(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var xh=34918,g0=34919,Cf=35007,_0=function(S,G){if(!G.ext_disjoint_timer_query)return null;var ie=[];function De(){return ie.pop()||G.ext_disjoint_timer_query.createQueryEXT()}function pt(wt){ie.push(wt)}var ze=[];function tt(wt){var tr=De();G.ext_disjoint_timer_query.beginQueryEXT(Cf,tr),ze.push(tr),_t(ze.length-1,ze.length,wt)}function gt(){G.ext_disjoint_timer_query.endQueryEXT(Cf)}function bt(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var vt=[];function At(){return vt.pop()||new bt}function Ft(wt){vt.push(wt)}var kt=[];function _t(wt,tr,yt){var Qt=At();Qt.startQueryIndex=wt,Qt.endQueryIndex=tr,Qt.sum=0,Qt.stats=yt,kt.push(Qt)}var Dt=[],Ce=[];function He(){var wt,tr,yt=ze.length;if(yt!==0){Ce.length=Math.max(Ce.length,yt+1),Dt.length=Math.max(Dt.length,yt+1),Dt[0]=0,Ce[0]=0;var Qt=0;for(wt=0,tr=0;tr<ze.length;++tr){var Kt=ze[tr];G.ext_disjoint_timer_query.getQueryObjectEXT(Kt,g0)?(Qt+=G.ext_disjoint_timer_query.getQueryObjectEXT(Kt,xh),pt(Kt)):ze[wt++]=Kt,Dt[tr+1]=Qt,Ce[tr+1]=wt}for(ze.length=wt,wt=0,tr=0;tr<kt.length;++tr){var br=kt[tr],ht=br.startQueryIndex,st=br.endQueryIndex;br.sum+=Dt[st]-Dt[ht];var or=Ce[ht],Bt=Ce[st];Bt===or?(br.stats.gpuTime+=br.sum/1e6,Ft(br)):(br.startQueryIndex=or,br.endQueryIndex=Bt,kt[wt++]=br)}kt.length=wt}}return{beginQuery:tt,endQuery:gt,pushScopeStats:_t,update:He,getNumPendingQueries:function(){return ze.length},clear:function(){ie.push.apply(ie,ze);for(var wt=0;wt<ie.length;wt++)G.ext_disjoint_timer_query.deleteQueryEXT(ie[wt]);ze.length=0,ie.length=0},restore:function(){ze.length=0,ie.length=0}}},y0=16384,iu=256,Af=1024,Uc=34962,Gc="webglcontextlost",ul="webglcontextrestored",Es=1,Wr=2,zc=3;function Jl(S,G){for(var ie=0;ie<S.length;++ie)if(S[ie]===G)return ie;return-1}function Fu(S){var G=Os(S);if(!G)return null;var ie=G.gl,De=ie.getContextAttributes(),pt=ie.isContextLost(),ze=du(ie,G);if(!ze)return null;var tt=hu(),gt=Zc(),bt=ze.extensions,vt=_0(ie,bt),At=Ni(),Ft=ie.drawingBufferWidth,kt=ie.drawingBufferHeight,_t={tick:0,time:0,viewportWidth:Ft,viewportHeight:kt,framebufferWidth:Ft,framebufferHeight:kt,drawingBufferWidth:Ft,drawingBufferHeight:kt,pixelRatio:G.pixelRatio},Dt={},Ce={elements:null,primitive:4,count:-1,offset:0,instances:-1},He=ma(ie,bt),wt=C(ie,gt,G,Qt),tr=_a(ie,bt,wt,gt),yt=ch(ie,bt,He,gt,wt,tr,Ce);function Qt(Rr){return yt.destroyBuffer(Rr)}var Kt=f0(ie,tt,gt,G),br=r0(ie,bt,He,function(){or.procs.poll()},_t,gt,G),ht=dd(ie,bt,He,gt,G),st=Zn(ie,bt,He,br,ht,gt),or=Uo(ie,tt,bt,He,wt,tr,br,st,Dt,yt,Kt,Ce,_t,vt,G),Bt=tu(ie,st,or.procs.poll,_t,De,bt,He),Ot=or.next,Xt=ie.canvas,Yt=[],Nr=[],Mr=[],$t=[G.onDestroy],Jt=null;function Or(){if(Yt.length===0){vt&&vt.update(),Jt=null;return}Jt=ln.next(Or),vi();for(var Rr=Yt.length-1;Rr>=0;--Rr){var qr=Yt[Rr];qr&&qr(_t,null,0)}ie.flush(),vt&&vt.update()}function Ir(){!Jt&&Yt.length>0&&(Jt=ln.next(Or))}function en(){Jt&&(ln.cancel(Or),Jt=null)}function An(Rr){Rr.preventDefault(),pt=!0,en(),Nr.forEach(function(qr){qr()})}function Un(Rr){ie.getError(),pt=!1,ze.restore(),Kt.restore(),wt.restore(),br.restore(),ht.restore(),st.restore(),yt.restore(),vt&&vt.restore(),or.procs.refresh(),Ir(),Mr.forEach(function(qr){qr()})}var tn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!tn&&Xt&&(Xt.addEventListener(Gc,An,!1),Xt.addEventListener(ul,Un,!1));function Ti(){Yt.length=0,en(),!tn&&Xt&&(Xt.removeEventListener(Gc,An),Xt.removeEventListener(ul,Un)),Kt.clear(),st.clear(),ht.clear(),yt.clear(),br.clear(),tr.clear(),wt.clear(),vt&&vt.clear(),$t.forEach(function(Rr){Rr()})}function jn(Rr){j(!!Rr,"invalid args to regl({...})"),j.type(Rr,"object","invalid args to regl({...})");function qr(de){var fe=$({},de);delete fe.uniforms,delete fe.attributes,delete fe.context,delete fe.vao,"stencil"in fe&&fe.stencil.op&&(fe.stencil.opBack=fe.stencil.opFront=fe.stencil.op,delete fe.stencil.op);function me(H){if(H in fe){var ae=fe[H];delete fe[H],Object.keys(ae).forEach(function(J){fe[H+"."+J]=ae[J]})}}return me("blend"),me("depth"),me("cull"),me("stencil"),me("polygonOffset"),me("scissor"),me("sample"),"vao"in de&&(fe.vao=de.vao),fe}function Pn(de,fe){var me={},H={};return Object.keys(de).forEach(function(ae){var J=de[ae];if(vr.isDynamic(J)){H[ae]=vr.unbox(J,ae);return}else if(fe&&Array.isArray(J)){for(var Se=0;Se<J.length;++Se)if(vr.isDynamic(J[Se])){H[ae]=vr.unbox(J,ae);return}}me[ae]=J}),{dynamic:H,static:me}}var mi=Pn(Rr.context||{},!0),au=Pn(Rr.uniforms||{},!0),te=Pn(Rr.attributes||{},!1),Ye=Pn(qr(Rr),!1),Ne={gpuTime:0,cpuTime:0,count:0},nr=or.compile(Ye,te,au,mi,Ne),on=nr.draw,q=nr.batch,N=nr.scope,ue=[];function _e(de){for(;ue.length<de;)ue.push(null);return ue}function We(de,fe){var me;if(pt&&j.raise("context lost"),typeof de=="function")return N.call(this,null,de,0);if(typeof fe=="function")if(typeof de=="number")for(me=0;me<de;++me)N.call(this,null,fe,me);else if(Array.isArray(de))for(me=0;me<de.length;++me)N.call(this,de[me],fe,me);else return N.call(this,de,fe,0);else if(typeof de=="number"){if(de>0)return q.call(this,_e(de|0),de|0)}else if(Array.isArray(de)){if(de.length)return q.call(this,de,de.length)}else return on.call(this,de)}return $(We,{stats:Ne,destroy:function(){nr.destroy()}})}var Ei=st.setFBO=jn({framebuffer:vr.define.call(null,Es,"framebuffer")});function pi(Rr,qr){var Pn=0;or.procs.poll();var mi=qr.color;mi&&(ie.clearColor(+mi[0]||0,+mi[1]||0,+mi[2]||0,+mi[3]||0),Pn|=y0),"depth"in qr&&(ie.clearDepth(+qr.depth),Pn|=iu),"stencil"in qr&&(ie.clearStencil(qr.stencil|0),Pn|=Af),j(!!Pn,"called regl.clear with no buffer specified"),ie.clear(Pn)}function Mi(Rr){if(j(typeof Rr=="object"&&Rr,"regl.clear() takes an object as input"),"framebuffer"in Rr)if(Rr.framebuffer&&Rr.framebuffer_reglType==="framebufferCube")for(var qr=0;qr<6;++qr)Ei($({framebuffer:Rr.framebuffer.faces[qr]},Rr),pi);else Ei(Rr,pi);else pi(null,Rr)}function Di(Rr){j.type(Rr,"function","regl.frame() callback must be a function"),Yt.push(Rr);function qr(){var Pn=Jl(Yt,Rr);j(Pn>=0,"cannot cancel a frame twice");function mi(){var au=Jl(Yt,mi);Yt[au]=Yt[Yt.length-1],Yt.length-=1,Yt.length<=0&&en()}Yt[Pn]=mi}return Ir(),{cancel:qr}}function Zi(){var Rr=Ot.viewport,qr=Ot.scissor_box;Rr[0]=Rr[1]=qr[0]=qr[1]=0,_t.viewportWidth=_t.framebufferWidth=_t.drawingBufferWidth=Rr[2]=qr[2]=ie.drawingBufferWidth,_t.viewportHeight=_t.framebufferHeight=_t.drawingBufferHeight=Rr[3]=qr[3]=ie.drawingBufferHeight}function vi(){_t.tick+=1,_t.time=Oi(),Zi(),or.procs.poll()}function jr(){br.refresh(),Zi(),or.procs.refresh(),vt&&vt.update()}function Oi(){return(Ni()-At)/1e3}jr();function bn(Rr,qr){j.type(qr,"function","listener callback must be a function");var Pn;switch(Rr){case"frame":return Di(qr);case"lost":Pn=Nr;break;case"restore":Pn=Mr;break;case"destroy":Pn=$t;break;default:j.raise("invalid event, must be one of frame,lost,restore,destroy")}return Pn.push(qr),{cancel:function(){for(var mi=0;mi<Pn.length;++mi)if(Pn[mi]===qr){Pn[mi]=Pn[Pn.length-1],Pn.pop();return}}}}var Ri=$(jn,{clear:Mi,prop:vr.define.bind(null,Es),context:vr.define.bind(null,Wr),this:vr.define.bind(null,zc),draw:jn({}),buffer:function(Rr){return wt.create(Rr,Uc,!1,!1)},elements:function(Rr){return tr.create(Rr,!1)},texture:br.create2D,cube:br.createCube,renderbuffer:ht.create,framebuffer:st.create,framebufferCube:st.createCube,vao:yt.createVAO,attributes:De,frame:Di,on:bn,limits:He,hasExtension:function(Rr){return He.extensions.indexOf(Rr.toLowerCase())>=0},read:Bt,destroy:Ti,_gl:ie,_refresh:jr,poll:function(){vi(),vt&&vt.update()},now:Oi,stats:gt});return G.onDone(null,Ri),Ri}return Fu})},47443:function(et,I,T){var W=T(42118);function A($,k){var L=$==null?0:$.length;return!!L&&W($,k,0)>-1}et.exports=A},1196:function(et){function I(T,W,A){for(var $=-1,k=T==null?0:T.length;++$<k;)if(A(W,T[$]))return!0;return!1}et.exports=I},62663:function(et){function I(T,W,A,$){var k=-1,L=T==null?0:T.length;for($&&L&&(A=T[++k]);++k<L;)A=W(A,T[k],k,T);return A}et.exports=I},44286:function(et){function I(T){return T.split("")}et.exports=I},49029:function(et){var I=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function T(W){return W.match(I)||[]}et.exports=T},29750:function(et){function I(T,W,A){return T===T&&(A!==void 0&&(T=T<=A?T:A),W!==void 0&&(T=T>=W?T:W)),T}et.exports=I},41848:function(et){function I(T,W,A,$){for(var k=T.length,L=A+($?1:-1);$?L--:++L<k;)if(W(T[L],L,T))return L;return-1}et.exports=I},42118:function(et,I,T){var W=T(41848),A=T(62722),$=T(42351);function k(L,U,re){return U===U?$(L,U,re):W(L,A,re)}et.exports=k},62722:function(et){function I(T){return T!==T}et.exports=I},18674:function(et){function I(T){return function(W){return T==null?void 0:T[W]}}et.exports=I},14259:function(et){function I(T,W,A){var $=-1,k=T.length;W<0&&(W=-W>k?0:k+W),A=A>k?k:A,A<0&&(A+=k),k=W>A?0:A-W>>>0,W>>>=0;for(var L=Array(k);++$<k;)L[$]=T[$+W];return L}et.exports=I},45652:function(et,I,T){var W=T(88668),A=T(47443),$=T(1196),k=T(74757),L=T(23593),U=T(21814),re=200;function K(ne,le,pe){var xe=-1,it=A,nt=ne.length,we=!0,Ke=[],ke=Ke;if(pe)we=!1,it=$;else if(nt>=re){var Oe=le?null:L(ne);if(Oe)return U(Oe);we=!1,it=k,ke=new W}else ke=le?[]:Ke;e:for(;++xe<nt;){var Re=ne[xe],Je=le?le(Re):Re;if(Re=pe||Re!==0?Re:0,we&&Je===Je){for(var O=ke.length;O--;)if(ke[O]===Je)continue e;le&&ke.push(Je),Ke.push(Re)}else it(ke,Je,pe)||(ke!==Ke&&ke.push(Je),Ke.push(Re))}return Ke}et.exports=K},40180:function(et,I,T){var W=T(14259);function A($,k,L){var U=$.length;return L=L===void 0?U:L,!k&&L>=U?$:W($,k,L)}et.exports=A},98805:function(et,I,T){var W=T(40180),A=T(62689),$=T(83140),k=T(79833);function L(U){return function(re){re=k(re);var K=A(re)?$(re):void 0,ne=K?K[0]:re.charAt(0),le=K?W(K,1).join(""):re.slice(1);return ne[U]()+le}}et.exports=L},35393:function(et,I,T){var W=T(62663),A=T(53816),$=T(58748),k="['\u2019]",L=RegExp(k,"g");function U(re){return function(K){return W($(A(K).replace(L,"")),re,"")}}et.exports=U},23593:function(et,I,T){var W=T(58525),A=T(50308),$=T(21814),k=1/0,L=W&&1/$(new W([,-0]))[1]==k?function(U){return new W(U)}:A;et.exports=L},69389:function(et,I,T){var W=T(18674),A={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},$=W(A);et.exports=$},62689:function(et){var I="\\ud800-\\udfff",T="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",A="\\u20d0-\\u20ff",$=T+W+A,k="\\ufe0e\\ufe0f",L="\\u200d",U=RegExp("["+L+I+$+k+"]");function re(K){return U.test(K)}et.exports=re},93157:function(et){var I=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function T(W){return I.test(W)}et.exports=T},42351:function(et){function I(T,W,A){for(var $=A-1,k=T.length;++$<k;)if(T[$]===W)return $;return-1}et.exports=I},83140:function(et,I,T){var W=T(44286),A=T(62689),$=T(676);function k(L){return A(L)?$(L):W(L)}et.exports=k},676:function(et){var I="\\ud800-\\udfff",T="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",A="\\u20d0-\\u20ff",$=T+W+A,k="\\ufe0e\\ufe0f",L="["+I+"]",U="["+$+"]",re="\\ud83c[\\udffb-\\udfff]",K="(?:"+U+"|"+re+")",ne="[^"+I+"]",le="(?:\\ud83c[\\udde6-\\uddff]){2}",pe="[\\ud800-\\udbff][\\udc00-\\udfff]",xe="\\u200d",it=K+"?",nt="["+k+"]?",we="(?:"+xe+"(?:"+[ne,le,pe].join("|")+")"+nt+it+")*",Ke=nt+it+we,ke="(?:"+[ne+U+"?",U,le,pe,L].join("|")+")",Oe=RegExp(re+"(?="+re+")|"+ke+Ke,"g");function Re(Je){return Je.match(Oe)||[]}et.exports=Re},2757:function(et){var I="\\ud800-\\udfff",T="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",A="\\u20d0-\\u20ff",$=T+W+A,k="\\u2700-\\u27bf",L="a-z\\xdf-\\xf6\\xf8-\\xff",U="\\xac\\xb1\\xd7\\xf7",re="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",K="\\u2000-\\u206f",ne=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",le="A-Z\\xc0-\\xd6\\xd8-\\xde",pe="\\ufe0e\\ufe0f",xe=U+re+K+ne,it="['\u2019]",nt="["+xe+"]",we="["+$+"]",Ke="\\d+",ke="["+k+"]",Oe="["+L+"]",Re="[^"+I+xe+Ke+k+L+le+"]",Je="\\ud83c[\\udffb-\\udfff]",O="(?:"+we+"|"+Je+")",at="[^"+I+"]",Pe="(?:\\ud83c[\\udde6-\\uddff]){2}",ve="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+le+"]",Ae="\\u200d",ct="(?:"+Oe+"|"+Re+")",ut="(?:"+Be+"|"+Re+")",St="(?:"+it+"(?:d|ll|m|re|s|t|ve))?",Tt="(?:"+it+"(?:D|LL|M|RE|S|T|VE))?",Q=O+"?",p="["+pe+"]?",B="(?:"+Ae+"(?:"+[at,Pe,ve].join("|")+")"+p+Q+")*",be="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Te="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ge=p+Q+B,$e="(?:"+[ke,Pe,ve].join("|")+")"+Ge,Mt=RegExp([Be+"?"+Oe+"+"+St+"(?="+[nt,Be,"$"].join("|")+")",ut+"+"+Tt+"(?="+[nt,Be+ct,"$"].join("|")+")",Be+"?"+ct+"+"+St,Be+"+"+Tt,Te,be,Ke,$e].join("|"),"g");function Sr(gr){return gr.match(Mt)||[]}et.exports=Sr},68929:function(et,I,T){var W=T(48403),A=T(35393),$=A(function(k,L,U){return L=L.toLowerCase(),k+(U?W(L):L)});et.exports=$},48403:function(et,I,T){var W=T(79833),A=T(11700);function $(k){return A(W(k).toLowerCase())}et.exports=$},74691:function(et,I,T){var W=T(29750),A=T(14841);function $(k,L,U){return U===void 0&&(U=L,L=void 0),U!==void 0&&(U=A(U),U=U===U?U:0),L!==void 0&&(L=A(L),L=L===L?L:0),W(A(k),L,U)}et.exports=$},53816:function(et,I,T){var W=T(69389),A=T(79833),$=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,k="\\u0300-\\u036f",L="\\ufe20-\\ufe2f",U="\\u20d0-\\u20ff",re=k+L+U,K="["+re+"]",ne=RegExp(K,"g");function le(pe){return pe=A(pe),pe&&pe.replace($,W).replace(ne,"")}et.exports=le},14293:function(et){function I(T){return T==null}et.exports=I},81763:function(et,I,T){var W=T(44239),A=T(37005),$="[object Number]";function k(L){return typeof L=="number"||A(L)&&W(L)==$}et.exports=k},52353:function(et){function I(T){return T===void 0}et.exports=I},96486:function(et,I,T){et=T.nmd(et);var W;/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(){var A,$="4.17.21",k=200,L="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",U="Expected a function",re="Invalid `variable` option passed into `_.template`",K="__lodash_hash_undefined__",ne=500,le="__lodash_placeholder__",pe=1,xe=2,it=4,nt=1,we=2,Ke=1,ke=2,Oe=4,Re=8,Je=16,O=32,at=64,Pe=128,ve=256,Be=512,Ae=30,ct="...",ut=800,St=16,Tt=1,Q=2,p=3,B=1/0,be=9007199254740991,Te=17976931348623157e292,Ge=0/0,$e=4294967295,Mt=$e-1,Sr=$e>>>1,gr=[["ary",Pe],["bind",Ke],["bindKey",ke],["curry",Re],["curryRight",Je],["flip",Be],["partial",O],["partialRight",at],["rearg",ve]],sn="[object Arguments]",Cr="[object Array]",Br="[object AsyncFunction]",Zr="[object Boolean]",kr="[object Date]",Jn="[object DOMException]",Tn="[object Error]",rn="[object Function]",En="[object GeneratorFunction]",Gr="[object Map]",Fn="[object Number]",si="[object Null]",zn="[object Object]",Nn="[object Promise]",_n="[object Proxy]",On="[object RegExp]",cn="[object Set]",Aa="[object String]",j="[object Symbol]",Hr="[object Undefined]",ri="[object WeakMap]",fu="[object WeakSet]",qe="[object ArrayBuffer]",dt="[object DataView]",Nt="[object Float32Array]",ar="[object Float64Array]",yr="[object Int8Array]",Tr="[object Int16Array]",$r="[object Int32Array]",Vr="[object Uint8Array]",vr="[object Uint8ClampedArray]",ln="[object Uint16Array]",fn="[object Uint32Array]",Ni=/\b__p \+= '';/g,hu=/\b(__p \+=) '' \+/g,da=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ni=/&(?:amp|lt|gt|quot|#39);/g,lo=/[&<>"']/g,gl=RegExp(ni.source),To=RegExp(lo.source),Ms=/<%-([\s\S]+?)%>/g,Os=/<%([\s\S]+?)%>/g,du=/<%=([\s\S]+?)%>/g,ki=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_l=/^\w*$/,oc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vo=/[\\^$.*+?()[\]{}|]/g,yl=RegExp(Vo.source),ja=/^\s+/,Fr=/\s/,Qi=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,zu=/\{\n\/\* \[wrapped with (.+)\] \*/,Hu=/,? & /,Rs=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$n=/[()=,{}\[\]\/\s]/,El=/\\(\\)?/g,ju=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Vu=/\w*$/,Wu=/^[-+]0x[0-9a-f]+$/i,xl=/^0b[01]+$/i,pu=/^\[object .+?Constructor\]$/,Rn=/^0o[0-7]+$/i,Va=/^(?:0|[1-9]\d*)$/,pa=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,va=/($^)/,nn=/['\n\r\u2028\u2029\\]/g,ft="\\ud800-\\udfff",mt="\\u0300-\\u036f",Xu="\\ufe20-\\ufe2f",Ui="\\u20d0-\\u20ff",Wo=mt+Xu+Ui,Gi="\\u2700-\\u27bf",lr="a-z\\xdf-\\xf6\\xf8-\\xff",cr="\\xac\\xb1\\xd7\\xf7",Xe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Bi="\\u2000-\\u206f",z=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",zi="A-Z\\xc0-\\xd6\\xd8-\\xde",Yu="\\ufe0e\\ufe0f",co=cr+Xe+Bi+z,Ji="['\u2019]",Hi="["+ft+"]",Wa="["+co+"]",ba="["+Wo+"]",Xo="\\d+",Yo="["+Gi+"]",Xa="["+lr+"]",yi="[^"+ft+co+Xo+Gi+lr+zi+"]",Hn="\\ud83c[\\udffb-\\udfff]",$o="(?:"+ba+"|"+Hn+")",Ya="[^"+ft+"]",Ta="(?:\\ud83c[\\udde6-\\uddff]){2}",Mo="[\\ud800-\\udbff][\\udc00-\\udfff]",ma="["+zi+"]",ji="\\u200d",D="(?:"+Xa+"|"+yi+")",V="(?:"+ma+"|"+yi+")",he="(?:"+Ji+"(?:d|ll|m|re|s|t|ve))?",Ue="(?:"+Ji+"(?:D|LL|M|RE|S|T|VE))?",Zt=$o+"?",mr="["+Yu+"]?",hn="(?:"+ji+"(?:"+[Ya,Ta,Mo].join("|")+")"+mr+Zt+")*",li="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ii="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Kn=mr+Zt+hn,Vi="(?:"+[Yo,Ta,Mo].join("|")+")"+Kn,Sl="(?:"+[Ya+ba+"?",ba,Ta,Mo,Hi].join("|")+")",$a=RegExp(Ji,"g"),ga=RegExp(ba,"g"),Wi=RegExp(Hn+"(?="+Hn+")|"+Sl+Kn,"g"),vu=RegExp([ma+"?"+Xa+"+"+he+"(?="+[Wa,ma,"$"].join("|")+")",V+"+"+Ue+"(?="+[Wa,ma+D,"$"].join("|")+")",ma+"?"+D+"+"+he,ma+"+"+Ue,ii,li,Xo,Vi].join("|"),"g"),Ps=RegExp("["+ji+ft+Wo+Yu+"]"),Oo=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ef=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ka=-1,vn={};vn[Nt]=vn[ar]=vn[yr]=vn[Tr]=vn[$r]=vn[Vr]=vn[vr]=vn[ln]=vn[fn]=!0,vn[sn]=vn[Cr]=vn[qe]=vn[Zr]=vn[dt]=vn[kr]=vn[Tn]=vn[rn]=vn[Gr]=vn[Fn]=vn[zn]=vn[On]=vn[cn]=vn[Aa]=vn[ri]=!1;var dn={};dn[sn]=dn[Cr]=dn[qe]=dn[dt]=dn[Zr]=dn[kr]=dn[Nt]=dn[ar]=dn[yr]=dn[Tr]=dn[$r]=dn[Gr]=dn[Fn]=dn[zn]=dn[On]=dn[cn]=dn[Aa]=dn[j]=dn[Vr]=dn[vr]=dn[ln]=dn[fn]=!0,dn[Tn]=dn[rn]=dn[ri]=!1;var ea={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},$u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Wf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ma={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Cl=parseFloat,fo=parseInt,mu=typeof T.g=="object"&&T.g&&T.g.Object===Object&&T.g,f=typeof self=="object"&&self&&self.Object===Object&&self,m=mu||f||Function("return this")(),C=I&&!I.nodeType&&I,_=C&&!0&&et&&!et.nodeType&&et,R=_&&_.exports===C,X=R&&mu.process,oe=function(){try{var Fe=_&&_.require&&_.require("util").types;return Fe||X&&X.binding&&X.binding("util")}catch(lt){}}(),Me=oe&&oe.isArrayBuffer,Ie=oe&&oe.isDate,Ct=oe&&oe.isMap,Pt=oe&&oe.isRegExp,dr=oe&&oe.isSet,zr=oe&&oe.isTypedArray;function Ar(Fe,lt,ot){switch(ot.length){case 0:return Fe.call(lt);case 1:return Fe.call(lt,ot[0]);case 2:return Fe.call(lt,ot[0],ot[1]);case 3:return Fe.call(lt,ot[0],ot[1],ot[2])}return Fe.apply(lt,ot)}function Qr(Fe,lt,ot,Wt){for(var an=-1,Bn=Fe==null?0:Fe.length;++an<Bn;){var ei=Fe[an];lt(Wt,ei,ot(ei),Fe)}return Wt}function un(Fe,lt){for(var ot=-1,Wt=Fe==null?0:Fe.length;++ot<Wt&&lt(Fe[ot],ot,Fe)!==!1;);return Fe}function kn(Fe,lt){for(var ot=Fe==null?0:Fe.length;ot--&&lt(Fe[ot],ot,Fe)!==!1;);return Fe}function Oa(Fe,lt){for(var ot=-1,Wt=Fe==null?0:Fe.length;++ot<Wt;)if(!lt(Fe[ot],ot,Fe))return!1;return!0}function ci(Fe,lt){for(var ot=-1,Wt=Fe==null?0:Fe.length,an=0,Bn=[];++ot<Wt;){var ei=Fe[ot];lt(ei,ot,Fe)&&(Bn[an++]=ei)}return Bn}function ho(Fe,lt){var ot=Fe==null?0:Fe.length;return!!ot&&Po(Fe,lt,0)>-1}function Ro(Fe,lt,ot){for(var Wt=-1,an=Fe==null?0:Fe.length;++Wt<an;)if(ot(lt,Fe[Wt]))return!0;return!1}function qn(Fe,lt){for(var ot=-1,Wt=Fe==null?0:Fe.length,an=Array(Wt);++ot<Wt;)an[ot]=lt(Fe[ot],ot,Fe);return an}function _a(Fe,lt){for(var ot=-1,Wt=lt.length,an=Fe.length;++ot<Wt;)Fe[an+ot]=lt[ot];return Fe}function ws(Fe,lt,ot,Wt){var an=-1,Bn=Fe==null?0:Fe.length;for(Wt&&Bn&&(ot=Fe[++an]);++an<Bn;)ot=lt(ot,Fe[an],an,Fe);return ot}function uc(Fe,lt,ot,Wt){var an=Fe==null?0:Fe.length;for(Wt&&an&&(ot=Fe[--an]);an--;)ot=lt(ot,Fe[an],an,Fe);return ot}function Al(Fe,lt){for(var ot=-1,Wt=Fe==null?0:Fe.length;++ot<Wt;)if(lt(Fe[ot],ot,Fe))return!0;return!1}var sc=Is("length");function fi(Fe){return Fe.split("")}function Xf(Fe){return Fe.match(Rs)||[]}function Yf(Fe,lt,ot){var Wt;return ot(Fe,function(an,Bn,ei){if(lt(an,Bn,ei))return Wt=Bn,!1}),Wt}function Ra(Fe,lt,ot,Wt){for(var an=Fe.length,Bn=ot+(Wt?1:-1);Wt?Bn--:++Bn<an;)if(lt(Fe[Bn],Bn,Fe))return Bn;return-1}function Po(Fe,lt,ot){return lt===lt?Kh(Fe,lt,ot):Ra(Fe,gu,ot)}function bl(Fe,lt,ot,Wt){for(var an=ot-1,Bn=Fe.length;++an<Bn;)if(Wt(Fe[an],lt))return an;return-1}function gu(Fe){return Fe!==Fe}function tf(Fe,lt){var ot=Fe==null?0:Fe.length;return ot?Tl(Fe,lt)/ot:Ge}function Is(Fe){return function(lt){return lt==null?A:lt[Fe]}}function Ls(Fe){return function(lt){return Fe==null?A:Fe[lt]}}function ta(Fe,lt,ot,Wt,an){return an(Fe,function(Bn,ei,wn){ot=Wt?(Wt=!1,Bn):lt(ot,Bn,ei,wn)}),ot}function $f(Fe,lt){var ot=Fe.length;for(Fe.sort(lt);ot--;)Fe[ot]=Fe[ot].value;return Fe}function Tl(Fe,lt){for(var ot,Wt=-1,an=Fe.length;++Wt<an;){var Bn=lt(Fe[Wt]);Bn!==A&&(ot=ot===A?Bn:ot+Bn)}return ot}function lc(Fe,lt){for(var ot=-1,Wt=Array(Fe);++ot<Fe;)Wt[ot]=lt(ot);return Wt}function rf(Fe,lt){return qn(lt,function(ot){return[ot,Fe[ot]]})}function cc(Fe){return Fe&&Fe.slice(0,Ns(Fe)+1).replace(ja,"")}function Pa(Fe){return function(lt){return Fe(lt)}}function Kf(Fe,lt){return qn(lt,function(ot){return Fe[ot]})}function Ds(Fe,lt){return Fe.has(lt)}function fc(Fe,lt){for(var ot=-1,Wt=Fe.length;++ot<Wt&&Po(lt,Fe[ot],0)>-1;);return ot}function nf(Fe,lt){for(var ot=Fe.length;ot--&&Po(lt,Fe[ot],0)>-1;);return ot}function af(Fe,lt){for(var ot=Fe.length,Wt=0;ot--;)Fe[ot]===lt&&++Wt;return Wt}var Fs=Ls(ea),of=Ls($u);function hc(Fe){return"\\"+Ma[Fe]}function uf(Fe,lt){return Fe==null?A:Fe[lt]}function _u(Fe){return Ps.test(Fe)}function qf(Fe){return Oo.test(Fe)}function Qf(Fe){for(var lt,ot=[];!(lt=Fe.next()).done;)ot.push(lt.value);return ot}function yu(Fe){var lt=-1,ot=Array(Fe.size);return Fe.forEach(function(Wt,an){ot[++lt]=[an,Wt]}),ot}function sf(Fe,lt){return function(ot){return Fe(lt(ot))}}function Ko(Fe,lt){for(var ot=-1,Wt=Fe.length,an=0,Bn=[];++ot<Wt;){var ei=Fe[ot];(ei===lt||ei===le)&&(Fe[ot]=le,Bn[an++]=ot)}return Bn}function Ml(Fe){var lt=-1,ot=Array(Fe.size);return Fe.forEach(function(Wt){ot[++lt]=Wt}),ot}function dc(Fe){var lt=-1,ot=Array(Fe.size);return Fe.forEach(function(Wt){ot[++lt]=[Wt,Wt]}),ot}function Kh(Fe,lt,ot){for(var Wt=ot-1,an=Fe.length;++Wt<an;)if(Fe[Wt]===lt)return Wt;return-1}function Ol(Fe,lt,ot){for(var Wt=ot+1;Wt--;)if(Fe[Wt]===lt)return Wt;return Wt}function Ku(Fe){return _u(Fe)?lf(Fe):sc(Fe)}function wa(Fe){return _u(Fe)?cd(Fe):fi(Fe)}function Ns(Fe){for(var lt=Fe.length;lt--&&Fr.test(Fe.charAt(lt)););return lt}var ld=Ls(Wf);function lf(Fe){for(var lt=Wi.lastIndex=0;Wi.test(Fe);)++lt;return lt}function cd(Fe){return Fe.match(Wi)||[]}function Jf(Fe){return Fe.match(vu)||[]}var fd=function Fe(lt){lt=lt==null?m:pc.defaults(m.Object(),lt,pc.pick(m,ef));var ot=lt.Array,Wt=lt.Date,an=lt.Error,Bn=lt.Function,ei=lt.Math,wn=lt.Object,ks=lt.RegExp,qh=lt.String,Cn=lt.TypeError,qo=ot.prototype,qu=Bn.prototype,wo=wn.prototype,vc=lt["__core-js_shared__"],Rl=qu.toString,In=wo.hasOwnProperty,Bs=0,eh=function(){var u=/[^.]+$/.exec(vc&&vc.keys&&vc.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""}(),Eu=wo.toString,qa=Rl.call(wn),Pl=m._,th=ks("^"+Rl.call(In).replace(Vo,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qn=R?lt.Buffer:A,Io=lt.Symbol,wl=lt.Uint8Array,cf=Qn?Qn.allocUnsafe:A,Lo=sf(wn.getPrototypeOf,wn),mc=wn.create,Qu=wo.propertyIsEnumerable,Ci=qo.splice,Il=Io?Io.isConcatSpreadable:A,Ju=Io?Io.iterator:A,Qa=Io?Io.toStringTag:A,Ll=function(){try{var u=Fu(wn,"defineProperty");return u({},"",{}),u}catch(c){}}(),Qh=lt.clearTimeout!==m.clearTimeout&&lt.clearTimeout,Jh=Wt&&Wt.now!==m.Date.now&&Wt.now,rh=lt.setTimeout!==m.setTimeout&&lt.setTimeout,es=ei.ceil,gc=ei.floor,Zs=wn.getOwnPropertySymbols,e0=Qn?Qn.isBuffer:A,Dl=lt.isFinite,_c=qo.join,hd=sf(wn.keys,wn),bi=ei.max,Xi=ei.min,t0=Wt.now,Ia=lt.parseInt,r0=ei.random,xu=qo.reverse,Fl=Fu(lt,"DataView"),Su=Fu(lt,"Map"),Nl=Fu(lt,"Promise"),ts=Fu(lt,"Set"),Us=Fu(lt,"WeakMap"),Gs=Fu(wn,"create"),zs=Us&&new Us,Hs={},nh=Un(Fl),n0=Un(Su),po=Un(Nl),rs=Un(ts),dd=Un(Us),ya=Io?Io.prototype:A,Cu=ya?ya.valueOf:A,Ja=ya?ya.toString:A;function Z(u){if(Ai(u)&&!pn(u)&&!(u instanceof Jr)){if(u instanceof Yi)return u;if(In.call(u,"__wrapped__"))return Ti(u)}return new Yi(u)}var Do=function(){function u(){}return function(c){if(!xi(c))return{};if(mc)return mc(c);u.prototype=c;var v=new u;return u.prototype=A,v}}();function Fo(){}function Yi(u,c){this.__wrapped__=u,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=A}Z.templateSettings={escape:Ms,evaluate:Os,interpolate:du,variable:"",imports:{_:Z}},Z.prototype=Fo.prototype,Z.prototype.constructor=Z,Yi.prototype=Do(Fo.prototype),Yi.prototype.constructor=Yi;function Jr(u){this.__wrapped__=u,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$e,this.__views__=[]}function ih(){var u=new Jr(this.__wrapped__);return u.__actions__=Li(this.__actions__),u.__dir__=this.__dir__,u.__filtered__=this.__filtered__,u.__iteratees__=Li(this.__iteratees__),u.__takeCount__=this.__takeCount__,u.__views__=Li(this.__views__),u}function i0(){if(this.__filtered__){var u=new Jr(this);u.__dir__=-1,u.__filtered__=!0}else u=this.clone(),u.__dir__*=-1;return u}function a0(){var u=this.__wrapped__.value(),c=this.__dir__,v=pn(u),x=c<0,P=v?u.length:0,Y=pt(0,P,this.__views__),ce=Y.start,ye=Y.end,Ze=ye-ce,It=x?ye:ce-1,Lt=this.__iteratees__,Vt=Lt.length,_r=0,Lr=Xi(Ze,this.__takeCount__);if(!v||!x&&P==Ze&&Lr==Ze)return _h(u,this.__actions__);var Kr=[];e:for(;Ze--&&_r<Lr;){It+=c;for(var yn=-1,Yr=u[It];++yn<Vt;){var xn=Lt[yn],Mn=xn.iteratee,io=xn.type,Ga=Mn(Yr);if(io==Q)Yr=Ga;else if(!Ga){if(io==Tt)continue e;break e}}Kr[_r++]=Yr}return Kr}Jr.prototype=Do(Fo.prototype),Jr.prototype.constructor=Jr;function ns(u){var c=-1,v=u==null?0:u.length;for(this.clear();++c<v;){var x=u[c];this.set(x[0],x[1])}}function o0(){this.__data__=Gs?Gs(null):{},this.size=0}function u0(u){var c=this.has(u)&&delete this.__data__[u];return this.size-=c?1:0,c}function s0(u){var c=this.__data__;if(Gs){var v=c[u];return v===K?A:v}return In.call(c,u)?c[u]:A}function ah(u){var c=this.__data__;return Gs?c[u]!==A:In.call(c,u)}function ff(u,c){var v=this.__data__;return this.size+=this.has(u)?0:1,v[u]=Gs&&c===A?K:c,this}ns.prototype.clear=o0,ns.prototype.delete=u0,ns.prototype.get=s0,ns.prototype.has=ah,ns.prototype.set=ff;function No(u){var c=-1,v=u==null?0:u.length;for(this.clear();++c<v;){var x=u[c];this.set(x[0],x[1])}}function oh(){this.__data__=[],this.size=0}function Au(u){var c=this.__data__,v=xc(c,u);if(v<0)return!1;var x=c.length-1;return v==x?c.pop():Ci.call(c,v,1),--this.size,!0}function yc(u){var c=this.__data__,v=xc(c,u);return v<0?A:c[v][1]}function is(u){return xc(this.__data__,u)>-1}function l0(u,c){var v=this.__data__,x=xc(v,u);return x<0?(++this.size,v.push([u,c])):v[x][1]=c,this}No.prototype.clear=oh,No.prototype.delete=Au,No.prototype.get=yc,No.prototype.has=is,No.prototype.set=l0;function eo(u){var c=-1,v=u==null?0:u.length;for(this.clear();++c<v;){var x=u[c];this.set(x[0],x[1])}}function La(){this.size=0,this.__data__={hash:new ns,map:new(Su||No),string:new ns}}function uh(u){var c=zc(this,u).delete(u);return this.size-=c?1:0,c}function sh(u){return zc(this,u).get(u)}function Ec(u){return zc(this,u).has(u)}function lh(u,c){var v=zc(this,u),x=v.size;return v.set(u,c),this.size+=v.size==x?0:1,this}eo.prototype.clear=La,eo.prototype.delete=uh,eo.prototype.get=sh,eo.prototype.has=Ec,eo.prototype.set=lh;function bu(u){var c=-1,v=u==null?0:u.length;for(this.__data__=new eo;++c<v;)this.add(u[c])}function c0(u){return this.__data__.set(u,K),this}function ko(u){return this.__data__.has(u)}bu.prototype.add=bu.prototype.push=c0,bu.prototype.has=ko;function Da(u){var c=this.__data__=new No(u);this.size=c.size}function js(){this.__data__=new No,this.size=0}function Zn(u){var c=this.__data__,v=c.delete(u);return this.size=c.size,v}function Vs(u){return this.__data__.get(u)}function Ws(u){return this.__data__.has(u)}function Xs(u,c){var v=this.__data__;if(v instanceof No){var x=v.__data__;if(!Su||x.length<k-1)return x.push([u,c]),this.size=++v.size,this;v=this.__data__=new eo(x)}return v.set(u,c),this.size=v.size,this}Da.prototype.clear=js,Da.prototype.delete=Zn,Da.prototype.get=Vs,Da.prototype.has=Ws,Da.prototype.set=Xs;function Ys(u,c){var v=pn(u),x=!v&&Eo(u),P=!v&&!x&&xs(u),Y=!v&&!x&&!P&&rc(u),ce=v||x||P||Y,ye=ce?lc(u.length,qh):[],Ze=ye.length;for(var It in u)(c||In.call(u,It))&&!(ce&&(It=="length"||P&&(It=="offset"||It=="parent")||Y&&(It=="buffer"||It=="byteLength"||It=="byteOffset")||kt(It,Ze)))&&ye.push(It);return ye}function as(u){var c=u.length;return c?u[Iu(0,c-1)]:A}function ch(u,c){return Ir(Li(u),tu(c,0,u.length))}function ai(u){return Ir(Li(u))}function Qo(u,c,v){(v!==A&&!Ho(u[c],v)||v===A&&!(c in u))&&eu(u,c,v)}function Jo(u,c,v){var x=u[c];(!(In.call(u,c)&&Ho(x,v))||v===A&&!(c in u))&&eu(u,c,v)}function xc(u,c){for(var v=u.length;v--;)if(Ho(u[v][0],c))return v;return-1}function f0(u,c,v,x){return Fa(u,function(P,Y,ce){c(x,P,v(P),ce)}),x}function hf(u,c){return u&&ra(c,qi(c),u)}function kl(u,c){return u&&ra(c,Ua(c),u)}function eu(u,c,v){c=="__proto__"&&Ll?Ll(u,c,{configurable:!0,enumerable:!0,value:v,writable:!0}):u[c]=v}function Tu(u,c){for(var v=-1,x=c.length,P=ot(x),Y=u==null;++v<x;)P[v]=Y?A:Mh(u,c[v]);return P}function tu(u,c,v){return u===u&&(v!==A&&(u=u<=v?u:v),c!==A&&(u=u>=c?u:c)),u}function $i(u,c,v,x,P,Y){var ce,ye=c&pe,Ze=c&xe,It=c&it;if(v&&(ce=P?v(u,x,P,Y):v(u)),ce!==A)return ce;if(!xi(u))return u;var Lt=pn(u);if(Lt){if(ce=gt(u),!ye)return Li(u,ce)}else{var Vt=De(u),_r=Vt==rn||Vt==En;if(xs(u))return nu(u,ye);if(Vt==zn||Vt==sn||_r&&!P){if(ce=Ze||_r?{}:bt(u),!ye)return Ze?Ef(u,kl(ce,u)):yh(u,hf(ce,u))}else{if(!dn[Vt])return P?u:{};ce=vt(u,Vt,ye)}}Y||(Y=new Da);var Lr=Y.get(u);if(Lr)return Lr;Y.set(u,ce),b0(u)?u.forEach(function(Yr){ce.add($i(Yr,c,v,Yr,u,Y))}):Nd(u)&&u.forEach(function(Yr,xn){ce.set(xn,$i(Yr,c,v,xn,u,Y))});var Kr=It?Ze?Uc:Af:Ze?Ua:qi,yn=Lt?A:Kr(u);return un(yn||u,function(Yr,xn){yn&&(xn=Yr,Yr=u[xn]),Jo(ce,xn,$i(Yr,c,v,xn,u,Y))}),ce}function os(u){var c=qi(u);return function(v){return fh(v,u,c)}}function fh(u,c,v){var x=v.length;if(u==null)return!x;for(u=wn(u);x--;){var P=v[x],Y=c[P],ce=u[P];if(ce===A&&!(P in u)||!Y(ce))return!1}return!0}function us(u,c,v){if(typeof u!="function")throw new Cn(U);return Mr(function(){u.apply(A,v)},c)}function $s(u,c,v,x){var P=-1,Y=ho,ce=!0,ye=u.length,Ze=[],It=c.length;if(!ye)return Ze;v&&(c=qn(c,Pa(v))),x?(Y=Ro,ce=!1):c.length>=k&&(Y=Ds,ce=!1,c=new bu(c));e:for(;++P<ye;){var Lt=u[P],Vt=v==null?Lt:v(Lt);if(Lt=x||Lt!==0?Lt:0,ce&&Vt===Vt){for(var _r=It;_r--;)if(c[_r]===Vt)continue e;Ze.push(Lt)}else Y(c,Vt,x)||Ze.push(Lt)}return Ze}var Fa=m0(vo),Sc=m0(Ac,!0);function Na(u,c){var v=!0;return Fa(u,function(x,P,Y){return v=!!c(x,P,Y),v}),v}function Ks(u,c,v){for(var x=-1,P=u.length;++x<P;){var Y=u[x],ce=c(Y);if(ce!=null&&(ye===A?ce===ce&&!Za(ce):v(ce,ye)))var ye=ce,Ze=Y}return Ze}function ru(u,c,v,x){var P=u.length;for(v=gn(v),v<0&&(v=-v>P?0:P+v),x=x===A||x>P?P:gn(x),x<0&&(x+=P),x=v>x?0:O0(x);v<x;)u[v++]=c;return u}function Cc(u,c){var v=[];return Fa(u,function(x,P,Y){c(x,P,Y)&&v.push(x)}),v}function hi(u,c,v,x,P){var Y=-1,ce=u.length;for(v||(v=Ft),P||(P=[]);++Y<ce;){var ye=u[Y];c>0&&v(ye)?c>1?hi(ye,c-1,v,x,P):_a(P,ye):x||(P[P.length]=ye)}return P}var qs=Ut(),df=Ut(!0);function vo(u,c){return u&&qs(u,c,qi)}function Ac(u,c){return u&&df(u,c,qi)}function Bl(u,c){return ci(c,function(v){return Nu(u[v])})}function Wn(u,c){c=Bo(c,u);for(var v=0,x=c.length;u!=null&&v<x;)u=u[An(c[v++])];return v&&v==x?u:A}function di(u,c,v){var x=c(u);return pn(u)?x:_a(x,v(u))}function Ii(u){return u==null?u===A?Hr:si:Qa&&Qa in wn(u)?S(u):or(u)}function Zl(u,c){return u>c}function ss(u,c){return u!=null&&In.call(u,c)}function h0(u,c){return u!=null&&c in wn(u)}function hh(u,c,v){return u>=Xi(c,v)&&u<bi(c,v)}function pf(u,c,v){for(var x=v?Ro:ho,P=u[0].length,Y=u.length,ce=Y,ye=ot(Y),Ze=Infinity,It=[];ce--;){var Lt=u[ce];ce&&c&&(Lt=qn(Lt,Pa(c))),Ze=Xi(Lt.length,Ze),ye[ce]=!v&&(c||P>=120&&Lt.length>=120)?new bu(ce&&Lt):A}Lt=u[0];var Vt=-1,_r=ye[0];e:for(;++Vt<P&&It.length<Ze;){var Lr=Lt[Vt],Kr=c?c(Lr):Lr;if(Lr=v||Lr!==0?Lr:0,!(_r?Ds(_r,Kr):x(It,Kr,v))){for(ce=Y;--ce;){var yn=ye[ce];if(!(yn?Ds(yn,Kr):x(u[ce],Kr,v)))continue e}_r&&_r.push(Kr),It.push(Lr)}}return It}function d0(u,c,v,x){return vo(u,function(P,Y,ce){c(x,v(P),Y,ce)}),x}function Mu(u,c,v){c=Bo(c,u),u=Ot(u,c);var x=u==null?u:u[An(_e(c))];return x==null?A:Ar(x,u,v)}function Ea(u){return Ai(u)&&Ii(u)==sn}function p0(u){return Ai(u)&&Ii(u)==qe}function dh(u){return Ai(u)&&Ii(u)==kr}function Ul(u,c,v,x,P){return u===c?!0:u==null||c==null||!Ai(u)&&!Ai(c)?u!==u&&c!==c:ls(u,c,v,x,Ul,P)}function ls(u,c,v,x,P,Y){var ce=pn(u),ye=pn(c),Ze=ce?Cr:De(u),It=ye?Cr:De(c);Ze=Ze==sn?zn:Ze,It=It==sn?zn:It;var Lt=Ze==zn,Vt=It==zn,_r=Ze==It;if(_r&&xs(u)){if(!xs(c))return!1;ce=!0,Lt=!1}if(_r&&!Lt)return Y||(Y=new Da),ce||rc(u)?Cf(u,c,v,x,P,Y):_0(u,c,Ze,v,x,P,Y);if(!(v&nt)){var Lr=Lt&&In.call(u,"__wrapped__"),Kr=Vt&&In.call(c,"__wrapped__");if(Lr||Kr){var yn=Lr?u.value():u,Yr=Kr?c.value():c;return Y||(Y=new Da),P(yn,Yr,v,x,Y)}}return _r?(Y||(Y=new Da),y0(u,c,v,x,P,Y)):!1}function Gl(u){return Ai(u)&&De(u)==Gr}function cs(u,c,v,x){var P=v.length,Y=P,ce=!x;if(u==null)return!Y;for(u=wn(u);P--;){var ye=v[P];if(ce&&ye[2]?ye[1]!==u[ye[0]]:!(ye[0]in u))return!1}for(;++P<Y;){ye=v[P];var Ze=ye[0],It=u[Ze],Lt=ye[1];if(ce&&ye[2]){if(It===A&&!(Ze in u))return!1}else{var Vt=new Da;if(x)var _r=x(It,Lt,Ze,u,c,Vt);if(!(_r===A?Ul(Lt,It,nt|we,x,Vt):_r))return!1}}return!0}function bc(u){if(!xi(u)||wt(u))return!1;var c=Nu(u)?th:pu;return c.test(Un(u))}function Tc(u){return Ai(u)&&Ii(u)==On}function Qs(u){return Ai(u)&&De(u)==cn}function Ou(u){return Ai(u)&&Mf(u.length)&&!!vn[Ii(u)]}function Mc(u){return typeof u=="function"?u:u==null?no:typeof u=="object"?pn(u)?ua(u[0],u[1]):hs(u):Z0(u)}function fs(u){if(!yt(u))return hd(u);var c=[];for(var v in wn(u))In.call(u,v)&&v!="constructor"&&c.push(v);return c}function mo(u){if(!xi(u))return st(u);var c=yt(u),v=[];for(var x in u)x=="constructor"&&(c||!In.call(u,x))||v.push(x);return v}function Ru(u,c){return u<c}function Pu(u,c){var v=-1,x=Ba(u)?ot(u.length):[];return Fa(u,function(P,Y,ce){x[++v]=c(P,Y,ce)}),x}function hs(u){var c=Jl(u);return c.length==1&&c[0][2]?Kt(c[0][0],c[0][1]):function(v){return v===u||cs(v,u,c)}}function ua(u,c){return Dt(u)&&Qt(c)?Kt(An(u),c):function(v){var x=Mh(v,u);return x===A&&x===c?Oh(v,u):Ul(c,x,nt|we)}}function go(u,c,v,x,P){u!==c&&qs(c,function(Y,ce){if(P||(P=new Da),xi(Y))ds(u,c,ce,v,go,x,P);else{var ye=x?x(Yt(u,ce),Y,ce+"",u,c,P):A;ye===A&&(ye=Y),Qo(u,ce,ye)}},Ua)}function ds(u,c,v,x,P,Y,ce){var ye=Yt(u,v),Ze=Yt(c,v),It=ce.get(Ze);if(It){Qo(u,v,It);return}var Lt=Y?Y(ye,Ze,v+"",u,c,ce):A,Vt=Lt===A;if(Vt){var _r=pn(Ze),Lr=!_r&&xs(Ze),Kr=!_r&&!Lr&&rc(Ze);Lt=Ze,_r||Lr||Kr?pn(ye)?Lt=ye:wi(ye)?Lt=Li(ye):Lr?(Vt=!1,Lt=nu(Ze,!0)):Kr?(Vt=!1,Lt=gs(Ze,!0)):Lt=[]:Rf(Ze)||Eo(Ze)?(Lt=ye,Eo(ye)?Lt=R0(ye):(!xi(ye)||Nu(ye))&&(Lt=bt(Ze))):Vt=!1}Vt&&(ce.set(Ze,Lt),P(Lt,Ze,x,Y,ce),ce.delete(Ze)),Qo(u,v,Lt)}function wu(u,c){var v=u.length;if(!!v)return c+=c<0?v:0,kt(c,v)?u[c]:A}function zl(u,c,v){c.length?c=qn(c,function(Y){return pn(Y)?function(ce){return Wn(ce,Y.length===1?Y[0]:Y)}:Y}):c=[no];var x=-1;c=qn(c,Pa(Wr()));var P=Pu(u,function(Y,ce,ye){var Ze=qn(c,function(It){return It(Y)});return{criteria:Ze,index:++x,value:Y}});return $f(P,function(Y,ce){return Yl(Y,ce,v)})}function Oc(u,c){return Js(u,c,function(v,x){return Oh(u,x)})}function Js(u,c,v){for(var x=-1,P=c.length,Y={};++x<P;){var ce=c[x],ye=Wn(u,ce);v(ye,ce)&&Hl(Y,Bo(ce,u),ye)}return Y}function vf(u){return function(c){return Wn(c,u)}}function ps(u,c,v,x){var P=x?bl:Po,Y=-1,ce=c.length,ye=u;for(u===c&&(c=Li(c)),v&&(ye=qn(u,Pa(v)));++Y<ce;)for(var Ze=0,It=c[Y],Lt=v?v(It):It;(Ze=P(ye,Lt,Ze,x))>-1;)ye!==u&&Ci.call(ye,Ze,1),Ci.call(u,Ze,1);return u}function Ki(u,c){for(var v=u?c.length:0,x=v-1;v--;){var P=c[v];if(v==x||P!==Y){var Y=P;kt(P)?Ci.call(u,P,1):yf(u,P)}}return u}function Iu(u,c){return u+gc(r0()*(c-u+1))}function v0(u,c,v,x){for(var P=-1,Y=bi(es((c-u)/(v||1)),0),ce=ot(Y);Y--;)ce[x?Y:++P]=u,u+=v;return ce}function Rc(u,c){var v="";if(!u||c<1||c>be)return v;do c%2&&(v+=u),c=gc(c/2),c&&(u+=u);while(c);return v}function mn(u,c){return $t(Bt(u,c,no),u+"")}function mf(u){return as(Wc(u))}function gf(u,c){var v=Wc(u);return Ir(v,tu(c,0,v.length))}function Hl(u,c,v,x){if(!xi(u))return u;c=Bo(c,u);for(var P=-1,Y=c.length,ce=Y-1,ye=u;ye!=null&&++P<Y;){var Ze=An(c[P]),It=v;if(Ze==="__proto__"||Ze==="constructor"||Ze==="prototype")return u;if(P!=ce){var Lt=ye[Ze];It=x?x(Lt,Ze,ye):A,It===A&&(It=xi(Lt)?Lt:kt(c[P+1])?[]:{})}Jo(ye,Ze,It),ye=ye[Ze]}return u}var vs=zs?function(u,c){return zs.set(u,c),u}:no,_f=Ll?function(u,c){return Ll(u,"toString",{configurable:!0,enumerable:!1,value:Ph(c),writable:!0})}:no;function ph(u){return Ir(Wc(u))}function to(u,c,v){var x=-1,P=u.length;c<0&&(c=-c>P?0:P+c),v=v>P?P:v,v<0&&(v+=P),P=c>v?0:v-c>>>0,c>>>=0;for(var Y=ot(P);++x<P;)Y[x]=u[x+c];return Y}function vh(u,c){var v;return Fa(u,function(x,P,Y){return v=c(x,P,Y),!v}),!!v}function Pc(u,c,v){var x=0,P=u==null?x:u.length;if(typeof c=="number"&&c===c&&P<=Sr){for(;x<P;){var Y=x+P>>>1,ce=u[Y];ce!==null&&!Za(ce)&&(v?ce<=c:ce<c)?x=Y+1:P=Y}return P}return wc(u,c,no,v)}function wc(u,c,v,x){var P=0,Y=u==null?0:u.length;if(Y===0)return 0;c=v(c);for(var ce=c!==c,ye=c===null,Ze=Za(c),It=c===A;P<Y;){var Lt=gc((P+Y)/2),Vt=v(u[Lt]),_r=Vt!==A,Lr=Vt===null,Kr=Vt===Vt,yn=Za(Vt);if(ce)var Yr=x||Kr;else It?Yr=Kr&&(x||_r):ye?Yr=Kr&&_r&&(x||!Lr):Ze?Yr=Kr&&_r&&!Lr&&(x||!yn):Lr||yn?Yr=!1:Yr=x?Vt<=c:Vt<c;Yr?P=Lt+1:Y=Lt}return Xi(Y,Mt)}function jl(u,c){for(var v=-1,x=u.length,P=0,Y=[];++v<x;){var ce=u[v],ye=c?c(ce):ce;if(!v||!Ho(ye,Ze)){var Ze=ye;Y[P++]=ce===0?0:ce}}return Y}function mh(u){return typeof u=="number"?u:Za(u)?Ge:+u}function ka(u){if(typeof u=="string")return u;if(pn(u))return qn(u,ka)+"";if(Za(u))return Ja?Ja.call(u):"";var c=u+"";return c=="0"&&1/u==-B?"-0":c}function Lu(u,c,v){var x=-1,P=ho,Y=u.length,ce=!0,ye=[],Ze=ye;if(v)ce=!1,P=Ro;else if(Y>=k){var It=c?null:xa(u);if(It)return Ml(It);ce=!1,P=Ds,Ze=new bu}else Ze=c?[]:ye;e:for(;++x<Y;){var Lt=u[x],Vt=c?c(Lt):Lt;if(Lt=v||Lt!==0?Lt:0,ce&&Vt===Vt){for(var _r=Ze.length;_r--;)if(Ze[_r]===Vt)continue e;c&&Ze.push(Vt),ye.push(Lt)}else P(Ze,Vt,v)||(Ze!==ye&&Ze.push(Vt),ye.push(Lt))}return ye}function yf(u,c){return c=Bo(c,u),u=Ot(u,c),u==null||delete u[An(_e(c))]}function gh(u,c,v,x){return Hl(u,c,v(Wn(u,c)),x)}function Vl(u,c,v,x){for(var P=u.length,Y=x?P:-1;(x?Y--:++Y<P)&&c(u[Y],Y,u););return v?to(u,x?0:Y,x?Y+1:P):to(u,x?Y+1:0,x?P:Y)}function _h(u,c){var v=u;return v instanceof Jr&&(v=v.value()),ws(c,function(x,P){return P.func.apply(P.thisArg,_a([x],P.args))},v)}function el(u,c,v){var x=u.length;if(x<2)return x?Lu(u[0]):[];for(var P=-1,Y=ot(x);++P<x;)for(var ce=u[P],ye=-1;++ye<x;)ye!=P&&(Y[P]=$s(Y[P]||ce,u[ye],c,v));return Lu(hi(Y,1),c,v)}function ms(u,c,v){for(var x=-1,P=u.length,Y=c.length,ce={};++x<P;){var ye=x<Y?c[x]:A;v(ce,u[x],ye)}return ce}function tl(u){return wi(u)?u:[]}function rl(u){return typeof u=="function"?u:no}function Bo(u,c){return pn(u)?u:Dt(u,c)?[u]:en(Vn(u))}var Ic=mn;function _o(u,c,v){var x=u.length;return v=v===A?x:v,!c&&v>=x?u:to(u,c,v)}var Wl=Qh||function(u){return m.clearTimeout(u)};function nu(u,c){if(c)return u.slice();var v=u.length,x=cf?cf(v):new u.constructor(v);return u.copy(x),x}function nl(u){var c=new u.constructor(u.byteLength);return new wl(c).set(new wl(u)),c}function Lc(u,c){var v=c?nl(u.buffer):u.buffer;return new u.constructor(v,u.byteOffset,u.byteLength)}function Dc(u){var c=new u.constructor(u.source,Vu.exec(u));return c.lastIndex=u.lastIndex,c}function Xl(u){return Cu?wn(Cu.call(u)):{}}function gs(u,c){var v=c?nl(u.buffer):u.buffer;return new u.constructor(v,u.byteOffset,u.length)}function _s(u,c){if(u!==c){var v=u!==A,x=u===null,P=u===u,Y=Za(u),ce=c!==A,ye=c===null,Ze=c===c,It=Za(c);if(!ye&&!It&&!Y&&u>c||Y&&ce&&Ze&&!ye&&!It||x&&ce&&Ze||!v&&Ze||!P)return 1;if(!x&&!Y&&!It&&u<c||It&&v&&P&&!x&&!Y||ye&&v&&P||!ce&&P||!Ze)return-1}return 0}function Yl(u,c,v){for(var x=-1,P=u.criteria,Y=c.criteria,ce=P.length,ye=v.length;++x<ce;){var Ze=_s(P[x],Y[x]);if(Ze){if(x>=ye)return Ze;var It=v[x];return Ze*(It=="desc"?-1:1)}}return u.index-c.index}function il(u,c,v,x){for(var P=-1,Y=u.length,ce=v.length,ye=-1,Ze=c.length,It=bi(Y-ce,0),Lt=ot(Ze+It),Vt=!x;++ye<Ze;)Lt[ye]=c[ye];for(;++P<ce;)(Vt||P<Y)&&(Lt[v[P]]=u[P]);for(;It--;)Lt[ye++]=u[P++];return Lt}function $l(u,c,v,x){for(var P=-1,Y=u.length,ce=-1,ye=v.length,Ze=-1,It=c.length,Lt=bi(Y-ye,0),Vt=ot(Lt+It),_r=!x;++P<Lt;)Vt[P]=u[P];for(var Lr=P;++Ze<It;)Vt[Lr+Ze]=c[Ze];for(;++ce<ye;)(_r||P<Y)&&(Vt[Lr+v[ce]]=u[P++]);return Vt}function Li(u,c){var v=-1,x=u.length;for(c||(c=ot(x));++v<x;)c[v]=u[v];return c}function ra(u,c,v,x){var P=!v;v||(v={});for(var Y=-1,ce=c.length;++Y<ce;){var ye=c[Y],Ze=x?x(v[ye],u[ye],ye,v,u):A;Ze===A&&(Ze=u[ye]),P?eu(v,ye,Ze):Jo(v,ye,Ze)}return v}function yh(u,c){return ra(u,G(u),c)}function Ef(u,c){return ra(u,ie(u),c)}function Fc(u,c){return function(v,x){var P=pn(v)?Qr:f0,Y=c?c():{};return P(v,u,Wr(x,2),Y)}}function al(u){return mn(function(c,v){var x=-1,P=v.length,Y=P>1?v[P-1]:A,ce=P>2?v[2]:A;for(Y=u.length>3&&typeof Y=="function"?(P--,Y):A,ce&&_t(v[0],v[1],ce)&&(Y=P<3?A:Y,P=1),c=wn(c);++x<P;){var ye=v[x];ye&&u(c,ye,x,Y)}return c})}function m0(u,c){return function(v,x){if(v==null)return v;if(!Ba(v))return u(v,x);for(var P=v.length,Y=c?P:-1,ce=wn(v);(c?Y--:++Y<P)&&x(ce[Y],Y,ce)!==!1;);return v}}function Ut(u){return function(c,v,x){for(var P=-1,Y=wn(c),ce=x(c),ye=ce.length;ye--;){var Ze=ce[u?ye:++P];if(v(Y[Ze],Ze,Y)===!1)break}return c}}function Eh(u,c,v){var x=c&Ke,P=Kl(u);function Y(){var ce=this&&this!==m&&this instanceof Y?P:u;return ce.apply(x?v:this,arguments)}return Y}function Qe(u){return function(c){c=Vn(c);var v=_u(c)?wa(c):A,x=v?v[0]:c.charAt(0),P=v?_o(v,1).join(""):c.slice(1);return x[u]()+P}}function ys(u){return function(c){return ws(N0(dp(c).replace($a,"")),u,"")}}function Kl(u){return function(){var c=arguments;switch(c.length){case 0:return new u;case 1:return new u(c[0]);case 2:return new u(c[0],c[1]);case 3:return new u(c[0],c[1],c[2]);case 4:return new u(c[0],c[1],c[2],c[3]);case 5:return new u(c[0],c[1],c[2],c[3],c[4]);case 6:return new u(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new u(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var v=Do(u.prototype),x=u.apply(v,c);return xi(x)?x:v}}function xf(u,c,v){var x=Kl(u);function P(){for(var Y=arguments.length,ce=ot(Y),ye=Y,Ze=Es(P);ye--;)ce[ye]=arguments[ye];var It=Y<3&&ce[0]!==Ze&&ce[Y-1]!==Ze?[]:Ko(ce,Ze);if(Y-=It.length,Y<v)return Zo(u,c,ql,P.placeholder,A,ce,It,A,A,v-Y);var Lt=this&&this!==m&&this instanceof P?x:u;return Ar(Lt,this,ce)}return P}function Sf(u){return function(c,v,x){var P=wn(c);if(!Ba(c)){var Y=Wr(v,3);c=qi(c),v=function(ye){return Y(P[ye],ye,P)}}var ce=u(c,v,x);return ce>-1?P[Y?c[ce]:ce]:A}}function ro(u){return iu(function(c){var v=c.length,x=v,P=Yi.prototype.thru;for(u&&c.reverse();x--;){var Y=c[x];if(typeof Y!="function")throw new Cn(U);if(P&&!ce&&ul(Y)=="wrapper")var ce=new Yi([],!0)}for(x=ce?x:v;++x<v;){Y=c[x];var ye=ul(Y),Ze=ye=="wrapper"?Gc(Y):A;Ze&&He(Ze[0])&&Ze[1]==(Pe|Re|O|ve)&&!Ze[4].length&&Ze[9]==1?ce=ce[ul(Ze[0])].apply(ce,Ze[3]):ce=Y.length==1&&He(Y)?ce[ye]():ce.thru(Y)}return function(){var It=arguments,Lt=It[0];if(ce&&It.length==1&&pn(Lt))return ce.plant(Lt).value();for(var Vt=0,_r=v?c[Vt].apply(this,It):Lt;++Vt<v;)_r=c[Vt].call(this,_r);return _r}})}function ql(u,c,v,x,P,Y,ce,ye,Ze,It){var Lt=c&Pe,Vt=c&Ke,_r=c&ke,Lr=c&(Re|Je),Kr=c&Be,yn=_r?A:Kl(u);function Yr(){for(var xn=arguments.length,Mn=ot(xn),io=xn;io--;)Mn[io]=arguments[io];if(Lr)var Ga=Es(Yr),So=af(Mn,Ga);if(x&&(Mn=il(Mn,x,P,Lr)),Y&&(Mn=$l(Mn,Y,ce,Lr)),xn-=So,Lr&&xn<It){var Fi=Ko(Mn,Ga);return Zo(u,c,ql,Yr.placeholder,v,Mn,Fi,ye,Ze,It-xn)}var uu=Vt?v:this,bs=_r?uu[u]:u;return xn=Mn.length,ye?Mn=Xt(Mn,ye):Kr&&xn>1&&Mn.reverse(),Lt&&Ze<xn&&(Mn.length=Ze),this&&this!==m&&this instanceof Yr&&(bs=yn||Kl(bs)),bs.apply(uu,Mn)}return Yr}function Du(u,c){return function(v,x){return d0(v,u,c(x),{})}}function sa(u,c){return function(v,x){var P;if(v===A&&x===A)return c;if(v!==A&&(P=v),x!==A){if(P===A)return x;typeof v=="string"||typeof x=="string"?(v=ka(v),x=ka(x)):(v=mh(v),x=mh(x)),P=u(v,x)}return P}}function Nc(u){return iu(function(c){return c=qn(c,Pa(Wr())),mn(function(v){var x=this;return u(c,function(P){return Ar(P,x,v)})})})}function ol(u,c){c=c===A?" ":ka(c);var v=c.length;if(v<2)return v?Rc(c,u):c;var x=Rc(c,es(u/Ku(c)));return _u(c)?_o(wa(x),0,u).join(""):x.slice(0,u)}function Ql(u,c,v,x){var P=c&Ke,Y=Kl(u);function ce(){for(var ye=-1,Ze=arguments.length,It=-1,Lt=x.length,Vt=ot(Lt+Ze),_r=this&&this!==m&&this instanceof ce?Y:u;++It<Lt;)Vt[It]=x[It];for(;Ze--;)Vt[It++]=arguments[++ye];return Ar(_r,P?v:this,Vt)}return ce}function kc(u){return function(c,v,x){return x&&typeof x!="number"&&_t(c,v,x)&&(v=x=A),c=Cs(c),v===A?(v=c,c=0):v=Cs(v),x=x===A?c<v?1:-1:Cs(x),v0(c,v,x,u)}}function ui(u){return function(c,v){return typeof c=="string"&&typeof v=="string"||(c=xo(c),v=xo(v)),u(c,v)}}function Zo(u,c,v,x,P,Y,ce,ye,Ze,It){var Lt=c&Re,Vt=Lt?ce:A,_r=Lt?A:ce,Lr=Lt?Y:A,Kr=Lt?A:Y;c|=Lt?O:at,c&=~(Lt?at:O),c&Oe||(c&=~(Ke|ke));var yn=[u,c,P,Lr,Vt,Kr,_r,ye,Ze,It],Yr=v.apply(A,yn);return He(u)&&Nr(Yr,yn),Yr.placeholder=x,Jt(Yr,u,c)}function oi(u){var c=ei[u];return function(v,x){if(v=xo(v),x=x==null?0:Xi(gn(x),292),x&&Dl(v)){var P=(Vn(v)+"e").split("e"),Y=c(P[0]+"e"+(+P[1]+x));return P=(Vn(Y)+"e").split("e"),+(P[0]+"e"+(+P[1]-x))}return c(v)}}var xa=ts&&1/Ml(new ts([,-0]))[1]==B?function(u){return new ts(u)}:Ih;function Bc(u){return function(c){var v=De(c);return v==Gr?yu(c):v==cn?dc(c):rf(c,u(c))}}function Uo(u,c,v,x,P,Y,ce,ye){var Ze=c&ke;if(!Ze&&typeof u!="function")throw new Cn(U);var It=x?x.length:0;if(It||(c&=~(O|at),x=P=A),ce=ce===A?ce:bi(gn(ce),0),ye=ye===A?ye:gn(ye),It-=P?P.length:0,c&at){var Lt=x,Vt=P;x=P=A}var _r=Ze?A:Gc(u),Lr=[u,c,v,x,P,Lt,Vt,Y,ce,ye];if(_r&&ht(Lr,_r),u=Lr[0],c=Lr[1],v=Lr[2],x=Lr[3],P=Lr[4],ye=Lr[9]=Lr[9]===A?Ze?0:u.length:bi(Lr[9]-It,0),!ye&&c&(Re|Je)&&(c&=~(Re|Je)),!c||c==Ke)var Kr=Eh(u,c,v);else c==Re||c==Je?Kr=xf(u,c,ye):(c==O||c==(Ke|O))&&!P.length?Kr=Ql(u,c,v,x):Kr=ql.apply(A,Lr);var yn=_r?vs:Nr;return Jt(yn(Kr,Lr),u,c)}function Zc(u,c,v,x){return u===A||Ho(u,wo[v])&&!In.call(x,v)?c:u}function xh(u,c,v,x,P,Y){return xi(u)&&xi(c)&&(Y.set(c,u),go(u,c,A,xh,Y),Y.delete(c)),u}function g0(u){return Rf(u)?A:u}function Cf(u,c,v,x,P,Y){var ce=v&nt,ye=u.length,Ze=c.length;if(ye!=Ze&&!(ce&&Ze>ye))return!1;var It=Y.get(u),Lt=Y.get(c);if(It&&Lt)return It==c&&Lt==u;var Vt=-1,_r=!0,Lr=v&we?new bu:A;for(Y.set(u,c),Y.set(c,u);++Vt<ye;){var Kr=u[Vt],yn=c[Vt];if(x)var Yr=ce?x(yn,Kr,Vt,c,u,Y):x(Kr,yn,Vt,u,c,Y);if(Yr!==A){if(Yr)continue;_r=!1;break}if(Lr){if(!Al(c,function(xn,Mn){if(!Ds(Lr,Mn)&&(Kr===xn||P(Kr,xn,v,x,Y)))return Lr.push(Mn)})){_r=!1;break}}else if(!(Kr===yn||P(Kr,yn,v,x,Y))){_r=!1;break}}return Y.delete(u),Y.delete(c),_r}function _0(u,c,v,x,P,Y,ce){switch(v){case dt:if(u.byteLength!=c.byteLength||u.byteOffset!=c.byteOffset)return!1;u=u.buffer,c=c.buffer;case qe:return!(u.byteLength!=c.byteLength||!Y(new wl(u),new wl(c)));case Zr:case kr:case Fn:return Ho(+u,+c);case Tn:return u.name==c.name&&u.message==c.message;case On:case Aa:return u==c+"";case Gr:var ye=yu;case cn:var Ze=x&nt;if(ye||(ye=Ml),u.size!=c.size&&!Ze)return!1;var It=ce.get(u);if(It)return It==c;x|=we,ce.set(u,c);var Lt=Cf(ye(u),ye(c),x,P,Y,ce);return ce.delete(u),Lt;case j:if(Cu)return Cu.call(u)==Cu.call(c)}return!1}function y0(u,c,v,x,P,Y){var ce=v&nt,ye=Af(u),Ze=ye.length,It=Af(c),Lt=It.length;if(Ze!=Lt&&!ce)return!1;for(var Vt=Ze;Vt--;){var _r=ye[Vt];if(!(ce?_r in c:In.call(c,_r)))return!1}var Lr=Y.get(u),Kr=Y.get(c);if(Lr&&Kr)return Lr==c&&Kr==u;var yn=!0;Y.set(u,c),Y.set(c,u);for(var Yr=ce;++Vt<Ze;){_r=ye[Vt];var xn=u[_r],Mn=c[_r];if(x)var io=ce?x(Mn,xn,_r,c,u,Y):x(xn,Mn,_r,u,c,Y);if(!(io===A?xn===Mn||P(xn,Mn,v,x,Y):io)){yn=!1;break}Yr||(Yr=_r=="constructor")}if(yn&&!Yr){var Ga=u.constructor,So=c.constructor;Ga!=So&&"constructor"in u&&"constructor"in c&&!(typeof Ga=="function"&&Ga instanceof Ga&&typeof So=="function"&&So instanceof So)&&(yn=!1)}return Y.delete(u),Y.delete(c),yn}function iu(u){return $t(Bt(u,A,Pn),u+"")}function Af(u){return di(u,qi,G)}function Uc(u){return di(u,Ua,ie)}var Gc=zs?function(u){return zs.get(u)}:Ih;function ul(u){for(var c=u.name+"",v=Hs[c],x=In.call(Hs,c)?v.length:0;x--;){var P=v[x],Y=P.func;if(Y==null||Y==u)return P.name}return c}function Es(u){var c=In.call(Z,"placeholder")?Z:u;return c.placeholder}function Wr(){var u=Z.iteratee||k0;return u=u===k0?Mc:u,arguments.length?u(arguments[0],arguments[1]):u}function zc(u,c){var v=u.__data__;return Ce(c)?v[typeof c=="string"?"string":"hash"]:v.map}function Jl(u){for(var c=qi(u),v=c.length;v--;){var x=c[v],P=u[x];c[v]=[x,P,Qt(P)]}return c}function Fu(u,c){var v=uf(u,c);return bc(v)?v:A}function S(u){var c=In.call(u,Qa),v=u[Qa];try{u[Qa]=A;var x=!0}catch(Y){}var P=Eu.call(u);return x&&(c?u[Qa]=v:delete u[Qa]),P}var G=Zs?function(u){return u==null?[]:(u=wn(u),ci(Zs(u),function(c){return Qu.call(u,c)}))}:U0,ie=Zs?function(u){for(var c=[];u;)_a(c,G(u)),u=Lo(u);return c}:U0,De=Ii;(Fl&&De(new Fl(new ArrayBuffer(1)))!=dt||Su&&De(new Su)!=Gr||Nl&&De(Nl.resolve())!=Nn||ts&&De(new ts)!=cn||Us&&De(new Us)!=ri)&&(De=function(u){var c=Ii(u),v=c==zn?u.constructor:A,x=v?Un(v):"";if(x)switch(x){case nh:return dt;case n0:return Gr;case po:return Nn;case rs:return cn;case dd:return ri}return c});function pt(u,c,v){for(var x=-1,P=v.length;++x<P;){var Y=v[x],ce=Y.size;switch(Y.type){case"drop":u+=ce;break;case"dropRight":c-=ce;break;case"take":c=Xi(c,u+ce);break;case"takeRight":u=bi(u,c-ce);break}}return{start:u,end:c}}function ze(u){var c=u.match(zu);return c?c[1].split(Hu):[]}function tt(u,c,v){c=Bo(c,u);for(var x=-1,P=c.length,Y=!1;++x<P;){var ce=An(c[x]);if(!(Y=u!=null&&v(u,ce)))break;u=u[ce]}return Y||++x!=P?Y:(P=u==null?0:u.length,!!P&&Mf(P)&&kt(ce,P)&&(pn(u)||Eo(u)))}function gt(u){var c=u.length,v=new u.constructor(c);return c&&typeof u[0]=="string"&&In.call(u,"index")&&(v.index=u.index,v.input=u.input),v}function bt(u){return typeof u.constructor=="function"&&!yt(u)?Do(Lo(u)):{}}function vt(u,c,v){var x=u.constructor;switch(c){case qe:return nl(u);case Zr:case kr:return new x(+u);case dt:return Lc(u,v);case Nt:case ar:case yr:case Tr:case $r:case Vr:case vr:case ln:case fn:return gs(u,v);case Gr:return new x;case Fn:case Aa:return new x(u);case On:return Dc(u);case cn:return new x;case j:return Xl(u)}}function At(u,c){var v=c.length;if(!v)return u;var x=v-1;return c[x]=(v>1?"& ":"")+c[x],c=c.join(v>2?", ":" "),u.replace(Qi,`{
/* [wrapped with `+c+`] */
`)}function Ft(u){return pn(u)||Eo(u)||!!(Il&&u&&u[Il])}function kt(u,c){var v=typeof u;return c=c==null?be:c,!!c&&(v=="number"||v!="symbol"&&Va.test(u))&&u>-1&&u%1==0&&u<c}function _t(u,c,v){if(!xi(v))return!1;var x=typeof c;return(x=="number"?Ba(v)&&kt(c,v.length):x=="string"&&c in v)?Ho(v[c],u):!1}function Dt(u,c){if(pn(u))return!1;var v=typeof u;return v=="number"||v=="symbol"||v=="boolean"||u==null||Za(u)?!0:_l.test(u)||!ki.test(u)||c!=null&&u in wn(c)}function Ce(u){var c=typeof u;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?u!=="__proto__":u===null}function He(u){var c=ul(u),v=Z[c];if(typeof v!="function"||!(c in Jr.prototype))return!1;if(u===v)return!0;var x=Gc(v);return!!x&&u===x[0]}function wt(u){return!!eh&&eh in u}var tr=vc?Nu:G0;function yt(u){var c=u&&u.constructor,v=typeof c=="function"&&c.prototype||wo;return u===v}function Qt(u){return u===u&&!xi(u)}function Kt(u,c){return function(v){return v==null?!1:v[u]===c&&(c!==A||u in wn(v))}}function br(u){var c=Tf(u,function(x){return v.size===ne&&v.clear(),x}),v=c.cache;return c}function ht(u,c){var v=u[1],x=c[1],P=v|x,Y=P<(Ke|ke|Pe),ce=x==Pe&&v==Re||x==Pe&&v==ve&&u[7].length<=c[8]||x==(Pe|ve)&&c[7].length<=c[8]&&v==Re;if(!(Y||ce))return u;x&Ke&&(u[2]=c[2],P|=v&Ke?0:Oe);var ye=c[3];if(ye){var Ze=u[3];u[3]=Ze?il(Ze,ye,c[4]):ye,u[4]=Ze?Ko(u[3],le):c[4]}return ye=c[5],ye&&(Ze=u[5],u[5]=Ze?$l(Ze,ye,c[6]):ye,u[6]=Ze?Ko(u[5],le):c[6]),ye=c[7],ye&&(u[7]=ye),x&Pe&&(u[8]=u[8]==null?c[8]:Xi(u[8],c[8])),u[9]==null&&(u[9]=c[9]),u[0]=c[0],u[1]=P,u}function st(u){var c=[];if(u!=null)for(var v in wn(u))c.push(v);return c}function or(u){return Eu.call(u)}function Bt(u,c,v){return c=bi(c===A?u.length-1:c,0),function(){for(var x=arguments,P=-1,Y=bi(x.length-c,0),ce=ot(Y);++P<Y;)ce[P]=x[c+P];P=-1;for(var ye=ot(c+1);++P<c;)ye[P]=x[P];return ye[c]=v(ce),Ar(u,this,ye)}}function Ot(u,c){return c.length<2?u:Wn(u,to(c,0,-1))}function Xt(u,c){for(var v=u.length,x=Xi(c.length,v),P=Li(u);x--;){var Y=c[x];u[x]=kt(Y,v)?P[Y]:A}return u}function Yt(u,c){if(!(c==="constructor"&&typeof u[c]=="function")&&c!="__proto__")return u[c]}var Nr=Or(vs),Mr=rh||function(u,c){return m.setTimeout(u,c)},$t=Or(_f);function Jt(u,c,v){var x=c+"";return $t(u,At(x,tn(ze(x),v)))}function Or(u){var c=0,v=0;return function(){var x=t0(),P=St-(x-v);if(v=x,P>0){if(++c>=ut)return arguments[0]}else c=0;return u.apply(A,arguments)}}function Ir(u,c){var v=-1,x=u.length,P=x-1;for(c=c===A?x:c;++v<c;){var Y=Iu(v,P),ce=u[Y];u[Y]=u[v],u[v]=ce}return u.length=c,u}var en=br(function(u){var c=[];return u.charCodeAt(0)===46&&c.push(""),u.replace(oc,function(v,x,P,Y){c.push(P?Y.replace(El,"$1"):x||v)}),c});function An(u){if(typeof u=="string"||Za(u))return u;var c=u+"";return c=="0"&&1/u==-B?"-0":c}function Un(u){if(u!=null){try{return Rl.call(u)}catch(c){}try{return u+""}catch(c){}}return""}function tn(u,c){return un(gr,function(v){var x="_."+v[0];c&v[1]&&!ho(u,x)&&u.push(x)}),u.sort()}function Ti(u){if(u instanceof Jr)return u.clone();var c=new Yi(u.__wrapped__,u.__chain__);return c.__actions__=Li(u.__actions__),c.__index__=u.__index__,c.__values__=u.__values__,c}function jn(u,c,v){(v?_t(u,c,v):c===A)?c=1:c=bi(gn(c),0);var x=u==null?0:u.length;if(!x||c<1)return[];for(var P=0,Y=0,ce=ot(es(x/c));P<x;)ce[Y++]=to(u,P,P+=c);return ce}function Ei(u){for(var c=-1,v=u==null?0:u.length,x=0,P=[];++c<v;){var Y=u[c];Y&&(P[x++]=Y)}return P}function pi(){var u=arguments.length;if(!u)return[];for(var c=ot(u-1),v=arguments[0],x=u;x--;)c[x-1]=arguments[x];return _a(pn(v)?Li(v):[v],hi(c,1))}var Mi=mn(function(u,c){return wi(u)?$s(u,hi(c,1,wi,!0)):[]}),Di=mn(function(u,c){var v=_e(c);return wi(v)&&(v=A),wi(u)?$s(u,hi(c,1,wi,!0),Wr(v,2)):[]}),Zi=mn(function(u,c){var v=_e(c);return wi(v)&&(v=A),wi(u)?$s(u,hi(c,1,wi,!0),A,v):[]});function vi(u,c,v){var x=u==null?0:u.length;return x?(c=v||c===A?1:gn(c),to(u,c<0?0:c,x)):[]}function jr(u,c,v){var x=u==null?0:u.length;return x?(c=v||c===A?1:gn(c),c=x-c,to(u,0,c<0?0:c)):[]}function Oi(u,c){return u&&u.length?Vl(u,Wr(c,3),!0,!0):[]}function bn(u,c){return u&&u.length?Vl(u,Wr(c,3),!0):[]}function Ri(u,c,v,x){var P=u==null?0:u.length;return P?(v&&typeof v!="number"&&_t(u,c,v)&&(v=0,x=P),ru(u,c,v,x)):[]}function Rr(u,c,v){var x=u==null?0:u.length;if(!x)return-1;var P=v==null?0:gn(v);return P<0&&(P=bi(x+P,0)),Ra(u,Wr(c,3),P)}function qr(u,c,v){var x=u==null?0:u.length;if(!x)return-1;var P=x-1;return v!==A&&(P=gn(v),P=v<0?bi(x+P,0):Xi(P,x-1)),Ra(u,Wr(c,3),P,!0)}function Pn(u){var c=u==null?0:u.length;return c?hi(u,1):[]}function mi(u){var c=u==null?0:u.length;return c?hi(u,B):[]}function au(u,c){var v=u==null?0:u.length;return v?(c=c===A?1:gn(c),hi(u,c)):[]}function te(u){for(var c=-1,v=u==null?0:u.length,x={};++c<v;){var P=u[c];x[P[0]]=P[1]}return x}function Ye(u){return u&&u.length?u[0]:A}function Ne(u,c,v){var x=u==null?0:u.length;if(!x)return-1;var P=v==null?0:gn(v);return P<0&&(P=bi(x+P,0)),Po(u,c,P)}function nr(u){var c=u==null?0:u.length;return c?to(u,0,-1):[]}var on=mn(function(u){var c=qn(u,tl);return c.length&&c[0]===u[0]?pf(c):[]}),q=mn(function(u){var c=_e(u),v=qn(u,tl);return c===_e(v)?c=A:v.pop(),v.length&&v[0]===u[0]?pf(v,Wr(c,2)):[]}),N=mn(function(u){var c=_e(u),v=qn(u,tl);return c=typeof c=="function"?c:A,c&&v.pop(),v.length&&v[0]===u[0]?pf(v,A,c):[]});function ue(u,c){return u==null?"":_c.call(u,c)}function _e(u){var c=u==null?0:u.length;return c?u[c-1]:A}function We(u,c,v){var x=u==null?0:u.length;if(!x)return-1;var P=x;return v!==A&&(P=gn(v),P=P<0?bi(x+P,0):Xi(P,x-1)),c===c?Ol(u,c,P):Ra(u,gu,P,!0)}function de(u,c){return u&&u.length?wu(u,gn(c)):A}var fe=mn(me);function me(u,c){return u&&u.length&&c&&c.length?ps(u,c):u}function H(u,c,v){return u&&u.length&&c&&c.length?ps(u,c,Wr(v,2)):u}function ae(u,c,v){return u&&u.length&&c&&c.length?ps(u,c,A,v):u}var J=iu(function(u,c){var v=u==null?0:u.length,x=Tu(u,c);return Ki(u,qn(c,function(P){return kt(P,v)?+P:P}).sort(_s)),x});function Se(u,c){var v=[];if(!(u&&u.length))return v;var x=-1,P=[],Y=u.length;for(c=Wr(c,3);++x<Y;){var ce=u[x];c(ce,x,u)&&(v.push(ce),P.push(x))}return Ki(u,P),v}function Le(u){return u==null?u:xu.call(u)}function xt(u,c,v){var x=u==null?0:u.length;return x?(v&&typeof v!="number"&&_t(u,c,v)?(c=0,v=x):(c=c==null?0:gn(c),v=v===A?x:gn(v)),to(u,c,v)):[]}function Ht(u,c){return Pc(u,c)}function jt(u,c,v){return wc(u,c,Wr(v,2))}function qt(u,c){var v=u==null?0:u.length;if(v){var x=Pc(u,c);if(x<v&&Ho(u[x],c))return x}return-1}function Gt(u,c){return Pc(u,c,!0)}function fr(u,c,v){return wc(u,c,Wr(v,2),!0)}function rr(u,c){var v=u==null?0:u.length;if(v){var x=Pc(u,c,!0)-1;if(Ho(u[x],c))return x}return-1}function ur(u){return u&&u.length?jl(u):[]}function sr(u,c){return u&&u.length?jl(u,Wr(c,2)):[]}function hr(u){var c=u==null?0:u.length;return c?to(u,1,c):[]}function Pr(u,c,v){return u&&u.length?(c=v||c===A?1:gn(c),to(u,0,c<0?0:c)):[]}function Gn(u,c,v){var x=u==null?0:u.length;return x?(c=v||c===A?1:gn(c),c=x-c,to(u,c<0?0:c,x)):[]}function Pi(u,c){return u&&u.length?Vl(u,Wr(c,3),!1,!0):[]}function Go(u,c){return u&&u.length?Vl(u,Wr(c,3)):[]}var yo=mn(function(u){return Lu(hi(u,1,wi,!0))}),ou=mn(function(u){var c=_e(u);return wi(c)&&(c=A),Lu(hi(u,1,wi,!0),Wr(c,2))}),na=mn(function(u){var c=_e(u);return c=typeof c=="function"?c:A,Lu(hi(u,1,wi,!0),A,c)});function zo(u){return u&&u.length?Lu(u):[]}function wr(u,c){return u&&u.length?Lu(u,Wr(c,2)):[]}function Xr(u,c){return c=typeof c=="function"?c:A,u&&u.length?Lu(u,A,c):[]}function Sa(u){if(!(u&&u.length))return[];var c=0;return u=ci(u,function(v){if(wi(v))return c=bi(v.length,c),!0}),lc(c,function(v){return qn(u,Is(v))})}function Sh(u,c){if(!(u&&u.length))return[];var v=Sa(u);return c==null?v:qn(v,function(x){return Ar(c,A,x)})}var bv=mn(function(u,c){return wi(u)?$s(u,c):[]}),Cg=mn(function(u){return el(ci(u,wi))}),Ag=mn(function(u){var c=_e(u);return wi(c)&&(c=A),el(ci(u,wi),Wr(c,2))}),bg=mn(function(u){var c=_e(u);return c=typeof c=="function"?c:A,el(ci(u,wi),A,c)}),Tg=mn(Sa);function Mg(u,c){return ms(u||[],c||[],Jo)}function Og(u,c){return ms(u||[],c||[],Hl)}var Rg=mn(function(u){var c=u.length,v=c>1?u[c-1]:A;return v=typeof v=="function"?(u.pop(),v):A,Sh(u,v)});function Tv(u){var c=Z(u);return c.__chain__=!0,c}function Pg(u,c){return c(u),u}function E0(u,c){return c(u)}var wg=iu(function(u){var c=u.length,v=c?u[0]:0,x=this.__wrapped__,P=function(Y){return Tu(Y,u)};return c>1||this.__actions__.length||!(x instanceof Jr)||!kt(v)?this.thru(P):(x=x.slice(v,+v+(c?1:0)),x.__actions__.push({func:E0,args:[P],thisArg:A}),new Yi(x,this.__chain__).thru(function(Y){return c&&!Y.length&&Y.push(A),Y}))});function Ig(){return Tv(this)}function Lg(){return new Yi(this.value(),this.__chain__)}function Dg(){this.__values__===A&&(this.__values__=M0(this.value()));var u=this.__index__>=this.__values__.length,c=u?A:this.__values__[this.__index__++];return{done:u,value:c}}function Fg(){return this}function Ng(u){for(var c,v=this;v instanceof Fo;){var x=Ti(v);x.__index__=0,x.__values__=A,c?P.__wrapped__=x:c=x;var P=x;v=v.__wrapped__}return P.__wrapped__=u,c}function kg(){var u=this.__wrapped__;if(u instanceof Jr){var c=u;return this.__actions__.length&&(c=new Jr(this)),c=c.reverse(),c.__actions__.push({func:E0,args:[Le],thisArg:A}),new Yi(c,this.__chain__)}return this.thru(Le)}function Bg(){return _h(this.__wrapped__,this.__actions__)}var Zg=Fc(function(u,c,v){In.call(u,v)?++u[v]:eu(u,v,1)});function Ug(u,c,v){var x=pn(u)?Oa:Na;return v&&_t(u,c,v)&&(c=A),x(u,Wr(c,3))}function Gg(u,c){var v=pn(u)?ci:Cc;return v(u,Wr(c,3))}var zg=Sf(Rr),Hg=Sf(qr);function jg(u,c){return hi(x0(u,c),1)}function pd(u,c){return hi(x0(u,c),B)}function Vg(u,c,v){return v=v===A?1:gn(v),hi(x0(u,c),v)}function Mv(u,c){var v=pn(u)?un:Fa;return v(u,Wr(c,3))}function Ov(u,c){var v=pn(u)?kn:Sc;return v(u,Wr(c,3))}var Wg=Fc(function(u,c,v){In.call(u,v)?u[v].push(c):eu(u,v,[c])});function Xg(u,c,v,x){u=Ba(u)?u:Wc(u),v=v&&!x?gn(v):0;var P=u.length;return v<0&&(v=bi(P+v,0)),Pf(u)?v<=P&&u.indexOf(c,v)>-1:!!P&&Po(u,c,v)>-1}var Yg=mn(function(u,c,v){var x=-1,P=typeof c=="function",Y=Ba(u)?ot(u.length):[];return Fa(u,function(ce){Y[++x]=P?Ar(c,ce,v):Mu(ce,c,v)}),Y}),$g=Fc(function(u,c,v){eu(u,v,c)});function x0(u,c){var v=pn(u)?qn:Pu;return v(u,Wr(c,3))}function Kg(u,c,v,x){return u==null?[]:(pn(c)||(c=c==null?[]:[c]),v=x?A:v,pn(v)||(v=v==null?[]:[v]),zl(u,c,v))}var qg=Fc(function(u,c,v){u[v?0:1].push(c)},function(){return[[],[]]});function Qg(u,c,v){var x=pn(u)?ws:ta,P=arguments.length<3;return x(u,Wr(c,4),v,P,Fa)}function Jg(u,c,v){var x=pn(u)?uc:ta,P=arguments.length<3;return x(u,Wr(c,4),v,P,Sc)}function e_(u,c){var v=pn(u)?ci:Cc;return v(u,jc(Wr(c,3)))}function S0(u){var c=pn(u)?as:mf;return c(u)}function Rv(u,c,v){(v?_t(u,c,v):c===A)?c=1:c=gn(c);var x=pn(u)?ch:gf;return x(u,c)}function vd(u){var c=pn(u)?ai:ph;return c(u)}function md(u){if(u==null)return 0;if(Ba(u))return Pf(u)?Ku(u):u.length;var c=De(u);return c==Gr||c==cn?u.size:fs(u).length}function sl(u,c,v){var x=pn(u)?Al:vh;return v&&_t(u,c,v)&&(c=A),x(u,Wr(c,3))}var ec=mn(function(u,c){if(u==null)return[];var v=c.length;return v>1&&_t(u,c[0],c[1])?c=[]:v>2&&_t(c[0],c[1],c[2])&&(c=[c[0]]),zl(u,hi(c,1),[])}),bf=Jh||function(){return m.Date.now()};function gd(u,c){if(typeof c!="function")throw new Cn(U);return u=gn(u),function(){if(--u<1)return c.apply(this,arguments)}}function C0(u,c,v){return c=v?A:c,c=u&&c==null?u.length:c,Uo(u,Pe,A,A,A,A,c)}function Ch(u,c){var v;if(typeof c!="function")throw new Cn(U);return u=gn(u),function(){return--u>0&&(v=c.apply(this,arguments)),u<=1&&(c=A),v}}var Ah=mn(function(u,c,v){var x=Ke;if(v.length){var P=Ko(v,Es(Ah));x|=O}return Uo(u,x,c,v,P)}),_d=mn(function(u,c,v){var x=Ke|ke;if(v.length){var P=Ko(v,Es(_d));x|=O}return Uo(c,x,u,v,P)});function yd(u,c,v){c=v?A:c;var x=Uo(u,Re,A,A,A,A,A,c);return x.placeholder=yd.placeholder,x}function Ed(u,c,v){c=v?A:c;var x=Uo(u,Je,A,A,A,A,A,c);return x.placeholder=Ed.placeholder,x}function Hc(u,c,v){var x,P,Y,ce,ye,Ze,It=0,Lt=!1,Vt=!1,_r=!0;if(typeof u!="function")throw new Cn(U);c=xo(c)||0,xi(v)&&(Lt=!!v.leading,Vt="maxWait"in v,Y=Vt?bi(xo(v.maxWait)||0,c):Y,_r="trailing"in v?!!v.trailing:_r);function Lr(Fi){var uu=x,bs=P;return x=P=A,It=Fi,ce=u.apply(bs,uu),ce}function Kr(Fi){return It=Fi,ye=Mr(xn,c),Lt?Lr(Fi):ce}function yn(Fi){var uu=Fi-Ze,bs=Fi-It,z0=c-uu;return Vt?Xi(z0,Y-bs):z0}function Yr(Fi){var uu=Fi-Ze,bs=Fi-It;return Ze===A||uu>=c||uu<0||Vt&&bs>=Y}function xn(){var Fi=bf();if(Yr(Fi))return Mn(Fi);ye=Mr(xn,yn(Fi))}function Mn(Fi){return ye=A,_r&&x?Lr(Fi):(x=P=A,ce)}function io(){ye!==A&&Wl(ye),It=0,x=Ze=P=ye=A}function Ga(){return ye===A?ce:Mn(bf())}function So(){var Fi=bf(),uu=Yr(Fi);if(x=arguments,P=this,Ze=Fi,uu){if(ye===A)return Kr(Ze);if(Vt)return Wl(ye),ye=Mr(xn,c),Lr(Ze)}return ye===A&&(ye=Mr(xn,c)),ce}return So.cancel=io,So.flush=Ga,So}var la=mn(function(u,c){return us(u,1,c)}),xd=mn(function(u,c,v){return us(u,xo(c)||0,v)});function Sd(u){return Uo(u,Be)}function Tf(u,c){if(typeof u!="function"||c!=null&&typeof c!="function")throw new Cn(U);var v=function(){var x=arguments,P=c?c.apply(this,x):x[0],Y=v.cache;if(Y.has(P))return Y.get(P);var ce=u.apply(this,x);return v.cache=Y.set(P,ce)||Y,ce};return v.cache=new(Tf.Cache||eo),v}Tf.Cache=eo;function jc(u){if(typeof u!="function")throw new Cn(U);return function(){var c=arguments;switch(c.length){case 0:return!u.call(this);case 1:return!u.call(this,c[0]);case 2:return!u.call(this,c[0],c[1]);case 3:return!u.call(this,c[0],c[1],c[2])}return!u.apply(this,c)}}function Cd(u){return Ch(2,u)}var Pv=Ic(function(u,c){c=c.length==1&&pn(c[0])?qn(c[0],Pa(Wr())):qn(hi(c,1),Pa(Wr()));var v=c.length;return mn(function(x){for(var P=-1,Y=Xi(x.length,v);++P<Y;)x[P]=c[P].call(this,x[P]);return Ar(u,this,x)})}),A0=mn(function(u,c){var v=Ko(c,Es(A0));return Uo(u,O,A,c,v)}),Ad=mn(function(u,c){var v=Ko(c,Es(Ad));return Uo(u,at,A,c,v)}),wv=iu(function(u,c){return Uo(u,ve,A,A,A,c)});function ca(u,c){if(typeof u!="function")throw new Cn(U);return c=c===A?c:gn(c),mn(u,c)}function Iv(u,c){if(typeof u!="function")throw new Cn(U);return c=c==null?0:bi(gn(c),0),mn(function(v){var x=v[c],P=_o(v,0,c);return x&&_a(P,x),Ar(u,this,P)})}function Ln(u,c,v){var x=!0,P=!0;if(typeof u!="function")throw new Cn(U);return xi(v)&&(x="leading"in v?!!v.leading:x,P="trailing"in v?!!v.trailing:P),Hc(u,c,{leading:x,maxWait:c,trailing:P})}function Lv(u){return C0(u,1)}function Dv(u,c){return A0(rl(c),u)}function Fv(){if(!arguments.length)return[];var u=arguments[0];return pn(u)?u:[u]}function M(u){return $i(u,it)}function bd(u,c){return c=typeof c=="function"?c:A,$i(u,it,c)}function Td(u){return $i(u,pe|it)}function Md(u,c){return c=typeof c=="function"?c:A,$i(u,pe|it,c)}function Od(u,c){return c==null||fh(u,c,qi(c))}function Ho(u,c){return u===c||u!==u&&c!==c}var Rd=ui(Zl),Pd=ui(function(u,c){return u>=c}),Eo=Ea(function(){return arguments}())?Ea:function(u){return Ai(u)&&In.call(u,"callee")&&!Qu.call(u,"callee")},pn=ot.isArray,wd=Me?Pa(Me):p0;function Ba(u){return u!=null&&Mf(u.length)&&!Nu(u)}function wi(u){return Ai(u)&&Ba(u)}function Id(u){return u===!0||u===!1||Ai(u)&&Ii(u)==Zr}var xs=e0||G0,bh=Ie?Pa(Ie):dh;function Nv(u){return Ai(u)&&u.nodeType===1&&!Rf(u)}function kv(u){if(u==null)return!0;if(Ba(u)&&(pn(u)||typeof u=="string"||typeof u.splice=="function"||xs(u)||rc(u)||Eo(u)))return!u.length;var c=De(u);if(c==Gr||c==cn)return!u.size;if(yt(u))return!fs(u).length;for(var v in u)if(In.call(u,v))return!1;return!0}function Ld(u,c){return Ul(u,c)}function Dd(u,c,v){v=typeof v=="function"?v:A;var x=v?v(u,c):A;return x===A?Ul(u,c,A,v):!!x}function Th(u){if(!Ai(u))return!1;var c=Ii(u);return c==Tn||c==Jn||typeof u.message=="string"&&typeof u.name=="string"&&!Rf(u)}function Fd(u){return typeof u=="number"&&Dl(u)}function Nu(u){if(!xi(u))return!1;var c=Ii(u);return c==rn||c==En||c==Br||c==_n}function Vc(u){return typeof u=="number"&&u==gn(u)}function Mf(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=be}function xi(u){var c=typeof u;return u!=null&&(c=="object"||c=="function")}function Ai(u){return u!=null&&typeof u=="object"}var Nd=Ct?Pa(Ct):Gl;function Bv(u,c){return u===c||cs(u,c,Jl(c))}function kd(u,c,v){return v=typeof v=="function"?v:A,cs(u,c,Jl(c),v)}function Zv(u){return Bd(u)&&u!=+u}function Of(u){if(tr(u))throw new an(L);return bc(u)}function Uv(u){return u===null}function Ss(u){return u==null}function Bd(u){return typeof u=="number"||Ai(u)&&Ii(u)==Fn}function Rf(u){if(!Ai(u)||Ii(u)!=zn)return!1;var c=Lo(u);if(c===null)return!0;var v=In.call(c,"constructor")&&c.constructor;return typeof v=="function"&&v instanceof v&&Rl.call(v)==qa}var tc=Pt?Pa(Pt):Tc;function Zd(u){return Vc(u)&&u>=-be&&u<=be}var b0=dr?Pa(dr):Qs;function Pf(u){return typeof u=="string"||!pn(u)&&Ai(u)&&Ii(u)==Aa}function Za(u){return typeof u=="symbol"||Ai(u)&&Ii(u)==j}var rc=zr?Pa(zr):Ou;function Ud(u){return u===A}function T0(u){return Ai(u)&&De(u)==ri}function t_(u){return Ai(u)&&Ii(u)==fu}var Gv=ui(Ru),zv=ui(function(u,c){return u<=c});function M0(u){if(!u)return[];if(Ba(u))return Pf(u)?wa(u):Li(u);if(Ju&&u[Ju])return Qf(u[Ju]());var c=De(u),v=c==Gr?yu:c==cn?Ml:Wc;return v(u)}function Cs(u){if(!u)return u===0?u:0;if(u=xo(u),u===B||u===-B){var c=u<0?-1:1;return c*Te}return u===u?u:0}function gn(u){var c=Cs(u),v=c%1;return c===c?v?c-v:c:0}function O0(u){return u?tu(gn(u),0,$e):0}function xo(u){if(typeof u=="number")return u;if(Za(u))return Ge;if(xi(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=xi(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=cc(u);var v=xl.test(u);return v||Rn.test(u)?fo(u.slice(2),v?2:8):Wu.test(u)?Ge:+u}function R0(u){return ra(u,Ua(u))}function Gd(u){return u?tu(gn(u),-be,be):u===0?u:0}function Vn(u){return u==null?"":ka(u)}var zd=al(function(u,c){if(yt(c)||Ba(c)){ra(c,qi(c),u);return}for(var v in c)In.call(c,v)&&Jo(u,v,c[v])}),P0=al(function(u,c){ra(c,Ua(c),u)}),wf=al(function(u,c,v,x){ra(c,Ua(c),u,x)}),Hd=al(function(u,c,v,x){ra(c,qi(c),u,x)}),jd=iu(Tu);function Vd(u,c){var v=Do(u);return c==null?v:hf(v,c)}var Wd=mn(function(u,c){u=wn(u);var v=-1,x=c.length,P=x>2?c[2]:A;for(P&&_t(c[0],c[1],P)&&(x=1);++v<x;)for(var Y=c[v],ce=Ua(Y),ye=-1,Ze=ce.length;++ye<Ze;){var It=ce[ye],Lt=u[It];(Lt===A||Ho(Lt,wo[It])&&!In.call(u,It))&&(u[It]=Y[It])}return u}),Xd=mn(function(u){return u.push(A,xh),Ar(sp,A,u)});function Yd(u,c){return Yf(u,Wr(c,3),vo)}function $d(u,c){return Yf(u,Wr(c,3),Ac)}function Kd(u,c){return u==null?u:qs(u,Wr(c,3),Ua)}function fa(u,c){return u==null?u:df(u,Wr(c,3),Ua)}function qd(u,c){return u&&vo(u,Wr(c,3))}function Qd(u,c){return u&&Ac(u,Wr(c,3))}function Jd(u){return u==null?[]:Bl(u,qi(u))}function ep(u){return u==null?[]:Bl(u,Ua(u))}function Mh(u,c,v){var x=u==null?A:Wn(u,c);return x===A?v:x}function tp(u,c){return u!=null&&tt(u,c,ss)}function Oh(u,c){return u!=null&&tt(u,c,h0)}var rp=Du(function(u,c,v){c!=null&&typeof c.toString!="function"&&(c=Eu.call(c)),u[c]=v},Ph(no)),np=Du(function(u,c,v){c!=null&&typeof c.toString!="function"&&(c=Eu.call(c)),In.call(u,c)?u[c].push(v):u[c]=[v]},Wr),ip=mn(Mu);function qi(u){return Ba(u)?Ys(u):fs(u)}function Ua(u){return Ba(u)?Ys(u,!0):mo(u)}function ap(u,c){var v={};return c=Wr(c,3),vo(u,function(x,P,Y){eu(v,c(x,P,Y),x)}),v}function op(u,c){var v={};return c=Wr(c,3),vo(u,function(x,P,Y){eu(v,P,c(x,P,Y))}),v}var up=al(function(u,c,v){go(u,c,v)}),sp=al(function(u,c,v,x){go(u,c,v,x)}),Hv=iu(function(u,c){var v={};if(u==null)return v;var x=!1;c=qn(c,function(Y){return Y=Bo(Y,u),x||(x=Y.length>1),Y}),ra(u,Uc(u),v),x&&(v=$i(v,pe|xe|it,g0));for(var P=c.length;P--;)yf(v,c[P]);return v});function jv(u,c){return w0(u,jc(Wr(c)))}var Vv=iu(function(u,c){return u==null?{}:Oc(u,c)});function w0(u,c){if(u==null)return{};var v=qn(Uc(u),function(x){return[x]});return c=Wr(c),Js(u,v,function(x,P){return c(x,P[0])})}function Wv(u,c,v){c=Bo(c,u);var x=-1,P=c.length;for(P||(P=1,u=A);++x<P;){var Y=u==null?A:u[An(c[x])];Y===A&&(x=P,Y=v),u=Nu(Y)?Y.call(u):Y}return u}function Xv(u,c,v){return u==null?u:Hl(u,c,v)}function lp(u,c,v,x){return x=typeof x=="function"?x:A,u==null?u:Hl(u,c,v,x)}var I0=Bc(qi),L0=Bc(Ua);function cp(u,c,v){var x=pn(u),P=x||xs(u)||rc(u);if(c=Wr(c,4),v==null){var Y=u&&u.constructor;P?v=x?new Y:[]:xi(u)?v=Nu(Y)?Do(Lo(u)):{}:v={}}return(P?un:vo)(u,function(ce,ye,Ze){return c(v,ce,ye,Ze)}),v}function If(u,c){return u==null?!0:yf(u,c)}function fp(u,c,v){return u==null?u:gh(u,c,rl(v))}function Yv(u,c,v,x){return x=typeof x=="function"?x:A,u==null?u:gh(u,c,rl(v),x)}function Wc(u){return u==null?[]:Kf(u,qi(u))}function $v(u){return u==null?[]:Kf(u,Ua(u))}function Kv(u,c,v){return v===A&&(v=c,c=A),v!==A&&(v=xo(v),v=v===v?v:0),c!==A&&(c=xo(c),c=c===c?c:0),tu(xo(u),c,v)}function qv(u,c,v){return c=Cs(c),v===A?(v=c,c=0):v=Cs(v),u=xo(u),hh(u,c,v)}function Qv(u,c,v){if(v&&typeof v!="boolean"&&_t(u,c,v)&&(c=v=A),v===A&&(typeof c=="boolean"?(v=c,c=A):typeof u=="boolean"&&(v=u,u=A)),u===A&&c===A?(u=0,c=1):(u=Cs(u),c===A?(c=u,u=0):c=Cs(c)),u>c){var x=u;u=c,c=x}if(v||u%1||c%1){var P=r0();return Xi(u+P*(c-u+Cl("1e-"+((P+"").length-1))),c)}return Iu(u,c)}var Jv=ys(function(u,c,v){return c=c.toLowerCase(),u+(v?hp(c):c)});function hp(u){return F0(Vn(u).toLowerCase())}function dp(u){return u=Vn(u),u&&u.replace(pa,Fs).replace(ga,"")}function em(u,c,v){u=Vn(u),c=ka(c);var x=u.length;v=v===A?x:tu(gn(v),0,x);var P=v;return v-=c.length,v>=0&&u.slice(v,P)==c}function tm(u){return u=Vn(u),u&&To.test(u)?u.replace(lo,of):u}function rm(u){return u=Vn(u),u&&yl.test(u)?u.replace(Vo,"\\$&"):u}var nm=ys(function(u,c,v){return u+(v?"-":"")+c.toLowerCase()}),im=ys(function(u,c,v){return u+(v?" ":"")+c.toLowerCase()}),am=Qe("toLowerCase");function om(u,c,v){u=Vn(u),c=gn(c);var x=c?Ku(u):0;if(!c||x>=c)return u;var P=(c-x)/2;return ol(gc(P),v)+u+ol(es(P),v)}function um(u,c,v){u=Vn(u),c=gn(c);var x=c?Ku(u):0;return c&&x<c?u+ol(c-x,v):u}function sm(u,c,v){u=Vn(u),c=gn(c);var x=c?Ku(u):0;return c&&x<c?ol(c-x,v)+u:u}function nc(u,c,v){return v||c==null?c=0:c&&(c=+c),Ia(Vn(u).replace(ja,""),c||0)}function ll(u,c,v){return(v?_t(u,c,v):c===A)?c=1:c=gn(c),Rc(Vn(u),c)}function pp(){var u=arguments,c=Vn(u[0]);return u.length<3?c:c.replace(u[1],u[2])}var vp=ys(function(u,c,v){return u+(v?"_":"")+c.toLowerCase()});function Rh(u,c,v){return v&&typeof v!="number"&&_t(u,c,v)&&(c=v=A),v=v===A?$e:v>>>0,v?(u=Vn(u),u&&(typeof c=="string"||c!=null&&!tc(c))&&(c=ka(c),!c&&_u(u))?_o(wa(u),0,v):u.split(c,v)):[]}var mp=ys(function(u,c,v){return u+(v?" ":"")+F0(c)});function gp(u,c,v){return u=Vn(u),v=v==null?0:tu(gn(v),0,u.length),c=ka(c),u.slice(v,v+c.length)==c}function lm(u,c,v){var x=Z.templateSettings;v&&_t(u,c,v)&&(c=A),u=Vn(u),c=wf({},c,x,Zc);var P=wf({},c.imports,x.imports,Zc),Y=qi(P),ce=Kf(P,Y),ye,Ze,It=0,Lt=c.interpolate||va,Vt="__p += '",_r=ks((c.escape||va).source+"|"+Lt.source+"|"+(Lt===du?ju:va).source+"|"+(c.evaluate||va).source+"|$","g"),Lr="//# sourceURL="+(In.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ka+"]")+`
`;u.replace(_r,function(Yr,xn,Mn,io,Ga,So){return Mn||(Mn=io),Vt+=u.slice(It,So).replace(nn,hc),xn&&(ye=!0,Vt+=`' +
__e(`+xn+`) +
'`),Ga&&(Ze=!0,Vt+=`';
`+Ga+`;
__p += '`),Mn&&(Vt+=`' +
((__t = (`+Mn+`)) == null ? '' : __t) +
'`),It=So+Yr.length,Yr}),Vt+=`';
`;var Kr=In.call(c,"variable")&&c.variable;if(!Kr)Vt=`with (obj) {
`+Vt+`
}
`;else if($n.test(Kr))throw new an(re);Vt=(Ze?Vt.replace(Ni,""):Vt).replace(hu,"$1").replace(da,"$1;"),Vt="function("+(Kr||"obj")+`) {
`+(Kr?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ye?", __e = _.escape":"")+(Ze?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Vt+`return __p
}`;var yn=Sp(function(){return Bn(Y,Lr+"return "+Vt).apply(A,ce)});if(yn.source=Vt,Th(yn))throw yn;return yn}function cm(u){return Vn(u).toLowerCase()}function fm(u){return Vn(u).toUpperCase()}function _p(u,c,v){if(u=Vn(u),u&&(v||c===A))return cc(u);if(!u||!(c=ka(c)))return u;var x=wa(u),P=wa(c),Y=fc(x,P),ce=nf(x,P)+1;return _o(x,Y,ce).join("")}function yp(u,c,v){if(u=Vn(u),u&&(v||c===A))return u.slice(0,Ns(u)+1);if(!u||!(c=ka(c)))return u;var x=wa(u),P=nf(x,wa(c))+1;return _o(x,0,P).join("")}function Ep(u,c,v){if(u=Vn(u),u&&(v||c===A))return u.replace(ja,"");if(!u||!(c=ka(c)))return u;var x=wa(u),P=fc(x,wa(c));return _o(x,P).join("")}function D0(u,c){var v=Ae,x=ct;if(xi(c)){var P="separator"in c?c.separator:P;v="length"in c?gn(c.length):v,x="omission"in c?ka(c.omission):x}u=Vn(u);var Y=u.length;if(_u(u)){var ce=wa(u);Y=ce.length}if(v>=Y)return u;var ye=v-Ku(x);if(ye<1)return x;var Ze=ce?_o(ce,0,ye).join(""):u.slice(0,ye);if(P===A)return Ze+x;if(ce&&(ye+=Ze.length-ye),tc(P)){if(u.slice(ye).search(P)){var It,Lt=Ze;for(P.global||(P=ks(P.source,Vn(Vu.exec(P))+"g")),P.lastIndex=0;It=P.exec(Lt);)var Vt=It.index;Ze=Ze.slice(0,Vt===A?ye:Vt)}}else if(u.indexOf(ka(P),ye)!=ye){var _r=Ze.lastIndexOf(P);_r>-1&&(Ze=Ze.slice(0,_r))}return Ze+x}function xp(u){return u=Vn(u),u&&gl.test(u)?u.replace(ni,ld):u}var hm=ys(function(u,c,v){return u+(v?" ":"")+c.toUpperCase()}),F0=Qe("toUpperCase");function N0(u,c,v){return u=Vn(u),c=v?A:c,c===A?qf(u)?Jf(u):Xf(u):u.match(c)||[]}var Sp=mn(function(u,c){try{return Ar(u,A,c)}catch(v){return Th(v)?v:new an(v)}}),Cp=iu(function(u,c){return un(c,function(v){v=An(v),eu(u,v,Ah(u[v],u))}),u});function Ap(u){var c=u==null?0:u.length,v=Wr();return u=c?qn(u,function(x){if(typeof x[1]!="function")throw new Cn(U);return[v(x[0]),x[1]]}):[],mn(function(x){for(var P=-1;++P<c;){var Y=u[P];if(Ar(Y[0],this,x))return Ar(Y[1],this,x)}})}function bp(u){return os($i(u,pe))}function Ph(u){return function(){return u}}function dm(u,c){return u==null||u!==u?c:u}var pm=ro(),vm=ro(!0);function no(u){return u}function k0(u){return Mc(typeof u=="function"?u:$i(u,pe))}function mm(u){return hs($i(u,pe))}function gm(u,c){return ua(u,$i(c,pe))}var Tp=mn(function(u,c){return function(v){return Mu(v,u,c)}}),Mp=mn(function(u,c){return function(v){return Mu(u,v,c)}});function wh(u,c,v){var x=qi(c),P=Bl(c,x);v==null&&!(xi(c)&&(P.length||!x.length))&&(v=c,c=u,u=this,P=Bl(c,qi(c)));var Y=!(xi(v)&&"chain"in v)||!!v.chain,ce=Nu(u);return un(P,function(ye){var Ze=c[ye];u[ye]=Ze,ce&&(u.prototype[ye]=function(){var It=this.__chain__;if(Y||It){var Lt=u(this.__wrapped__),Vt=Lt.__actions__=Li(this.__actions__);return Vt.push({func:Ze,args:arguments,thisArg:u}),Lt.__chain__=It,Lt}return Ze.apply(u,_a([this.value()],arguments))})}),u}function B0(){return m._===this&&(m._=Pl),this}function Ih(){}function Op(u){return u=gn(u),mn(function(c){return wu(c,u)})}var Lf=Nc(qn),_m=Nc(Oa),As=Nc(Al);function Z0(u){return Dt(u)?Is(An(u)):vf(u)}function Rp(u){return function(c){return u==null?A:Wn(u,c)}}var Pp=kc(),wp=kc(!0);function U0(){return[]}function G0(){return!1}function ym(){return{}}function Em(){return""}function xm(){return!0}function Ip(u,c){if(u=gn(u),u<1||u>be)return[];var v=$e,x=Xi(u,$e);c=Wr(c),u-=$e;for(var P=lc(x,c);++v<u;)c(v);return P}function Lp(u){return pn(u)?qn(u,An):Za(u)?[u]:Li(en(Vn(u)))}function Dp(u){var c=++Bs;return Vn(u)+c}var Fp=sa(function(u,c){return u+c},0),Sm=oi("ceil"),Cm=sa(function(u,c){return u/c},1),Am=oi("floor");function bm(u){return u&&u.length?Ks(u,no,Zl):A}function Tm(u,c){return u&&u.length?Ks(u,Wr(c,2),Zl):A}function Np(u){return tf(u,no)}function kp(u,c){return tf(u,Wr(c,2))}function Bp(u){return u&&u.length?Ks(u,no,Ru):A}function Zp(u,c){return u&&u.length?Ks(u,Wr(c,2),Ru):A}var Mm=sa(function(u,c){return u*c},1),Om=oi("round"),Rm=sa(function(u,c){return u-c},0);function Pm(u){return u&&u.length?Tl(u,no):0}function wm(u,c){return u&&u.length?Tl(u,Wr(c,2)):0}return Z.after=gd,Z.ary=C0,Z.assign=zd,Z.assignIn=P0,Z.assignInWith=wf,Z.assignWith=Hd,Z.at=jd,Z.before=Ch,Z.bind=Ah,Z.bindAll=Cp,Z.bindKey=_d,Z.castArray=Fv,Z.chain=Tv,Z.chunk=jn,Z.compact=Ei,Z.concat=pi,Z.cond=Ap,Z.conforms=bp,Z.constant=Ph,Z.countBy=Zg,Z.create=Vd,Z.curry=yd,Z.curryRight=Ed,Z.debounce=Hc,Z.defaults=Wd,Z.defaultsDeep=Xd,Z.defer=la,Z.delay=xd,Z.difference=Mi,Z.differenceBy=Di,Z.differenceWith=Zi,Z.drop=vi,Z.dropRight=jr,Z.dropRightWhile=Oi,Z.dropWhile=bn,Z.fill=Ri,Z.filter=Gg,Z.flatMap=jg,Z.flatMapDeep=pd,Z.flatMapDepth=Vg,Z.flatten=Pn,Z.flattenDeep=mi,Z.flattenDepth=au,Z.flip=Sd,Z.flow=pm,Z.flowRight=vm,Z.fromPairs=te,Z.functions=Jd,Z.functionsIn=ep,Z.groupBy=Wg,Z.initial=nr,Z.intersection=on,Z.intersectionBy=q,Z.intersectionWith=N,Z.invert=rp,Z.invertBy=np,Z.invokeMap=Yg,Z.iteratee=k0,Z.keyBy=$g,Z.keys=qi,Z.keysIn=Ua,Z.map=x0,Z.mapKeys=ap,Z.mapValues=op,Z.matches=mm,Z.matchesProperty=gm,Z.memoize=Tf,Z.merge=up,Z.mergeWith=sp,Z.method=Tp,Z.methodOf=Mp,Z.mixin=wh,Z.negate=jc,Z.nthArg=Op,Z.omit=Hv,Z.omitBy=jv,Z.once=Cd,Z.orderBy=Kg,Z.over=Lf,Z.overArgs=Pv,Z.overEvery=_m,Z.overSome=As,Z.partial=A0,Z.partialRight=Ad,Z.partition=qg,Z.pick=Vv,Z.pickBy=w0,Z.property=Z0,Z.propertyOf=Rp,Z.pull=fe,Z.pullAll=me,Z.pullAllBy=H,Z.pullAllWith=ae,Z.pullAt=J,Z.range=Pp,Z.rangeRight=wp,Z.rearg=wv,Z.reject=e_,Z.remove=Se,Z.rest=ca,Z.reverse=Le,Z.sampleSize=Rv,Z.set=Xv,Z.setWith=lp,Z.shuffle=vd,Z.slice=xt,Z.sortBy=ec,Z.sortedUniq=ur,Z.sortedUniqBy=sr,Z.split=Rh,Z.spread=Iv,Z.tail=hr,Z.take=Pr,Z.takeRight=Gn,Z.takeRightWhile=Pi,Z.takeWhile=Go,Z.tap=Pg,Z.throttle=Ln,Z.thru=E0,Z.toArray=M0,Z.toPairs=I0,Z.toPairsIn=L0,Z.toPath=Lp,Z.toPlainObject=R0,Z.transform=cp,Z.unary=Lv,Z.union=yo,Z.unionBy=ou,Z.unionWith=na,Z.uniq=zo,Z.uniqBy=wr,Z.uniqWith=Xr,Z.unset=If,Z.unzip=Sa,Z.unzipWith=Sh,Z.update=fp,Z.updateWith=Yv,Z.values=Wc,Z.valuesIn=$v,Z.without=bv,Z.words=N0,Z.wrap=Dv,Z.xor=Cg,Z.xorBy=Ag,Z.xorWith=bg,Z.zip=Tg,Z.zipObject=Mg,Z.zipObjectDeep=Og,Z.zipWith=Rg,Z.entries=I0,Z.entriesIn=L0,Z.extend=P0,Z.extendWith=wf,wh(Z,Z),Z.add=Fp,Z.attempt=Sp,Z.camelCase=Jv,Z.capitalize=hp,Z.ceil=Sm,Z.clamp=Kv,Z.clone=M,Z.cloneDeep=Td,Z.cloneDeepWith=Md,Z.cloneWith=bd,Z.conformsTo=Od,Z.deburr=dp,Z.defaultTo=dm,Z.divide=Cm,Z.endsWith=em,Z.eq=Ho,Z.escape=tm,Z.escapeRegExp=rm,Z.every=Ug,Z.find=zg,Z.findIndex=Rr,Z.findKey=Yd,Z.findLast=Hg,Z.findLastIndex=qr,Z.findLastKey=$d,Z.floor=Am,Z.forEach=Mv,Z.forEachRight=Ov,Z.forIn=Kd,Z.forInRight=fa,Z.forOwn=qd,Z.forOwnRight=Qd,Z.get=Mh,Z.gt=Rd,Z.gte=Pd,Z.has=tp,Z.hasIn=Oh,Z.head=Ye,Z.identity=no,Z.includes=Xg,Z.indexOf=Ne,Z.inRange=qv,Z.invoke=ip,Z.isArguments=Eo,Z.isArray=pn,Z.isArrayBuffer=wd,Z.isArrayLike=Ba,Z.isArrayLikeObject=wi,Z.isBoolean=Id,Z.isBuffer=xs,Z.isDate=bh,Z.isElement=Nv,Z.isEmpty=kv,Z.isEqual=Ld,Z.isEqualWith=Dd,Z.isError=Th,Z.isFinite=Fd,Z.isFunction=Nu,Z.isInteger=Vc,Z.isLength=Mf,Z.isMap=Nd,Z.isMatch=Bv,Z.isMatchWith=kd,Z.isNaN=Zv,Z.isNative=Of,Z.isNil=Ss,Z.isNull=Uv,Z.isNumber=Bd,Z.isObject=xi,Z.isObjectLike=Ai,Z.isPlainObject=Rf,Z.isRegExp=tc,Z.isSafeInteger=Zd,Z.isSet=b0,Z.isString=Pf,Z.isSymbol=Za,Z.isTypedArray=rc,Z.isUndefined=Ud,Z.isWeakMap=T0,Z.isWeakSet=t_,Z.join=ue,Z.kebabCase=nm,Z.last=_e,Z.lastIndexOf=We,Z.lowerCase=im,Z.lowerFirst=am,Z.lt=Gv,Z.lte=zv,Z.max=bm,Z.maxBy=Tm,Z.mean=Np,Z.meanBy=kp,Z.min=Bp,Z.minBy=Zp,Z.stubArray=U0,Z.stubFalse=G0,Z.stubObject=ym,Z.stubString=Em,Z.stubTrue=xm,Z.multiply=Mm,Z.nth=de,Z.noConflict=B0,Z.noop=Ih,Z.now=bf,Z.pad=om,Z.padEnd=um,Z.padStart=sm,Z.parseInt=nc,Z.random=Qv,Z.reduce=Qg,Z.reduceRight=Jg,Z.repeat=ll,Z.replace=pp,Z.result=Wv,Z.round=Om,Z.runInContext=Fe,Z.sample=S0,Z.size=md,Z.snakeCase=vp,Z.some=sl,Z.sortedIndex=Ht,Z.sortedIndexBy=jt,Z.sortedIndexOf=qt,Z.sortedLastIndex=Gt,Z.sortedLastIndexBy=fr,Z.sortedLastIndexOf=rr,Z.startCase=mp,Z.startsWith=gp,Z.subtract=Rm,Z.sum=Pm,Z.sumBy=wm,Z.template=lm,Z.times=Ip,Z.toFinite=Cs,Z.toInteger=gn,Z.toLength=O0,Z.toLower=cm,Z.toNumber=xo,Z.toSafeInteger=Gd,Z.toString=Vn,Z.toUpper=fm,Z.trim=_p,Z.trimEnd=yp,Z.trimStart=Ep,Z.truncate=D0,Z.unescape=xp,Z.uniqueId=Dp,Z.upperCase=hm,Z.upperFirst=F0,Z.each=Mv,Z.eachRight=Ov,Z.first=Ye,wh(Z,function(){var u={};return vo(Z,function(c,v){In.call(Z.prototype,v)||(u[v]=c)}),u}(),{chain:!1}),Z.VERSION=$,un(["bind","bindKey","curry","curryRight","partial","partialRight"],function(u){Z[u].placeholder=Z}),un(["drop","take"],function(u,c){Jr.prototype[u]=function(v){v=v===A?1:bi(gn(v),0);var x=this.__filtered__&&!c?new Jr(this):this.clone();return x.__filtered__?x.__takeCount__=Xi(v,x.__takeCount__):x.__views__.push({size:Xi(v,$e),type:u+(x.__dir__<0?"Right":"")}),x},Jr.prototype[u+"Right"]=function(v){return this.reverse()[u](v).reverse()}}),un(["filter","map","takeWhile"],function(u,c){var v=c+1,x=v==Tt||v==p;Jr.prototype[u]=function(P){var Y=this.clone();return Y.__iteratees__.push({iteratee:Wr(P,3),type:v}),Y.__filtered__=Y.__filtered__||x,Y}}),un(["head","last"],function(u,c){var v="take"+(c?"Right":"");Jr.prototype[u]=function(){return this[v](1).value()[0]}}),un(["initial","tail"],function(u,c){var v="drop"+(c?"":"Right");Jr.prototype[u]=function(){return this.__filtered__?new Jr(this):this[v](1)}}),Jr.prototype.compact=function(){return this.filter(no)},Jr.prototype.find=function(u){return this.filter(u).head()},Jr.prototype.findLast=function(u){return this.reverse().find(u)},Jr.prototype.invokeMap=mn(function(u,c){return typeof u=="function"?new Jr(this):this.map(function(v){return Mu(v,u,c)})}),Jr.prototype.reject=function(u){return this.filter(jc(Wr(u)))},Jr.prototype.slice=function(u,c){u=gn(u);var v=this;return v.__filtered__&&(u>0||c<0)?new Jr(v):(u<0?v=v.takeRight(-u):u&&(v=v.drop(u)),c!==A&&(c=gn(c),v=c<0?v.dropRight(-c):v.take(c-u)),v)},Jr.prototype.takeRightWhile=function(u){return this.reverse().takeWhile(u).reverse()},Jr.prototype.toArray=function(){return this.take($e)},vo(Jr.prototype,function(u,c){var v=/^(?:filter|find|map|reject)|While$/.test(c),x=/^(?:head|last)$/.test(c),P=Z[x?"take"+(c=="last"?"Right":""):c],Y=x||/^find/.test(c);!P||(Z.prototype[c]=function(){var ce=this.__wrapped__,ye=x?[1]:arguments,Ze=ce instanceof Jr,It=ye[0],Lt=Ze||pn(ce),Vt=function(xn){var Mn=P.apply(Z,_a([xn],ye));return x&&_r?Mn[0]:Mn};Lt&&v&&typeof It=="function"&&It.length!=1&&(Ze=Lt=!1);var _r=this.__chain__,Lr=!!this.__actions__.length,Kr=Y&&!_r,yn=Ze&&!Lr;if(!Y&&Lt){ce=yn?ce:new Jr(this);var Yr=u.apply(ce,ye);return Yr.__actions__.push({func:E0,args:[Vt],thisArg:A}),new Yi(Yr,_r)}return Kr&&yn?u.apply(this,ye):(Yr=this.thru(Vt),Kr?x?Yr.value()[0]:Yr.value():Yr)})}),un(["pop","push","shift","sort","splice","unshift"],function(u){var c=qo[u],v=/^(?:push|sort|unshift)$/.test(u)?"tap":"thru",x=/^(?:pop|shift)$/.test(u);Z.prototype[u]=function(){var P=arguments;if(x&&!this.__chain__){var Y=this.value();return c.apply(pn(Y)?Y:[],P)}return this[v](function(ce){return c.apply(pn(ce)?ce:[],P)})}}),vo(Jr.prototype,function(u,c){var v=Z[c];if(v){var x=v.name+"";In.call(Hs,x)||(Hs[x]=[]),Hs[x].push({name:c,func:v})}}),Hs[ql(A,ke).name]=[{name:"wrapper",func:A}],Jr.prototype.clone=ih,Jr.prototype.reverse=i0,Jr.prototype.value=a0,Z.prototype.at=wg,Z.prototype.chain=Ig,Z.prototype.commit=Lg,Z.prototype.next=Dg,Z.prototype.plant=Ng,Z.prototype.reverse=kg,Z.prototype.toJSON=Z.prototype.valueOf=Z.prototype.value=Bg,Z.prototype.first=Z.prototype.head,Ju&&(Z.prototype[Ju]=Fg),Z},pc=fd();m._=pc,W=function(){return pc}.call(I,T,I,et),W!==A&&(et.exports=W)}).call(this)},30236:function(et,I,T){var W=T(42980),A=T(21463),$=A(function(k,L,U,re){W(k,L,U,re)});et.exports=$},50308:function(et){function I(){}et.exports=I},44908:function(et,I,T){var W=T(45652);function A($){return $&&$.length?W($):[]}et.exports=A},11700:function(et,I,T){var W=T(98805),A=W("toUpperCase");et.exports=A},58748:function(et,I,T){var W=T(49029),A=T(93157),$=T(79833),k=T(2757);function L(U,re,K){return U=$(U),re=K?void 0:re,re===void 0?A(U)?k(U):W(U):U.match(re)||[]}et.exports=L},28660:function(et,I,T){var W=T(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var A;(function($){(function(k){var L=typeof T.g=="object"?T.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),U=re($);typeof L.Reflect=="undefined"?L.Reflect=$:U=re(L.Reflect,U),k(U);function re(K,ne){return function(le,pe){typeof K[le]!="function"&&Object.defineProperty(K,le,{configurable:!0,writable:!0,value:pe}),ne&&ne(le,pe)}}})(function(k){var L=Object.prototype.hasOwnProperty,U=typeof Symbol=="function",re=U&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",K=U&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",le={__proto__:[]}instanceof Array,pe=!ne&&!le,xe={create:ne?function(){return fu(Object.create(null))}:le?function(){return fu({__proto__:null})}:function(){return fu({})},has:pe?function(qe,dt){return L.call(qe,dt)}:function(qe,dt){return dt in qe},get:pe?function(qe,dt){return L.call(qe,dt)?qe[dt]:void 0}:function(qe,dt){return qe[dt]}},it=Object.getPrototypeOf(Function),nt=typeof W=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",we=!nt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:j(),Ke=!nt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Hr(),ke=!nt&&typeof WeakMap=="function"?WeakMap:ri(),Oe=new ke;function Re(qe,dt,Nt,ar){if(gr(Nt)){if(!En(qe))throw new TypeError;if(!Fn(dt))throw new TypeError;return St(qe,dt)}else{if(!En(qe))throw new TypeError;if(!Br(dt))throw new TypeError;if(!Br(ar)&&!gr(ar)&&!sn(ar))throw new TypeError;return sn(ar)&&(ar=void 0),Nt=rn(Nt),Tt(qe,dt,Nt,ar)}}k("decorate",Re);function Je(qe,dt){function Nt(ar,yr){if(!Br(ar))throw new TypeError;if(!gr(yr)&&!si(yr))throw new TypeError;Ge(qe,dt,ar,yr)}return Nt}k("metadata",Je);function O(qe,dt,Nt,ar){if(!Br(Nt))throw new TypeError;return gr(ar)||(ar=rn(ar)),Ge(qe,dt,Nt,ar)}k("defineMetadata",O);function at(qe,dt,Nt){if(!Br(dt))throw new TypeError;return gr(Nt)||(Nt=rn(Nt)),p(qe,dt,Nt)}k("hasMetadata",at);function Pe(qe,dt,Nt){if(!Br(dt))throw new TypeError;return gr(Nt)||(Nt=rn(Nt)),B(qe,dt,Nt)}k("hasOwnMetadata",Pe);function ve(qe,dt,Nt){if(!Br(dt))throw new TypeError;return gr(Nt)||(Nt=rn(Nt)),be(qe,dt,Nt)}k("getMetadata",ve);function Be(qe,dt,Nt){if(!Br(dt))throw new TypeError;return gr(Nt)||(Nt=rn(Nt)),Te(qe,dt,Nt)}k("getOwnMetadata",Be);function Ae(qe,dt){if(!Br(qe))throw new TypeError;return gr(dt)||(dt=rn(dt)),$e(qe,dt)}k("getMetadataKeys",Ae);function ct(qe,dt){if(!Br(qe))throw new TypeError;return gr(dt)||(dt=rn(dt)),Mt(qe,dt)}k("getOwnMetadataKeys",ct);function ut(qe,dt,Nt){if(!Br(dt))throw new TypeError;gr(Nt)||(Nt=rn(Nt));var ar=Q(dt,Nt,!1);if(gr(ar)||!ar.delete(qe))return!1;if(ar.size>0)return!0;var yr=Oe.get(dt);return yr.delete(Nt),yr.size>0||Oe.delete(dt),!0}k("deleteMetadata",ut);function St(qe,dt){for(var Nt=qe.length-1;Nt>=0;--Nt){var ar=qe[Nt],yr=ar(dt);if(!gr(yr)&&!sn(yr)){if(!Fn(yr))throw new TypeError;dt=yr}}return dt}function Tt(qe,dt,Nt,ar){for(var yr=qe.length-1;yr>=0;--yr){var Tr=qe[yr],$r=Tr(dt,Nt,ar);if(!gr($r)&&!sn($r)){if(!Br($r))throw new TypeError;ar=$r}}return ar}function Q(qe,dt,Nt){var ar=Oe.get(qe);if(gr(ar)){if(!Nt)return;ar=new we,Oe.set(qe,ar)}var yr=ar.get(dt);if(gr(yr)){if(!Nt)return;yr=new we,ar.set(dt,yr)}return yr}function p(qe,dt,Nt){var ar=B(qe,dt,Nt);if(ar)return!0;var yr=Aa(dt);return sn(yr)?!1:p(qe,yr,Nt)}function B(qe,dt,Nt){var ar=Q(dt,Nt,!1);return gr(ar)?!1:Jn(ar.has(qe))}function be(qe,dt,Nt){var ar=B(qe,dt,Nt);if(ar)return Te(qe,dt,Nt);var yr=Aa(dt);if(!sn(yr))return be(qe,yr,Nt)}function Te(qe,dt,Nt){var ar=Q(dt,Nt,!1);if(!gr(ar))return ar.get(qe)}function Ge(qe,dt,Nt,ar){var yr=Q(Nt,ar,!0);yr.set(qe,dt)}function $e(qe,dt){var Nt=Mt(qe,dt),ar=Aa(qe);if(ar===null)return Nt;var yr=$e(ar,dt);if(yr.length<=0)return Nt;if(Nt.length<=0)return yr;for(var Tr=new Ke,$r=[],Vr=0,vr=Nt;Vr<vr.length;Vr++){var ln=vr[Vr],fn=Tr.has(ln);fn||(Tr.add(ln),$r.push(ln))}for(var Ni=0,hu=yr;Ni<hu.length;Ni++){var ln=hu[Ni],fn=Tr.has(ln);fn||(Tr.add(ln),$r.push(ln))}return $r}function Mt(qe,dt){var Nt=[],ar=Q(qe,dt,!1);if(gr(ar))return Nt;for(var yr=ar.keys(),Tr=Nn(yr),$r=0;;){var Vr=On(Tr);if(!Vr)return Nt.length=$r,Nt;var vr=_n(Vr);try{Nt[$r]=vr}catch(ln){try{cn(Tr)}finally{throw ln}}$r++}}function Sr(qe){if(qe===null)return 1;switch(typeof qe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return qe===null?1:6;default:return 6}}function gr(qe){return qe===void 0}function sn(qe){return qe===null}function Cr(qe){return typeof qe=="symbol"}function Br(qe){return typeof qe=="object"?qe!==null:typeof qe=="function"}function Zr(qe,dt){switch(Sr(qe)){case 0:return qe;case 1:return qe;case 2:return qe;case 3:return qe;case 4:return qe;case 5:return qe}var Nt=dt===3?"string":dt===5?"number":"default",ar=zn(qe,re);if(ar!==void 0){var yr=ar.call(qe,Nt);if(Br(yr))throw new TypeError;return yr}return kr(qe,Nt==="default"?"number":Nt)}function kr(qe,dt){if(dt==="string"){var Nt=qe.toString;if(Gr(Nt)){var ar=Nt.call(qe);if(!Br(ar))return ar}var yr=qe.valueOf;if(Gr(yr)){var ar=yr.call(qe);if(!Br(ar))return ar}}else{var yr=qe.valueOf;if(Gr(yr)){var ar=yr.call(qe);if(!Br(ar))return ar}var Tr=qe.toString;if(Gr(Tr)){var ar=Tr.call(qe);if(!Br(ar))return ar}}throw new TypeError}function Jn(qe){return!!qe}function Tn(qe){return""+qe}function rn(qe){var dt=Zr(qe,3);return Cr(dt)?dt:Tn(dt)}function En(qe){return Array.isArray?Array.isArray(qe):qe instanceof Object?qe instanceof Array:Object.prototype.toString.call(qe)==="[object Array]"}function Gr(qe){return typeof qe=="function"}function Fn(qe){return typeof qe=="function"}function si(qe){switch(Sr(qe)){case 3:return!0;case 4:return!0;default:return!1}}function zn(qe,dt){var Nt=qe[dt];if(Nt!=null){if(!Gr(Nt))throw new TypeError;return Nt}}function Nn(qe){var dt=zn(qe,K);if(!Gr(dt))throw new TypeError;var Nt=dt.call(qe);if(!Br(Nt))throw new TypeError;return Nt}function _n(qe){return qe.value}function On(qe){var dt=qe.next();return dt.done?!1:dt}function cn(qe){var dt=qe.return;dt&&dt.call(qe)}function Aa(qe){var dt=Object.getPrototypeOf(qe);if(typeof qe!="function"||qe===it||dt!==it)return dt;var Nt=qe.prototype,ar=Nt&&Object.getPrototypeOf(Nt);if(ar==null||ar===Object.prototype)return dt;var yr=ar.constructor;return typeof yr!="function"||yr===qe?dt:yr}function j(){var qe={},dt=[],Nt=function(){function $r(Vr,vr,ln){this._index=0,this._keys=Vr,this._values=vr,this._selector=ln}return $r.prototype["@@iterator"]=function(){return this},$r.prototype[K]=function(){return this},$r.prototype.next=function(){var Vr=this._index;if(Vr>=0&&Vr<this._keys.length){var vr=this._selector(this._keys[Vr],this._values[Vr]);return Vr+1>=this._keys.length?(this._index=-1,this._keys=dt,this._values=dt):this._index++,{value:vr,done:!1}}return{value:void 0,done:!0}},$r.prototype.throw=function(Vr){throw this._index>=0&&(this._index=-1,this._keys=dt,this._values=dt),Vr},$r.prototype.return=function(Vr){return this._index>=0&&(this._index=-1,this._keys=dt,this._values=dt),{value:Vr,done:!0}},$r}();return function(){function $r(){this._keys=[],this._values=[],this._cacheKey=qe,this._cacheIndex=-2}return Object.defineProperty($r.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),$r.prototype.has=function(Vr){return this._find(Vr,!1)>=0},$r.prototype.get=function(Vr){var vr=this._find(Vr,!1);return vr>=0?this._values[vr]:void 0},$r.prototype.set=function(Vr,vr){var ln=this._find(Vr,!0);return this._values[ln]=vr,this},$r.prototype.delete=function(Vr){var vr=this._find(Vr,!1);if(vr>=0){for(var ln=this._keys.length,fn=vr+1;fn<ln;fn++)this._keys[fn-1]=this._keys[fn],this._values[fn-1]=this._values[fn];return this._keys.length--,this._values.length--,Vr===this._cacheKey&&(this._cacheKey=qe,this._cacheIndex=-2),!0}return!1},$r.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=qe,this._cacheIndex=-2},$r.prototype.keys=function(){return new Nt(this._keys,this._values,ar)},$r.prototype.values=function(){return new Nt(this._keys,this._values,yr)},$r.prototype.entries=function(){return new Nt(this._keys,this._values,Tr)},$r.prototype["@@iterator"]=function(){return this.entries()},$r.prototype[K]=function(){return this.entries()},$r.prototype._find=function(Vr,vr){return this._cacheKey!==Vr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Vr)),this._cacheIndex<0&&vr&&(this._cacheIndex=this._keys.length,this._keys.push(Vr),this._values.push(void 0)),this._cacheIndex},$r}();function ar($r,Vr){return $r}function yr($r,Vr){return Vr}function Tr($r,Vr){return[$r,Vr]}}function Hr(){return function(){function qe(){this._map=new we}return Object.defineProperty(qe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),qe.prototype.has=function(dt){return this._map.has(dt)},qe.prototype.add=function(dt){return this._map.set(dt,dt),this},qe.prototype.delete=function(dt){return this._map.delete(dt)},qe.prototype.clear=function(){this._map.clear()},qe.prototype.keys=function(){return this._map.keys()},qe.prototype.values=function(){return this._map.values()},qe.prototype.entries=function(){return this._map.entries()},qe.prototype["@@iterator"]=function(){return this.keys()},qe.prototype[K]=function(){return this.keys()},qe}()}function ri(){var qe=16,dt=xe.create(),Nt=ar();return function(){function vr(){this._key=ar()}return vr.prototype.has=function(ln){var fn=yr(ln,!1);return fn!==void 0?xe.has(fn,this._key):!1},vr.prototype.get=function(ln){var fn=yr(ln,!1);return fn!==void 0?xe.get(fn,this._key):void 0},vr.prototype.set=function(ln,fn){var Ni=yr(ln,!0);return Ni[this._key]=fn,this},vr.prototype.delete=function(ln){var fn=yr(ln,!1);return fn!==void 0?delete fn[this._key]:!1},vr.prototype.clear=function(){this._key=ar()},vr}();function ar(){var vr;do vr="@@WeakMap@@"+Vr();while(xe.has(dt,vr));return dt[vr]=!0,vr}function yr(vr,ln){if(!L.call(vr,Nt)){if(!ln)return;Object.defineProperty(vr,Nt,{value:xe.create()})}return vr[Nt]}function Tr(vr,ln){for(var fn=0;fn<ln;++fn)vr[fn]=Math.random()*255|0;return vr}function $r(vr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(vr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(vr)):Tr(new Uint8Array(vr),vr):Tr(new Array(vr),vr)}function Vr(){var vr=$r(qe);vr[6]=vr[6]&79|64,vr[8]=vr[8]&191|128;for(var ln="",fn=0;fn<qe;++fn){var Ni=vr[fn];(fn===4||fn===6||fn===8)&&(ln+="-"),Ni<16&&(ln+="0"),ln+=Ni.toString(16).toLowerCase()}return ln}}function fu(qe){return qe.__=void 0,delete qe.__,qe}})})(A||(A={}))},69848:function(et){(function(I,T){et.exports=T()})(this,function(){"use strict";function I(Pe,ve,Be,Ae,ct,ut){if(!(ct-Ae<=Be)){var St=Ae+ct>>1;T(Pe,ve,St,Ae,ct,ut%2),I(Pe,ve,Be,Ae,St-1,ut+1),I(Pe,ve,Be,St+1,ct,ut+1)}}function T(Pe,ve,Be,Ae,ct,ut){for(;ct>Ae;){if(ct-Ae>600){var St=ct-Ae+1,Tt=Be-Ae+1,Q=Math.log(St),p=.5*Math.exp(2*Q/3),B=.5*Math.sqrt(Q*p*(St-p)/St)*(Tt-St/2<0?-1:1),be=Math.max(Ae,Math.floor(Be-Tt*p/St+B)),Te=Math.min(ct,Math.floor(Be+(St-Tt)*p/St+B));T(Pe,ve,Be,be,Te,ut)}var Ge=ve[2*Be+ut],$e=Ae,Mt=ct;for(W(Pe,ve,Ae,Be),ve[2*ct+ut]>Ge&&W(Pe,ve,Ae,ct);$e<Mt;){for(W(Pe,ve,$e,Mt),$e++,Mt--;ve[2*$e+ut]<Ge;)$e++;for(;ve[2*Mt+ut]>Ge;)Mt--}ve[2*Ae+ut]===Ge?W(Pe,ve,Ae,Mt):(Mt++,W(Pe,ve,Mt,ct)),Mt<=Be&&(Ae=Mt+1),Be<=Mt&&(ct=Mt-1)}}function W(Pe,ve,Be,Ae){A(Pe,Be,Ae),A(ve,2*Be,2*Ae),A(ve,2*Be+1,2*Ae+1)}function A(Pe,ve,Be){var Ae=Pe[ve];Pe[ve]=Pe[Be],Pe[Be]=Ae}function $(Pe,ve,Be,Ae,ct,ut,St){for(var Tt=[0,Pe.length-1,0],Q=[],p,B;Tt.length;){var be=Tt.pop(),Te=Tt.pop(),Ge=Tt.pop();if(Te-Ge<=St){for(var $e=Ge;$e<=Te;$e++)p=ve[2*$e],B=ve[2*$e+1],p>=Be&&p<=ct&&B>=Ae&&B<=ut&&Q.push(Pe[$e]);continue}var Mt=Math.floor((Ge+Te)/2);p=ve[2*Mt],B=ve[2*Mt+1],p>=Be&&p<=ct&&B>=Ae&&B<=ut&&Q.push(Pe[Mt]);var Sr=(be+1)%2;(be===0?Be<=p:Ae<=B)&&(Tt.push(Ge),Tt.push(Mt-1),Tt.push(Sr)),(be===0?ct>=p:ut>=B)&&(Tt.push(Mt+1),Tt.push(Te),Tt.push(Sr))}return Q}function k(Pe,ve,Be,Ae,ct,ut){for(var St=[0,Pe.length-1,0],Tt=[],Q=ct*ct;St.length;){var p=St.pop(),B=St.pop(),be=St.pop();if(B-be<=ut){for(var Te=be;Te<=B;Te++)L(ve[2*Te],ve[2*Te+1],Be,Ae)<=Q&&Tt.push(Pe[Te]);continue}var Ge=Math.floor((be+B)/2),$e=ve[2*Ge],Mt=ve[2*Ge+1];L($e,Mt,Be,Ae)<=Q&&Tt.push(Pe[Ge]);var Sr=(p+1)%2;(p===0?Be-ct<=$e:Ae-ct<=Mt)&&(St.push(be),St.push(Ge-1),St.push(Sr)),(p===0?Be+ct>=$e:Ae+ct>=Mt)&&(St.push(Ge+1),St.push(B),St.push(Sr))}return Tt}function L(Pe,ve,Be,Ae){var ct=Pe-Be,ut=ve-Ae;return ct*ct+ut*ut}var U=function(Pe){return Pe[0]},re=function(Pe){return Pe[1]},K=function(ve,Be,Ae,ct,ut){Be===void 0&&(Be=U),Ae===void 0&&(Ae=re),ct===void 0&&(ct=64),ut===void 0&&(ut=Float64Array),this.nodeSize=ct,this.points=ve;for(var St=ve.length<65536?Uint16Array:Uint32Array,Tt=this.ids=new St(ve.length),Q=this.coords=new ut(ve.length*2),p=0;p<ve.length;p++)Tt[p]=p,Q[2*p]=Be(ve[p]),Q[2*p+1]=Ae(ve[p]);I(Tt,Q,ct,0,Tt.length-1,0)};K.prototype.range=function(ve,Be,Ae,ct){return $(this.ids,this.coords,ve,Be,Ae,ct,this.nodeSize)},K.prototype.within=function(ve,Be,Ae){return k(this.ids,this.coords,ve,Be,Ae,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Pe){return Pe}},le=Math.fround||function(Pe){return function(ve){return Pe[0]=+ve,Pe[0]}}(new Float32Array(1)),pe=function(ve){this.options=Je(Object.create(ne),ve),this.trees=new Array(this.options.maxZoom+1)};pe.prototype.load=function(ve){var Be=this.options,Ae=Be.log,ct=Be.minZoom,ut=Be.maxZoom,St=Be.nodeSize;Ae&&console.time("total time");var Tt="prepare "+ve.length+" points";Ae&&console.time(Tt),this.points=ve;for(var Q=[],p=0;p<ve.length;p++)!ve[p].geometry||Q.push(it(ve[p],p));this.trees[ut+1]=new K(Q,O,at,St,Float32Array),Ae&&console.timeEnd(Tt);for(var B=ut;B>=ct;B--){var be=+Date.now();Q=this._cluster(Q,B),this.trees[B]=new K(Q,O,at,St,Float32Array),Ae&&console.log("z%d: %d clusters in %dms",B,Q.length,+Date.now()-be)}return Ae&&console.timeEnd("total time"),this},pe.prototype.getClusters=function(ve,Be){var Ae=((ve[0]+180)%360+360)%360-180,ct=Math.max(-90,Math.min(90,ve[1])),ut=ve[2]===180?180:((ve[2]+180)%360+360)%360-180,St=Math.max(-90,Math.min(90,ve[3]));if(ve[2]-ve[0]>=360)Ae=-180,ut=180;else if(Ae>ut){var Tt=this.getClusters([Ae,ct,180,St],Be),Q=this.getClusters([-180,ct,ut,St],Be);return Tt.concat(Q)}for(var p=this.trees[this._limitZoom(Be)],B=p.range(Ke(Ae),ke(St),Ke(ut),ke(ct)),be=[],Te=0,Ge=B;Te<Ge.length;Te+=1){var $e=Ge[Te],Mt=p.points[$e];be.push(Mt.numPoints?nt(Mt):this.points[Mt.index])}return be},pe.prototype.getChildren=function(ve){var Be=this._getOriginId(ve),Ae=this._getOriginZoom(ve),ct="No cluster with the specified id.",ut=this.trees[Ae];if(!ut)throw new Error(ct);var St=ut.points[Be];if(!St)throw new Error(ct);for(var Tt=this.options.radius/(this.options.extent*Math.pow(2,Ae-1)),Q=ut.within(St.x,St.y,Tt),p=[],B=0,be=Q;B<be.length;B+=1){var Te=be[B],Ge=ut.points[Te];Ge.parentId===ve&&p.push(Ge.numPoints?nt(Ge):this.points[Ge.index])}if(p.length===0)throw new Error(ct);return p},pe.prototype.getLeaves=function(ve,Be,Ae){Be=Be||10,Ae=Ae||0;var ct=[];return this._appendLeaves(ct,ve,Be,Ae,0),ct},pe.prototype.getTile=function(ve,Be,Ae){var ct=this.trees[this._limitZoom(ve)],ut=Math.pow(2,ve),St=this.options,Tt=St.extent,Q=St.radius,p=Q/Tt,B=(Ae-p)/ut,be=(Ae+1+p)/ut,Te={features:[]};return this._addTileFeatures(ct.range((Be-p)/ut,B,(Be+1+p)/ut,be),ct.points,Be,Ae,ut,Te),Be===0&&this._addTileFeatures(ct.range(1-p/ut,B,1,be),ct.points,ut,Ae,ut,Te),Be===ut-1&&this._addTileFeatures(ct.range(0,B,p/ut,be),ct.points,-1,Ae,ut,Te),Te.features.length?Te:null},pe.prototype.getClusterExpansionZoom=function(ve){for(var Be=this._getOriginZoom(ve)-1;Be<=this.options.maxZoom;){var Ae=this.getChildren(ve);if(Be++,Ae.length!==1)break;ve=Ae[0].properties.cluster_id}return Be},pe.prototype._appendLeaves=function(ve,Be,Ae,ct,ut){for(var St=this.getChildren(Be),Tt=0,Q=St;Tt<Q.length;Tt+=1){var p=Q[Tt],B=p.properties;if(B&&B.cluster?ut+B.point_count<=ct?ut+=B.point_count:ut=this._appendLeaves(ve,B.cluster_id,Ae,ct,ut):ut<ct?ut++:ve.push(p),ve.length===Ae)break}return ut},pe.prototype._addTileFeatures=function(ve,Be,Ae,ct,ut,St){for(var Tt=0,Q=ve;Tt<Q.length;Tt+=1){var p=Q[Tt],B=Be[p],be=B.numPoints,Te=void 0,Ge=void 0,$e=void 0;if(be)Te=we(B),Ge=B.x,$e=B.y;else{var Mt=this.points[B.index];Te=Mt.properties,Ge=Ke(Mt.geometry.coordinates[0]),$e=ke(Mt.geometry.coordinates[1])}var Sr={type:1,geometry:[[Math.round(this.options.extent*(Ge*ut-Ae)),Math.round(this.options.extent*($e*ut-ct))]],tags:Te},gr=void 0;be?gr=B.id:this.options.generateId?gr=B.index:this.points[B.index].id&&(gr=this.points[B.index].id),gr!==void 0&&(Sr.id=gr),St.features.push(Sr)}},pe.prototype._limitZoom=function(ve){return Math.max(this.options.minZoom,Math.min(+ve,this.options.maxZoom+1))},pe.prototype._cluster=function(ve,Be){for(var Ae=[],ct=this.options,ut=ct.radius,St=ct.extent,Tt=ct.reduce,Q=ct.minPoints,p=ut/(St*Math.pow(2,Be)),B=0;B<ve.length;B++){var be=ve[B];if(!(be.zoom<=Be)){be.zoom=Be;for(var Te=this.trees[Be+1],Ge=Te.within(be.x,be.y,p),$e=be.numPoints||1,Mt=$e,Sr=0,gr=Ge;Sr<gr.length;Sr+=1){var sn=gr[Sr],Cr=Te.points[sn];Cr.zoom>Be&&(Mt+=Cr.numPoints||1)}if(Mt>$e&&Mt>=Q){for(var Br=be.x*$e,Zr=be.y*$e,kr=Tt&&$e>1?this._map(be,!0):null,Jn=(B<<5)+(Be+1)+this.points.length,Tn=0,rn=Ge;Tn<rn.length;Tn+=1){var En=rn[Tn],Gr=Te.points[En];if(!(Gr.zoom<=Be)){Gr.zoom=Be;var Fn=Gr.numPoints||1;Br+=Gr.x*Fn,Zr+=Gr.y*Fn,Gr.parentId=Jn,Tt&&(kr||(kr=this._map(be,!0)),Tt(kr,this._map(Gr)))}}be.parentId=Jn,Ae.push(xe(Br/Mt,Zr/Mt,Jn,Mt,kr))}else if(Ae.push(be),Mt>1)for(var si=0,zn=Ge;si<zn.length;si+=1){var Nn=zn[si],_n=Te.points[Nn];_n.zoom<=Be||(_n.zoom=Be,Ae.push(_n))}}}return Ae},pe.prototype._getOriginId=function(ve){return ve-this.points.length>>5},pe.prototype._getOriginZoom=function(ve){return(ve-this.points.length)%32},pe.prototype._map=function(ve,Be){if(ve.numPoints)return Be?Je({},ve.properties):ve.properties;var Ae=this.points[ve.index].properties,ct=this.options.map(Ae);return Be&&ct===Ae?Je({},ct):ct};function xe(Pe,ve,Be,Ae,ct){return{x:le(Pe),y:le(ve),zoom:Infinity,id:Be,parentId:-1,numPoints:Ae,properties:ct}}function it(Pe,ve){var Be=Pe.geometry.coordinates,Ae=Be[0],ct=Be[1];return{x:le(Ke(Ae)),y:le(ke(ct)),zoom:Infinity,index:ve,parentId:-1}}function nt(Pe){return{type:"Feature",id:Pe.id,properties:we(Pe),geometry:{type:"Point",coordinates:[Oe(Pe.x),Re(Pe.y)]}}}function we(Pe){var ve=Pe.numPoints,Be=ve>=1e4?Math.round(ve/1e3)+"k":ve>=1e3?Math.round(ve/100)/10+"k":ve;return Je(Je({},Pe.properties),{cluster:!0,cluster_id:Pe.id,point_count:ve,point_count_abbreviated:Be})}function Ke(Pe){return Pe/360+.5}function ke(Pe){var ve=Math.sin(Pe*Math.PI/180),Be=.5-.25*Math.log((1+ve)/(1-ve))/Math.PI;return Be<0?0:Be>1?1:Be}function Oe(Pe){return(Pe-.5)*360}function Re(Pe){var ve=(180-Pe*360)*Math.PI/180;return 360*Math.atan(Math.exp(ve))/Math.PI-90}function Je(Pe,ve){for(var Be in ve)Pe[Be]=ve[Be];return Pe}function O(Pe){return Pe.x}function at(Pe){return Pe.y}return pe})},75752:function(et){et.exports.RADIUS=6378137,et.exports.FLATTENING=1/298.257223563,et.exports.POLAR_RADIUS=63567523142e-4}}]);
